/*! For license information please see main.4c494121.js.LICENSE.txt */
(()=>{var e={9194:e=>{e.exports.p$=function(e){const t=[];if(e.dataTransfer.items)for(let n=0;n<e.dataTransfer.items.length;n++){const r=e.dataTransfer.items[n];"file"===r.kind&&t.push(r.getAsFile())}else for(let n=0;n<e.dataTransfer.files.length;n++)t.push(e.dataTransfer.files.item(n));return t}},405:e=>{"use strict";e.exports=function(e){if(e.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var r=0;r<e.length;r++){var i=e.charAt(r),o=i.charCodeAt(0);if(255!==t[o])throw new TypeError(i+" is ambiguous");t[o]=r}var s=e.length,a=e.charAt(0),l=Math.log(s)/Math.log(256),c=Math.log(256)/Math.log(s);function u(e){if("string"!==typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var n=0;if(" "!==e[n]){for(var r=0,i=0;e[n]===a;)r++,n++;for(var o=(e.length-n)*l+1>>>0,c=new Uint8Array(o);e[n];){var u=t[e.charCodeAt(n)];if(255===u)return;for(var h=0,d=o-1;(0!==u||h<i)&&-1!==d;d--,h++)u+=s*c[d]>>>0,c[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=h,n++}if(" "!==e[n]){for(var f=o-i;f!==o&&0===c[f];)f++;for(var p=new Uint8Array(r+(o-f)),g=r;f!==o;)p[g++]=c[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,i=0,o=t.length;i!==o&&0===t[i];)i++,n++;for(var l=(o-i)*c+1>>>0,u=new Uint8Array(l);i!==o;){for(var h=t[i],d=0,f=l-1;(0!==h||d<r)&&-1!==f;f--,d++)h+=256*u[f]>>>0,u[f]=h%s>>>0,h=h/s>>>0;if(0!==h)throw new Error("Non-zero carry");r=d,i++}for(var p=l-r;p!==l&&0===u[p];)p++;for(var g=a.repeat(n);p<l;++p)g+=e.charAt(u[p]);return g},decodeUnsafe:u,decode:function(e){var t=u(e);if(t)return t;throw new Error("Non-base"+s+" character")}}}},8233:(e,t)=>{"use strict";const n=Math.exp;e.exports=function(e){if("number"!==typeof e)throw new Error("must provide a timespan to the moving average constructor");if(e<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");let t,r,i=0,o=0,s=0,a={};return a.push=function(a,l){if(r){const c=1-n(-(a-r)/e),u=l-t;t=c*l+(1-c)*t,i=(1-c)*(i+u*(c*u)),o=Math.sqrt(i),s=t+c*u}else t=l;r=a},a.movingAverage=function(){return t},a.variance=function(){return i},a.deviation=function(){return o},a.forecast=function(){return s},a}},6119:(e,t,n)=>{"use strict";const{fromCallback:r}=n(8573),i=n(7155),{getCallback:o,getOptions:s}=n(8216),a=Symbol("promise"),l=Symbol("status"),c=Symbol("operations"),u=Symbol("finishClose"),h=Symbol("closeCallbacks");t.AbstractChainedBatch=class{constructor(e){if("object"!==typeof e||null===e){throw new TypeError("The first argument must be an abstract-level database, received ".concat(null===e?"null":typeof e))}this[c]=[],this[h]=[],this[l]="open",this[u]=this[u].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[c].length}put(e,t,n){if("open"!==this[l])throw new i("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const r=this.db._checkKey(e)||this.db._checkValue(t);if(r)throw r;const o=n&&null!=n.sublevel?n.sublevel:this.db,s=n,a=o.keyEncoding(n&&n.keyEncoding),u=o.valueEncoding(n&&n.valueEncoding),h=a.format;n={...n,keyEncoding:h,valueEncoding:u.format},o!==this.db&&(n.sublevel=null);const d=o.prefixKey(a.encode(e),h),f=u.encode(t);return this._put(d,f,n),this[c].push({...s,type:"put",key:e,value:t}),this}_put(e,t,n){}del(e,t){if("open"!==this[l])throw new i("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const n=this.db._checkKey(e);if(n)throw n;const r=t&&null!=t.sublevel?t.sublevel:this.db,o=t,s=r.keyEncoding(t&&t.keyEncoding),a=s.format;return t={...t,keyEncoding:a},r!==this.db&&(t.sublevel=null),this._del(r.prefixKey(s.encode(e),a),t),this[c].push({...o,type:"del",key:e}),this}_del(e,t){}clear(){if("open"!==this[l])throw new i("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[c]=[],this}_clear(){}write(e,t){return t=o(e,t),t=r(t,a),e=s(e),"open"!==this[l]?this.nextTick(t,new i("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):0===this.length?this.close(t):(this[l]="writing",this._write(e,(e=>{this[l]="closing",this[h].push((()=>t(e))),e||this.db.emit("batch",this[c]),this._close(this[u])}))),t[a]}_write(e,t){}close(e){return e=r(e,a),"closing"===this[l]?this[h].push(e):"closed"===this[l]?this.nextTick(e):(this[h].push(e),"writing"!==this[l]&&(this[l]="closing",this._close(this[u]))),e[a]}_close(e){this.nextTick(e)}[u](){this[l]="closed",this.db.detachResource(this);const e=this[h];this[h]=[];for(const t of e)t()}}},5822:(e,t,n)=>{"use strict";const{fromCallback:r}=n(8573),i=n(7155),{getOptions:o,getCallback:s}=n(8216),a=Symbol("promise"),l=Symbol("callback"),c=Symbol("working"),u=Symbol("handleOne"),h=Symbol("handleMany"),d=Symbol("autoClose"),f=Symbol("finishWork"),p=Symbol("returnMany"),g=Symbol("closing"),y=Symbol("handleClose"),v=Symbol("closed"),m=Symbol("closeCallbacks"),w=Symbol("keyEncoding"),b=Symbol("valueEncoding"),E=Symbol("abortOnClose"),_=Symbol("legacy"),S=Symbol("keys"),k=Symbol("values"),A=Symbol("limit"),I=Symbol("count"),T=Object.freeze({}),R=()=>{};let C=!1;class x{constructor(e,t,n){if("object"!==typeof e||null===e){throw new TypeError("The first argument must be an abstract-level database, received ".concat(null===e?"null":typeof e))}if("object"!==typeof t||null===t)throw new TypeError("The second argument must be an options object");this[v]=!1,this[m]=[],this[c]=!1,this[g]=!1,this[d]=!1,this[l]=null,this[u]=this[u].bind(this),this[h]=this[h].bind(this),this[y]=this[y].bind(this),this[w]=t[w],this[b]=t[b],this[_]=n,this[A]=Number.isInteger(t.limit)&&t.limit>=0?t.limit:1/0,this[I]=0,this[E]=!!t.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[I]}get limit(){return this[A]}next(e){let t;if(void 0===e)t=new Promise(((t,n)=>{e=(e,r,i)=>{e?n(e):this[_]?void 0===r&&void 0===i?t():t([r,i]):t(r)}}));else if("function"!==typeof e)throw new TypeError("Callback must be a function");return this[g]?this.nextTick(e,new i("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[c]?this.nextTick(e,new i("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[c]=!0,this[l]=e,this[I]>=this[A]?this.nextTick(this[u],null):this._next(this[u])),t}_next(e){this.nextTick(e)}nextv(e,t,n){return n=s(t,n),n=r(n,a),t=o(t,T),Number.isInteger(e)?(this[g]?this.nextTick(n,new i("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[c]?this.nextTick(n,new i("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[A]<1/0&&(e=Math.min(e,this[A]-this[I])),this[c]=!0,this[l]=n,e<=0?this.nextTick(this[h],null,[]):this._nextv(e,t,this[h])),n[a]):(this.nextTick(n,new TypeError("The first argument 'size' must be an integer")),n[a])}_nextv(e,t,n){const r=[],i=(t,o,s)=>t?n(t):(this[_]?void 0===o&&void 0===s:void 0===o)?n(null,r):(r.push(this[_]?[o,s]:o),void(r.length===e?n(null,r):this._next(i)));this._next(i)}all(e,t){return t=s(e,t),t=r(t,a),e=o(e,T),this[g]?this.nextTick(t,new i("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[c]?this.nextTick(t,new i("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[c]=!0,this[l]=t,this[d]=!0,this[I]>=this[A]?this.nextTick(this[h],null,[]):this._all(e,this[h])),t[a]}_all(e,t){let n=this[I];const r=[],i=()=>{const e=this[A]<1/0?Math.min(1e3,this[A]-n):1e3;e<=0?this.nextTick(t,null,r):this._nextv(e,T,o)},o=(e,o)=>{e?t(e):0===o.length?t(null,r):(r.push.apply(r,o),n+=o.length,i())};i()}[f](){const e=this[l];return this[E]&&null===e?R:(this[c]=!1,this[l]=null,this[g]&&this._close(this[y]),e)}[p](e,t,n){this[d]?this.close(e.bind(null,t,n)):e(t,n)}seek(e,t){if(t=o(t,T),this[g]);else{if(this[c])throw new i("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{const n=this.db.keyEncoding(t.keyEncoding||this[w]),r=n.format;t.keyEncoding!==r&&(t={...t,keyEncoding:r});const i=this.db.prefixKey(n.encode(e),r);this._seek(i,t)}}}_seek(e,t){throw new i("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){if(e=r(e,a),this[v])this.nextTick(e);else if(this[g])this[m].push(e);else if(this[g]=!0,this[m].push(e),this[c]){if(this[E]){this[f]()(new i("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))}}else this._close(this[y]);return e[a]}_close(e){this.nextTick(e)}[y](){this[v]=!0,this.db.detachResource(this);const e=this[m];this[m]=[];for(const t of e)t()}async*[Symbol.asyncIterator](){try{let e;for(;void 0!==(e=await this.next());)yield e}finally{this[v]||await this.close()}}}class P extends x{constructor(e,t){super(e,t,!0),this[S]=!1!==t.keys,this[k]=!1!==t.values}[u](e,t,n){const r=this[f]();if(e)return r(e);try{t=this[S]&&void 0!==t?this[w].decode(t):void 0,n=this[k]&&void 0!==n?this[b].decode(n):void 0}catch(e){return r(new D("entry",e))}void 0===t&&void 0===n||this[I]++,r(null,t,n)}[h](e,t){const n=this[f]();if(e)return this[p](n,e);try{for(const e of t){const t=e[0],n=e[1];e[0]=this[S]&&void 0!==t?this[w].decode(t):void 0,e[1]=this[k]&&void 0!==n?this[b].decode(n):void 0}}catch(e){return this[p](n,new D("entries",e))}this[I]+=t.length,this[p](n,null,t)}end(e){return C||"undefined"===typeof console||(C=!0,console.warn(new i("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}}class D extends i{constructor(e,t){super("Iterator could not decode ".concat(e),{code:"LEVEL_DECODE_ERROR",cause:t})}}for(const N of["_ended property","_nexting property","_end method"])Object.defineProperty(P.prototype,N.split(" ")[0],{get(){throw new i("The ".concat(N," has been removed"),{code:"LEVEL_LEGACY"})},set(){throw new i("The ".concat(N," has been removed"),{code:"LEVEL_LEGACY"})}});P.keyEncoding=w,P.valueEncoding=b,t.AbstractIterator=P,t.AbstractKeyIterator=class extends x{constructor(e,t){super(e,t,!1)}[u](e,t){const n=this[f]();if(e)return n(e);try{t=void 0!==t?this[w].decode(t):void 0}catch(e){return n(new D("key",e))}void 0!==t&&this[I]++,n(null,t)}[h](e,t){const n=this[f]();if(e)return this[p](n,e);try{for(let e=0;e<t.length;e++){const n=t[e];t[e]=void 0!==n?this[w].decode(n):void 0}}catch(e){return this[p](n,new D("keys",e))}this[I]+=t.length,this[p](n,null,t)}},t.AbstractValueIterator=class extends x{constructor(e,t){super(e,t,!1)}[u](e,t){const n=this[f]();if(e)return n(e);try{t=void 0!==t?this[b].decode(t):void 0}catch(e){return n(new D("value",e))}void 0!==t&&this[I]++,n(null,t)}[h](e,t){const n=this[f]();if(e)return this[p](n,e);try{for(let e=0;e<t.length;e++){const n=t[e];t[e]=void 0!==n?this[b].decode(n):void 0}}catch(e){return this[p](n,new D("values",e))}this[I]+=t.length,this[p](n,null,t)}}},9636:(e,t,n)=>{"use strict";const{supports:r}=n(5573),{Transcoder:i}=n(6030),{EventEmitter:o}=n(7284),{fromCallback:s}=n(8573),a=n(7155),{AbstractIterator:l}=n(5822),{DefaultKeyIterator:c,DefaultValueIterator:u}=n(8255),{DeferredIterator:h,DeferredKeyIterator:d,DeferredValueIterator:f}=n(5641),{DefaultChainedBatch:p}=n(1472),{getCallback:g,getOptions:y}=n(8216),v=n(3823),m=Symbol("promise"),w=Symbol("landed"),b=Symbol("resources"),E=Symbol("closeResources"),_=Symbol("operations"),S=Symbol("undefer"),k=Symbol("deferOpen"),A=Symbol("options"),I=Symbol("status"),T=Symbol("defaultOptions"),R=Symbol("transcoder"),C=Symbol("keyEncoding"),x=Symbol("valueEncoding"),P=()=>{};class D extends o{constructor(e,t){if(super(),"object"!==typeof e||null===e)throw new TypeError("The first argument 'manifest' must be an object");t=y(t);const{keyEncoding:n,valueEncoding:o,passive:s,...a}=t;this[b]=new Set,this[_]=[],this[k]=!0,this[A]=a,this[I]="opening",this.supports=r(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:!1!==e.snapshots,permanence:!1!==e.permanence,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[R]=new i(L(this)),this[C]=this[R].encoding(n||"utf8"),this[x]=this[R].encoding(o||"utf8");for(const r of this[R].encodings())this.supports.encodings[r.commonName]||(this.supports.encodings[r.commonName]=!0);this[T]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[C].commonName,valueEncoding:this[x].commonName}),key:Object.freeze({keyEncoding:this[C].commonName})},this.nextTick((()=>{this[k]&&this.open({passive:!1},P)}))}get status(){return this[I]}keyEncoding(e){return this[R].encoding(null!=e?e:this[C])}valueEncoding(e){return this[R].encoding(null!=e?e:this[x])}open(e,t){t=g(e,t),t=s(t,m),(e={...this[A],...y(e)}).createIfMissing=!1!==e.createIfMissing,e.errorIfExists=!!e.errorIfExists;const n=e=>{"closing"===this[I]||"opening"===this[I]?this.once(w,e?()=>n(e):n):"open"!==this[I]?t(new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:e})):t()};return e.passive?"opening"===this[I]?this.once(w,n):this.nextTick(n):"closed"===this[I]||this[k]?(this[k]=!1,this[I]="opening",this.emit("opening"),this._open(e,(e=>{if(e)return this[I]="closed",this[E]((()=>{this.emit(w),n(e)})),void this[S]();this[I]="open",this[S](),this.emit(w),"open"===this[I]&&this.emit("open"),"open"===this[I]&&this.emit("ready"),n()}))):"open"===this[I]?this.nextTick(n):this.once(w,(()=>this.open(e,t))),t[m]}_open(e,t){this.nextTick(t)}close(e){e=s(e,m);const t=n=>{"opening"===this[I]||"closing"===this[I]?this.once(w,n?t(n):t):"closed"!==this[I]?e(new a("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:n})):e()};if("open"===this[I]){this[I]="closing",this.emit("closing");const e=e=>{this[I]="open",this[S](),this.emit(w),t(e)};this[E]((()=>{this._close((n=>{if(n)return e(n);this[I]="closed",this[S](),this.emit(w),"closed"===this[I]&&this.emit("closed"),t()}))}))}else"closed"===this[I]?this.nextTick(t):this.once(w,(()=>this.close(e)));return e[m]}[E](e){if(0===this[b].size)return this.nextTick(e);let t=this[b].size,n=!0;const r=()=>{0===--t&&(n?this.nextTick(e):e())};for(const i of this[b])i.close(r);n=!1,this[b].clear()}_close(e){this.nextTick(e)}get(e,t,n){if(n=g(t,n),n=s(n,m),t=y(t,this[T].entry),"opening"===this[I])return this.defer((()=>this.get(e,t,n))),n[m];if(B(this,n))return n[m];const r=this._checkKey(e);if(r)return this.nextTick(n,r),n[m];const i=this.keyEncoding(t.keyEncoding),o=this.valueEncoding(t.valueEncoding),l=i.format,c=o.format;return t.keyEncoding===l&&t.valueEncoding===c||(t=Object.assign({},t,{keyEncoding:l,valueEncoding:c})),this._get(this.prefixKey(i.encode(e),l),t,((e,t)=>{if(e)return("LEVEL_NOT_FOUND"===e.code||e.notFound||/NotFound/i.test(e))&&(e.code||(e.code="LEVEL_NOT_FOUND"),e.notFound||(e.notFound=!0),e.status||(e.status=404)),n(e);try{t=o.decode(t)}catch(e){return n(new a("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:e}))}n(null,t)})),n[m]}_get(e,t,n){this.nextTick(n,new Error("NotFound"))}getMany(e,t,n){if(n=g(t,n),n=s(n,m),t=y(t,this[T].entry),"opening"===this[I])return this.defer((()=>this.getMany(e,t,n))),n[m];if(B(this,n))return n[m];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'keys' must be an array")),n[m];if(0===e.length)return this.nextTick(n,null,[]),n[m];const r=this.keyEncoding(t.keyEncoding),i=this.valueEncoding(t.valueEncoding),o=r.format,l=i.format;t.keyEncoding===o&&t.valueEncoding===l||(t=Object.assign({},t,{keyEncoding:o,valueEncoding:l}));const c=new Array(e.length);for(let s=0;s<e.length;s++){const t=e[s],i=this._checkKey(t);if(i)return this.nextTick(n,i),n[m];c[s]=this.prefixKey(r.encode(t),o)}return this._getMany(c,t,((e,t)=>{if(e)return n(e);try{for(let e=0;e<t.length;e++)void 0!==t[e]&&(t[e]=i.decode(t[e]))}catch(e){return n(new a("Could not decode one or more of ".concat(t.length," value(s)"),{code:"LEVEL_DECODE_ERROR",cause:e}))}n(null,t)})),n[m]}_getMany(e,t,n){this.nextTick(n,null,new Array(e.length).fill(void 0))}put(e,t,n,r){if(r=g(n,r),r=s(r,m),n=y(n,this[T].entry),"opening"===this[I])return this.defer((()=>this.put(e,t,n,r))),r[m];if(B(this,r))return r[m];const i=this._checkKey(e)||this._checkValue(t);if(i)return this.nextTick(r,i),r[m];const o=this.keyEncoding(n.keyEncoding),a=this.valueEncoding(n.valueEncoding),l=o.format,c=a.format;n.keyEncoding===l&&n.valueEncoding===c||(n=Object.assign({},n,{keyEncoding:l,valueEncoding:c}));const u=this.prefixKey(o.encode(e),l),h=a.encode(t);return this._put(u,h,n,(n=>{if(n)return r(n);this.emit("put",e,t),r()})),r[m]}_put(e,t,n,r){this.nextTick(r)}del(e,t,n){if(n=g(t,n),n=s(n,m),t=y(t,this[T].key),"opening"===this[I])return this.defer((()=>this.del(e,t,n))),n[m];if(B(this,n))return n[m];const r=this._checkKey(e);if(r)return this.nextTick(n,r),n[m];const i=this.keyEncoding(t.keyEncoding),o=i.format;return t.keyEncoding!==o&&(t=Object.assign({},t,{keyEncoding:o})),this._del(this.prefixKey(i.encode(e),o),t,(t=>{if(t)return n(t);this.emit("del",e),n()})),n[m]}_del(e,t,n){this.nextTick(n)}batch(e,t,n){if(!arguments.length){if("opening"===this[I])return new p(this);if("open"!==this[I])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(n="function"===typeof e?e:g(t,n),n=s(n,m),t=y(t,this[T].empty),"opening"===this[I])return this.defer((()=>this.batch(e,t,n))),n[m];if(B(this,n))return n[m];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'operations' must be an array")),n[m];if(0===e.length)return this.nextTick(n),n[m];const r=new Array(e.length),{keyEncoding:i,valueEncoding:o,...l}=t;for(let s=0;s<e.length;s++){if("object"!==typeof e[s]||null===e[s])return this.nextTick(n,new TypeError("A batch operation must be an object")),n[m];const t=Object.assign({},e[s]);if("put"!==t.type&&"del"!==t.type)return this.nextTick(n,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),n[m];const a=this._checkKey(t.key);if(a)return this.nextTick(n,a),n[m];const l=null!=t.sublevel?t.sublevel:this,c=l.keyEncoding(t.keyEncoding||i),u=c.format;if(t.key=l.prefixKey(c.encode(t.key),u),t.keyEncoding=u,"put"===t.type){const e=this._checkValue(t.value);if(e)return this.nextTick(n,e),n[m];const r=l.valueEncoding(t.valueEncoding||o);t.value=r.encode(t.value),t.valueEncoding=r.format}l!==this&&(t.sublevel=null),r[s]=t}return this._batch(r,l,(t=>{if(t)return n(t);this.emit("batch",e),n()})),n[m]}_batch(e,t,n){this.nextTick(n)}sublevel(e,t){return this._sublevel(e,N.defaults(t))}_sublevel(e,t){return new N(this,e,t)}prefixKey(e,t){return e}clear(e,t){if(t=g(e,t),t=s(t,m),e=y(e,this[T].empty),"opening"===this[I])return this.defer((()=>this.clear(e,t))),t[m];if(B(this,t))return t[m];const n=e,r=this.keyEncoding(e.keyEncoding);return(e=v(e,r)).keyEncoding=r.format,0===e.limit?this.nextTick(t):this._clear(e,(e=>{if(e)return t(e);this.emit("clear",n),t()})),t[m]}_clear(e,t){this.nextTick(t)}iterator(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if((e=v(e,t)).keys=!1!==e.keys,e.values=!1!==e.values,e[l.keyEncoding]=t,e[l.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,"opening"===this[I])return new h(this,e);if("open"!==this[I])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new l(this,e)}keys(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if((e=v(e,t))[l.keyEncoding]=t,e[l.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,"opening"===this[I])return new d(this,e);if("open"!==this[I])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new c(this,e)}values(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if((e=v(e,t))[l.keyEncoding]=t,e[l.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,"opening"===this[I])return new f(this,e);if("open"!==this[I])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new u(this,e)}defer(e){if("function"!==typeof e)throw new TypeError("The first argument must be a function");this[_].push(e)}[S](){if(0===this[_].length)return;const e=this[_];this[_]=[];for(const t of e)t()}attachResource(e){if("object"!==typeof e||null===e||"function"!==typeof e.close)throw new TypeError("The first argument must be a resource object");this[b].add(e)}detachResource(e){this[b].delete(e)}_chainedBatch(){return new p(this)}_checkKey(e){if(null===e||void 0===e)return new a("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(null===e||void 0===e)return new a("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}}D.prototype.nextTick=n(2377);const{AbstractSublevel:N}=n(984)({AbstractLevel:D});t.AbstractLevel=D,t.AbstractSublevel=N;const B=function(e,t){return"open"!==e[I]&&(e.nextTick(t,new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0)},L=function(e){return Object.keys(e.supports.encodings).filter((t=>!!e.supports.encodings[t]))}},7913:(e,t,n)=>{"use strict";t.AbstractLevel=n(9636).AbstractLevel,t.AbstractSublevel=n(9636).AbstractSublevel,t.AbstractIterator=n(5822).AbstractIterator,t.AbstractKeyIterator=n(5822).AbstractKeyIterator,t.AbstractValueIterator=n(5822).AbstractValueIterator,t.AbstractChainedBatch=n(6119).AbstractChainedBatch},9887:(e,t,n)=>{"use strict";const{AbstractIterator:r,AbstractKeyIterator:i,AbstractValueIterator:o}=n(5822),s=Symbol("unfix"),a=Symbol("iterator"),l=Symbol("handleOne"),c=Symbol("handleMany"),u=Symbol("callback");class h extends r{constructor(e,t,n,r){super(e,t),this[a]=n,this[s]=r,this[l]=this[l].bind(this),this[c]=this[c].bind(this),this[u]=null}[l](e,t,n){const r=this[u];if(e)return r(e);void 0!==t&&(t=this[s](t)),r(e,t,n)}[c](e,t){const n=this[u];if(e)return n(e);for(const r of t){const e=r[0];void 0!==e&&(r[0]=this[s](e))}n(e,t)}}class d extends i{constructor(e,t,n,r){super(e,t),this[a]=n,this[s]=r,this[l]=this[l].bind(this),this[c]=this[c].bind(this),this[u]=null}[l](e,t){const n=this[u];if(e)return n(e);void 0!==t&&(t=this[s](t)),n(e,t)}[c](e,t){const n=this[u];if(e)return n(e);for(let r=0;r<t.length;r++){const e=t[r];void 0!==e&&(t[r]=this[s](e))}n(e,t)}}class f extends o{constructor(e,t,n){super(e,t),this[a]=n}}for(const p of[h,d])p.prototype._next=function(e){this[u]=e,this[a].next(this[l])},p.prototype._nextv=function(e,t,n){this[u]=n,this[a].nextv(e,t,this[c])},p.prototype._all=function(e,t){this[u]=t,this[a].all(e,this[c])};for(const p of[f])p.prototype._next=function(e){this[a].next(e)},p.prototype._nextv=function(e,t,n){this[a].nextv(e,t,n)},p.prototype._all=function(e,t){this[a].all(e,t)};for(const p of[h,d,f])p.prototype._seek=function(e,t){this[a].seek(e,t)},p.prototype._close=function(e){this[a].close(e)};t.AbstractSublevelIterator=h,t.AbstractSublevelKeyIterator=d,t.AbstractSublevelValueIterator=f},984:(e,t,n)=>{"use strict";const r=n(7155),{Buffer:i}=n(6382)||{},{AbstractSublevelIterator:o,AbstractSublevelKeyIterator:s,AbstractSublevelValueIterator:a}=n(9887),l=Symbol("prefix"),c=Symbol("upperBound"),u=Symbol("prefixRange"),h=Symbol("parent"),d=Symbol("unfix"),f=new TextEncoder,p={separator:"!"};e.exports=function(e){let{AbstractLevel:t}=e;class n extends t{static defaults(e){if("string"===typeof e)throw new r("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(e&&e.open)throw new r("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return null==e?p:e.separator?e:{...e,separator:"!"}}constructor(e,t,i){const{separator:o,manifest:s,...a}=n.defaults(i);t=w(t,o);const u=o.charCodeAt(0)+1,p=e[h]||e;if(!f.encode(t).every((e=>e>u&&e<127)))throw new r("Prefix must use bytes > ".concat(u," < ",127),{code:"LEVEL_INVALID_PREFIX"});super(g(p,s),a);const y=(e.prefix||"")+o+t+o,b=y.slice(0,-1)+String.fromCharCode(u);this[h]=p,this[l]=new v(y),this[c]=new v(b),this[d]=new m,this.nextTick=p.nextTick}prefixKey(e,t){if("utf8"===t)return this[l].utf8+e;if(0===e.byteLength)return this[l][t];if("view"===t){const t=this[l].view,n=new Uint8Array(t.byteLength+e.byteLength);return n.set(t,0),n.set(e,t.byteLength),n}{const t=this[l].buffer;return i.concat([t,e],t.byteLength+e.byteLength)}}[u](e,t){void 0!==e.gte?e.gte=this.prefixKey(e.gte,t):void 0!==e.gt?e.gt=this.prefixKey(e.gt,t):e.gte=this[l][t],void 0!==e.lte?e.lte=this.prefixKey(e.lte,t):void 0!==e.lt?e.lt=this.prefixKey(e.lt,t):e.lte=this[c][t]}get prefix(){return this[l].utf8}get db(){return this[h]}_open(e,t){this[h].open({passive:!0},t)}_put(e,t,n,r){this[h].put(e,t,n,r)}_get(e,t,n){this[h].get(e,t,n)}_getMany(e,t,n){this[h].getMany(e,t,n)}_del(e,t,n){this[h].del(e,t,n)}_batch(e,t,n){this[h].batch(e,t,n)}_clear(e,t){this[u](e,e.keyEncoding),this[h].clear(e,t)}_iterator(e){this[u](e,e.keyEncoding);const t=this[h].iterator(e),n=this[d].get(this[l].utf8.length,e.keyEncoding);return new o(this,e,t,n)}_keys(e){this[u](e,e.keyEncoding);const t=this[h].keys(e),n=this[d].get(this[l].utf8.length,e.keyEncoding);return new s(this,e,t,n)}_values(e){this[u](e,e.keyEncoding);const t=this[h].values(e);return new a(this,e,t)}}return{AbstractSublevel:n}};const g=function(e,t){return{...e.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...t,encodings:{utf8:y(e,"utf8"),buffer:y(e,"buffer"),view:y(e,"view")}}},y=function(e,t){return!!e.supports.encodings[t]&&e.keyEncoding(t).name===t};class v{constructor(e){this.utf8=e,this.view=f.encode(e),this.buffer=i?i.from(this.view.buffer,0,this.view.byteLength):{}}}class m{constructor(){this.cache=new Map}get(e,t){let n=this.cache.get(t);return void 0===n&&(n="view"===t?function(e,t){return t.subarray(e)}.bind(null,e):function(e,t){return t.slice(e)}.bind(null,e),this.cache.set(t,n)),n}}const w=function(e,t){let n=0,r=e.length;for(;n<r&&e[n]===t;)n++;for(;r>n&&e[r-1]===t;)r--;return e.slice(n,r)}},8216:(e,t)=>{"use strict";t.getCallback=function(e,t){return"function"===typeof e?e:t},t.getOptions=function(e,t){return"object"===typeof e&&null!==e?e:void 0!==t?t:{}}},1472:(e,t,n)=>{"use strict";const{AbstractChainedBatch:r}=n(6119),i=n(7155),o=Symbol("encoded");t.DefaultChainedBatch=class extends r{constructor(e){super(e),this[o]=[]}_put(e,t,n){this[o].push({...n,type:"put",key:e,value:t})}_del(e,t){this[o].push({...t,type:"del",key:e})}_clear(){this[o]=[]}_write(e,t){"opening"===this.db.status?this.db.defer((()=>this._write(e,t))):"open"===this.db.status?0===this[o].length?this.nextTick(t):this.db._batch(this[o],e,t):this.nextTick(t,new i("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}}},8255:(e,t,n)=>{"use strict";const{AbstractKeyIterator:r,AbstractValueIterator:i}=n(5822),o=Symbol("iterator"),s=Symbol("callback"),a=Symbol("handleOne"),l=Symbol("handleMany");class c extends r{constructor(e,t){super(e,t),this[o]=e.iterator({...t,keys:!0,values:!1}),this[a]=this[a].bind(this),this[l]=this[l].bind(this)}}class u extends i{constructor(e,t){super(e,t),this[o]=e.iterator({...t,keys:!1,values:!0}),this[a]=this[a].bind(this),this[l]=this[l].bind(this)}}for(const h of[c,u]){const e=h===c,t=e?e=>e[0]:e=>e[1];h.prototype._next=function(e){this[s]=e,this[o].next(this[a])},h.prototype[a]=function(t,n,r){const i=this[s];t?i(t):i(null,e?n:r)},h.prototype._nextv=function(e,t,n){this[s]=n,this[o].nextv(e,t,this[l])},h.prototype._all=function(e,t){this[s]=t,this[o].all(e,this[l])},h.prototype[l]=function(e,n){const r=this[s];e?r(e):r(null,n.map(t))},h.prototype._seek=function(e,t){this[o].seek(e,t)},h.prototype._close=function(e){this[o].close(e)}}t.DefaultKeyIterator=c,t.DefaultValueIterator=u},5641:(e,t,n)=>{"use strict";const{AbstractIterator:r,AbstractKeyIterator:i,AbstractValueIterator:o}=n(5822),s=n(7155),a=Symbol("nut"),l=Symbol("undefer"),c=Symbol("factory");class u extends r{constructor(e,t){super(e,t),this[a]=null,this[c]=()=>e.iterator(t),this.db.defer((()=>this[l]()))}}class h extends i{constructor(e,t){super(e,t),this[a]=null,this[c]=()=>e.keys(t),this.db.defer((()=>this[l]()))}}class d extends o{constructor(e,t){super(e,t),this[a]=null,this[c]=()=>e.values(t),this.db.defer((()=>this[l]()))}}for(const f of[u,h,d])f.prototype[l]=function(){"open"===this.db.status&&(this[a]=this[c]())},f.prototype._next=function(e){null!==this[a]?this[a].next(e):"opening"===this.db.status?this.db.defer((()=>this._next(e))):this.nextTick(e,new s("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},f.prototype._nextv=function(e,t,n){null!==this[a]?this[a].nextv(e,t,n):"opening"===this.db.status?this.db.defer((()=>this._nextv(e,t,n))):this.nextTick(n,new s("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},f.prototype._all=function(e,t){null!==this[a]?this[a].all(t):"opening"===this.db.status?this.db.defer((()=>this._all(e,t))):this.nextTick(t,new s("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},f.prototype._seek=function(e,t){null!==this[a]?this[a]._seek(e,t):"opening"===this.db.status&&this.db.defer((()=>this._seek(e,t)))},f.prototype._close=function(e){null!==this[a]?this[a].close(e):"opening"===this.db.status?this.db.defer((()=>this._close(e))):this.nextTick(e)};t.DeferredIterator=u,t.DeferredKeyIterator=h,t.DeferredValueIterator=d},2377:(e,t,n)=>{"use strict";const r=n(4275);e.exports=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];0===n.length?r(e):r((()=>e(...n)))}},3823:(e,t,n)=>{"use strict";const r=n(7155),i=Object.prototype.hasOwnProperty,o=new Set(["lt","lte","gt","gte"]);e.exports=function(e,t){const n={};for(const s in e)if(i.call(e,s)&&"keyEncoding"!==s&&"valueEncoding"!==s){if("start"===s||"end"===s)throw new r("The legacy range option '".concat(s,"' has been removed"),{code:"LEVEL_LEGACY"});if("encoding"===s)throw new r("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});o.has(s)?n[s]=t.encode(e[s]):n[s]=e[s]}return n.reverse=!!n.reverse,n.limit=Number.isInteger(n.limit)&&n.limit>=0?n.limit:-1,n}},4445:(e,t)=>{"use strict";t.byteLength=function(e){var t=a(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,o=a(e),s=o[0],l=o[1],c=new i(function(e,t,n){return 3*(t+n)/4-n}(0,s,l)),u=0,h=l>0?s-4:s;for(n=0;n<h;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;2===l&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,c[u++]=255&t);1===l&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t);return c},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],s=16383,a=0,c=r-i;a<c;a+=s)o.push(l(e,a,a+s>c?c:a+s));1===i?(t=e[r-1],o.push(n[t>>2]+n[t<<4&63]+"==")):2===i&&(t=(e[r-2]<<8)+e[r-1],o.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return o.join("")};for(var n=[],r=[],i="undefined"!==typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0;s<64;++s)n[s]=o[s],r[o.charCodeAt(s)]=s;function a(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,r){for(var i,o,s=[],a=t;a<r;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return s.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},9483:(e,t,n)=>{"use strict";const{AbstractLevel:r}=n(7913),i=n(7155),o=n(6845),{fromCallback:s}=n(8573),{Iterator:a}=n(8133),l=n(4715),c=n(3489),u=n(5331),h="level-js-",d=Symbol("idb"),f=Symbol("namePrefix"),p=Symbol("location"),g=Symbol("version"),y=Symbol("store"),v=Symbol("onComplete"),m=Symbol("promise");class w extends r{constructor(e,t,n){if("function"===typeof t||"function"===typeof n)throw new i("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});const{prefix:r,version:o,...s}=t||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},s),"string"!==typeof e)throw new Error("constructor requires a location string argument");this[p]=e,this[f]=null==r?h:r,this[g]=parseInt(o||1,10),this[d]=null}get location(){return this[p]}get namePrefix(){return this[f]}get version(){return this[g]}get db(){return this[d]}get type(){return"browser-level"}_open(e,t){const n=indexedDB.open(this[f]+this[p],this[g]);n.onerror=function(){t(n.error||new Error("unknown error"))},n.onsuccess=()=>{this[d]=n.result,t()},n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this[p])||t.createObjectStore(this[p])}}[y](e){return this[d].transaction([this[p]],e).objectStore(this[p])}[v](e,t){const n=e.transaction;n.onabort=function(){t(n.error||new Error("aborted by user"))},n.oncomplete=function(){t(null,e.result)}}_get(e,t,n){const r=this[y]("readonly");let o;try{o=r.get(e)}catch(s){return this.nextTick(n,s)}this[v](o,(function(e,t){return e?n(e):void 0===t?n(new i("Entry not found",{code:"LEVEL_NOT_FOUND"})):void n(null,l(t))}))}_getMany(e,t,n){const r=this[y]("readonly"),i=e.map((e=>t=>{let n;try{n=r.get(e)}catch(i){return t(i)}n.onsuccess=()=>{const e=n.result;t(null,void 0===e?e:l(e))},n.onerror=e=>{e.stopPropagation(),t(n.error)}}));o(i,16,n)}_del(e,t,n){const r=this[y]("readwrite");let i;try{i=r.delete(e)}catch(o){return this.nextTick(n,o)}this[v](i,n)}_put(e,t,n,r){const i=this[y]("readwrite");let o;try{o=i.put(t,e)}catch(s){return this.nextTick(r,s)}this[v](o,r)}_iterator(e){return new a(this,this[p],e)}_batch(e,t,n){const r=this[y]("readwrite"),i=r.transaction;let o,s=0;i.onabort=function(){n(o||i.error||new Error("aborted by user"))},i.oncomplete=function(){n()},function t(){const n=e[s++],a=n.key;let l;try{l="del"===n.type?r.delete(a):r.put(n.value,a)}catch(c){return o=c,void i.abort()}s<e.length?l.onsuccess=t:"function"===typeof i.commit&&i.commit()}()}_clear(e,t){let n,r;try{n=u(e)}catch(i){return this.nextTick(t)}if(e.limit>=0)return c(this,this[p],n,e,t);try{const e=this[y]("readwrite");r=n?e.delete(n):e.clear()}catch(o){return this.nextTick(t,o)}this[v](r,t)}_close(e){this[d].close(),this.nextTick(e)}}w.destroy=function(e,t,n){"function"===typeof t&&(n=t,t=h),n=s(n,m);const r=indexedDB.deleteDatabase(t+e);return r.onsuccess=function(){n()},r.onerror=function(e){n(e)},n[m]},t.BrowserLevel=w},8133:(e,t,n)=>{"use strict";const{AbstractIterator:r}=n(7913),i=n(5331),o=n(4715),s=Symbol("cache"),a=Symbol("finished"),l=Symbol("options"),c=Symbol("currentOptions"),u=Symbol("position"),h=Symbol("location"),d=Symbol("first"),f={};function p(e){"function"===typeof e.commit&&e.commit()}t.Iterator=class extends r{constructor(e,t,n){super(e,n),this[s]=[],this[a]=0===this.limit,this[l]=n,this[c]={...n},this[u]=void 0,this[h]=t,this[d]=!0}_nextv(e,t,n){if(this[d]=!1,this[a])return this.nextTick(n,null,[]);if(this[s].length>0)return e=Math.min(e,this[s].length),this.nextTick(n,null,this[s].splice(0,e));let r;void 0!==this[u]&&(this[l].reverse?(this[c].lt=this[u],this[c].lte=void 0):(this[c].gt=this[u],this[c].gte=void 0));try{r=i(this[c])}catch(v){return this[a]=!0,this.nextTick(n,null,[])}const f=this.db.db.transaction([this[h]],"readonly"),g=f.objectStore(this[h]),y=[];if(this[l].reverse){g[!this[l].values&&g.openKeyCursor?"openKeyCursor":"openCursor"](r,"prev").onsuccess=t=>{const n=t.target.result;if(n){const{key:t,value:r}=n;this[u]=t,y.push([this[l].keys&&void 0!==t?o(t):void 0,this[l].values&&void 0!==r?o(r):void 0]),y.length<e?n.continue():p(f)}else this[a]=!0}}else{let t,n;const i=()=>{if(void 0===t||void 0===n)return;const r=Math.max(t.length,n.length);0===r||e===1/0?this[a]=!0:this[u]=t[r-1],y.length=r;for(let e=0;e<r;e++){const r=t[e],i=n[e];y[e]=[this[l].keys&&void 0!==r?o(r):void 0,this[l].values&&void 0!==i?o(i):void 0]}p(f)};this[l].keys||e<1/0?g.getAllKeys(r,e<1/0?e:void 0).onsuccess=e=>{t=e.target.result,i()}:(t=[],this.nextTick(i)),this[l].values?g.getAll(r,e<1/0?e:void 0).onsuccess=e=>{n=e.target.result,i()}:(n=[],this.nextTick(i))}f.onabort=()=>{n(f.error||new Error("aborted by user")),n=null},f.oncomplete=()=>{n(null,y),n=null}}_next(e){if(this[s].length>0){const[t,n]=this[s].shift();this.nextTick(e,null,t,n)}else if(this[a])this.nextTick(e);else{let t=Math.min(100,this.limit-this.count);this[d]&&(this[d]=!1,t=1),this._nextv(t,f,((t,n)=>{if(t)return e(t);this[s]=n,this._next(e)}))}}_all(e,t){this[d]=!1;const n=this[s].splice(0,this[s].length),r=this.limit-this.count-n.length;if(r<=0)return this.nextTick(t,null,n);this._nextv(r,f,((e,r)=>{if(e)return t(e);n.length>0&&(r=n.concat(r)),t(null,r)}))}_seek(e,t){let n;this[d]=!0,this[s]=[],this[a]=!1,this[u]=void 0,this[c]={...this[l]};try{n=i(this[l])}catch(r){return void(this[a]=!0)}null===n||n.includes(e)?this[l].reverse?this[c].lte=e:this[c].gte=e:this[a]=!0}}},3489:e=>{"use strict";e.exports=function(e,t,n,r,i){if(0===r.limit)return e.nextTick(i);const o=e.db.transaction([t],"readwrite"),s=o.objectStore(t);let a=0;o.oncomplete=function(){i()},o.onabort=function(){i(o.error||new Error("aborted by user"))};const l=s.openKeyCursor?"openKeyCursor":"openCursor",c=r.reverse?"prev":"next";s[l](n,c).onsuccess=function(e){const t=e.target.result;t&&(s.delete(t.key).onsuccess=function(){(r.limit<=0||++a<r.limit)&&t.continue()})}}},4715:e=>{"use strict";const t=new TextEncoder;e.exports=function(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):t.encode(e)}},5331:e=>{"use strict";e.exports=function(e){const t=void 0!==e.gte?e.gte:void 0!==e.gt?e.gt:void 0,n=void 0!==e.lte?e.lte:void 0!==e.lt?e.lt:void 0,r=void 0===e.gte,i=void 0===e.lte;return void 0!==t&&void 0!==n?IDBKeyRange.bound(t,n,r,i):void 0!==t?IDBKeyRange.lowerBound(t,r):void 0!==n?IDBKeyRange.upperBound(n,i):null}},6382:(e,t,n)=>{"use strict";const r=n(4445),i=n(6900),o="function"===typeof Symbol&&"function"===typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.Buffer=l,t.SlowBuffer=function(e){+e!=e&&(e=0);return l.alloc(+e)},t.INSPECT_MAX_BYTES=50;const s=2147483647;function a(e){if(e>s)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,l.prototype),t}function l(e,t,n){if("number"===typeof e){if("string"===typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return h(e)}return c(e,t,n)}function c(e,t,n){if("string"===typeof e)return function(e,t){"string"===typeof t&&""!==t||(t="utf8");if(!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|g(e,t);let r=a(n);const i=r.write(e,t);i!==n&&(r=r.slice(0,i));return r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(Q(e,Uint8Array)){const t=new Uint8Array(e);return f(t.buffer,t.byteOffset,t.byteLength)}return d(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(Q(e,ArrayBuffer)||e&&Q(e.buffer,ArrayBuffer))return f(e,t,n);if("undefined"!==typeof SharedArrayBuffer&&(Q(e,SharedArrayBuffer)||e&&Q(e.buffer,SharedArrayBuffer)))return f(e,t,n);if("number"===typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return l.from(r,t,n);const i=function(e){if(l.isBuffer(e)){const t=0|p(e.length),n=a(t);return 0===n.length||e.copy(n,0,0,t),n}if(void 0!==e.length)return"number"!==typeof e.length||X(e.length)?a(0):d(e);if("Buffer"===e.type&&Array.isArray(e.data))return d(e.data)}(e);if(i)return i;if("undefined"!==typeof Symbol&&null!=Symbol.toPrimitive&&"function"===typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function u(e){if("number"!==typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return u(e),a(e<0?0:0|p(e))}function d(e){const t=e.length<0?0:0|p(e.length),n=a(t);for(let r=0;r<t;r+=1)n[r]=255&e[r];return n}function f(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,l.prototype),r}function p(e){if(e>=s)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s.toString(16)+" bytes");return 0|e}function g(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||Q(e,ArrayBuffer))return e.byteLength;if("string"!==typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let i=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return W(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return G(e).length;default:if(i)return r?-1:W(e).length;t=(""+t).toLowerCase(),i=!0}}function y(e,t,n){let r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return x(this,t,n);case"utf8":case"utf-8":return I(this,t,n);case"ascii":return R(this,t,n);case"latin1":case"binary":return C(this,t,n);case"base64":return A(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function v(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function m(e,t,n,r,i){if(0===e.length)return-1;if("string"===typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),X(n=+n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"===typeof t&&(t=l.from(t,r)),l.isBuffer(t))return 0===t.length?-1:w(e,t,n,r,i);if("number"===typeof t)return t&=255,"function"===typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):w(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function w(e,t,n,r,i){let o,s=1,a=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,l/=2,n/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){let r=-1;for(o=n;o<a;o++)if(c(e,o)===c(t,-1===r?0:o-r)){if(-1===r&&(r=o),o-r+1===l)return r*s}else-1!==r&&(o-=o-r),r=-1}else for(n+l>a&&(n=a-l),o=n;o>=0;o--){let n=!0;for(let r=0;r<l;r++)if(c(e,o+r)!==c(t,r)){n=!1;break}if(n)return o}return-1}function b(e,t,n,r){n=Number(n)||0;const i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;const o=t.length;let s;for(r>o/2&&(r=o/2),s=0;s<r;++s){const r=parseInt(t.substr(2*s,2),16);if(X(r))return s;e[n+s]=r}return s}function E(e,t,n,r){return Y(W(t,e.length-n),e,n,r)}function _(e,t,n,r){return Y(function(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function S(e,t,n,r){return Y(G(t),e,n,r)}function k(e,t,n,r){return Y(function(e,t){let n,r,i;const o=[];for(let s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function A(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function I(e,t,n){n=Math.min(e.length,n);const r=[];let i=t;for(;i<n;){const t=e[i];let o=null,s=t>239?4:t>223?3:t>191?2:1;if(i+s<=n){let n,r,a,l;switch(s){case 1:t<128&&(o=t);break;case 2:n=e[i+1],128===(192&n)&&(l=(31&t)<<6|63&n,l>127&&(o=l));break;case 3:n=e[i+1],r=e[i+2],128===(192&n)&&128===(192&r)&&(l=(15&t)<<12|(63&n)<<6|63&r,l>2047&&(l<55296||l>57343)&&(o=l));break;case 4:n=e[i+1],r=e[i+2],a=e[i+3],128===(192&n)&&128===(192&r)&&128===(192&a)&&(l=(15&t)<<18|(63&n)<<12|(63&r)<<6|63&a,l>65535&&l<1114112&&(o=l))}}null===o?(o=65533,s=1):o>65535&&(o-=65536,r.push(o>>>10&1023|55296),o=56320|1023&o),r.push(o),i+=s}return function(e){const t=e.length;if(t<=T)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=T));return n}(r)}t.kMaxLength=s,l.TYPED_ARRAY_SUPPORT=function(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}(),l.TYPED_ARRAY_SUPPORT||"undefined"===typeof console||"function"!==typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(e,t,n){return c(e,t,n)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(e,t,n){return function(e,t,n){return u(e),e<=0?a(e):void 0!==t?"string"===typeof n?a(e).fill(t,n):a(e).fill(t):a(e)}(e,t,n)},l.allocUnsafe=function(e){return h(e)},l.allocUnsafeSlow=function(e){return h(e)},l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,t){if(Q(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),Q(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,r=t.length;for(let i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const r=l.allocUnsafe(t);let i=0;for(n=0;n<e.length;++n){let t=e[n];if(Q(t,Uint8Array))i+t.length>r.length?(l.isBuffer(t)||(t=l.from(t)),t.copy(r,i)):Uint8Array.prototype.set.call(r,t,i);else{if(!l.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(r,i)}i+=t.length}return r},l.byteLength=g,l.prototype._isBuffer=!0,l.prototype.swap16=function(){const e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)v(this,t,t+1);return this},l.prototype.swap32=function(){const e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)v(this,t,t+3),v(this,t+1,t+2);return this},l.prototype.swap64=function(){const e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)v(this,t,t+7),v(this,t+1,t+6),v(this,t+2,t+5),v(this,t+3,t+4);return this},l.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?I(this,0,e):y.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){let e="";const n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},o&&(l.prototype[o]=l.prototype.inspect),l.prototype.compare=function(e,t,n,r,i){if(Q(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;let o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0);const a=Math.min(o,s),c=this.slice(r,i),u=e.slice(t,n);for(let l=0;l<a;++l)if(c[l]!==u[l]){o=c[l],s=u[l];break}return o<s?-1:s<o?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)},l.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"===typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let o=!1;for(;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return E(this,e,t,n);case"ascii":case"latin1":case"binary":return _(this,e,t,n);case"base64":return S(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const T=4096;function R(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function C(e,t,n){let r="";n=Math.min(e.length,n);for(let i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function x(e,t,n){const r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);let i="";for(let o=t;o<n;++o)i+=J[e[o]];return i}function P(e,t,n){const r=e.slice(t,n);let i="";for(let o=0;o<r.length-1;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function D(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function N(e,t,n,r,i,o){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function B(e,t,n,r,i){K(t,r,i,e,n,7);let o=Number(t&BigInt(4294967295));e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,s>>=8,e[n++]=s,n}function L(e,t,n,r,i){K(t,r,i,e,n,7);let o=Number(t&BigInt(4294967295));e[n+7]=o,o>>=8,e[n+6]=o,o>>=8,e[n+5]=o,o>>=8,e[n+4]=o;let s=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=s,s>>=8,e[n+2]=s,s>>=8,e[n+1]=s,s>>=8,e[n]=s,n+8}function O(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function M(e,t,n,r,o){return t=+t,n>>>=0,o||O(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function U(e,t,n,r,o){return t=+t,n>>>=0,o||O(e,0,n,8),i.write(e,t,n,r,52,8),n+8}l.prototype.slice=function(e,t){const n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);const r=this.subarray(e,t);return Object.setPrototypeOf(r,l.prototype),r},l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||D(e,t,this.length);let r=this[e],i=1,o=0;for(;++o<t&&(i*=256);)r+=this[e+o]*i;return r},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||D(e,t,this.length);let r=this[e+--t],i=1;for(;t>0&&(i*=256);)r+=this[e+--t]*i;return r},l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e>>>=0,t||D(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||D(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e>>>=0,t||D(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||D(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||D(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readBigUInt64LE=$((function(e){j(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||H(e,this.length-8);const r=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,i=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(r)+(BigInt(i)<<BigInt(32))})),l.prototype.readBigUInt64BE=$((function(e){j(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||H(e,this.length-8);const r=t*2**24+65536*this[++e]+256*this[++e]+this[++e],i=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(i)})),l.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||D(e,t,this.length);let r=this[e],i=1,o=0;for(;++o<t&&(i*=256);)r+=this[e+o]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*t)),r},l.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||D(e,t,this.length);let r=t,i=1,o=this[e+--r];for(;r>0&&(i*=256);)o+=this[e+--r]*i;return i*=128,o>=i&&(o-=Math.pow(2,8*t)),o},l.prototype.readInt8=function(e,t){return e>>>=0,t||D(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){e>>>=0,t||D(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){e>>>=0,t||D(e,2,this.length);const n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||D(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||D(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readBigInt64LE=$((function(e){j(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||H(e,this.length-8);const r=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),l.prototype.readBigInt64BE=$((function(e){j(e>>>=0,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||H(e,this.length-8);const r=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(r)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)})),l.prototype.readFloatLE=function(e,t){return e>>>=0,t||D(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e>>>=0,t||D(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||D(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,t||D(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){N(this,e,t,n,Math.pow(2,8*n)-1,0)}let i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){N(this,e,t,n,Math.pow(2,8*n)-1,0)}let i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeBigUInt64LE=$((function(e){return B(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeBigUInt64BE=$((function(e){return L(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);N(this,e,t,n,r-1,-r)}let i=0,o=1,s=0;for(this[t]=255&e;++i<n&&(o*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/o|0)-s&255;return t+n},l.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);N(this,e,t,n,r-1,-r)}let i=n-1,o=1,s=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/o|0)-s&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||N(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeBigInt64LE=$((function(e){return B(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeBigInt64BE=$((function(e){return L(this,e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeFloatLE=function(e,t,n){return M(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return M(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return U(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return U(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,r){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);const i=r-n;return this===e&&"function"===typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),i},l.prototype.fill=function(e,t,n,r){if("string"===typeof e){if("string"===typeof t?(r=t,t=0,n=this.length):"string"===typeof n&&(r=n,n=this.length),void 0!==r&&"string"!==typeof r)throw new TypeError("encoding must be a string");if("string"===typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){const t=e.charCodeAt(0);("utf8"===r&&t<128||"latin1"===r)&&(e=t)}}else"number"===typeof e?e&=255:"boolean"===typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"===typeof e)for(i=t;i<n;++i)this[i]=e;else{const o=l.isBuffer(e)?e:l.from(e,r),s=o.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=o[i%s]}return this};const F={};function V(e,t,n){F[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name="".concat(this.name," [").concat(e,"]"),this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return"".concat(this.name," [").concat(e,"]: ").concat(this.message)}}}function z(e){let t="",n=e.length;const r="-"===e[0]?1:0;for(;n>=r+4;n-=3)t="_".concat(e.slice(n-3,n)).concat(t);return"".concat(e.slice(0,n)).concat(t)}function K(e,t,n,r,i,o){if(e>n||e<t){const r="bigint"===typeof t?"n":"";let i;throw i=o>3?0===t||t===BigInt(0)?">= 0".concat(r," and < 2").concat(r," ** ").concat(8*(o+1)).concat(r):">= -(2".concat(r," ** ").concat(8*(o+1)-1).concat(r,") and < 2 ** ")+"".concat(8*(o+1)-1).concat(r):">= ".concat(t).concat(r," and <= ").concat(n).concat(r),new F.ERR_OUT_OF_RANGE("value",i,e)}!function(e,t,n){j(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||H(t,e.length-(n+1))}(r,i,o)}function j(e,t){if("number"!==typeof e)throw new F.ERR_INVALID_ARG_TYPE(t,"number",e)}function H(e,t,n){if(Math.floor(e)!==e)throw j(e,n),new F.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new F.ERR_BUFFER_OUT_OF_BOUNDS;throw new F.ERR_OUT_OF_RANGE(n||"offset",">= ".concat(n?1:0," and <= ").concat(t),e)}V("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?"".concat(e," is outside of buffer bounds"):"Attempt to access memory outside buffer bounds"}),RangeError),V("ERR_INVALID_ARG_TYPE",(function(e,t){return'The "'.concat(e,'" argument must be of type number. Received type ').concat(typeof t)}),TypeError),V("ERR_OUT_OF_RANGE",(function(e,t,n){let r='The value of "'.concat(e,'" is out of range.'),i=n;return Number.isInteger(n)&&Math.abs(n)>2**32?i=z(String(n)):"bigint"===typeof n&&(i=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(i=z(i)),i+="n"),r+=" It must be ".concat(t,". Received ").concat(i),r}),RangeError);const q=/[^+/0-9A-Za-z-_]/g;function W(e,t){let n;t=t||1/0;const r=e.length;let i=null;const o=[];for(let s=0;s<r;++s){if(n=e.charCodeAt(s),n>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function G(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(q,"")).length<2)return"";for(;e.length%4!==0;)e+="=";return e}(e))}function Y(e,t,n,r){let i;for(i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function Q(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function X(e){return e!==e}const J=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const r=16*n;for(let i=0;i<16;++i)t[r+i]=e[n]+e[i]}return t}();function $(e){return"undefined"===typeof BigInt?Z:e}function Z(){throw new Error("BigInt not supported")}},8573:(e,t,n)=>{"use strict";var r=n(8101);t.fromCallback=function(e,t){if(void 0===e){var n=new Promise((function(t,n){e=function(e,r){e?n(e):t(r)}}));e[void 0!==t?t:"promise"]=n}else if("function"!==typeof e)throw new TypeError("Callback must be a function");return e},t.fromPromise=function(e,t){if(void 0===t)return e;e.then((function(e){r((()=>t(null,e)))})).catch((function(e){r((()=>t(e)))}))}},8101:e=>{e.exports="function"===typeof queueMicrotask?queueMicrotask:e=>Promise.resolve().then(e)},6522:(e,t,n)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(n){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(n){}!e&&"undefined"!==typeof process&&"env"in process&&(e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.DEBUG);return e},t.useColors=function(){if("undefined"!==typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(5237)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}},5237:(e,t,n)=>{e.exports=function(e){function t(e){let n,i,o,s=null;function a(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(!a.enabled)return;const o=a,s=Number(new Date),l=s-(n||s);o.diff=l,o.prev=n,o.curr=s,n=s,r[0]=t.coerce(r[0]),"string"!==typeof r[0]&&r.unshift("%O");let c=0;r[0]=r[0].replace(/%([a-zA-Z%])/g,((e,n)=>{if("%%"===e)return"%";c++;const i=t.formatters[n];if("function"===typeof i){const t=r[c];e=i.call(o,t),r.splice(c,1),c--}return e})),t.formatArgs.call(o,r);(o.log||t.log).apply(o,r)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(i!==t.namespaces&&(i=t.namespaces,o=t.enabled(e)),o),set:e=>{s=e}}),"function"===typeof t.init&&t.init(a),a}function r(e,n){const r=t(this.namespace+("undefined"===typeof n?":":n)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(i),...t.skips.map(i).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"===typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(7340),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},80:e=>{"use strict";function t(e,t){t=t||{};this._capacity=t.capacity,this._head=0,this._tail=0,Array.isArray(e)?this._fromArray(e):(this._capacityMask=3,this._list=new Array(4))}t.prototype.peekAt=function(e){var t=e;if(t===(0|t)){var n=this.size();if(!(t>=n||t<-n))return t<0&&(t+=n),t=this._head+t&this._capacityMask,this._list[t]}},t.prototype.get=function(e){return this.peekAt(e)},t.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},t.prototype.peekFront=function(){return this.peek()},t.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(t.prototype,"length",{get:function(){return this.size()}}),t.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.unshift=function(e){if(0===arguments.length)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}},t.prototype.push=function(e){if(0===arguments.length)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},t.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),n}},t.prototype.removeOne=function(e){var t=e;if(t===(0|t)&&this._head!==this._tail){var n=this.size(),r=this._list.length;if(!(t>=n||t<-n)){t<0&&(t+=n),t=this._head+t&this._capacityMask;var i,o=this._list[t];if(e<n/2){for(i=e;i>0;i--)this._list[t]=this._list[t=t-1+r&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+r&this._capacityMask}else{for(i=n-1-e;i>0;i--)this._list[t]=this._list[t=t+1+r&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+r&this._capacityMask}return o}}},t.prototype.remove=function(e,t){var n,r=e,i=t;if(r===(0|r)&&this._head!==this._tail){var o=this.size(),s=this._list.length;if(!(r>=o||r<-o||t<1)){if(r<0&&(r+=o),1===t||!t)return(n=new Array(1))[0]=this.removeOne(r),n;if(0===r&&r+t>=o)return n=this.toArray(),this.clear(),n;var a;for(r+t>o&&(t=o-r),n=new Array(t),a=0;a<t;a++)n[a]=this._list[this._head+r+a&this._capacityMask];if(r=this._head+r&this._capacityMask,e+t===o){for(this._tail=this._tail-t+s&this._capacityMask,a=t;a>0;a--)this._list[r=r+1+s&this._capacityMask]=void 0;return n}if(0===e){for(this._head=this._head+t+s&this._capacityMask,a=t-1;a>0;a--)this._list[r=r+1+s&this._capacityMask]=void 0;return n}if(r<o/2){for(this._head=this._head+e+t+s&this._capacityMask,a=e;a>0;a--)this.unshift(this._list[r=r-1+s&this._capacityMask]);for(r=this._head-1+s&this._capacityMask;i>0;)this._list[r=r-1+s&this._capacityMask]=void 0,i--;e<0&&(this._tail=r)}else{for(this._tail=r,r=r+t+s&this._capacityMask,a=o-(t+e);a>0;a--)this.push(this._list[r++]);for(r=this._tail;i>0;)this._list[r=r+1+s&this._capacityMask]=void 0,i--}return this._head<2&&this._tail>1e4&&this._tail<=s>>>2&&this._shrinkArray(),n}}},t.prototype.splice=function(e,t){var n=e;if(n===(0|n)){var r=this.size();if(n<0&&(n+=r),!(n>r)){if(arguments.length>2){var i,o,s,a=arguments.length,l=this._list.length,c=2;if(!r||n<r/2){for(o=new Array(n),i=0;i<n;i++)o[i]=this._list[this._head+i&this._capacityMask];for(0===t?(s=[],n>0&&(this._head=this._head+n+l&this._capacityMask)):(s=this.remove(n,t),this._head=this._head+n+l&this._capacityMask);a>c;)this.unshift(arguments[--a]);for(i=n;i>0;i--)this.unshift(o[i-1])}else{var u=(o=new Array(r-(n+t))).length;for(i=0;i<u;i++)o[i]=this._list[this._head+n+t+i&this._capacityMask];for(0===t?(s=[],n!=r&&(this._tail=this._head+n+l&this._capacityMask)):(s=this.remove(n,t),this._tail=this._tail-u+l&this._capacityMask);c<a;)this.push(arguments[c++]);for(i=0;i<u;i++)this.push(o[i])}return s}return this.remove(n,t)}}},t.prototype.clear=function(){this._list=new Array(this._list.length),this._head=0,this._tail=0},t.prototype.isEmpty=function(){return this._head===this._tail},t.prototype.toArray=function(){return this._copyArray(!1)},t.prototype._fromArray=function(e){var t=e.length,n=this._nextPowerOf2(t);this._list=new Array(n),this._capacityMask=n-1,this._tail=t;for(var r=0;r<t;r++)this._list[r]=e[r]},t.prototype._copyArray=function(e,t){var n=this._list,r=n.length,i=this.length;if((t|=i)==i&&this._head<this._tail)return this._list.slice(this._head,this._tail);var o,s=new Array(t),a=0;if(e||this._head>this._tail){for(o=this._head;o<r;o++)s[a++]=n[o];for(o=0;o<this._tail;o++)s[a++]=n[o]}else for(o=this._head;o<this._tail;o++)s[a++]=n[o];return s},t.prototype._growArray=function(){if(0!=this._head){var e=this._copyArray(!0,this._list.length<<1);this._tail=this._list.length,this._head=0,this._list=e}else this._tail=this._list.length,this._list.length<<=1;this._capacityMask=this._capacityMask<<1|1},t.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1},t.prototype._nextPowerOf2=function(e){var t=1<<Math.log(e)/Math.log(2)+1;return Math.max(t,4)},e.exports=t},4823:e=>{"use strict";function t(e,t){for(const n in t)Object.defineProperty(e,n,{value:t[n],enumerable:!0,configurable:!0});return e}e.exports=function(e,n,r){if(!e||"string"===typeof e)throw new TypeError("Please pass an Error to err-code");r||(r={}),"object"===typeof n&&(r=n,n=""),n&&(r.code=n);try{return t(e,r)}catch(i){r.message=e.message,r.stack=e.stack;const n=function(){};n.prototype=Object.create(Object.getPrototypeOf(e));return t(new n,r)}}},2605:(e,t,n)=>{"use strict";const r=n(9020);t.PP=r.EventIterator,r.EventIterator},9020:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});class n{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;const t={value:e,done:!1};if(this.pullQueue.length){const e=this.pullQueue.shift();e&&e.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),void 0!==this.highWaterMark&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn("EventIterator queue reached ".concat(this.pushQueue.length," items")))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{const t=Promise.reject(e);t.catch((()=>{})),this.pushQueue.push(t)}}remove(){Promise.resolve().then((()=>{this.removeCallback&&this.removeCallback()}))}[Symbol.asyncIterator](){return{next:e=>{const t=this.pushQueue.shift();return t?(void 0!==this.lowWaterMark&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise(((e,t)=>{this.pullQueue.push({resolve:e,reject:t})}))},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class r{constructor(e){let{highWaterMark:t=100,lowWaterMark:r=1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=new n;i.highWaterMark=t,i.lowWaterMark=r,i.removeCallback=e({push:e=>i.push(e),stop:()=>i.stop(),fail:e=>i.fail(e),on:(e,t)=>{i.eventHandlers[e]=t}})||(()=>{}),this[Symbol.asyncIterator]=()=>i[Symbol.asyncIterator](),Object.freeze(this)}}t.EventIterator=r,t.default=r},7283:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,s){if("function"!==typeof r)throw new TypeError("The listener must be a function");var a=new i(r,o||e,s),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function s(e,t){0===--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),a.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,s=new Array(o);i<o;i++)s[i]=r[i].fn;return s},a.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,i,o,s){var a=n?n+e:e;if(!this._events[a])return!1;var l,c,u=this._events[a],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,r),!0;case 4:return u.fn.call(u.context,t,r,i),!0;case 5:return u.fn.call(u.context,t,r,i,o),!0;case 6:return u.fn.call(u.context,t,r,i,o,s),!0}for(c=1,l=new Array(h-1);c<h;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var d,f=u.length;for(c=0;c<f;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),h){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,r);break;case 4:u[c].fn.call(u[c].context,t,r,i);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];u[c].fn.apply(u[c].context,l)}}return!0},a.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||i&&!a.once||r&&a.context!==r||s(this,o);else{for(var l=0,c=[],u=a.length;l<u;l++)(a[l].fn!==t||i&&!a[l].once||r&&a[l].context!==r)&&c.push(a[l]);c.length?this._events[o]=1===c.length?c[0]:c:s(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a},7284:e=>{"use strict";var t,n="object"===typeof Reflect?Reflect:null,r=n&&"function"===typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"===typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!==e};function o(){o.init.call(this)}e.exports=o,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"===typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}g(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"===typeof e.on&&g(e,"error",t,n)}(e,i,{once:!0})}))},o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var s=10;function a(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function c(e,t,n,r){var i,o,s,c;if(a(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"===typeof s?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=l(e))>0&&s.length>i&&!s.warned){s.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=e,u.type=t,u.count=s.length,c=u,console&&console.warn&&console.warn(c)}return e}function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=u.bind(r);return i.listener=n,r.wrapFn=i,i}function d(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"===typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):p(i,i.length)}function f(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function p(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function g(e,t,n,r){if("function"===typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!==typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i="error"===e,o=this._events;if(void 0!==o)i=i&&void 0===o.error;else if(!i)return!1;if(i){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var l=o[e];if(void 0===l)return!1;if("function"===typeof l)r(l,this,t);else{var c=l.length,u=p(l,c);for(n=0;n<c;++n)r(u[n],this,t)}return!0},o.prototype.addListener=function(e,t){return c(this,e,t,!1)},o.prototype.on=o.prototype.addListener,o.prototype.prependListener=function(e,t){return c(this,e,t,!0)},o.prototype.once=function(e,t){return a(t),this.on(e,h(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return a(t),this.prependListener(e,h(this,e,t)),this},o.prototype.removeListener=function(e,t){var n,r,i,o,s;if(a(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!==typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.off=o.prototype.removeListener,o.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"===typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return d(this,e,!0)},o.prototype.rawListeners=function(e){return d(this,e,!1)},o.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):f.call(e,t)},o.prototype.listenerCount=f,o.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},101:e=>{e.exports=function(e){if(!e)throw Error("hashlru must have a max value, of type number, greater than 0");var t=0,n=Object.create(null),r=Object.create(null);function i(i,o){n[i]=o,++t>=e&&(t=0,r=n,n=Object.create(null))}return{has:function(e){return void 0!==n[e]||void 0!==r[e]},remove:function(e){void 0!==n[e]&&(n[e]=void 0),void 0!==r[e]&&(r[e]=void 0)},get:function(e){var t=n[e];return void 0!==t?t:void 0!==(t=r[e])?(i(e,t),t):void 0},set:function(e,t){void 0!==n[e]?n[e]=t:i(e,t)},clear:function(){n=Object.create(null),r=Object.create(null)}}}},6900:(e,t)=>{t.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,l=(1<<a)-1,c=l>>1,u=-7,h=n?i-1:0,d=n?-1:1,f=e[t+h];for(h+=d,o=f&(1<<-u)-1,f>>=-u,u+=a;u>0;o=256*o+e[t+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+e[t+h],h+=d,u-=8);if(0===o)o=1-c;else{if(o===l)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,r),o-=c}return(f?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var s,a,l,c=8*o-i-1,u=(1<<c)-1,h=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=u):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),(t+=s+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(s++,l/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(t*l-1)*Math.pow(2,i),s+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;e[n+f]=255&a,f+=p,a/=256,i-=8);for(s=s<<i|a,c+=i;c>0;e[n+f]=255&s,f+=p,s/=256,c-=8);e[n+f-p]|=128*g}},6329:e=>{"function"===typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},4053:e=>{e.exports=function(){return"undefined"!==typeof window&&"object"===typeof window.process&&"renderer"===window.process.type||(!("undefined"===typeof process||"object"!==typeof process.versions||!process.versions.electron)||"object"===typeof navigator&&"string"===typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0)}},8313:e=>{"use strict";e.exports=e=>{if("[object Object]"!==Object.prototype.toString.call(e))return!1;const t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}},5573:(e,t)=>{"use strict";t.supports=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=t.reduce(((e,t)=>Object.assign(e,t)),{});return Object.assign(r,{snapshots:r.snapshots||!1,permanence:r.permanence||!1,seek:r.seek||!1,clear:r.clear||!1,getMany:r.getMany||!1,keyIterator:r.keyIterator||!1,valueIterator:r.valueIterator||!1,iteratorNextv:r.iteratorNextv||!1,iteratorAll:r.iteratorAll||!1,status:r.status||!1,createIfMissing:r.createIfMissing||!1,errorIfExists:r.errorIfExists||!1,deferredOpen:r.deferredOpen||!1,promises:r.promises||!1,streams:r.streams||!1,encodings:Object.assign({},r.encodings),events:Object.assign({},r.events),additionalMethods:Object.assign({},r.additionalMethods)})}},6030:(e,t,n)=>{"use strict";const r=n(7155),i=n(4624),{Encoding:o}=n(7125),{BufferFormat:s,ViewFormat:a,UTF8Format:l}=n(6934),c=Symbol("formats"),u=Symbol("encodings"),h=new Set(["buffer","view","utf8"]);t.Transcoder=class{constructor(e){if(!Array.isArray(e))throw new TypeError("The first argument 'formats' must be an array");if(!e.every((e=>h.has(e))))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'");this[u]=new Map,this[c]=new Set(e);for(const n in i)try{this.encoding(n)}catch(t){if("LEVEL_ENCODING_NOT_SUPPORTED"!==t.code)throw t}}encodings(){return Array.from(new Set(this[u].values()))}encoding(e){let t=this[u].get(e);if(void 0===t){if("string"===typeof e&&""!==e){if(t=f[e],!t)throw new r("Encoding '".concat(e,"' is not found"),{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if("object"!==typeof e||null===e)throw new TypeError("First argument 'encoding' must be a string or object");t=function(e){if(e instanceof o)return e;const t="type"in e&&"string"===typeof e.type?e.type:void 0,n=e.name||t||"anonymous-".concat(p++);switch(function(e){return"format"in e&&void 0!==e.format?e.format:"buffer"in e&&"boolean"===typeof e.buffer?e.buffer?"buffer":"utf8":"code"in e&&Number.isInteger(e.code)?"view":"buffer"}(e)){case"view":return new a({...e,name:n});case"utf8":return new l({...e,name:n});case"buffer":return new s({...e,name:n});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}(e)}const{name:n,format:i}=t;if(!this[c].has(i))if(this[c].has("view"))t=t.createViewTranscoder();else if(this[c].has("buffer"))t=t.createBufferTranscoder();else{if(!this[c].has("utf8"))throw new r("Encoding '".concat(n,"' cannot be transcoded"),{code:"LEVEL_ENCODING_NOT_SUPPORTED"});t=t.createUTF8Transcoder()}for(const r of[e,n,t.name,t.commonName])this[u].set(r,t)}return t}};const d={binary:i.buffer,"utf-8":i.utf8},f={...i,...d};let p=0},7125:(e,t,n)=>{"use strict";const r=n(7155),i=new Set(["buffer","view","utf8"]);t.Encoding=class{constructor(e){if(this.encode=e.encode||this.encode,this.decode=e.decode||this.decode,this.name=e.name||this.name,this.format=e.format||this.format,"function"!==typeof this.encode)throw new TypeError("The 'encode' property must be a function");if("function"!==typeof this.decode)throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),"string"!==typeof this.name||""===this.name)throw new TypeError("The 'name' property must be a string");if("string"!==typeof this.format||!i.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");e.createViewTranscoder&&(this.createViewTranscoder=e.createViewTranscoder),e.createBufferTranscoder&&(this.createBufferTranscoder=e.createBufferTranscoder),e.createUTF8Transcoder&&(this.createUTF8Transcoder=e.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new r("Encoding '".concat(this.name,"' cannot be transcoded to 'buffer'"),{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new r("Encoding '".concat(this.name,"' cannot be transcoded to 'view'"),{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new r("Encoding '".concat(this.name,"' cannot be transcoded to 'utf8'"),{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}}},4624:(e,t,n)=>{"use strict";const{Buffer:r}=n(6382)||{Buffer:{isBuffer:()=>!1}},{textEncoder:i,textDecoder:o}=n(2595)(),{BufferFormat:s,ViewFormat:a,UTF8Format:l}=n(6934),c=e=>e;t.utf8=new l({encode:function(e){return r.isBuffer(e)?e.toString("utf8"):ArrayBuffer.isView(e)?o.decode(e):String(e)},decode:c,name:"utf8",createViewTranscoder(){return new a({encode:function(e){return ArrayBuffer.isView(e)?e:i.encode(e)},decode:function(e){return o.decode(e)},name:"".concat(this.name,"+view")})},createBufferTranscoder(){return new s({encode:function(e){return r.isBuffer(e)?e:ArrayBuffer.isView(e)?r.from(e.buffer,e.byteOffset,e.byteLength):r.from(String(e),"utf8")},decode:function(e){return e.toString("utf8")},name:"".concat(this.name,"+buffer")})}}),t.json=new l({encode:JSON.stringify,decode:JSON.parse,name:"json"}),t.buffer=new s({encode:function(e){return r.isBuffer(e)?e:ArrayBuffer.isView(e)?r.from(e.buffer,e.byteOffset,e.byteLength):r.from(String(e),"utf8")},decode:c,name:"buffer",createViewTranscoder(){return new a({encode:function(e){return ArrayBuffer.isView(e)?e:r.from(String(e),"utf8")},decode:function(e){return r.from(e.buffer,e.byteOffset,e.byteLength)},name:"".concat(this.name,"+view")})}}),t.view=new a({encode:function(e){return ArrayBuffer.isView(e)?e:i.encode(e)},decode:c,name:"view",createBufferTranscoder(){return new s({encode:function(e){return r.isBuffer(e)?e:ArrayBuffer.isView(e)?r.from(e.buffer,e.byteOffset,e.byteLength):r.from(String(e),"utf8")},decode:c,name:"".concat(this.name,"+buffer")})}}),t.hex=new s({encode:function(e){return r.isBuffer(e)?e:r.from(String(e),"hex")},decode:function(e){return e.toString("hex")},name:"hex"}),t.base64=new s({encode:function(e){return r.isBuffer(e)?e:r.from(String(e),"base64")},decode:function(e){return e.toString("base64")},name:"base64"})},6934:(e,t,n)=>{"use strict";const{Buffer:r}=n(6382)||{},{Encoding:i}=n(7125),o=n(2595);class s extends i{constructor(e){super({...e,format:"buffer"})}createViewTranscoder(){return new a({encode:this.encode,decode:e=>this.decode(r.from(e.buffer,e.byteOffset,e.byteLength)),name:"".concat(this.name,"+view")})}createBufferTranscoder(){return this}}class a extends i{constructor(e){super({...e,format:"view"})}createBufferTranscoder(){return new s({encode:e=>{const t=this.encode(e);return r.from(t.buffer,t.byteOffset,t.byteLength)},decode:this.decode,name:"".concat(this.name,"+buffer")})}createViewTranscoder(){return this}}t.BufferFormat=s,t.ViewFormat=a,t.UTF8Format=class extends i{constructor(e){super({...e,format:"utf8"})}createBufferTranscoder(){return new s({encode:e=>r.from(this.encode(e),"utf8"),decode:e=>this.decode(e.toString("utf8")),name:"".concat(this.name,"+buffer")})}createViewTranscoder(){const{textEncoder:e,textDecoder:t}=o();return new a({encode:t=>e.encode(this.encode(t)),decode:e=>this.decode(t.decode(e)),name:"".concat(this.name,"+view")})}createUTF8Transcoder(){return this}}},2595:e=>{"use strict";let t=null;e.exports=function(){return null===t&&(t={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),t}},1602:(e,t,n)=>{t.Level=n(9483).BrowserLevel},3477:(e,t,n)=>{var r=n(7284),i=n(6329);function o(e){if(!(this instanceof o))return new o(e);"number"===typeof e&&(e={max:e}),e||(e={}),r.EventEmitter.call(this),this.cache={},this.head=this.tail=null,this.length=0,this.max=e.max||1e3,this.maxAge=e.maxAge||0}e.exports=o,i(o,r.EventEmitter),Object.defineProperty(o.prototype,"keys",{get:function(){return Object.keys(this.cache)}}),o.prototype.clear=function(){this.cache={},this.head=this.tail=null,this.length=0},o.prototype.remove=function(e){if("string"!==typeof e&&(e=""+e),this.cache.hasOwnProperty(e)){var t=this.cache[e];return delete this.cache[e],this._unlink(e,t.prev,t.next),t.value}},o.prototype._unlink=function(e,t,n){this.length--,0===this.length?this.head=this.tail=null:this.head===e?(this.head=t,this.cache[this.head].next=null):this.tail===e?(this.tail=n,this.cache[this.tail].prev=null):(this.cache[t].next=n,this.cache[n].prev=t)},o.prototype.peek=function(e){if(this.cache.hasOwnProperty(e)){var t=this.cache[e];if(this._checkAge(e,t))return t.value}},o.prototype.set=function(e,t){var n;if("string"!==typeof e&&(e=""+e),this.cache.hasOwnProperty(e)){if((n=this.cache[e]).value=t,this.maxAge&&(n.modified=Date.now()),e===this.head)return t;this._unlink(e,n.prev,n.next)}else n={value:t,modified:0,next:null,prev:null},this.maxAge&&(n.modified=Date.now()),this.cache[e]=n,this.length===this.max&&this.evict();return this.length++,n.next=null,n.prev=this.head,this.head&&(this.cache[this.head].next=e),this.head=e,this.tail||(this.tail=e),t},o.prototype._checkAge=function(e,t){return!(this.maxAge&&Date.now()-t.modified>this.maxAge)||(this.remove(e),this.emit("evict",{key:e,value:t.value}),!1)},o.prototype.get=function(e){if("string"!==typeof e&&(e=""+e),this.cache.hasOwnProperty(e)){var t=this.cache[e];if(this._checkAge(e,t))return this.head!==e&&(e===this.tail?(this.tail=t.next,this.cache[this.tail].prev=null):this.cache[t.prev].next=t.next,this.cache[t.next].prev=t.prev,this.cache[this.head].next=e,t.prev=this.head,t.next=null,this.head=e),t.value}},o.prototype.evict=function(){if(this.tail){var e=this.tail,t=this.remove(this.tail);this.emit("evict",{key:e,value:t})}}},8355:function(e,t,n){"use strict";const r=n(8313),{hasOwnProperty:i}=Object.prototype,{propertyIsEnumerable:o}=Object,s=(e,t,n)=>Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0}),a=this,l={concatArrays:!1,ignoreUndefined:!1},c=e=>{const t=[];for(const n in e)i.call(e,n)&&t.push(n);if(Object.getOwnPropertySymbols){const n=Object.getOwnPropertySymbols(e);for(const r of n)o.call(e,r)&&t.push(r)}return t};function u(e){return Array.isArray(e)?function(e){const t=e.slice(0,0);return c(e).forEach((n=>{s(t,n,u(e[n]))})),t}(e):r(e)?function(e){const t=null===Object.getPrototypeOf(e)?Object.create(null):{};return c(e).forEach((n=>{s(t,n,u(e[n]))})),t}(e):e}const h=(e,t,n,r)=>(n.forEach((n=>{"undefined"===typeof t[n]&&r.ignoreUndefined||(n in e&&e[n]!==Object.getPrototypeOf(e)?s(e,n,f(e[n],t[n],r)):s(e,n,u(t[n])))})),e),d=(e,t,n)=>{let r=e.slice(0,0),o=0;return[e,t].forEach((t=>{const a=[];for(let n=0;n<t.length;n++)i.call(t,n)&&(a.push(String(n)),s(r,o++,t===e?t[n]:u(t[n])));r=h(r,t,c(t).filter((e=>!a.includes(e))),n)})),r};function f(e,t,n){return n.concatArrays&&Array.isArray(e)&&Array.isArray(t)?d(e,t,n):r(t)&&r(e)?h(e,t,c(t),n):u(t)}e.exports=function(){const e=f(u(l),this!==a&&this||{},l);let t={_:{}};for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];for(const s of i)if(void 0!==s){if(!r(s))throw new TypeError("`"+s+"` is not an Option Object");t=f(t,{_:s},e)}return t._}},7155:e=>{"use strict";e.exports=class extends Error{constructor(e,t){super(e||""),"object"===typeof t&&null!==t&&(t.code&&(this.code=String(t.code)),t.expected&&(this.expected=!0),t.transient&&(this.transient=!0),t.cause&&(this.cause=t.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}},7340:e=>{var t=1e3,n=60*t,r=60*n,i=24*r,o=7*i,s=365.25*i;function a(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}e.exports=function(e,l){l=l||{};var c=typeof e;if("string"===c&&e.length>0)return function(e){if((e=String(e)).length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!a)return;var l=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return l*s;case"weeks":case"week":case"w":return l*o;case"days":case"day":case"d":return l*i;case"hours":case"hour":case"hrs":case"hr":case"h":return l*r;case"minutes":case"minute":case"mins":case"min":case"m":return l*n;case"seconds":case"second":case"secs":case"sec":case"s":return l*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return l;default:return}}(e);if("number"===c&&isFinite(e))return l.long?function(e){var o=Math.abs(e);if(o>=i)return a(e,o,i,"day");if(o>=r)return a(e,o,r,"hour");if(o>=n)return a(e,o,n,"minute");if(o>=t)return a(e,o,t,"second");return e+" ms"}(e):function(e){var o=Math.abs(e);if(o>=i)return Math.round(e/i)+"d";if(o>=r)return Math.round(e/r)+"h";if(o>=n)return Math.round(e/n)+"m";if(o>=t)return Math.round(e/t)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},3540:(e,t,n)=>{"use strict";const{encodeText:r}=n(3065);e.exports=class{constructor(e,t,n,i){this.name=e,this.code=t,this.codeBuf=r(this.code),this.alphabet=i,this.codec=n(i)}encode(e){return this.codec.encode(e)}decode(e){for(const t of e)if(this.alphabet&&this.alphabet.indexOf(t)<0)throw new Error("invalid character '".concat(t,"' in '").concat(e,"'"));return this.codec.decode(e)}}},1240:(e,t,n)=>{"use strict";const r=n(405),i=n(3540),{rfc4648:o}=n(950),{decodeText:s,encodeText:a}=n(3065),l=[["identity","\0",()=>({encode:s,decode:a}),""],["base2","0",o(1),"01"],["base8","7",o(3),"01234567"],["base10","9",r,"0123456789"],["base16","f",o(4),"0123456789abcdef"],["base16upper","F",o(4),"0123456789ABCDEF"],["base32hex","v",o(5),"0123456789abcdefghijklmnopqrstuv"],["base32hexupper","V",o(5),"0123456789ABCDEFGHIJKLMNOPQRSTUV"],["base32hexpad","t",o(5),"0123456789abcdefghijklmnopqrstuv="],["base32hexpadupper","T",o(5),"0123456789ABCDEFGHIJKLMNOPQRSTUV="],["base32","b",o(5),"abcdefghijklmnopqrstuvwxyz234567"],["base32upper","B",o(5),"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"],["base32pad","c",o(5),"abcdefghijklmnopqrstuvwxyz234567="],["base32padupper","C",o(5),"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567="],["base32z","h",o(5),"ybndrfg8ejkmcpqxot1uwisza345h769"],["base36","k",r,"0123456789abcdefghijklmnopqrstuvwxyz"],["base36upper","K",r,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"],["base58btc","z",r,"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"],["base58flickr","Z",r,"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"],["base64","m",o(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"],["base64pad","M",o(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="],["base64url","u",o(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"],["base64urlpad","U",o(6),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_="]],c=l.reduce(((e,t)=>(e[t[0]]=new i(t[0],t[1],t[2],t[3]),e)),{}),u=l.reduce(((e,t)=>(e[t[1]]=c[t[0]],e)),{});e.exports={names:c,codes:u}},7841:(e,t,n)=>{"use strict";const r=n(1240),{encodeText:i,decodeText:o,concat:s}=n(3065);function a(e){if(Object.prototype.hasOwnProperty.call(r.names,e))return r.names[e];if(Object.prototype.hasOwnProperty.call(r.codes,e))return r.codes[e];throw new Error("Unsupported encoding: ".concat(e))}(t=e.exports=function(e,t){if(!t)throw new Error("requires an encoded Uint8Array");const{name:n,codeBuf:r}=a(e);return function(e,t){const n=a(e);n.decode(o(t))}(n,t),s([r,t],r.length+t.length)}).encode=function(e,t){const n=a(e),r=i(n.encode(t));return s([n.codeBuf,r],n.codeBuf.length+r.length)},t.decode=function(e){e instanceof Uint8Array&&(e=o(e));const t=e[0];return["f","F","v","V","t","T","b","B","c","C","h","k","K"].includes(t)&&(e=e.toLowerCase()),a(e[0]).decode(e.substring(1))},t.isEncoded=function(e){if(e instanceof Uint8Array&&(e=o(e)),"[object String]"!==Object.prototype.toString.call(e))return!1;try{return a(e[0]).name}catch(t){return!1}},t.encoding=a,t.encodingFromData=function(e){return e instanceof Uint8Array&&(e=o(e)),a(e[0])};const l=Object.freeze(r.names),c=Object.freeze(r.codes);t.names=l,t.codes=c},950:e=>{"use strict";e.exports={rfc4648:e=>t=>({encode:n=>((e,t,n)=>{const r="="===t[t.length-1],i=(1<<n)-1;let o="",s=0,a=0;for(let l=0;l<e.length;++l)for(a=a<<8|e[l],s+=8;s>n;)s-=n,o+=t[i&a>>s];if(s&&(o+=t[i&a<<n-s]),r)for(;o.length*n&7;)o+="=";return o})(n,t,e),decode:n=>((e,t,n)=>{const r={};for(let c=0;c<t.length;++c)r[t[c]]=c;let i=e.length;for(;"="===e[i-1];)--i;const o=new Uint8Array(i*n/8|0);let s=0,a=0,l=0;for(let c=0;c<i;++c){const t=r[e[c]];if(void 0===t)throw new SyntaxError("Invalid character "+e[c]);a=a<<n|t,s+=n,s>=8&&(s-=8,o[l++]=255&a>>s)}if(s>=n||255&a<<8-s)throw new SyntaxError("Unexpected end of data");return o})(n,t,e)})}},3065:e=>{"use strict";const t=new TextDecoder,n=new TextEncoder;e.exports={decodeText:e=>t.decode(e),encodeText:e=>n.encode(e),concat:function(e,t){const n=new Uint8Array(t);let r=0;for(const i of e)n.set(i,r),r+=i.length;return n}}},6797:e=>{e.exports=function e(r,i){var o,s=0,a=0,l=i=i||0,c=r.length;do{if(l>=c)throw e.bytes=0,new RangeError("Could not decode varint");o=r[l++],s+=a<28?(o&n)<<a:(o&n)*Math.pow(2,a),a+=7}while(o>=t);return e.bytes=l-i,s};var t=128,n=127},3525:e=>{e.exports=function e(i,o,s){o=o||[];var a=s=s||0;for(;i>=r;)o[s++]=255&i|t,i/=128;for(;i&n;)o[s++]=255&i|t,i>>>=7;return o[s]=0|i,e.bytes=s-a+1,o};var t=128,n=-128,r=Math.pow(2,31)},3475:(e,t,n)=>{e.exports={encode:n(3525),decode:n(6797),encodingLength:n(6395)}},6395:e=>{var t=Math.pow(2,7),n=Math.pow(2,14),r=Math.pow(2,21),i=Math.pow(2,28),o=Math.pow(2,35),s=Math.pow(2,42),a=Math.pow(2,49),l=Math.pow(2,56),c=Math.pow(2,63);e.exports=function(e){return e<t?1:e<n?2:e<r?3:e<i?4:e<o?5:e<s?6:e<a?7:e<l?8:e<c?9:10}},3137:e=>{"use strict";const t=Object.freeze({identity:0,sha1:17,"sha2-256":18,"sha2-512":19,"sha3-512":20,"sha3-384":21,"sha3-256":22,"sha3-224":23,"shake-128":24,"shake-256":25,"keccak-224":26,"keccak-256":27,"keccak-384":28,"keccak-512":29,blake3:30,"murmur3-128":34,"murmur3-32":35,"dbl-sha2-256":86,md4:212,md5:213,bmt:214,"sha2-256-trunc254-padded":4114,"ripemd-128":4178,"ripemd-160":4179,"ripemd-256":4180,"ripemd-320":4181,x11:4352,kangarootwelve:7425,"sm3-256":21325,"blake2b-8":45569,"blake2b-16":45570,"blake2b-24":45571,"blake2b-32":45572,"blake2b-40":45573,"blake2b-48":45574,"blake2b-56":45575,"blake2b-64":45576,"blake2b-72":45577,"blake2b-80":45578,"blake2b-88":45579,"blake2b-96":45580,"blake2b-104":45581,"blake2b-112":45582,"blake2b-120":45583,"blake2b-128":45584,"blake2b-136":45585,"blake2b-144":45586,"blake2b-152":45587,"blake2b-160":45588,"blake2b-168":45589,"blake2b-176":45590,"blake2b-184":45591,"blake2b-192":45592,"blake2b-200":45593,"blake2b-208":45594,"blake2b-216":45595,"blake2b-224":45596,"blake2b-232":45597,"blake2b-240":45598,"blake2b-248":45599,"blake2b-256":45600,"blake2b-264":45601,"blake2b-272":45602,"blake2b-280":45603,"blake2b-288":45604,"blake2b-296":45605,"blake2b-304":45606,"blake2b-312":45607,"blake2b-320":45608,"blake2b-328":45609,"blake2b-336":45610,"blake2b-344":45611,"blake2b-352":45612,"blake2b-360":45613,"blake2b-368":45614,"blake2b-376":45615,"blake2b-384":45616,"blake2b-392":45617,"blake2b-400":45618,"blake2b-408":45619,"blake2b-416":45620,"blake2b-424":45621,"blake2b-432":45622,"blake2b-440":45623,"blake2b-448":45624,"blake2b-456":45625,"blake2b-464":45626,"blake2b-472":45627,"blake2b-480":45628,"blake2b-488":45629,"blake2b-496":45630,"blake2b-504":45631,"blake2b-512":45632,"blake2s-8":45633,"blake2s-16":45634,"blake2s-24":45635,"blake2s-32":45636,"blake2s-40":45637,"blake2s-48":45638,"blake2s-56":45639,"blake2s-64":45640,"blake2s-72":45641,"blake2s-80":45642,"blake2s-88":45643,"blake2s-96":45644,"blake2s-104":45645,"blake2s-112":45646,"blake2s-120":45647,"blake2s-128":45648,"blake2s-136":45649,"blake2s-144":45650,"blake2s-152":45651,"blake2s-160":45652,"blake2s-168":45653,"blake2s-176":45654,"blake2s-184":45655,"blake2s-192":45656,"blake2s-200":45657,"blake2s-208":45658,"blake2s-216":45659,"blake2s-224":45660,"blake2s-232":45661,"blake2s-240":45662,"blake2s-248":45663,"blake2s-256":45664,"skein256-8":45825,"skein256-16":45826,"skein256-24":45827,"skein256-32":45828,"skein256-40":45829,"skein256-48":45830,"skein256-56":45831,"skein256-64":45832,"skein256-72":45833,"skein256-80":45834,"skein256-88":45835,"skein256-96":45836,"skein256-104":45837,"skein256-112":45838,"skein256-120":45839,"skein256-128":45840,"skein256-136":45841,"skein256-144":45842,"skein256-152":45843,"skein256-160":45844,"skein256-168":45845,"skein256-176":45846,"skein256-184":45847,"skein256-192":45848,"skein256-200":45849,"skein256-208":45850,"skein256-216":45851,"skein256-224":45852,"skein256-232":45853,"skein256-240":45854,"skein256-248":45855,"skein256-256":45856,"skein512-8":45857,"skein512-16":45858,"skein512-24":45859,"skein512-32":45860,"skein512-40":45861,"skein512-48":45862,"skein512-56":45863,"skein512-64":45864,"skein512-72":45865,"skein512-80":45866,"skein512-88":45867,"skein512-96":45868,"skein512-104":45869,"skein512-112":45870,"skein512-120":45871,"skein512-128":45872,"skein512-136":45873,"skein512-144":45874,"skein512-152":45875,"skein512-160":45876,"skein512-168":45877,"skein512-176":45878,"skein512-184":45879,"skein512-192":45880,"skein512-200":45881,"skein512-208":45882,"skein512-216":45883,"skein512-224":45884,"skein512-232":45885,"skein512-240":45886,"skein512-248":45887,"skein512-256":45888,"skein512-264":45889,"skein512-272":45890,"skein512-280":45891,"skein512-288":45892,"skein512-296":45893,"skein512-304":45894,"skein512-312":45895,"skein512-320":45896,"skein512-328":45897,"skein512-336":45898,"skein512-344":45899,"skein512-352":45900,"skein512-360":45901,"skein512-368":45902,"skein512-376":45903,"skein512-384":45904,"skein512-392":45905,"skein512-400":45906,"skein512-408":45907,"skein512-416":45908,"skein512-424":45909,"skein512-432":45910,"skein512-440":45911,"skein512-448":45912,"skein512-456":45913,"skein512-464":45914,"skein512-472":45915,"skein512-480":45916,"skein512-488":45917,"skein512-496":45918,"skein512-504":45919,"skein512-512":45920,"skein1024-8":45921,"skein1024-16":45922,"skein1024-24":45923,"skein1024-32":45924,"skein1024-40":45925,"skein1024-48":45926,"skein1024-56":45927,"skein1024-64":45928,"skein1024-72":45929,"skein1024-80":45930,"skein1024-88":45931,"skein1024-96":45932,"skein1024-104":45933,"skein1024-112":45934,"skein1024-120":45935,"skein1024-128":45936,"skein1024-136":45937,"skein1024-144":45938,"skein1024-152":45939,"skein1024-160":45940,"skein1024-168":45941,"skein1024-176":45942,"skein1024-184":45943,"skein1024-192":45944,"skein1024-200":45945,"skein1024-208":45946,"skein1024-216":45947,"skein1024-224":45948,"skein1024-232":45949,"skein1024-240":45950,"skein1024-248":45951,"skein1024-256":45952,"skein1024-264":45953,"skein1024-272":45954,"skein1024-280":45955,"skein1024-288":45956,"skein1024-296":45957,"skein1024-304":45958,"skein1024-312":45959,"skein1024-320":45960,"skein1024-328":45961,"skein1024-336":45962,"skein1024-344":45963,"skein1024-352":45964,"skein1024-360":45965,"skein1024-368":45966,"skein1024-376":45967,"skein1024-384":45968,"skein1024-392":45969,"skein1024-400":45970,"skein1024-408":45971,"skein1024-416":45972,"skein1024-424":45973,"skein1024-432":45974,"skein1024-440":45975,"skein1024-448":45976,"skein1024-456":45977,"skein1024-464":45978,"skein1024-472":45979,"skein1024-480":45980,"skein1024-488":45981,"skein1024-496":45982,"skein1024-504":45983,"skein1024-512":45984,"skein1024-520":45985,"skein1024-528":45986,"skein1024-536":45987,"skein1024-544":45988,"skein1024-552":45989,"skein1024-560":45990,"skein1024-568":45991,"skein1024-576":45992,"skein1024-584":45993,"skein1024-592":45994,"skein1024-600":45995,"skein1024-608":45996,"skein1024-616":45997,"skein1024-624":45998,"skein1024-632":45999,"skein1024-640":46e3,"skein1024-648":46001,"skein1024-656":46002,"skein1024-664":46003,"skein1024-672":46004,"skein1024-680":46005,"skein1024-688":46006,"skein1024-696":46007,"skein1024-704":46008,"skein1024-712":46009,"skein1024-720":46010,"skein1024-728":46011,"skein1024-736":46012,"skein1024-744":46013,"skein1024-752":46014,"skein1024-760":46015,"skein1024-768":46016,"skein1024-776":46017,"skein1024-784":46018,"skein1024-792":46019,"skein1024-800":46020,"skein1024-808":46021,"skein1024-816":46022,"skein1024-824":46023,"skein1024-832":46024,"skein1024-840":46025,"skein1024-848":46026,"skein1024-856":46027,"skein1024-864":46028,"skein1024-872":46029,"skein1024-880":46030,"skein1024-888":46031,"skein1024-896":46032,"skein1024-904":46033,"skein1024-912":46034,"skein1024-920":46035,"skein1024-928":46036,"skein1024-936":46037,"skein1024-944":46038,"skein1024-952":46039,"skein1024-960":46040,"skein1024-968":46041,"skein1024-976":46042,"skein1024-984":46043,"skein1024-992":46044,"skein1024-1000":46045,"skein1024-1008":46046,"skein1024-1016":46047,"skein1024-1024":46048,"poseidon-bls12_381-a2-fc1":46081,"poseidon-bls12_381-a2-fc1-sc":46082});e.exports={names:t}},3180:(e,t,n)=>{"use strict";const r=n(7841),i=n(3475),{names:o}=n(3137),{toString:s}=n(6232),{fromString:a}=n(223),{concat:l}=n(17),c={};for(const g in o){const e=g;c[o[e]]=e}function u(e){if(!(e instanceof Uint8Array))throw new Error("multihash must be a Uint8Array");if(e.length<2)throw new Error("multihash too short. must be > 2 bytes.");const t=i.decode(e);if(!f(t))throw new Error("multihash unknown function code: 0x".concat(t.toString(16)));e=e.slice(i.decode.bytes);const n=i.decode(e);if(n<0)throw new Error("multihash invalid length: ".concat(n));if((e=e.slice(i.decode.bytes)).length!==n)throw new Error("multihash length inconsistent: 0x".concat(s(e,"base16")));return{code:t,name:c[t],length:n,digest:e}}function h(e){let t=e;if("string"===typeof e){if(void 0===o[e])throw new Error("Unrecognized hash function named: ".concat(e));t=o[e]}if("number"!==typeof t)throw new Error("Hash function code should be a number. Got: ".concat(t));if(void 0===c[t]&&!d(t))throw new Error("Unrecognized function code: ".concat(t));return t}function d(e){return e>0&&e<16}function f(e){return!!d(e)||!!c[e]}function p(e){u(e)}Object.freeze(c),e.exports={names:o,codes:c,toHexString:function(e){if(!(e instanceof Uint8Array))throw new Error("must be passed a Uint8Array");return s(e,"base16")},fromHexString:function(e){return a(e,"base16")},toB58String:function(e){if(!(e instanceof Uint8Array))throw new Error("must be passed a Uint8Array");return s(r.encode("base58btc",e)).slice(1)},fromB58String:function(e){const t=e instanceof Uint8Array?s(e):e;return r.decode("z"+t)},decode:u,encode:function(e,t,n){if(!e||void 0===t)throw new Error("multihash encode requires at least two args: digest, code");const r=h(t);if(!(e instanceof Uint8Array))throw new Error("digest should be a Uint8Array");if(null==n&&(n=e.length),n&&e.length!==n)throw new Error("digest length should be equal to specified length.");const o=i.encode(r),s=i.encode(n);return l([o,s,e],o.length+s.length+e.length)},coerceCode:h,isAppCode:d,validate:p,prefix:function(e){return p(e),e.subarray(0,2)},isValidCode:f}},2962:(e,t,n)=>{e.exports=n(892)},892:function(e,t){!function(n,r){"use strict";var i={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function o(e){if(!Array.isArray(e)&&!ArrayBuffer.isView(e))return!1;for(var t=0;t<e.length;t++)if(!Number.isInteger(e[t])||e[t]<0||e[t]>255)return!1;return!0}function s(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function a(e,t){return e<<t|e>>>32-t}function l(e){return e=s(e^=e>>>16,2246822507),e=s(e^=e>>>13,3266489909),e^=e>>>16}function c(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]+t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]+t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]+t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]+t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function u(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]*t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]*t[3],n[1]+=n[2]>>>16,n[2]&=65535,n[2]+=e[3]*t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]*t[3],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[2]*t[2],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[3]*t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function h(e,t){return 32===(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])}function d(e,t){return 0===(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]}function f(e,t){return[e[0]^t[0],e[1]^t[1]]}function p(e){return e=f(e,[0,e[0]>>>1]),e=f(e=u(e,[4283543511,3981806797]),[0,e[0]>>>1]),e=f(e=u(e,[3301882366,444984403]),[0,e[0]>>>1])}i.x86.hash32=function(e,t){if(i.inputValidation&&!o(e))return r;t=t||0;for(var n=e.length%4,c=e.length-n,u=t,h=0,d=3432918353,f=461845907,p=0;p<c;p+=4)h=s(h=e[p]|e[p+1]<<8|e[p+2]<<16|e[p+3]<<24,d),h=s(h=a(h,15),f),u=s(u=a(u^=h,13),5)+3864292196;switch(h=0,n){case 3:h^=e[p+2]<<16;case 2:h^=e[p+1]<<8;case 1:h=s(h^=e[p],d),u^=h=s(h=a(h,15),f)}return(u=l(u^=e.length))>>>0},i.x86.hash128=function(e,t){if(i.inputValidation&&!o(e))return r;t=t||0;for(var n=e.length%16,c=e.length-n,u=t,h=t,d=t,f=t,p=0,g=0,y=0,v=0,m=597399067,w=2869860233,b=951274213,E=2716044179,_=0;_<c;_+=16)p=e[_]|e[_+1]<<8|e[_+2]<<16|e[_+3]<<24,g=e[_+4]|e[_+5]<<8|e[_+6]<<16|e[_+7]<<24,y=e[_+8]|e[_+9]<<8|e[_+10]<<16|e[_+11]<<24,v=e[_+12]|e[_+13]<<8|e[_+14]<<16|e[_+15]<<24,p=a(p=s(p,m),15),u=a(u^=p=s(p,w),19),u=s(u+=h,5)+1444728091,g=a(g=s(g,w),16),h=a(h^=g=s(g,b),17),h=s(h+=d,5)+197830471,y=a(y=s(y,b),17),d=a(d^=y=s(y,E),15),d=s(d+=f,5)+2530024501,v=a(v=s(v,E),18),f=a(f^=v=s(v,m),13),f=s(f+=u,5)+850148119;switch(p=0,g=0,y=0,v=0,n){case 15:v^=e[_+14]<<16;case 14:v^=e[_+13]<<8;case 13:v=s(v^=e[_+12],E),f^=v=s(v=a(v,18),m);case 12:y^=e[_+11]<<24;case 11:y^=e[_+10]<<16;case 10:y^=e[_+9]<<8;case 9:y=s(y^=e[_+8],b),d^=y=s(y=a(y,17),E);case 8:g^=e[_+7]<<24;case 7:g^=e[_+6]<<16;case 6:g^=e[_+5]<<8;case 5:g=s(g^=e[_+4],w),h^=g=s(g=a(g,16),b);case 4:p^=e[_+3]<<24;case 3:p^=e[_+2]<<16;case 2:p^=e[_+1]<<8;case 1:p=s(p^=e[_],m),u^=p=s(p=a(p,15),w)}return u^=e.length,u+=h^=e.length,u+=d^=e.length,h+=u+=f^=e.length,d+=u,f+=u,u=l(u),u+=h=l(h),u+=d=l(d),h+=u+=f=l(f),d+=u,f+=u,("00000000"+(u>>>0).toString(16)).slice(-8)+("00000000"+(h>>>0).toString(16)).slice(-8)+("00000000"+(d>>>0).toString(16)).slice(-8)+("00000000"+(f>>>0).toString(16)).slice(-8)},i.x64.hash128=function(e,t){if(i.inputValidation&&!o(e))return r;t=t||0;for(var n=e.length%16,s=e.length-n,a=[0,t],l=[0,t],g=[0,0],y=[0,0],v=[2277735313,289559509],m=[1291169091,658871167],w=0;w<s;w+=16)g=[e[w+4]|e[w+5]<<8|e[w+6]<<16|e[w+7]<<24,e[w]|e[w+1]<<8|e[w+2]<<16|e[w+3]<<24],y=[e[w+12]|e[w+13]<<8|e[w+14]<<16|e[w+15]<<24,e[w+8]|e[w+9]<<8|e[w+10]<<16|e[w+11]<<24],g=h(g=u(g,v),31),a=c(a=h(a=f(a,g=u(g,m)),27),l),a=c(u(a,[0,5]),[0,1390208809]),y=h(y=u(y,m),33),l=c(l=h(l=f(l,y=u(y,v)),31),a),l=c(u(l,[0,5]),[0,944331445]);switch(g=[0,0],y=[0,0],n){case 15:y=f(y,d([0,e[w+14]],48));case 14:y=f(y,d([0,e[w+13]],40));case 13:y=f(y,d([0,e[w+12]],32));case 12:y=f(y,d([0,e[w+11]],24));case 11:y=f(y,d([0,e[w+10]],16));case 10:y=f(y,d([0,e[w+9]],8));case 9:y=u(y=f(y,[0,e[w+8]]),m),l=f(l,y=u(y=h(y,33),v));case 8:g=f(g,d([0,e[w+7]],56));case 7:g=f(g,d([0,e[w+6]],48));case 6:g=f(g,d([0,e[w+5]],40));case 5:g=f(g,d([0,e[w+4]],32));case 4:g=f(g,d([0,e[w+3]],24));case 3:g=f(g,d([0,e[w+2]],16));case 2:g=f(g,d([0,e[w+1]],8));case 1:g=u(g=f(g,[0,e[w]]),v),a=f(a,g=u(g=h(g,31),m))}return a=c(a=f(a,[0,e.length]),l=f(l,[0,e.length])),l=c(l,a),a=c(a=p(a),l=p(l)),l=c(l,a),("00000000"+(a[0]>>>0).toString(16)).slice(-8)+("00000000"+(a[1]>>>0).toString(16)).slice(-8)+("00000000"+(l[0]>>>0).toString(16)).slice(-8)+("00000000"+(l[1]>>>0).toString(16)).slice(-8)},e.exports&&(t=e.exports=i),t.murmurHash3=i}()},7364:function(e,t){(function(){var e,n,r,i,o,s,a,l;l=function(e){return[(e&255<<24)>>>24,(e&255<<16)>>>16,(65280&e)>>>8,255&e].join(".")},a=function(e){var t,r,i,o,s,a;for(t=[],i=o=0;o<=3&&0!==e.length;i=++o){if(i>0){if("."!==e[0])throw new Error("Invalid IP");e=e.substring(1)}s=(a=n(e))[0],r=a[1],e=e.substring(r),t.push(s)}if(0!==e.length)throw new Error("Invalid IP");switch(t.length){case 1:if(t[0]>4294967295)throw new Error("Invalid IP");return t[0]>>>0;case 2:if(t[0]>255||t[1]>16777215)throw new Error("Invalid IP");return(t[0]<<24|t[1])>>>0;case 3:if(t[0]>255||t[1]>255||t[2]>65535)throw new Error("Invalid IP");return(t[0]<<24|t[1]<<16|t[2])>>>0;case 4:if(t[0]>255||t[1]>255||t[2]>255||t[3]>255)throw new Error("Invalid IP");return(t[0]<<24|t[1]<<16|t[2]<<8|t[3])>>>0;default:throw new Error("Invalid IP")}},i=(r=function(e){return e.charCodeAt(0)})("0"),s=r("a"),o=r("A"),n=function(e){var t,n,a,l,c;for(l=0,t=10,n="9",a=0,e.length>1&&"0"===e[a]&&("x"===e[a+1]||"X"===e[a+1]?(a+=2,t=16):"0"<=e[a+1]&&e[a+1]<="9"&&(a++,t=8,n="7")),c=a;a<e.length;){if("0"<=e[a]&&e[a]<=n)l=l*t+(r(e[a])-i)>>>0;else{if(16!==t)break;if("a"<=e[a]&&e[a]<="f")l=l*t+(10+r(e[a])-s)>>>0;else{if(!("A"<=e[a]&&e[a]<="F"))break;l=l*t+(10+r(e[a])-o)>>>0}}if(l>4294967295)throw new Error("too large");a++}if(a===c)throw new Error("empty octet");return[l,a]},e=function(){function e(e,t){var n,r,i;if("string"!==typeof e)throw new Error("Missing `net' parameter");if(t||(i=e.split("/",2),e=i[0],t=i[1]),t||(t=32),"string"===typeof t&&t.indexOf(".")>-1){try{this.maskLong=a(t)}catch(o){throw o,new Error("Invalid mask: "+t)}for(n=r=32;r>=0;n=--r)if(this.maskLong===4294967295<<32-n>>>0){this.bitmask=n;break}}else{if(!t&&0!==t)throw new Error("Invalid mask: empty");this.bitmask=parseInt(t,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0)}try{this.netLong=(a(e)&this.maskLong)>>>0}catch(o){throw o,new Error("Invalid net address: "+e)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+t);this.size=Math.pow(2,32-this.bitmask),this.base=l(this.netLong),this.mask=l(this.maskLong),this.hostmask=l(~this.maskLong),this.first=this.bitmask<=30?l(this.netLong+1):this.base,this.last=this.bitmask<=30?l(this.netLong+this.size-2):l(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?l(this.netLong+this.size-1):void 0}return e.prototype.contains=function(t){return"string"===typeof t&&(t.indexOf("/")>0||4!==t.split(".").length)&&(t=new e(t)),t instanceof e?this.contains(t.base)&&this.contains(t.broadcast||t.last):(a(t)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},e.prototype.next=function(t){return null==t&&(t=1),new e(l(this.netLong+this.size*t),this.mask)},e.prototype.forEach=function(e){var t,n,r;for(r=a(this.first),n=a(this.last),t=0;r<=n;)e(l(r),r,t),t++,r++},e.prototype.toString=function(){return this.base+"/"+this.bitmask},e}(),t.ip2long=a,t.long2ip=l,t.Netmask=e}).call(this)},9353:(e,t,n)=>{var r=n(45);function i(e,t){r.cipher.registerAlgorithm(e,(function(){return new r.aes.Algorithm(e,t)}))}n(9151),n(1655),n(3900),e.exports=r.aes=r.aes||{},r.aes.startEncrypting=function(e,t,n,r){var i=g({key:e,output:n,decrypt:!1,mode:r});return i.start(t),i},r.aes.createEncryptionCipher=function(e,t){return g({key:e,output:null,decrypt:!1,mode:t})},r.aes.startDecrypting=function(e,t,n,r){var i=g({key:e,output:n,decrypt:!0,mode:r});return i.start(t),i},r.aes.createDecryptionCipher=function(e,t){return g({key:e,output:null,decrypt:!0,mode:t})},r.aes.Algorithm=function(e,t){u||d();var n=this;n.name=e,n.mode=new t({blockSize:16,cipher:{encrypt:function(e,t){return p(n._w,e,t,!1)},decrypt:function(e,t){return p(n._w,e,t,!0)}}}),n._init=!1},r.aes.Algorithm.prototype.initialize=function(e){if(!this._init){var t,n=e.key;if("string"!==typeof n||16!==n.length&&24!==n.length&&32!==n.length){if(r.util.isArray(n)&&(16===n.length||24===n.length||32===n.length)){t=n,n=r.util.createBuffer();for(var i=0;i<t.length;++i)n.putByte(t[i])}}else n=r.util.createBuffer(n);if(!r.util.isArray(n)){t=n,n=[];var o=t.length();if(16===o||24===o||32===o){o>>>=2;for(i=0;i<o;++i)n.push(t.getInt32())}}if(!r.util.isArray(n)||4!==n.length&&6!==n.length&&8!==n.length)throw new Error("Invalid key parameter.");var s=this.mode.name,a=-1!==["CFB","OFB","CTR","GCM"].indexOf(s);this._w=f(n,e.decrypt&&!a),this._init=!0}},r.aes._expandKey=function(e,t){return u||d(),f(e,t)},r.aes._updateBlock=p,i("AES-ECB",r.cipher.modes.ecb),i("AES-CBC",r.cipher.modes.cbc),i("AES-CFB",r.cipher.modes.cfb),i("AES-OFB",r.cipher.modes.ofb),i("AES-CTR",r.cipher.modes.ctr),i("AES-GCM",r.cipher.modes.gcm);var o,s,a,l,c,u=!1,h=4;function d(){u=!0,a=[0,1,2,4,8,16,32,64,128,27,54];for(var e=new Array(256),t=0;t<128;++t)e[t]=t<<1,e[t+128]=t+128<<1^283;o=new Array(256),s=new Array(256),l=new Array(4),c=new Array(4);for(t=0;t<4;++t)l[t]=new Array(256),c[t]=new Array(256);var n,r,i,h,d,f,p,g=0,y=0;for(t=0;t<256;++t){h=(h=y^y<<1^y<<2^y<<3^y<<4)>>8^255&h^99,o[g]=h,s[h]=g,f=(d=e[h])<<24^h<<16^h<<8^h^d,p=((n=e[g])^(r=e[n])^(i=e[r]))<<24^(g^i)<<16^(g^r^i)<<8^g^n^i;for(var v=0;v<4;++v)l[v][g]=f,c[v][h]=p,f=f<<24|f>>>8,p=p<<24|p>>>8;0===g?g=y=1:(g=n^e[e[e[n^i]]],y^=e[e[y]])}}function f(e,t){for(var n,r=e.slice(0),i=1,s=r.length,l=h*(s+6+1),u=s;u<l;++u)n=r[u-1],u%s===0?(n=o[n>>>16&255]<<24^o[n>>>8&255]<<16^o[255&n]<<8^o[n>>>24]^a[i]<<24,i++):s>6&&u%s===4&&(n=o[n>>>24]<<24^o[n>>>16&255]<<16^o[n>>>8&255]<<8^o[255&n]),r[u]=r[u-s]^n;if(t){for(var d,f=c[0],p=c[1],g=c[2],y=c[3],v=r.slice(0),m=(u=0,(l=r.length)-h);u<l;u+=h,m-=h)if(0===u||u===l-h)v[u]=r[m],v[u+1]=r[m+3],v[u+2]=r[m+2],v[u+3]=r[m+1];else for(var w=0;w<h;++w)d=r[m+w],v[u+(3&-w)]=f[o[d>>>24]]^p[o[d>>>16&255]]^g[o[d>>>8&255]]^y[o[255&d]];r=v}return r}function p(e,t,n,r){var i,a,u,h,d,f,p,g,y,v,m,w,b=e.length/4-1;r?(i=c[0],a=c[1],u=c[2],h=c[3],d=s):(i=l[0],a=l[1],u=l[2],h=l[3],d=o),f=t[0]^e[0],p=t[r?3:1]^e[1],g=t[2]^e[2],y=t[r?1:3]^e[3];for(var E=3,_=1;_<b;++_)v=i[f>>>24]^a[p>>>16&255]^u[g>>>8&255]^h[255&y]^e[++E],m=i[p>>>24]^a[g>>>16&255]^u[y>>>8&255]^h[255&f]^e[++E],w=i[g>>>24]^a[y>>>16&255]^u[f>>>8&255]^h[255&p]^e[++E],y=i[y>>>24]^a[f>>>16&255]^u[p>>>8&255]^h[255&g]^e[++E],f=v,p=m,g=w;n[0]=d[f>>>24]<<24^d[p>>>16&255]<<16^d[g>>>8&255]<<8^d[255&y]^e[++E],n[r?3:1]=d[p>>>24]<<24^d[g>>>16&255]<<16^d[y>>>8&255]<<8^d[255&f]^e[++E],n[2]=d[g>>>24]<<24^d[y>>>16&255]<<16^d[f>>>8&255]<<8^d[255&p]^e[++E],n[r?1:3]=d[y>>>24]<<24^d[f>>>16&255]<<16^d[p>>>8&255]<<8^d[255&g]^e[++E]}function g(e){var t,n="AES-"+((e=e||{}).mode||"CBC").toUpperCase(),i=(t=e.decrypt?r.cipher.createDecipher(n,e.key):r.cipher.createCipher(n,e.key)).start;return t.start=function(e,n){var o=null;n instanceof r.util.ByteBuffer&&(o=n,n={}),(n=n||{}).output=o,n.iv=e,i.call(t,n)},t}},5465:(e,t,n)=>{var r=n(45);n(3900),n(3225);var i=e.exports=r.asn1=r.asn1||{};function o(e,t,n){if(n>t){var r=new Error("Too few bytes to parse DER.");throw r.available=e.length(),r.remaining=t,r.requested=n,r}}i.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192},i.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30},i.create=function(e,t,n,o,s){if(r.util.isArray(o)){for(var a=[],l=0;l<o.length;++l)void 0!==o[l]&&a.push(o[l]);o=a}var c={tagClass:e,type:t,constructed:n,composed:n||r.util.isArray(o),value:o};return s&&"bitStringContents"in s&&(c.bitStringContents=s.bitStringContents,c.original=i.copy(c)),c},i.copy=function(e,t){var n;if(r.util.isArray(e)){n=[];for(var o=0;o<e.length;++o)n.push(i.copy(e[o],t));return n}return"string"===typeof e?e:(n={tagClass:e.tagClass,type:e.type,constructed:e.constructed,composed:e.composed,value:i.copy(e.value,t)},t&&!t.excludeBitStringContents&&(n.bitStringContents=e.bitStringContents),n)},i.equals=function(e,t,n){if(r.util.isArray(e)){if(!r.util.isArray(t))return!1;if(e.length!==t.length)return!1;for(var o=0;o<e.length;++o)if(!i.equals(e[o],t[o]))return!1;return!0}if(typeof e!==typeof t)return!1;if("string"===typeof e)return e===t;var s=e.tagClass===t.tagClass&&e.type===t.type&&e.constructed===t.constructed&&e.composed===t.composed&&i.equals(e.value,t.value);return n&&n.includeBitStringContents&&(s=s&&e.bitStringContents===t.bitStringContents),s},i.getBerValueLength=function(e){var t=e.getByte();if(128!==t)return 128&t?e.getInt((127&t)<<3):t};function s(e,t,n,r){var a;o(e,t,2);var l=e.getByte();t--;var c=192&l,u=31&l;a=e.length();var h,d,f=function(e,t){var n=e.getByte();if(t--,128!==n){var r;if(128&n){var i=127&n;o(e,t,i),r=e.getInt(i<<3)}else r=n;if(r<0)throw new Error("Negative length: "+r);return r}}(e,t);if(t-=a-e.length(),void 0!==f&&f>t){if(r.strict){var p=new Error("Too few bytes to read ASN.1 value.");throw p.available=e.length(),p.remaining=t,p.requested=f,p}f=t}var g=32===(32&l);if(g)if(h=[],void 0===f)for(;;){if(o(e,t,2),e.bytes(2)===String.fromCharCode(0,0)){e.getBytes(2),t-=2;break}a=e.length(),h.push(s(e,t,n+1,r)),t-=a-e.length()}else for(;f>0;)a=e.length(),h.push(s(e,f,n+1,r)),t-=a-e.length(),f-=a-e.length();if(void 0===h&&c===i.Class.UNIVERSAL&&u===i.Type.BITSTRING&&(d=e.bytes(f)),void 0===h&&r.decodeBitStrings&&c===i.Class.UNIVERSAL&&u===i.Type.BITSTRING&&f>1){var y=e.read,v=t,m=0;if(u===i.Type.BITSTRING&&(o(e,t,1),m=e.getByte(),t--),0===m)try{a=e.length();var w=s(e,t,n+1,{strict:!0,decodeBitStrings:!0}),b=a-e.length();t-=b,u==i.Type.BITSTRING&&b++;var E=w.tagClass;b!==f||E!==i.Class.UNIVERSAL&&E!==i.Class.CONTEXT_SPECIFIC||(h=[w])}catch(S){}void 0===h&&(e.read=y,t=v)}if(void 0===h){if(void 0===f){if(r.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");f=t}if(u===i.Type.BMPSTRING)for(h="";f>0;f-=2)o(e,t,2),h+=String.fromCharCode(e.getInt16()),t-=2;else h=e.getBytes(f),t-=f}var _=void 0===d?null:{bitStringContents:d};return i.create(c,u,g,h,_)}i.fromDer=function(e,t){void 0===t&&(t={strict:!0,parseAllBytes:!0,decodeBitStrings:!0}),"boolean"===typeof t&&(t={strict:t,parseAllBytes:!0,decodeBitStrings:!0}),"strict"in t||(t.strict=!0),"parseAllBytes"in t||(t.parseAllBytes=!0),"decodeBitStrings"in t||(t.decodeBitStrings=!0),"string"===typeof e&&(e=r.util.createBuffer(e));var n=e.length(),i=s(e,e.length(),0,t);if(t.parseAllBytes&&0!==e.length()){var o=new Error("Unparsed DER bytes remain after ASN.1 parsing.");throw o.byteCount=n,o.remaining=e.length(),o}return i},i.toDer=function(e){var t=r.util.createBuffer(),n=e.tagClass|e.type,o=r.util.createBuffer(),s=!1;if("bitStringContents"in e&&(s=!0,e.original&&(s=i.equals(e,e.original))),s)o.putBytes(e.bitStringContents);else if(e.composed){e.constructed?n|=32:o.putByte(0);for(var a=0;a<e.value.length;++a)void 0!==e.value[a]&&o.putBuffer(i.toDer(e.value[a]))}else if(e.type===i.Type.BMPSTRING)for(a=0;a<e.value.length;++a)o.putInt16(e.value.charCodeAt(a));else e.type===i.Type.INTEGER&&e.value.length>1&&(0===e.value.charCodeAt(0)&&0===(128&e.value.charCodeAt(1))||255===e.value.charCodeAt(0)&&128===(128&e.value.charCodeAt(1)))?o.putBytes(e.value.substr(1)):o.putBytes(e.value);if(t.putByte(n),o.length()<=127)t.putByte(127&o.length());else{var l=o.length(),c="";do{c+=String.fromCharCode(255&l),l>>>=8}while(l>0);t.putByte(128|c.length);for(a=c.length-1;a>=0;--a)t.putByte(c.charCodeAt(a))}return t.putBuffer(o),t},i.oidToDer=function(e){var t,n,i,o,s=e.split("."),a=r.util.createBuffer();a.putByte(40*parseInt(s[0],10)+parseInt(s[1],10));for(var l=2;l<s.length;++l){t=!0,n=[],i=parseInt(s[l],10);do{o=127&i,i>>>=7,t||(o|=128),n.push(o),t=!1}while(i>0);for(var c=n.length-1;c>=0;--c)a.putByte(n[c])}return a},i.derToOid=function(e){var t;"string"===typeof e&&(e=r.util.createBuffer(e));var n=e.getByte();t=Math.floor(n/40)+"."+n%40;for(var i=0;e.length()>0;)i<<=7,128&(n=e.getByte())?i+=127&n:(t+="."+(i+n),i=0);return t},i.utcTimeToDate=function(e){var t=new Date,n=parseInt(e.substr(0,2),10);n=n>=50?1900+n:2e3+n;var r=parseInt(e.substr(2,2),10)-1,i=parseInt(e.substr(4,2),10),o=parseInt(e.substr(6,2),10),s=parseInt(e.substr(8,2),10),a=0;if(e.length>11){var l=e.charAt(10),c=10;"+"!==l&&"-"!==l&&(a=parseInt(e.substr(10,2),10),c+=2)}if(t.setUTCFullYear(n,r,i),t.setUTCHours(o,s,a,0),c&&("+"===(l=e.charAt(c))||"-"===l)){var u=60*parseInt(e.substr(c+1,2),10)+parseInt(e.substr(c+4,2),10);u*=6e4,"+"===l?t.setTime(+t-u):t.setTime(+t+u)}return t},i.generalizedTimeToDate=function(e){var t=new Date,n=parseInt(e.substr(0,4),10),r=parseInt(e.substr(4,2),10)-1,i=parseInt(e.substr(6,2),10),o=parseInt(e.substr(8,2),10),s=parseInt(e.substr(10,2),10),a=parseInt(e.substr(12,2),10),l=0,c=0,u=!1;"Z"===e.charAt(e.length-1)&&(u=!0);var h=e.length-5,d=e.charAt(h);"+"!==d&&"-"!==d||(c=60*parseInt(e.substr(h+1,2),10)+parseInt(e.substr(h+4,2),10),c*=6e4,"+"===d&&(c*=-1),u=!0);return"."===e.charAt(14)&&(l=1e3*parseFloat(e.substr(14),10)),u?(t.setUTCFullYear(n,r,i),t.setUTCHours(o,s,a,l),t.setTime(+t+c)):(t.setFullYear(n,r,i),t.setHours(o,s,a,l)),t},i.dateToUtcTime=function(e){if("string"===typeof e)return e;var t="",n=[];n.push((""+e.getUTCFullYear()).substr(2)),n.push(""+(e.getUTCMonth()+1)),n.push(""+e.getUTCDate()),n.push(""+e.getUTCHours()),n.push(""+e.getUTCMinutes()),n.push(""+e.getUTCSeconds());for(var r=0;r<n.length;++r)n[r].length<2&&(t+="0"),t+=n[r];return t+="Z"},i.dateToGeneralizedTime=function(e){if("string"===typeof e)return e;var t="",n=[];n.push(""+e.getUTCFullYear()),n.push(""+(e.getUTCMonth()+1)),n.push(""+e.getUTCDate()),n.push(""+e.getUTCHours()),n.push(""+e.getUTCMinutes()),n.push(""+e.getUTCSeconds());for(var r=0;r<n.length;++r)n[r].length<2&&(t+="0"),t+=n[r];return t+="Z"},i.integerToDer=function(e){var t=r.util.createBuffer();if(e>=-128&&e<128)return t.putSignedInt(e,8);if(e>=-32768&&e<32768)return t.putSignedInt(e,16);if(e>=-8388608&&e<8388608)return t.putSignedInt(e,24);if(e>=-2147483648&&e<2147483648)return t.putSignedInt(e,32);var n=new Error("Integer too large; max is 32-bits.");throw n.integer=e,n},i.derToInteger=function(e){"string"===typeof e&&(e=r.util.createBuffer(e));var t=8*e.length();if(t>32)throw new Error("Integer too large; max is 32-bits.");return e.getSignedInt(t)},i.validate=function(e,t,n,o){var s=!1;if(e.tagClass!==t.tagClass&&"undefined"!==typeof t.tagClass||e.type!==t.type&&"undefined"!==typeof t.type)o&&(e.tagClass!==t.tagClass&&o.push("["+t.name+'] Expected tag class "'+t.tagClass+'", got "'+e.tagClass+'"'),e.type!==t.type&&o.push("["+t.name+'] Expected type "'+t.type+'", got "'+e.type+'"'));else if(e.constructed===t.constructed||"undefined"===typeof t.constructed){if(s=!0,t.value&&r.util.isArray(t.value))for(var a=0,l=0;s&&l<t.value.length;++l)s=t.value[l].optional||!1,e.value[a]&&((s=i.validate(e.value[a],t.value[l],n,o))?++a:t.value[l].optional&&(s=!0)),!s&&o&&o.push("["+t.name+'] Tag class "'+t.tagClass+'", type "'+t.type+'" expected value length "'+t.value.length+'", got "'+e.value.length+'"');if(s&&n)if(t.capture&&(n[t.capture]=e.value),t.captureAsn1&&(n[t.captureAsn1]=e),t.captureBitStringContents&&"bitStringContents"in e&&(n[t.captureBitStringContents]=e.bitStringContents),t.captureBitStringValue&&"bitStringContents"in e)if(e.bitStringContents.length<2)n[t.captureBitStringValue]="";else{if(0!==e.bitStringContents.charCodeAt(0))throw new Error("captureBitStringValue only supported for zero unused bits");n[t.captureBitStringValue]=e.bitStringContents.slice(1)}}else o&&o.push("["+t.name+'] Expected constructed "'+t.constructed+'", got "'+e.constructed+'"');return s};var a=/[^\\u0000-\\u00ff]/;i.prettyPrint=function(e,t,n){var o="";n=n||2,(t=t||0)>0&&(o+="\n");for(var s="",l=0;l<t*n;++l)s+=" ";switch(o+=s+"Tag: ",e.tagClass){case i.Class.UNIVERSAL:o+="Universal:";break;case i.Class.APPLICATION:o+="Application:";break;case i.Class.CONTEXT_SPECIFIC:o+="Context-Specific:";break;case i.Class.PRIVATE:o+="Private:"}if(e.tagClass===i.Class.UNIVERSAL)switch(o+=e.type,e.type){case i.Type.NONE:o+=" (None)";break;case i.Type.BOOLEAN:o+=" (Boolean)";break;case i.Type.INTEGER:o+=" (Integer)";break;case i.Type.BITSTRING:o+=" (Bit string)";break;case i.Type.OCTETSTRING:o+=" (Octet string)";break;case i.Type.NULL:o+=" (Null)";break;case i.Type.OID:o+=" (Object Identifier)";break;case i.Type.ODESC:o+=" (Object Descriptor)";break;case i.Type.EXTERNAL:o+=" (External or Instance of)";break;case i.Type.REAL:o+=" (Real)";break;case i.Type.ENUMERATED:o+=" (Enumerated)";break;case i.Type.EMBEDDED:o+=" (Embedded PDV)";break;case i.Type.UTF8:o+=" (UTF8)";break;case i.Type.ROID:o+=" (Relative Object Identifier)";break;case i.Type.SEQUENCE:o+=" (Sequence)";break;case i.Type.SET:o+=" (Set)";break;case i.Type.PRINTABLESTRING:o+=" (Printable String)";break;case i.Type.IA5String:o+=" (IA5String (ASCII))";break;case i.Type.UTCTIME:o+=" (UTC time)";break;case i.Type.GENERALIZEDTIME:o+=" (Generalized time)";break;case i.Type.BMPSTRING:o+=" (BMP String)"}else o+=e.type;if(o+="\n",o+=s+"Constructed: "+e.constructed+"\n",e.composed){var c=0,u="";for(l=0;l<e.value.length;++l)void 0!==e.value[l]&&(c+=1,u+=i.prettyPrint(e.value[l],t+1,n),l+1<e.value.length&&(u+=","));o+=s+"Sub values: "+c+u}else{if(o+=s+"Value: ",e.type===i.Type.OID){var h=i.derToOid(e.value);o+=h,r.pki&&r.pki.oids&&h in r.pki.oids&&(o+=" ("+r.pki.oids[h]+") ")}if(e.type===i.Type.INTEGER)try{o+=i.derToInteger(e.value)}catch(f){o+="0x"+r.util.bytesToHex(e.value)}else if(e.type===i.Type.BITSTRING){if(e.value.length>1?o+="0x"+r.util.bytesToHex(e.value.slice(1)):o+="(none)",e.value.length>0){var d=e.value.charCodeAt(0);1==d?o+=" (1 unused bit shown)":d>1&&(o+=" ("+d+" unused bits shown)")}}else if(e.type===i.Type.OCTETSTRING)a.test(e.value)||(o+="("+e.value+") "),o+="0x"+r.util.bytesToHex(e.value);else if(e.type===i.Type.UTF8)try{o+=r.util.decodeUtf8(e.value)}catch(p){if("URI malformed"!==p.message)throw p;o+="0x"+r.util.bytesToHex(e.value)+" (malformed UTF8)"}else e.type===i.Type.PRINTABLESTRING||e.type===i.Type.IA5String?o+=e.value:a.test(e.value)?o+="0x"+r.util.bytesToHex(e.value):0===e.value.length?o+="[null]":o+=e.value}return o}},6407:e=>{var t={};e.exports=t;var n={};t.encode=function(e,t,n){if("string"!==typeof t)throw new TypeError('"alphabet" must be a string.');if(void 0!==n&&"number"!==typeof n)throw new TypeError('"maxline" must be a number.');var r="";if(e instanceof Uint8Array){var i=0,o=t.length,s=t.charAt(0),a=[0];for(i=0;i<e.length;++i){for(var l=0,c=e[i];l<a.length;++l)c+=a[l]<<8,a[l]=c%o,c=c/o|0;for(;c>0;)a.push(c%o),c=c/o|0}for(i=0;0===e[i]&&i<e.length-1;++i)r+=s;for(i=a.length-1;i>=0;--i)r+=t[a[i]]}else r=function(e,t){var n=0,r=t.length,i=t.charAt(0),o=[0];for(n=0;n<e.length();++n){for(var s=0,a=e.at(n);s<o.length;++s)a+=o[s]<<8,o[s]=a%r,a=a/r|0;for(;a>0;)o.push(a%r),a=a/r|0}var l="";for(n=0;0===e.at(n)&&n<e.length()-1;++n)l+=i;for(n=o.length-1;n>=0;--n)l+=t[o[n]];return l}(e,t);if(n){var u=new RegExp(".{1,"+n+"}","g");r=r.match(u).join("\r\n")}return r},t.decode=function(e,t){if("string"!==typeof e)throw new TypeError('"input" must be a string.');if("string"!==typeof t)throw new TypeError('"alphabet" must be a string.');var r=n[t];if(!r){r=n[t]=[];for(var i=0;i<t.length;++i)r[t.charCodeAt(i)]=i}e=e.replace(/\s/g,"");var o=t.length,s=t.charAt(0),a=[0];for(i=0;i<e.length;i++){var l=r[e.charCodeAt(i)];if(void 0===l)return;for(var c=0,u=l;c<a.length;++c)u+=a[c]*o,a[c]=255&u,u>>=8;for(;u>0;)a.push(255&u),u>>=8}for(var h=0;e[h]===s&&h<e.length-1;++h)a.push(0);return"undefined"!==typeof Buffer?Buffer.from(a.reverse()):new Uint8Array(a.reverse())}},9151:(e,t,n)=>{var r=n(45);n(3900),e.exports=r.cipher=r.cipher||{},r.cipher.algorithms=r.cipher.algorithms||{},r.cipher.createCipher=function(e,t){var n=e;if("string"===typeof n&&(n=r.cipher.getAlgorithm(n))&&(n=n()),!n)throw new Error("Unsupported algorithm: "+e);return new r.cipher.BlockCipher({algorithm:n,key:t,decrypt:!1})},r.cipher.createDecipher=function(e,t){var n=e;if("string"===typeof n&&(n=r.cipher.getAlgorithm(n))&&(n=n()),!n)throw new Error("Unsupported algorithm: "+e);return new r.cipher.BlockCipher({algorithm:n,key:t,decrypt:!0})},r.cipher.registerAlgorithm=function(e,t){e=e.toUpperCase(),r.cipher.algorithms[e]=t},r.cipher.getAlgorithm=function(e){return(e=e.toUpperCase())in r.cipher.algorithms?r.cipher.algorithms[e]:null};var i=r.cipher.BlockCipher=function(e){this.algorithm=e.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=e.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=e.decrypt,this.algorithm.initialize(e)};i.prototype.start=function(e){e=e||{};var t={};for(var n in e)t[n]=e[n];t.decrypt=this._decrypt,this._finish=!1,this._input=r.util.createBuffer(),this.output=e.output||r.util.createBuffer(),this.mode.start(t)},i.prototype.update=function(e){for(e&&this._input.putBuffer(e);!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish;);this._input.compact()},i.prototype.finish=function(e){!e||"ECB"!==this.mode.name&&"CBC"!==this.mode.name||(this.mode.pad=function(t){return e(this.blockSize,t,!1)},this.mode.unpad=function(t){return e(this.blockSize,t,!0)});var t={};return t.decrypt=this._decrypt,t.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,t))&&(this._finish=!0,this.update(),!(this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,t))&&!(this.mode.afterFinish&&!this.mode.afterFinish(this.output,t)))}},1655:(e,t,n)=>{var r=n(45);n(3900),r.cipher=r.cipher||{};var i=e.exports=r.cipher.modes=r.cipher.modes||{};function o(e,t){if("string"===typeof e&&(e=r.util.createBuffer(e)),r.util.isArray(e)&&e.length>4){var n=e;e=r.util.createBuffer();for(var i=0;i<n.length;++i)e.putByte(n[i])}if(e.length()<t)throw new Error("Invalid IV length; got "+e.length()+" bytes and expected "+t+" bytes.");if(!r.util.isArray(e)){var o=[],s=t/4;for(i=0;i<s;++i)o.push(e.getInt32());e=o}return e}function s(e){e[e.length-1]=e[e.length-1]+1&4294967295}function a(e){return[e/4294967296|0,4294967295&e]}i.ecb=function(e){e=e||{},this.name="ECB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},i.ecb.prototype.start=function(e){},i.ecb.prototype.encrypt=function(e,t,n){if(e.length()<this.blockSize&&!(n&&e.length()>0))return!0;for(var r=0;r<this._ints;++r)this._inBlock[r]=e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(r=0;r<this._ints;++r)t.putInt32(this._outBlock[r])},i.ecb.prototype.decrypt=function(e,t,n){if(e.length()<this.blockSize&&!(n&&e.length()>0))return!0;for(var r=0;r<this._ints;++r)this._inBlock[r]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(r=0;r<this._ints;++r)t.putInt32(this._outBlock[r])},i.ecb.prototype.pad=function(e,t){var n=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(n,n),!0},i.ecb.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var n=e.length(),r=e.at(n-1);return!(r>this.blockSize<<2)&&(e.truncate(r),!0)},i.cbc=function(e){e=e||{},this.name="CBC",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},i.cbc.prototype.start=function(e){if(null===e.iv){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else{if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=o(e.iv,this.blockSize),this._prev=this._iv.slice(0)}},i.cbc.prototype.encrypt=function(e,t,n){if(e.length()<this.blockSize&&!(n&&e.length()>0))return!0;for(var r=0;r<this._ints;++r)this._inBlock[r]=this._prev[r]^e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(r=0;r<this._ints;++r)t.putInt32(this._outBlock[r]);this._prev=this._outBlock},i.cbc.prototype.decrypt=function(e,t,n){if(e.length()<this.blockSize&&!(n&&e.length()>0))return!0;for(var r=0;r<this._ints;++r)this._inBlock[r]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(r=0;r<this._ints;++r)t.putInt32(this._prev[r]^this._outBlock[r]);this._prev=this._inBlock.slice(0)},i.cbc.prototype.pad=function(e,t){var n=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(n,n),!0},i.cbc.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var n=e.length(),r=e.at(n-1);return!(r>this.blockSize<<2)&&(e.truncate(r),!0)},i.cfb=function(e){e=e||{},this.name="CFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=r.util.createBuffer(),this._partialBytes=0},i.cfb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=o(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},i.cfb.prototype.encrypt=function(e,t,n){var r=e.length();if(0===r)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&r>=this.blockSize)for(var i=0;i<this._ints;++i)this._inBlock[i]=e.getInt32()^this._outBlock[i],t.putInt32(this._inBlock[i]);else{var o=(this.blockSize-r)%this.blockSize;o>0&&(o=this.blockSize-o),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialBlock[i]=e.getInt32()^this._outBlock[i],this._partialOutput.putInt32(this._partialBlock[i]);if(o>0)e.read-=this.blockSize;else for(i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),o>0&&!n)return t.putBytes(this._partialOutput.getBytes(o-this._partialBytes)),this._partialBytes=o,!0;t.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0}},i.cfb.prototype.decrypt=function(e,t,n){var r=e.length();if(0===r)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&r>=this.blockSize)for(var i=0;i<this._ints;++i)this._inBlock[i]=e.getInt32(),t.putInt32(this._inBlock[i]^this._outBlock[i]);else{var o=(this.blockSize-r)%this.blockSize;o>0&&(o=this.blockSize-o),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialBlock[i]=e.getInt32(),this._partialOutput.putInt32(this._partialBlock[i]^this._outBlock[i]);if(o>0)e.read-=this.blockSize;else for(i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),o>0&&!n)return t.putBytes(this._partialOutput.getBytes(o-this._partialBytes)),this._partialBytes=o,!0;t.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0}},i.ofb=function(e){e=e||{},this.name="OFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=r.util.createBuffer(),this._partialBytes=0},i.ofb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=o(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},i.ofb.prototype.encrypt=function(e,t,n){var r=e.length();if(0===e.length())return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&r>=this.blockSize)for(var i=0;i<this._ints;++i)t.putInt32(e.getInt32()^this._outBlock[i]),this._inBlock[i]=this._outBlock[i];else{var o=(this.blockSize-r)%this.blockSize;o>0&&(o=this.blockSize-o),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialOutput.putInt32(e.getInt32()^this._outBlock[i]);if(o>0)e.read-=this.blockSize;else for(i=0;i<this._ints;++i)this._inBlock[i]=this._outBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),o>0&&!n)return t.putBytes(this._partialOutput.getBytes(o-this._partialBytes)),this._partialBytes=o,!0;t.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0}},i.ofb.prototype.decrypt=i.ofb.prototype.encrypt,i.ctr=function(e){e=e||{},this.name="CTR",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=r.util.createBuffer(),this._partialBytes=0},i.ctr.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=o(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},i.ctr.prototype.encrypt=function(e,t,n){var r=e.length();if(0===r)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&r>=this.blockSize)for(var i=0;i<this._ints;++i)t.putInt32(e.getInt32()^this._outBlock[i]);else{var o=(this.blockSize-r)%this.blockSize;o>0&&(o=this.blockSize-o),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialOutput.putInt32(e.getInt32()^this._outBlock[i]);if(o>0&&(e.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),o>0&&!n)return t.putBytes(this._partialOutput.getBytes(o-this._partialBytes)),this._partialBytes=o,!0;t.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0}s(this._inBlock)},i.ctr.prototype.decrypt=i.ctr.prototype.encrypt,i.gcm=function(e){e=e||{},this.name="GCM",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=r.util.createBuffer(),this._partialBytes=0,this._R=3774873600},i.gcm.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");var t,n=r.util.createBuffer(e.iv);if(this._cipherLength=0,t="additionalData"in e?r.util.createBuffer(e.additionalData):r.util.createBuffer(),this._tagLength="tagLength"in e?e.tagLength:128,this._tag=null,e.decrypt&&(this._tag=r.util.createBuffer(e.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var i=n.length();if(12===i)this._j0=[n.getInt32(),n.getInt32(),n.getInt32(),1];else{for(this._j0=[0,0,0,0];n.length()>0;)this._j0=this.ghash(this._hashSubkey,this._j0,[n.getInt32(),n.getInt32(),n.getInt32(),n.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(a(8*i)))}this._inBlock=this._j0.slice(0),s(this._inBlock),this._partialBytes=0,t=r.util.createBuffer(t),this._aDataLength=a(8*t.length());var o=t.length()%this.blockSize;for(o&&t.fillWithByte(0,this.blockSize-o),this._s=[0,0,0,0];t.length()>0;)this._s=this.ghash(this._hashSubkey,this._s,[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()])},i.gcm.prototype.encrypt=function(e,t,n){var r=e.length();if(0===r)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&r>=this.blockSize){for(var i=0;i<this._ints;++i)t.putInt32(this._outBlock[i]^=e.getInt32());this._cipherLength+=this.blockSize}else{var o=(this.blockSize-r)%this.blockSize;o>0&&(o=this.blockSize-o),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialOutput.putInt32(e.getInt32()^this._outBlock[i]);if(o<=0||n){if(n){var a=r%this.blockSize;this._cipherLength+=a,this._partialOutput.truncate(this.blockSize-a)}else this._cipherLength+=this.blockSize;for(i=0;i<this._ints;++i)this._outBlock[i]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),o>0&&!n)return e.read-=this.blockSize,t.putBytes(this._partialOutput.getBytes(o-this._partialBytes)),this._partialBytes=o,!0;t.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),s(this._inBlock)},i.gcm.prototype.decrypt=function(e,t,n){var r=e.length();if(r<this.blockSize&&!(n&&r>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),s(this._inBlock),this._hashBlock[0]=e.getInt32(),this._hashBlock[1]=e.getInt32(),this._hashBlock[2]=e.getInt32(),this._hashBlock[3]=e.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var i=0;i<this._ints;++i)t.putInt32(this._outBlock[i]^this._hashBlock[i]);r<this.blockSize?this._cipherLength+=r%this.blockSize:this._cipherLength+=this.blockSize},i.gcm.prototype.afterFinish=function(e,t){var n=!0;t.decrypt&&t.overflow&&e.truncate(this.blockSize-t.overflow),this.tag=r.util.createBuffer();var i=this._aDataLength.concat(a(8*this._cipherLength));this._s=this.ghash(this._hashSubkey,this._s,i);var o=[];this.cipher.encrypt(this._j0,o);for(var s=0;s<this._ints;++s)this.tag.putInt32(this._s[s]^o[s]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),t.decrypt&&this.tag.bytes()!==this._tag&&(n=!1),n},i.gcm.prototype.multiply=function(e,t){for(var n=[0,0,0,0],r=t.slice(0),i=0;i<128;++i){e[i/32|0]&1<<31-i%32&&(n[0]^=r[0],n[1]^=r[1],n[2]^=r[2],n[3]^=r[3]),this.pow(r,r)}return n},i.gcm.prototype.pow=function(e,t){for(var n=1&e[3],r=3;r>0;--r)t[r]=e[r]>>>1|(1&e[r-1])<<31;t[0]=e[0]>>>1,n&&(t[0]^=this._R)},i.gcm.prototype.tableMultiply=function(e){for(var t=[0,0,0,0],n=0;n<32;++n){var r=e[n/8|0]>>>4*(7-n%8)&15,i=this._m[n][r];t[0]^=i[0],t[1]^=i[1],t[2]^=i[2],t[3]^=i[3]}return t},i.gcm.prototype.ghash=function(e,t,n){return t[0]^=n[0],t[1]^=n[1],t[2]^=n[2],t[3]^=n[3],this.tableMultiply(t)},i.gcm.prototype.generateHashTable=function(e,t){for(var n=8/t,r=4*n,i=16*n,o=new Array(i),s=0;s<i;++s){var a=[0,0,0,0],l=(r-1-s%r)*t;a[s/r|0]=1<<t-1<<l,o[s]=this.generateSubHashTable(this.multiply(a,e),t)}return o},i.gcm.prototype.generateSubHashTable=function(e,t){var n=1<<t,r=n>>>1,i=new Array(n);i[r]=e.slice(0);for(var o=r>>>1;o>0;)this.pow(i[2*o],i[o]=[]),o>>=1;for(o=2;o<r;){for(var s=1;s<o;++s){var a=i[o],l=i[s];i[o+s]=[a[0]^l[0],a[1]^l[1],a[2]^l[2],a[3]^l[3]]}o*=2}for(i[0]=[0,0,0,0],o=r+1;o<n;++o){var c=i[o^r];i[o]=[e[0]^c[0],e[1]^c[1],e[2]^c[2],e[3]^c[3]]}return i}},2986:(e,t,n)=>{var r=n(45);function i(e,t){r.cipher.registerAlgorithm(e,(function(){return new r.des.Algorithm(e,t)}))}n(9151),n(1655),n(3900),e.exports=r.des=r.des||{},r.des.startEncrypting=function(e,t,n,r){var i=p({key:e,output:n,decrypt:!1,mode:r||(null===t?"ECB":"CBC")});return i.start(t),i},r.des.createEncryptionCipher=function(e,t){return p({key:e,output:null,decrypt:!1,mode:t})},r.des.startDecrypting=function(e,t,n,r){var i=p({key:e,output:n,decrypt:!0,mode:r||(null===t?"ECB":"CBC")});return i.start(t),i},r.des.createDecryptionCipher=function(e,t){return p({key:e,output:null,decrypt:!0,mode:t})},r.des.Algorithm=function(e,t){var n=this;n.name=e,n.mode=new t({blockSize:8,cipher:{encrypt:function(e,t){return f(n._keys,e,t,!1)},decrypt:function(e,t){return f(n._keys,e,t,!0)}}}),n._init=!1},r.des.Algorithm.prototype.initialize=function(e){if(!this._init){var t=r.util.createBuffer(e.key);if(0===this.name.indexOf("3DES")&&24!==t.length())throw new Error("Invalid Triple-DES key size: "+8*t.length());this._keys=function(e){for(var t,n=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],r=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],i=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],o=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],s=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],a=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],l=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],c=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],u=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],h=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],d=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],f=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],p=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],g=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],y=e.length()>8?3:1,v=[],m=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],w=0,b=0;b<y;b++){var E=e.getInt32(),_=e.getInt32();E^=(t=252645135&(E>>>4^_))<<4,E^=t=65535&((_^=t)>>>-16^E),E^=(t=858993459&(E>>>2^(_^=t<<-16)))<<2,E^=t=65535&((_^=t)>>>-16^E),E^=(t=1431655765&(E>>>1^(_^=t<<-16)))<<1,E^=t=16711935&((_^=t)>>>8^E),t=(E^=(t=1431655765&(E>>>1^(_^=t<<8)))<<1)<<8|(_^=t)>>>20&240,E=_<<24|_<<8&16711680|_>>>8&65280|_>>>24&240,_=t;for(var S=0;S<m.length;++S){m[S]?(E=E<<2|E>>>26,_=_<<2|_>>>26):(E=E<<1|E>>>27,_=_<<1|_>>>27),_&=-15;var k=n[(E&=-15)>>>28]|r[E>>>24&15]|i[E>>>20&15]|o[E>>>16&15]|s[E>>>12&15]|a[E>>>8&15]|l[E>>>4&15],A=c[_>>>28]|u[_>>>24&15]|h[_>>>20&15]|d[_>>>16&15]|f[_>>>12&15]|p[_>>>8&15]|g[_>>>4&15];t=65535&(A>>>16^k),v[w++]=k^t,v[w++]=A^t<<16}}return v}(t),this._init=!0}},i("DES-ECB",r.cipher.modes.ecb),i("DES-CBC",r.cipher.modes.cbc),i("DES-CFB",r.cipher.modes.cfb),i("DES-OFB",r.cipher.modes.ofb),i("DES-CTR",r.cipher.modes.ctr),i("3DES-ECB",r.cipher.modes.ecb),i("3DES-CBC",r.cipher.modes.cbc),i("3DES-CFB",r.cipher.modes.cfb),i("3DES-OFB",r.cipher.modes.ofb),i("3DES-CTR",r.cipher.modes.ctr);var o=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],s=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],a=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],l=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],c=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],u=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],h=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],d=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function f(e,t,n,r){var i,f,p=32===e.length?3:9;i=3===p?r?[30,-2,-2]:[0,32,2]:r?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var g=t[0],y=t[1];g^=(f=252645135&(g>>>4^y))<<4,g^=(f=65535&(g>>>16^(y^=f)))<<16,g^=f=858993459&((y^=f)>>>2^g),g^=f=16711935&((y^=f<<2)>>>8^g),g=(g^=(f=1431655765&(g>>>1^(y^=f<<8)))<<1)<<1|g>>>31,y=(y^=f)<<1|y>>>31;for(var v=0;v<p;v+=3){for(var m=i[v+1],w=i[v+2],b=i[v];b!=m;b+=w){var E=y^e[b],_=(y>>>4|y<<28)^e[b+1];f=g,g=y,y=f^(s[E>>>24&63]|l[E>>>16&63]|u[E>>>8&63]|d[63&E]|o[_>>>24&63]|a[_>>>16&63]|c[_>>>8&63]|h[63&_])}f=g,g=y,y=f}y=y>>>1|y<<31,y^=f=1431655765&((g=g>>>1|g<<31)>>>1^y),y^=(f=16711935&(y>>>8^(g^=f<<1)))<<8,y^=(f=858993459&(y>>>2^(g^=f)))<<2,y^=f=65535&((g^=f)>>>16^y),y^=f=252645135&((g^=f<<16)>>>4^y),g^=f<<4,n[0]=g,n[1]=y}function p(e){var t,n="DES-"+((e=e||{}).mode||"CBC").toUpperCase(),i=(t=e.decrypt?r.cipher.createDecipher(n,e.key):r.cipher.createCipher(n,e.key)).start;return t.start=function(e,n){var o=null;n instanceof r.util.ByteBuffer&&(o=n,n={}),(n=n||{}).output=o,n.iv=e,i.call(t,n)},t}},45:e=>{e.exports={options:{usePureJavaScript:!1}}},8163:(e,t,n)=>{var r=n(45);n(5693),n(3900),(e.exports=r.hmac=r.hmac||{}).create=function(){var e=null,t=null,n=null,i=null,o={start:function(o,s){if(null!==o)if("string"===typeof o){if(!((o=o.toLowerCase())in r.md.algorithms))throw new Error('Unknown hash algorithm "'+o+'"');t=r.md.algorithms[o].create()}else t=o;if(null===s)s=e;else{if("string"===typeof s)s=r.util.createBuffer(s);else if(r.util.isArray(s)){var a=s;s=r.util.createBuffer();for(var l=0;l<a.length;++l)s.putByte(a[l])}var c=s.length();c>t.blockLength&&(t.start(),t.update(s.bytes()),s=t.digest()),n=r.util.createBuffer(),i=r.util.createBuffer(),c=s.length();for(l=0;l<c;++l){a=s.at(l);n.putByte(54^a),i.putByte(92^a)}if(c<t.blockLength)for(a=t.blockLength-c,l=0;l<a;++l)n.putByte(54),i.putByte(92);e=s,n=n.bytes(),i=i.bytes()}t.start(),t.update(n)},update:function(e){t.update(e)},getMac:function(){var e=t.digest().bytes();return t.start(),t.update(i),t.update(e),t.digest()}};return o.digest=o.getMac,o}},9463:(e,t,n)=>{var r,i=n(45);e.exports=i.jsbn=i.jsbn||{};function o(e,t,n){this.data=[],null!=e&&("number"==typeof e?this.fromNumber(e,t,n):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function s(){return new o(null)}function a(e,t,n,r,i,o){for(var s=16383&t,a=t>>14;--o>=0;){var l=16383&this.data[e],c=this.data[e++]>>14,u=a*l+c*s;i=((l=s*l+((16383&u)<<14)+n.data[r]+i)>>28)+(u>>14)+a*c,n.data[r++]=268435455&l}return i}i.jsbn.BigInteger=o,"undefined"===typeof navigator?(o.prototype.am=a,r=28):"Microsoft Internet Explorer"==navigator.appName?(o.prototype.am=function(e,t,n,r,i,o){for(var s=32767&t,a=t>>15;--o>=0;){var l=32767&this.data[e],c=this.data[e++]>>15,u=a*l+c*s;i=((l=s*l+((32767&u)<<15)+n.data[r]+(1073741823&i))>>>30)+(u>>>15)+a*c+(i>>>30),n.data[r++]=1073741823&l}return i},r=30):"Netscape"!=navigator.appName?(o.prototype.am=function(e,t,n,r,i,o){for(;--o>=0;){var s=t*this.data[e++]+n.data[r]+i;i=Math.floor(s/67108864),n.data[r++]=67108863&s}return i},r=26):(o.prototype.am=a,r=28),o.prototype.DB=r,o.prototype.DM=(1<<r)-1,o.prototype.DV=1<<r;o.prototype.FV=Math.pow(2,52),o.prototype.F1=52-r,o.prototype.F2=2*r-52;var l,c,u="0123456789abcdefghijklmnopqrstuvwxyz",h=new Array;for(l="0".charCodeAt(0),c=0;c<=9;++c)h[l++]=c;for(l="a".charCodeAt(0),c=10;c<36;++c)h[l++]=c;for(l="A".charCodeAt(0),c=10;c<36;++c)h[l++]=c;function d(e){return u.charAt(e)}function f(e,t){var n=h[e.charCodeAt(t)];return null==n?-1:n}function p(e){var t=s();return t.fromInt(e),t}function g(e){var t,n=1;return 0!=(t=e>>>16)&&(e=t,n+=16),0!=(t=e>>8)&&(e=t,n+=8),0!=(t=e>>4)&&(e=t,n+=4),0!=(t=e>>2)&&(e=t,n+=2),0!=(t=e>>1)&&(e=t,n+=1),n}function y(e){this.m=e}function v(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function m(e,t){return e&t}function w(e,t){return e|t}function b(e,t){return e^t}function E(e,t){return e&~t}function _(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function S(e){for(var t=0;0!=e;)e&=e-1,++t;return t}function k(){}function A(e){return e}function I(e){this.r2=s(),this.q3=s(),o.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}y.prototype.convert=function(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e},y.prototype.revert=function(e){return e},y.prototype.reduce=function(e){e.divRemTo(this.m,null,e)},y.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},y.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},v.prototype.convert=function(e){var t=s();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(o.ZERO)>0&&this.m.subTo(t,t),t},v.prototype.revert=function(e){var t=s();return e.copyTo(t),this.reduce(t),t},v.prototype.reduce=function(e){for(;e.t<=this.mt2;)e.data[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=32767&e.data[t],r=n*this.mpl+((n*this.mph+(e.data[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(n=t+this.m.t,e.data[n]+=this.m.am(0,r,e,t,0,this.m.t);e.data[n]>=e.DV;)e.data[n]-=e.DV,e.data[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)},v.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},v.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)},o.prototype.copyTo=function(e){for(var t=this.t-1;t>=0;--t)e.data[t]=this.data[t];e.t=this.t,e.s=this.s},o.prototype.fromInt=function(e){this.t=1,this.s=e<0?-1:0,e>0?this.data[0]=e:e<-1?this.data[0]=e+this.DV:this.t=0},o.prototype.fromString=function(e,t){var n;if(16==t)n=4;else if(8==t)n=3;else if(256==t)n=8;else if(2==t)n=1;else if(32==t)n=5;else{if(4!=t)return void this.fromRadix(e,t);n=2}this.t=0,this.s=0;for(var r=e.length,i=!1,s=0;--r>=0;){var a=8==n?255&e[r]:f(e,r);a<0?"-"==e.charAt(r)&&(i=!0):(i=!1,0==s?this.data[this.t++]=a:s+n>this.DB?(this.data[this.t-1]|=(a&(1<<this.DB-s)-1)<<s,this.data[this.t++]=a>>this.DB-s):this.data[this.t-1]|=a<<s,(s+=n)>=this.DB&&(s-=this.DB))}8==n&&0!=(128&e[0])&&(this.s=-1,s>0&&(this.data[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),i&&o.ZERO.subTo(this,this)},o.prototype.clamp=function(){for(var e=this.s&this.DM;this.t>0&&this.data[this.t-1]==e;)--this.t},o.prototype.dlShiftTo=function(e,t){var n;for(n=this.t-1;n>=0;--n)t.data[n+e]=this.data[n];for(n=e-1;n>=0;--n)t.data[n]=0;t.t=this.t+e,t.s=this.s},o.prototype.drShiftTo=function(e,t){for(var n=e;n<this.t;++n)t.data[n-e]=this.data[n];t.t=Math.max(this.t-e,0),t.s=this.s},o.prototype.lShiftTo=function(e,t){var n,r=e%this.DB,i=this.DB-r,o=(1<<i)-1,s=Math.floor(e/this.DB),a=this.s<<r&this.DM;for(n=this.t-1;n>=0;--n)t.data[n+s+1]=this.data[n]>>i|a,a=(this.data[n]&o)<<r;for(n=s-1;n>=0;--n)t.data[n]=0;t.data[s]=a,t.t=this.t+s+1,t.s=this.s,t.clamp()},o.prototype.rShiftTo=function(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t)t.t=0;else{var r=e%this.DB,i=this.DB-r,o=(1<<r)-1;t.data[0]=this.data[n]>>r;for(var s=n+1;s<this.t;++s)t.data[s-n-1]|=(this.data[s]&o)<<i,t.data[s-n]=this.data[s]>>r;r>0&&(t.data[this.t-n-1]|=(this.s&o)<<i),t.t=this.t-n,t.clamp()}},o.prototype.subTo=function(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);n<i;)r+=this.data[n]-e.data[n],t.data[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r-=e.s;n<this.t;)r+=this.data[n],t.data[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r-=e.data[n],t.data[n++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=r<0?-1:0,r<-1?t.data[n++]=this.DV+r:r>0&&(t.data[n++]=r),t.t=n,t.clamp()},o.prototype.multiplyTo=function(e,t){var n=this.abs(),r=e.abs(),i=n.t;for(t.t=i+r.t;--i>=0;)t.data[i]=0;for(i=0;i<r.t;++i)t.data[i+n.t]=n.am(0,r.data[i],t,i,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&o.ZERO.subTo(t,t)},o.prototype.squareTo=function(e){for(var t=this.abs(),n=e.t=2*t.t;--n>=0;)e.data[n]=0;for(n=0;n<t.t-1;++n){var r=t.am(n,t.data[n],e,2*n,0,1);(e.data[n+t.t]+=t.am(n+1,2*t.data[n],e,2*n+1,r,t.t-n-1))>=t.DV&&(e.data[n+t.t]-=t.DV,e.data[n+t.t+1]=1)}e.t>0&&(e.data[e.t-1]+=t.am(n,t.data[n],e,2*n,0,1)),e.s=0,e.clamp()},o.prototype.divRemTo=function(e,t,n){var r=e.abs();if(!(r.t<=0)){var i=this.abs();if(i.t<r.t)return null!=t&&t.fromInt(0),void(null!=n&&this.copyTo(n));null==n&&(n=s());var a=s(),l=this.s,c=e.s,u=this.DB-g(r.data[r.t-1]);u>0?(r.lShiftTo(u,a),i.lShiftTo(u,n)):(r.copyTo(a),i.copyTo(n));var h=a.t,d=a.data[h-1];if(0!=d){var f=d*(1<<this.F1)+(h>1?a.data[h-2]>>this.F2:0),p=this.FV/f,y=(1<<this.F1)/f,v=1<<this.F2,m=n.t,w=m-h,b=null==t?s():t;for(a.dlShiftTo(w,b),n.compareTo(b)>=0&&(n.data[n.t++]=1,n.subTo(b,n)),o.ONE.dlShiftTo(h,b),b.subTo(a,a);a.t<h;)a.data[a.t++]=0;for(;--w>=0;){var E=n.data[--m]==d?this.DM:Math.floor(n.data[m]*p+(n.data[m-1]+v)*y);if((n.data[m]+=a.am(0,E,n,w,0,h))<E)for(a.dlShiftTo(w,b),n.subTo(b,n);n.data[m]<--E;)n.subTo(b,n)}null!=t&&(n.drShiftTo(h,t),l!=c&&o.ZERO.subTo(t,t)),n.t=h,n.clamp(),u>0&&n.rShiftTo(u,n),l<0&&o.ZERO.subTo(n,n)}}},o.prototype.invDigit=function(){if(this.t<1)return 0;var e=this.data[0];if(0==(1&e))return 0;var t=3&e;return(t=(t=(t=(t=t*(2-(15&e)*t)&15)*(2-(255&e)*t)&255)*(2-((65535&e)*t&65535))&65535)*(2-e*t%this.DV)%this.DV)>0?this.DV-t:-t},o.prototype.isEven=function(){return 0==(this.t>0?1&this.data[0]:this.s)},o.prototype.exp=function(e,t){if(e>4294967295||e<1)return o.ONE;var n=s(),r=s(),i=t.convert(this),a=g(e)-1;for(i.copyTo(n);--a>=0;)if(t.sqrTo(n,r),(e&1<<a)>0)t.mulTo(r,i,n);else{var l=n;n=r,r=l}return t.revert(n)},o.prototype.toString=function(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var n,r=(1<<t)-1,i=!1,o="",s=this.t,a=this.DB-s*this.DB%t;if(s-- >0)for(a<this.DB&&(n=this.data[s]>>a)>0&&(i=!0,o=d(n));s>=0;)a<t?(n=(this.data[s]&(1<<a)-1)<<t-a,n|=this.data[--s]>>(a+=this.DB-t)):(n=this.data[s]>>(a-=t)&r,a<=0&&(a+=this.DB,--s)),n>0&&(i=!0),i&&(o+=d(n));return i?o:"0"},o.prototype.negate=function(){var e=s();return o.ZERO.subTo(this,e),e},o.prototype.abs=function(){return this.s<0?this.negate():this},o.prototype.compareTo=function(e){var t=this.s-e.s;if(0!=t)return t;var n=this.t;if(0!=(t=n-e.t))return this.s<0?-t:t;for(;--n>=0;)if(0!=(t=this.data[n]-e.data[n]))return t;return 0},o.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+g(this.data[this.t-1]^this.s&this.DM)},o.prototype.mod=function(e){var t=s();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(o.ZERO)>0&&e.subTo(t,t),t},o.prototype.modPowInt=function(e,t){var n;return n=e<256||t.isEven()?new y(t):new v(t),this.exp(e,n)},o.ZERO=p(0),o.ONE=p(1),k.prototype.convert=A,k.prototype.revert=A,k.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n)},k.prototype.sqrTo=function(e,t){e.squareTo(t)},I.prototype.convert=function(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=s();return e.copyTo(t),this.reduce(t),t},I.prototype.revert=function(e){return e},I.prototype.reduce=function(e){for(e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);e.compareTo(this.r2)<0;)e.dAddOffset(1,this.m.t+1);for(e.subTo(this.r2,e);e.compareTo(this.m)>=0;)e.subTo(this.m,e)},I.prototype.mulTo=function(e,t,n){e.multiplyTo(t,n),this.reduce(n)},I.prototype.sqrTo=function(e,t){e.squareTo(t),this.reduce(t)};var T=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],R=(1<<26)/T[T.length-1];o.prototype.chunkSize=function(e){return Math.floor(Math.LN2*this.DB/Math.log(e))},o.prototype.toRadix=function(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),n=Math.pow(e,t),r=p(n),i=s(),o=s(),a="";for(this.divRemTo(r,i,o);i.signum()>0;)a=(n+o.intValue()).toString(e).substr(1)+a,i.divRemTo(r,i,o);return o.intValue().toString(e)+a},o.prototype.fromRadix=function(e,t){this.fromInt(0),null==t&&(t=10);for(var n=this.chunkSize(t),r=Math.pow(t,n),i=!1,s=0,a=0,l=0;l<e.length;++l){var c=f(e,l);c<0?"-"==e.charAt(l)&&0==this.signum()&&(i=!0):(a=t*a+c,++s>=n&&(this.dMultiply(r),this.dAddOffset(a,0),s=0,a=0))}s>0&&(this.dMultiply(Math.pow(t,s)),this.dAddOffset(a,0)),i&&o.ZERO.subTo(this,this)},o.prototype.fromNumber=function(e,t,n){if("number"==typeof t)if(e<2)this.fromInt(1);else for(this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(o.ONE.shiftLeft(e-1),w,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(t);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(o.ONE.shiftLeft(e-1),this);else{var r=new Array,i=7&e;r.length=1+(e>>3),t.nextBytes(r),i>0?r[0]&=(1<<i)-1:r[0]=0,this.fromString(r,256)}},o.prototype.bitwiseTo=function(e,t,n){var r,i,o=Math.min(e.t,this.t);for(r=0;r<o;++r)n.data[r]=t(this.data[r],e.data[r]);if(e.t<this.t){for(i=e.s&this.DM,r=o;r<this.t;++r)n.data[r]=t(this.data[r],i);n.t=this.t}else{for(i=this.s&this.DM,r=o;r<e.t;++r)n.data[r]=t(i,e.data[r]);n.t=e.t}n.s=t(this.s,e.s),n.clamp()},o.prototype.changeBit=function(e,t){var n=o.ONE.shiftLeft(e);return this.bitwiseTo(n,t,n),n},o.prototype.addTo=function(e,t){for(var n=0,r=0,i=Math.min(e.t,this.t);n<i;)r+=this.data[n]+e.data[n],t.data[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){for(r+=e.s;n<this.t;)r+=this.data[n],t.data[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;n<e.t;)r+=e.data[n],t.data[n++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=r<0?-1:0,r>0?t.data[n++]=r:r<-1&&(t.data[n++]=this.DV+r),t.t=n,t.clamp()},o.prototype.dMultiply=function(e){this.data[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()},o.prototype.dAddOffset=function(e,t){if(0!=e){for(;this.t<=t;)this.data[this.t++]=0;for(this.data[t]+=e;this.data[t]>=this.DV;)this.data[t]-=this.DV,++t>=this.t&&(this.data[this.t++]=0),++this.data[t]}},o.prototype.multiplyLowerTo=function(e,t,n){var r,i=Math.min(this.t+e.t,t);for(n.s=0,n.t=i;i>0;)n.data[--i]=0;for(r=n.t-this.t;i<r;++i)n.data[i+this.t]=this.am(0,e.data[i],n,i,0,this.t);for(r=Math.min(e.t,t);i<r;++i)this.am(0,e.data[i],n,i,0,t-i);n.clamp()},o.prototype.multiplyUpperTo=function(e,t,n){--t;var r=n.t=this.t+e.t-t;for(n.s=0;--r>=0;)n.data[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)n.data[this.t+r-t]=this.am(t-r,e.data[r],n,0,0,this.t+r-t);n.clamp(),n.drShiftTo(1,n)},o.prototype.modInt=function(e){if(e<=0)return 0;var t=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(0==t)n=this.data[0]%e;else for(var r=this.t-1;r>=0;--r)n=(t*n+this.data[r])%e;return n},o.prototype.millerRabin=function(e){var t=this.subtract(o.ONE),n=t.getLowestSetBit();if(n<=0)return!1;for(var r,i=t.shiftRight(n),s={nextBytes:function(e){for(var t=0;t<e.length;++t)e[t]=Math.floor(256*Math.random())}},a=0;a<e;++a){do{r=new o(this.bitLength(),s)}while(r.compareTo(o.ONE)<=0||r.compareTo(t)>=0);var l=r.modPow(i,this);if(0!=l.compareTo(o.ONE)&&0!=l.compareTo(t)){for(var c=1;c++<n&&0!=l.compareTo(t);)if(0==(l=l.modPowInt(2,this)).compareTo(o.ONE))return!1;if(0!=l.compareTo(t))return!1}}return!0},o.prototype.clone=function(){var e=s();return this.copyTo(e),e},o.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this.data[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this.data[0];if(0==this.t)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]},o.prototype.byteValue=function(){return 0==this.t?this.s:this.data[0]<<24>>24},o.prototype.shortValue=function(){return 0==this.t?this.s:this.data[0]<<16>>16},o.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this.data[0]<=0?0:1},o.prototype.toByteArray=function(){var e=this.t,t=new Array;t[0]=this.s;var n,r=this.DB-e*this.DB%8,i=0;if(e-- >0)for(r<this.DB&&(n=this.data[e]>>r)!=(this.s&this.DM)>>r&&(t[i++]=n|this.s<<this.DB-r);e>=0;)r<8?(n=(this.data[e]&(1<<r)-1)<<8-r,n|=this.data[--e]>>(r+=this.DB-8)):(n=this.data[e]>>(r-=8)&255,r<=0&&(r+=this.DB,--e)),0!=(128&n)&&(n|=-256),0==i&&(128&this.s)!=(128&n)&&++i,(i>0||n!=this.s)&&(t[i++]=n);return t},o.prototype.equals=function(e){return 0==this.compareTo(e)},o.prototype.min=function(e){return this.compareTo(e)<0?this:e},o.prototype.max=function(e){return this.compareTo(e)>0?this:e},o.prototype.and=function(e){var t=s();return this.bitwiseTo(e,m,t),t},o.prototype.or=function(e){var t=s();return this.bitwiseTo(e,w,t),t},o.prototype.xor=function(e){var t=s();return this.bitwiseTo(e,b,t),t},o.prototype.andNot=function(e){var t=s();return this.bitwiseTo(e,E,t),t},o.prototype.not=function(){for(var e=s(),t=0;t<this.t;++t)e.data[t]=this.DM&~this.data[t];return e.t=this.t,e.s=~this.s,e},o.prototype.shiftLeft=function(e){var t=s();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t},o.prototype.shiftRight=function(e){var t=s();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t},o.prototype.getLowestSetBit=function(){for(var e=0;e<this.t;++e)if(0!=this.data[e])return e*this.DB+_(this.data[e]);return this.s<0?this.t*this.DB:-1},o.prototype.bitCount=function(){for(var e=0,t=this.s&this.DM,n=0;n<this.t;++n)e+=S(this.data[n]^t);return e},o.prototype.testBit=function(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this.data[t]&1<<e%this.DB)},o.prototype.setBit=function(e){return this.changeBit(e,w)},o.prototype.clearBit=function(e){return this.changeBit(e,E)},o.prototype.flipBit=function(e){return this.changeBit(e,b)},o.prototype.add=function(e){var t=s();return this.addTo(e,t),t},o.prototype.subtract=function(e){var t=s();return this.subTo(e,t),t},o.prototype.multiply=function(e){var t=s();return this.multiplyTo(e,t),t},o.prototype.divide=function(e){var t=s();return this.divRemTo(e,t,null),t},o.prototype.remainder=function(e){var t=s();return this.divRemTo(e,null,t),t},o.prototype.divideAndRemainder=function(e){var t=s(),n=s();return this.divRemTo(e,t,n),new Array(t,n)},o.prototype.modPow=function(e,t){var n,r,i=e.bitLength(),o=p(1);if(i<=0)return o;n=i<18?1:i<48?3:i<144?4:i<768?5:6,r=i<8?new y(t):t.isEven()?new I(t):new v(t);var a=new Array,l=3,c=n-1,u=(1<<n)-1;if(a[1]=r.convert(this),n>1){var h=s();for(r.sqrTo(a[1],h);l<=u;)a[l]=s(),r.mulTo(h,a[l-2],a[l]),l+=2}var d,f,m=e.t-1,w=!0,b=s();for(i=g(e.data[m])-1;m>=0;){for(i>=c?d=e.data[m]>>i-c&u:(d=(e.data[m]&(1<<i+1)-1)<<c-i,m>0&&(d|=e.data[m-1]>>this.DB+i-c)),l=n;0==(1&d);)d>>=1,--l;if((i-=l)<0&&(i+=this.DB,--m),w)a[d].copyTo(o),w=!1;else{for(;l>1;)r.sqrTo(o,b),r.sqrTo(b,o),l-=2;l>0?r.sqrTo(o,b):(f=o,o=b,b=f),r.mulTo(b,a[d],o)}for(;m>=0&&0==(e.data[m]&1<<i);)r.sqrTo(o,b),f=o,o=b,b=f,--i<0&&(i=this.DB-1,--m)}return r.revert(o)},o.prototype.modInverse=function(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return o.ZERO;for(var n=e.clone(),r=this.clone(),i=p(1),s=p(0),a=p(0),l=p(1);0!=n.signum();){for(;n.isEven();)n.rShiftTo(1,n),t?(i.isEven()&&s.isEven()||(i.addTo(this,i),s.subTo(e,s)),i.rShiftTo(1,i)):s.isEven()||s.subTo(e,s),s.rShiftTo(1,s);for(;r.isEven();)r.rShiftTo(1,r),t?(a.isEven()&&l.isEven()||(a.addTo(this,a),l.subTo(e,l)),a.rShiftTo(1,a)):l.isEven()||l.subTo(e,l),l.rShiftTo(1,l);n.compareTo(r)>=0?(n.subTo(r,n),t&&i.subTo(a,i),s.subTo(l,s)):(r.subTo(n,r),t&&a.subTo(i,a),l.subTo(s,l))}return 0!=r.compareTo(o.ONE)?o.ZERO:l.compareTo(e)>=0?l.subtract(e):l.signum()<0?(l.addTo(e,l),l.signum()<0?l.add(e):l):l},o.prototype.pow=function(e){return this.exp(e,new k)},o.prototype.gcd=function(e){var t=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(t.compareTo(n)<0){var r=t;t=n,n=r}var i=t.getLowestSetBit(),o=n.getLowestSetBit();if(o<0)return t;for(i<o&&(o=i),o>0&&(t.rShiftTo(o,t),n.rShiftTo(o,n));t.signum()>0;)(i=t.getLowestSetBit())>0&&t.rShiftTo(i,t),(i=n.getLowestSetBit())>0&&n.rShiftTo(i,n),t.compareTo(n)>=0?(t.subTo(n,t),t.rShiftTo(1,t)):(n.subTo(t,n),n.rShiftTo(1,n));return o>0&&n.lShiftTo(o,n),n},o.prototype.isProbablePrime=function(e){var t,n=this.abs();if(1==n.t&&n.data[0]<=T[T.length-1]){for(t=0;t<T.length;++t)if(n.data[0]==T[t])return!0;return!1}if(n.isEven())return!1;for(t=1;t<T.length;){for(var r=T[t],i=t+1;i<T.length&&r<R;)r*=T[i++];for(r=n.modInt(r);t<i;)if(r%T[t++]==0)return!1}return n.millerRabin(e)}},5693:(e,t,n)=>{var r=n(45);e.exports=r.md=r.md||{},r.md.algorithms=r.md.algorithms||{}},3225:(e,t,n)=>{var r=n(45);r.pki=r.pki||{};var i=e.exports=r.pki.oids=r.oids=r.oids||{};function o(e,t){i[e]=t,i[t]=e}function s(e,t){i[e]=t}o("1.2.840.113549.1.1.1","rsaEncryption"),o("1.2.840.113549.1.1.4","md5WithRSAEncryption"),o("1.2.840.113549.1.1.5","sha1WithRSAEncryption"),o("1.2.840.113549.1.1.7","RSAES-OAEP"),o("1.2.840.113549.1.1.8","mgf1"),o("1.2.840.113549.1.1.9","pSpecified"),o("1.2.840.113549.1.1.10","RSASSA-PSS"),o("1.2.840.113549.1.1.11","sha256WithRSAEncryption"),o("1.2.840.113549.1.1.12","sha384WithRSAEncryption"),o("1.2.840.113549.1.1.13","sha512WithRSAEncryption"),o("1.3.101.112","EdDSA25519"),o("1.2.840.10040.4.3","dsa-with-sha1"),o("1.3.14.3.2.7","desCBC"),o("1.3.14.3.2.26","sha1"),o("1.3.14.3.2.29","sha1WithRSASignature"),o("2.16.840.1.101.3.4.2.1","sha256"),o("2.16.840.1.101.3.4.2.2","sha384"),o("2.16.840.1.101.3.4.2.3","sha512"),o("2.16.840.1.101.3.4.2.4","sha224"),o("2.16.840.1.101.3.4.2.5","sha512-224"),o("2.16.840.1.101.3.4.2.6","sha512-256"),o("1.2.840.113549.2.2","md2"),o("1.2.840.113549.2.5","md5"),o("1.2.840.113549.1.7.1","data"),o("1.2.840.113549.1.7.2","signedData"),o("1.2.840.113549.1.7.3","envelopedData"),o("1.2.840.113549.1.7.4","signedAndEnvelopedData"),o("1.2.840.113549.1.7.5","digestedData"),o("1.2.840.113549.1.7.6","encryptedData"),o("1.2.840.113549.1.9.1","emailAddress"),o("1.2.840.113549.1.9.2","unstructuredName"),o("1.2.840.113549.1.9.3","contentType"),o("1.2.840.113549.1.9.4","messageDigest"),o("1.2.840.113549.1.9.5","signingTime"),o("1.2.840.113549.1.9.6","counterSignature"),o("1.2.840.113549.1.9.7","challengePassword"),o("1.2.840.113549.1.9.8","unstructuredAddress"),o("1.2.840.113549.1.9.14","extensionRequest"),o("1.2.840.113549.1.9.20","friendlyName"),o("1.2.840.113549.1.9.21","localKeyId"),o("1.2.840.113549.1.9.22.1","x509Certificate"),o("1.2.840.113549.1.12.10.1.1","keyBag"),o("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag"),o("1.2.840.113549.1.12.10.1.3","certBag"),o("1.2.840.113549.1.12.10.1.4","crlBag"),o("1.2.840.113549.1.12.10.1.5","secretBag"),o("1.2.840.113549.1.12.10.1.6","safeContentsBag"),o("1.2.840.113549.1.5.13","pkcs5PBES2"),o("1.2.840.113549.1.5.12","pkcs5PBKDF2"),o("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4"),o("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4"),o("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC"),o("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC"),o("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC"),o("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC"),o("1.2.840.113549.2.7","hmacWithSHA1"),o("1.2.840.113549.2.8","hmacWithSHA224"),o("1.2.840.113549.2.9","hmacWithSHA256"),o("1.2.840.113549.2.10","hmacWithSHA384"),o("1.2.840.113549.2.11","hmacWithSHA512"),o("1.2.840.113549.3.7","des-EDE3-CBC"),o("2.16.840.1.101.3.4.1.2","aes128-CBC"),o("2.16.840.1.101.3.4.1.22","aes192-CBC"),o("2.16.840.1.101.3.4.1.42","aes256-CBC"),o("2.5.4.3","commonName"),o("2.5.4.4","surname"),o("2.5.4.5","serialNumber"),o("2.5.4.6","countryName"),o("2.5.4.7","localityName"),o("2.5.4.8","stateOrProvinceName"),o("2.5.4.9","streetAddress"),o("2.5.4.10","organizationName"),o("2.5.4.11","organizationalUnitName"),o("2.5.4.12","title"),o("2.5.4.13","description"),o("2.5.4.15","businessCategory"),o("2.5.4.17","postalCode"),o("2.5.4.42","givenName"),o("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName"),o("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName"),o("2.16.840.1.113730.1.1","nsCertType"),o("2.16.840.1.113730.1.13","nsComment"),s("2.5.29.1","authorityKeyIdentifier"),s("2.5.29.2","keyAttributes"),s("2.5.29.3","certificatePolicies"),s("2.5.29.4","keyUsageRestriction"),s("2.5.29.5","policyMapping"),s("2.5.29.6","subtreesConstraint"),s("2.5.29.7","subjectAltName"),s("2.5.29.8","issuerAltName"),s("2.5.29.9","subjectDirectoryAttributes"),s("2.5.29.10","basicConstraints"),s("2.5.29.11","nameConstraints"),s("2.5.29.12","policyConstraints"),s("2.5.29.13","basicConstraints"),o("2.5.29.14","subjectKeyIdentifier"),o("2.5.29.15","keyUsage"),s("2.5.29.16","privateKeyUsagePeriod"),o("2.5.29.17","subjectAltName"),o("2.5.29.18","issuerAltName"),o("2.5.29.19","basicConstraints"),s("2.5.29.20","cRLNumber"),s("2.5.29.21","cRLReason"),s("2.5.29.22","expirationDate"),s("2.5.29.23","instructionCode"),s("2.5.29.24","invalidityDate"),s("2.5.29.25","cRLDistributionPoints"),s("2.5.29.26","issuingDistributionPoint"),s("2.5.29.27","deltaCRLIndicator"),s("2.5.29.28","issuingDistributionPoint"),s("2.5.29.29","certificateIssuer"),s("2.5.29.30","nameConstraints"),o("2.5.29.31","cRLDistributionPoints"),o("2.5.29.32","certificatePolicies"),s("2.5.29.33","policyMappings"),s("2.5.29.34","policyConstraints"),o("2.5.29.35","authorityKeyIdentifier"),s("2.5.29.36","policyConstraints"),o("2.5.29.37","extKeyUsage"),s("2.5.29.46","freshestCRL"),s("2.5.29.54","inhibitAnyPolicy"),o("1.3.6.1.4.1.11129.2.4.2","timestampList"),o("1.3.6.1.5.5.7.1.1","authorityInfoAccess"),o("1.3.6.1.5.5.7.3.1","serverAuth"),o("1.3.6.1.5.5.7.3.2","clientAuth"),o("1.3.6.1.5.5.7.3.3","codeSigning"),o("1.3.6.1.5.5.7.3.4","emailProtection"),o("1.3.6.1.5.5.7.3.8","timeStamping")},3555:(e,t,n)=>{var r=n(45);if(n(9353),n(5465),n(2986),n(5693),n(3225),n(8009),n(5224),n(2795),n(1577),n(9408),n(3900),"undefined"===typeof i)var i=r.jsbn.BigInteger;var o=r.asn1,s=r.pki=r.pki||{};e.exports=s.pbe=r.pbe=r.pbe||{};var a=s.oids,l={name:"EncryptedPrivateKeyInfo",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:o.Class.UNIVERSAL,type:o.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},c={name:"PBES2Algorithms",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:o.Class.UNIVERSAL,type:o.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:o.Class.UNIVERSAL,type:o.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:o.Class.UNIVERSAL,type:o.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:o.Class.UNIVERSAL,type:o.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},u={name:"pkcs-12PbeParams",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:o.Class.UNIVERSAL,type:o.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"iterations"}]};function h(e,t){return e.start().update(t).digest().getBytes()}function d(e){var t;if(e){if(!(t=s.oids[o.derToOid(e)])){var n=new Error("Unsupported PRF OID.");throw n.oid=e,n.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],n}}else t="hmacWithSHA1";return f(t)}function f(e){var t=r.md;switch(e){case"hmacWithSHA224":t=r.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":e=e.substr(8).toLowerCase();break;default:var n=new Error("Unsupported PRF algorithm.");throw n.algorithm=e,n.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],n}if(!t||!(e in t))throw new Error("Unknown hash algorithm: "+e);return t[e].create()}s.encryptPrivateKeyInfo=function(e,t,n){(n=n||{}).saltSize=n.saltSize||8,n.count=n.count||2048,n.algorithm=n.algorithm||"aes128",n.prfAlgorithm=n.prfAlgorithm||"sha1";var i,l,c,u=r.random.getBytesSync(n.saltSize),h=n.count,d=o.integerToDer(h);if(0===n.algorithm.indexOf("aes")||"des"===n.algorithm){var p,g,y;switch(n.algorithm){case"aes128":i=16,p=16,g=a["aes128-CBC"],y=r.aes.createEncryptionCipher;break;case"aes192":i=24,p=16,g=a["aes192-CBC"],y=r.aes.createEncryptionCipher;break;case"aes256":i=32,p=16,g=a["aes256-CBC"],y=r.aes.createEncryptionCipher;break;case"des":i=8,p=8,g=a.desCBC,y=r.des.createEncryptionCipher;break;default:throw(_=new Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=n.algorithm,_}var v="hmacWith"+n.prfAlgorithm.toUpperCase(),m=f(v),w=r.pkcs5.pbkdf2(t,u,h,i,m),b=r.random.getBytesSync(p);(S=y(w)).start(b),S.update(o.toDer(e)),S.finish(),c=S.output.getBytes();var E=function(e,t,n,i){var a=o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OCTETSTRING,!1,e),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,t.getBytes())]);"hmacWithSHA1"!==i&&a.value.push(o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,r.util.hexToBytes(n.toString(16))),o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OID,!1,o.oidToDer(s.oids[i]).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.NULL,!1,"")]));return a}(u,d,i,v);l=o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OID,!1,o.oidToDer(a.pkcs5PBES2).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OID,!1,o.oidToDer(a.pkcs5PBKDF2).getBytes()),E]),o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OID,!1,o.oidToDer(g).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.OCTETSTRING,!1,b)])])])}else{var _;if("3des"!==n.algorithm)throw(_=new Error("Cannot encrypt private key. Unknown encryption algorithm.")).algorithm=n.algorithm,_;i=24;var S,k=new r.util.ByteBuffer(u);w=s.pbe.generatePkcs12Key(t,k,1,h,i),b=s.pbe.generatePkcs12Key(t,k,2,h,i);(S=r.des.createEncryptionCipher(w)).start(b),S.update(o.toDer(e)),S.finish(),c=S.output.getBytes(),l=o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OID,!1,o.oidToDer(a["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OCTETSTRING,!1,u),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,d.getBytes())])])}return o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[l,o.create(o.Class.UNIVERSAL,o.Type.OCTETSTRING,!1,c)])},s.decryptPrivateKeyInfo=function(e,t){var n=null,i={},a=[];if(!o.validate(e,l,i,a)){var c=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw c.errors=a,c}var u=o.derToOid(i.encryptionOid),h=s.pbe.getCipher(u,i.encryptionParams,t),d=r.util.createBuffer(i.encryptedData);return h.update(d),h.finish()&&(n=o.fromDer(h.output)),n},s.encryptedPrivateKeyToPem=function(e,t){var n={type:"ENCRYPTED PRIVATE KEY",body:o.toDer(e).getBytes()};return r.pem.encode(n,{maxline:t})},s.encryptedPrivateKeyFromPem=function(e){var t=r.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==t.type){var n=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw n.headerType=t.type,n}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return o.fromDer(t.body)},s.encryptRsaPrivateKey=function(e,t,n){if(!(n=n||{}).legacy){var i=s.wrapRsaPrivateKey(s.privateKeyToAsn1(e));return i=s.encryptPrivateKeyInfo(i,t,n),s.encryptedPrivateKeyToPem(i)}var a,l,c,u;switch(n.algorithm){case"aes128":a="AES-128-CBC",c=16,l=r.random.getBytesSync(16),u=r.aes.createEncryptionCipher;break;case"aes192":a="AES-192-CBC",c=24,l=r.random.getBytesSync(16),u=r.aes.createEncryptionCipher;break;case"aes256":a="AES-256-CBC",c=32,l=r.random.getBytesSync(16),u=r.aes.createEncryptionCipher;break;case"3des":a="DES-EDE3-CBC",c=24,l=r.random.getBytesSync(8),u=r.des.createEncryptionCipher;break;case"des":a="DES-CBC",c=8,l=r.random.getBytesSync(8),u=r.des.createEncryptionCipher;break;default:var h=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+n.algorithm+'".');throw h.algorithm=n.algorithm,h}var d=u(r.pbe.opensslDeriveBytes(t,l.substr(0,8),c));d.start(l),d.update(o.toDer(s.privateKeyToAsn1(e))),d.finish();var f={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:a,parameters:r.util.bytesToHex(l).toUpperCase()},body:d.output.getBytes()};return r.pem.encode(f)},s.decryptRsaPrivateKey=function(e,t){var n=null,i=r.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==i.type&&"PRIVATE KEY"!==i.type&&"RSA PRIVATE KEY"!==i.type)throw(c=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".')).headerType=c,c;if(i.procType&&"ENCRYPTED"===i.procType.type){var a,l;switch(i.dekInfo.algorithm){case"DES-CBC":a=8,l=r.des.createDecryptionCipher;break;case"DES-EDE3-CBC":a=24,l=r.des.createDecryptionCipher;break;case"AES-128-CBC":a=16,l=r.aes.createDecryptionCipher;break;case"AES-192-CBC":a=24,l=r.aes.createDecryptionCipher;break;case"AES-256-CBC":a=32,l=r.aes.createDecryptionCipher;break;case"RC2-40-CBC":a=5,l=function(e){return r.rc2.createDecryptionCipher(e,40)};break;case"RC2-64-CBC":a=8,l=function(e){return r.rc2.createDecryptionCipher(e,64)};break;case"RC2-128-CBC":a=16,l=function(e){return r.rc2.createDecryptionCipher(e,128)};break;default:var c;throw(c=new Error('Could not decrypt private key; unsupported encryption algorithm "'+i.dekInfo.algorithm+'".')).algorithm=i.dekInfo.algorithm,c}var u=r.util.hexToBytes(i.dekInfo.parameters),h=l(r.pbe.opensslDeriveBytes(t,u.substr(0,8),a));if(h.start(u),h.update(r.util.createBuffer(i.body)),!h.finish())return n;n=h.output.getBytes()}else n=i.body;return null!==(n="ENCRYPTED PRIVATE KEY"===i.type?s.decryptPrivateKeyInfo(o.fromDer(n),t):o.fromDer(n))&&(n=s.privateKeyFromAsn1(n)),n},s.pbe.generatePkcs12Key=function(e,t,n,i,o,s){var a,l;if("undefined"===typeof s||null===s){if(!("sha1"in r.md))throw new Error('"sha1" hash algorithm unavailable.');s=r.md.sha1.create()}var c=s.digestLength,u=s.blockLength,h=new r.util.ByteBuffer,d=new r.util.ByteBuffer;if(null!==e&&void 0!==e){for(l=0;l<e.length;l++)d.putInt16(e.charCodeAt(l));d.putInt16(0)}var f=d.length(),p=t.length(),g=new r.util.ByteBuffer;g.fillWithByte(n,u);var y=u*Math.ceil(p/u),v=new r.util.ByteBuffer;for(l=0;l<y;l++)v.putByte(t.at(l%p));var m=u*Math.ceil(f/u),w=new r.util.ByteBuffer;for(l=0;l<m;l++)w.putByte(d.at(l%f));var b=v;b.putBuffer(w);for(var E=Math.ceil(o/c),_=1;_<=E;_++){var S=new r.util.ByteBuffer;S.putBytes(g.bytes()),S.putBytes(b.bytes());for(var k=0;k<i;k++)s.start(),s.update(S.getBytes()),S=s.digest();var A=new r.util.ByteBuffer;for(l=0;l<u;l++)A.putByte(S.at(l%c));var I=Math.ceil(p/u)+Math.ceil(f/u),T=new r.util.ByteBuffer;for(a=0;a<I;a++){var R=new r.util.ByteBuffer(b.getBytes(u)),C=511;for(l=A.length()-1;l>=0;l--)C>>=8,C+=A.at(l)+R.at(l),R.setAt(l,255&C);T.putBuffer(R)}b=T,h.putBuffer(S)}return h.truncate(h.length()-o),h},s.pbe.getCipher=function(e,t,n){switch(e){case s.oids.pkcs5PBES2:return s.pbe.getCipherForPBES2(e,t,n);case s.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case s.oids["pbewithSHAAnd40BitRC2-CBC"]:return s.pbe.getCipherForPKCS12PBE(e,t,n);default:var r=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw r.oid=e,r.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],r}},s.pbe.getCipherForPBES2=function(e,t,n){var i,a={},l=[];if(!o.validate(t,c,a,l))throw(i=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=l,i;if((e=o.derToOid(a.kdfOid))!==s.oids.pkcs5PBKDF2)throw(i=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.")).oid=e,i.supportedOids=["pkcs5PBKDF2"],i;if((e=o.derToOid(a.encOid))!==s.oids["aes128-CBC"]&&e!==s.oids["aes192-CBC"]&&e!==s.oids["aes256-CBC"]&&e!==s.oids["des-EDE3-CBC"]&&e!==s.oids.desCBC)throw(i=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.")).oid=e,i.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],i;var u,h,f=a.kdfSalt,p=r.util.createBuffer(a.kdfIterationCount);switch(p=p.getInt(p.length()<<3),s.oids[e]){case"aes128-CBC":u=16,h=r.aes.createDecryptionCipher;break;case"aes192-CBC":u=24,h=r.aes.createDecryptionCipher;break;case"aes256-CBC":u=32,h=r.aes.createDecryptionCipher;break;case"des-EDE3-CBC":u=24,h=r.des.createDecryptionCipher;break;case"desCBC":u=8,h=r.des.createDecryptionCipher}var g=d(a.prfOid),y=r.pkcs5.pbkdf2(n,f,p,u,g),v=a.encIv,m=h(y);return m.start(v),m},s.pbe.getCipherForPKCS12PBE=function(e,t,n){var i={},a=[];if(!o.validate(t,u,i,a))throw(g=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.")).errors=a,g;var l,c,h,f=r.util.createBuffer(i.salt),p=r.util.createBuffer(i.iterations);switch(p=p.getInt(p.length()<<3),e){case s.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:l=24,c=8,h=r.des.startDecrypting;break;case s.oids["pbewithSHAAnd40BitRC2-CBC"]:l=5,c=8,h=function(e,t){var n=r.rc2.createDecryptionCipher(e,40);return n.start(t,null),n};break;default:var g;throw(g=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.")).oid=e,g}var y=d(i.prfOid),v=s.pbe.generatePkcs12Key(n,f,1,p,l,y);return y.start(),h(v,s.pbe.generatePkcs12Key(n,f,2,p,c,y))},s.pbe.opensslDeriveBytes=function(e,t,n,i){if("undefined"===typeof i||null===i){if(!("md5"in r.md))throw new Error('"md5" hash algorithm unavailable.');i=r.md.md5.create()}null===t&&(t="");for(var o=[h(i,e+t)],s=16,a=1;s<n;++a,s+=16)o.push(h(i,o[a-1]+e+t));return o.join("").substr(0,n)}},8009:(e,t,n)=>{var r=n(45);n(8163),n(5693),n(3900);var i,o=r.pkcs5=r.pkcs5||{};r.util.isNodejs&&!r.options.usePureJavaScript&&(i=n(310)),e.exports=r.pbkdf2=o.pbkdf2=function(e,t,n,o,s,a){if("function"===typeof s&&(a=s,s=null),r.util.isNodejs&&!r.options.usePureJavaScript&&i.pbkdf2&&(null===s||"object"!==typeof s)&&(i.pbkdf2Sync.length>4||!s||"sha1"===s))return"string"!==typeof s&&(s="sha1"),e=Buffer.from(e,"binary"),t=Buffer.from(t,"binary"),a?4===i.pbkdf2Sync.length?i.pbkdf2(e,t,n,o,(function(e,t){if(e)return a(e);a(null,t.toString("binary"))})):i.pbkdf2(e,t,n,o,s,(function(e,t){if(e)return a(e);a(null,t.toString("binary"))})):4===i.pbkdf2Sync.length?i.pbkdf2Sync(e,t,n,o).toString("binary"):i.pbkdf2Sync(e,t,n,o,s).toString("binary");if("undefined"!==typeof s&&null!==s||(s="sha1"),"string"===typeof s){if(!(s in r.md.algorithms))throw new Error("Unknown hash algorithm: "+s);s=r.md[s].create()}var l=s.digestLength;if(o>4294967295*l){var c=new Error("Derived key is too long.");if(a)return a(c);throw c}var u=Math.ceil(o/l),h=o-(u-1)*l,d=r.hmac.create();d.start(s,e);var f,p,g,y="";if(!a){for(var v=1;v<=u;++v){d.start(null,null),d.update(t),d.update(r.util.int32ToBytes(v)),f=g=d.digest().getBytes();for(var m=2;m<=n;++m)d.start(null,null),d.update(g),p=d.digest().getBytes(),f=r.util.xorBytes(f,p,l),g=p;y+=v<u?f:f.substr(0,h)}return y}v=1;function w(){if(v>u)return a(null,y);d.start(null,null),d.update(t),d.update(r.util.int32ToBytes(v)),f=g=d.digest().getBytes(),m=2,b()}function b(){if(m<=n)return d.start(null,null),d.update(g),p=d.digest().getBytes(),f=r.util.xorBytes(f,p,l),g=p,++m,r.util.setImmediate(b);y+=v<u?f:f.substr(0,h),++v,w()}w()}},5224:(e,t,n)=>{var r=n(45);n(3900);var i=e.exports=r.pem=r.pem||{};function o(e){for(var t=e.name+": ",n=[],r=function(e,t){return" "+t},i=0;i<e.values.length;++i)n.push(e.values[i].replace(/^(\S+\r\n)/,r));t+=n.join(",")+"\r\n";var o=0,s=-1;for(i=0;i<t.length;++i,++o)if(o>65&&-1!==s){var a=t[s];","===a?(++s,t=t.substr(0,s)+"\r\n "+t.substr(s)):t=t.substr(0,s)+"\r\n"+a+t.substr(s+1),o=i-s-1,s=-1,++i}else" "!==t[i]&&"\t"!==t[i]&&","!==t[i]||(s=i);return t}function s(e){return e.replace(/^\s+/,"")}i.encode=function(e,t){t=t||{};var n,i="-----BEGIN "+e.type+"-----\r\n";if(e.procType&&(i+=o(n={name:"Proc-Type",values:[String(e.procType.version),e.procType.type]})),e.contentDomain&&(i+=o(n={name:"Content-Domain",values:[e.contentDomain]})),e.dekInfo&&(n={name:"DEK-Info",values:[e.dekInfo.algorithm]},e.dekInfo.parameters&&n.values.push(e.dekInfo.parameters),i+=o(n)),e.headers)for(var s=0;s<e.headers.length;++s)i+=o(e.headers[s]);return e.procType&&(i+="\r\n"),i+=r.util.encode64(e.body,t.maxline||64)+"\r\n",i+="-----END "+e.type+"-----\r\n"},i.decode=function(e){for(var t,n=[],i=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,o=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,a=/\r?\n/;t=i.exec(e);){var l=t[1];"NEW CERTIFICATE REQUEST"===l&&(l="CERTIFICATE REQUEST");var c={type:l,procType:null,contentDomain:null,dekInfo:null,headers:[],body:r.util.decode64(t[3])};if(n.push(c),t[2]){for(var u=t[2].split(a),h=0;t&&h<u.length;){for(var d=u[h].replace(/\s+$/,""),f=h+1;f<u.length;++f){var p=u[f];if(!/\s/.test(p[0]))break;d+=p,h=f}if(t=d.match(o)){for(var g={name:t[1],values:[]},y=t[2].split(","),v=0;v<y.length;++v)g.values.push(s(y[v]));if(c.procType)if(c.contentDomain||"Content-Domain"!==g.name)if(c.dekInfo||"DEK-Info"!==g.name)c.headers.push(g);else{if(0===g.values.length)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');c.dekInfo={algorithm:y[0],parameters:y[1]||null}}else c.contentDomain=y[0]||"";else{if("Proc-Type"!==g.name)throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(2!==g.values.length)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');c.procType={version:y[0],type:y[1]}}}++h}if("ENCRYPTED"===c.procType&&!c.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(0===n.length)throw new Error("Invalid PEM formatted message.");return n}},7668:(e,t,n)=>{var r=n(45);n(3900),n(2795),n(3753);var i=e.exports=r.pkcs1=r.pkcs1||{};function o(e,t,n){n||(n=r.md.sha1.create());for(var i="",o=Math.ceil(t/n.digestLength),s=0;s<o;++s){var a=String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,255&s);n.start(),n.update(e+a),i+=n.digest().getBytes()}return i.substring(0,t)}i.encode_rsa_oaep=function(e,t,n){var i,s,a,l;"string"===typeof n?(i=n,s=arguments[3]||void 0,a=arguments[4]||void 0):n&&(i=n.label||void 0,s=n.seed||void 0,a=n.md||void 0,n.mgf1&&n.mgf1.md&&(l=n.mgf1.md)),a?a.start():a=r.md.sha1.create(),l||(l=a);var c=Math.ceil(e.n.bitLength()/8),u=c-2*a.digestLength-2;if(t.length>u)throw(y=new Error("RSAES-OAEP input message length is too long.")).length=t.length,y.maxLength=u,y;i||(i=""),a.update(i,"raw");for(var h=a.digest(),d="",f=u-t.length,p=0;p<f;p++)d+="\0";var g=h.getBytes()+d+"\x01"+t;if(s){if(s.length!==a.digestLength){var y;throw(y=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.")).seedLength=s.length,y.digestLength=a.digestLength,y}}else s=r.random.getBytes(a.digestLength);var v=o(s,c-a.digestLength-1,l),m=r.util.xorBytes(g,v,g.length),w=o(m,a.digestLength,l);return"\0"+r.util.xorBytes(s,w,s.length)+m},i.decode_rsa_oaep=function(e,t,n){var i,s,a;"string"===typeof n?(i=n,s=arguments[3]||void 0):n&&(i=n.label||void 0,s=n.md||void 0,n.mgf1&&n.mgf1.md&&(a=n.mgf1.md));var l=Math.ceil(e.n.bitLength()/8);if(t.length!==l)throw(v=new Error("RSAES-OAEP encoded message length is invalid.")).length=t.length,v.expectedLength=l,v;if(void 0===s?s=r.md.sha1.create():s.start(),a||(a=s),l<2*s.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");i||(i=""),s.update(i,"raw");for(var c=s.digest().getBytes(),u=t.charAt(0),h=t.substring(1,s.digestLength+1),d=t.substring(1+s.digestLength),f=o(d,s.digestLength,a),p=o(r.util.xorBytes(h,f,h.length),l-s.digestLength-1,a),g=r.util.xorBytes(d,p,d.length),y=g.substring(0,s.digestLength),v="\0"!==u,m=0;m<s.digestLength;++m)v|=c.charAt(m)!==y.charAt(m);for(var w=1,b=s.digestLength,E=s.digestLength;E<g.length;E++){var _=g.charCodeAt(E);v|=_&(w?65534:0),b+=w&=1&_^1}if(v||1!==g.charCodeAt(b))throw new Error("Invalid RSAES-OAEP padding.");return g.substring(b+1)}},8353:(e,t,n)=>{var r=n(45);n(3900),n(9463),n(2795),function(){if(r.prime)e.exports=r.prime;else{var t=e.exports=r.prime=r.prime||{},n=r.jsbn.BigInteger,i=[6,4,2,4,2,4,6,2],o=new n(null);o.fromInt(30);var s=function(e,t){return e|t};t.generateProbablePrime=function(e,t,i){"function"===typeof t&&(i=t,t={});var o=(t=t||{}).algorithm||"PRIMEINC";"string"===typeof o&&(o={name:o}),o.options=o.options||{};var s=t.prng||r.random,l={nextBytes:function(e){for(var t=s.getBytesSync(e.length),n=0;n<e.length;++n)e[n]=t.charCodeAt(n)}};if("PRIMEINC"===o.name)return function(e,t,i,o){if("workers"in i)return function(e,t,i,o){if("undefined"===typeof Worker)return a(e,t,i,o);var s=c(e,t),l=i.workers,u=i.workLoad||100,h=30*u/8,d=i.workerScript||"forge/prime.worker.js";if(-1===l)return r.util.estimateCores((function(e,t){e&&(t=2),l=t-1,f()}));function f(){l=Math.max(1,l);for(var r=[],i=0;i<l;++i)r[i]=new Worker(d);for(i=0;i<l;++i)r[i].addEventListener("message",f);var a=!1;function f(i){if(!a){0;var l=i.data;if(l.found){for(var d=0;d<r.length;++d)r[d].terminate();return a=!0,o(null,new n(l.prime,16))}s.bitLength()>e&&(s=c(e,t));var f=s.toString(16);i.target.postMessage({hex:f,workLoad:u}),s.dAddOffset(h,0)}}}f()}(e,t,i,o);return a(e,t,i,o)}(e,l,o.options,i);throw new Error("Invalid prime generation algorithm: "+o.name)}}function a(e,t,n,r){var i=c(e,t),o=function(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}(i.bitLength());"millerRabinTests"in n&&(o=n.millerRabinTests);var s=10;"maxBlockTime"in n&&(s=n.maxBlockTime),l(i,e,t,0,o,s,r)}function l(e,t,n,o,s,a,u){var h=+new Date;do{if(e.bitLength()>t&&(e=c(t,n)),e.isProbablePrime(s))return u(null,e);e.dAddOffset(i[o++%8],0)}while(a<0||+new Date-h<a);r.util.setImmediate((function(){l(e,t,n,o,s,a,u)}))}function c(e,t){var r=new n(e,t),i=e-1;return r.testBit(i)||r.bitwiseTo(n.ONE.shiftLeft(i),s,r),r.dAddOffset(31-r.mod(o).byteValue(),0),r}}()},1513:(e,t,n)=>{var r=n(45);n(3900);var i=null;!r.util.isNodejs||r.options.usePureJavaScript||process.versions["node-webkit"]||(i=n(310)),(e.exports=r.prng=r.prng||{}).create=function(e){for(var t={plugin:e,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},n=e.md,o=new Array(32),s=0;s<32;++s)o[s]=n.create();function a(){if(t.pools[0].messageLength>=32)return l();var e=32-t.pools[0].messageLength<<5;t.collect(t.seedFileSync(e)),l()}function l(){t.reseeds=4294967295===t.reseeds?0:t.reseeds+1;var e=t.plugin.md.create();e.update(t.keyBytes);for(var n=1,r=0;r<32;++r)t.reseeds%n===0&&(e.update(t.pools[r].digest().getBytes()),t.pools[r].start()),n<<=1;t.keyBytes=e.digest().getBytes(),e.start(),e.update(t.keyBytes);var i=e.digest().getBytes();t.key=t.plugin.formatKey(t.keyBytes),t.seed=t.plugin.formatSeed(i),t.generated=0}function c(e){var t=null,n=r.util.globalScope,i=n.crypto||n.msCrypto;i&&i.getRandomValues&&(t=function(e){return i.getRandomValues(e)});var o=r.util.createBuffer();if(t)for(;o.length()<e;){var s=Math.max(1,Math.min(e-o.length(),65536)/4),a=new Uint32Array(Math.floor(s));try{t(a);for(var l=0;l<a.length;++l)o.putInt32(a[l])}catch(f){if(!("undefined"!==typeof QuotaExceededError&&f instanceof QuotaExceededError))throw f}}if(o.length()<e)for(var c,u,h,d=Math.floor(65536*Math.random());o.length()<e;){u=16807*(65535&d),u+=(32767&(c=16807*(d>>16)))<<16,d=4294967295&(u=(2147483647&(u+=c>>15))+(u>>31));for(l=0;l<3;++l)h=d>>>(l<<3),h^=Math.floor(256*Math.random()),o.putByte(255&h)}return o.getBytes(e)}return t.pools=o,t.pool=0,t.generate=function(e,n){if(!n)return t.generateSync(e);var i=t.plugin.cipher,o=t.plugin.increment,s=t.plugin.formatKey,a=t.plugin.formatSeed,c=r.util.createBuffer();t.key=null,function u(h){if(h)return n(h);if(c.length()>=e)return n(null,c.getBytes(e));t.generated>1048575&&(t.key=null);if(null===t.key)return r.util.nextTick((function(){!function(e){if(t.pools[0].messageLength>=32)return l(),e();var n=32-t.pools[0].messageLength<<5;t.seedFile(n,(function(n,r){if(n)return e(n);t.collect(r),l(),e()}))}(u)}));var d=i(t.key,t.seed);t.generated+=d.length,c.putBytes(d),t.key=s(i(t.key,o(t.seed))),t.seed=a(i(t.key,t.seed)),r.util.setImmediate(u)}()},t.generateSync=function(e){var n=t.plugin.cipher,i=t.plugin.increment,o=t.plugin.formatKey,s=t.plugin.formatSeed;t.key=null;for(var l=r.util.createBuffer();l.length()<e;){t.generated>1048575&&(t.key=null),null===t.key&&a();var c=n(t.key,t.seed);t.generated+=c.length,l.putBytes(c),t.key=o(n(t.key,i(t.seed))),t.seed=s(n(t.key,t.seed))}return l.getBytes(e)},i?(t.seedFile=function(e,t){i.randomBytes(e,(function(e,n){if(e)return t(e);t(null,n.toString())}))},t.seedFileSync=function(e){return i.randomBytes(e).toString()}):(t.seedFile=function(e,t){try{t(null,c(e))}catch(n){t(n)}},t.seedFileSync=c),t.collect=function(e){for(var n=e.length,r=0;r<n;++r)t.pools[t.pool].update(e.substr(r,1)),t.pool=31===t.pool?0:t.pool+1},t.collectInt=function(e,n){for(var r="",i=0;i<n;i+=8)r+=String.fromCharCode(e>>i&255);t.collect(r)},t.registerWorker=function(e){if(e===self)t.seedFile=function(e,t){self.addEventListener("message",(function e(n){var r=n.data;r.forge&&r.forge.prng&&(self.removeEventListener("message",e),t(r.forge.prng.err,r.forge.prng.bytes))})),self.postMessage({forge:{prng:{needed:e}}})};else{e.addEventListener("message",(function(n){var r=n.data;r.forge&&r.forge.prng&&t.seedFile(r.forge.prng.needed,(function(t,n){e.postMessage({forge:{prng:{err:t,bytes:n}}})}))}))}},t}},2795:(e,t,n)=>{var r=n(45);n(9353),n(3899),n(1513),n(3900),r.random&&r.random.getBytes?e.exports=r.random:function(t){var n={},i=new Array(4),o=r.util.createBuffer();function s(){var e=r.prng.create(n);return e.getBytes=function(t,n){return e.generate(t,n)},e.getBytesSync=function(t){return e.generate(t)},e}n.formatKey=function(e){var t=r.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),r.aes._expandKey(e,!1)},n.formatSeed=function(e){var t=r.util.createBuffer(e);return(e=new Array(4))[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),e},n.cipher=function(e,t){return r.aes._updateBlock(e,t,i,!1),o.putInt32(i[0]),o.putInt32(i[1]),o.putInt32(i[2]),o.putInt32(i[3]),o.getBytes()},n.increment=function(e){return++e[3],e},n.md=r.md.sha256;var a=s(),l=null,c=r.util.globalScope,u=c.crypto||c.msCrypto;if(u&&u.getRandomValues&&(l=function(e){return u.getRandomValues(e)}),r.options.usePureJavaScript||!r.util.isNodejs&&!l){if("undefined"===typeof window||window.document,a.collectInt(+new Date,32),"undefined"!==typeof navigator){var h="";for(var d in navigator)try{"string"==typeof navigator[d]&&(h+=navigator[d])}catch(f){}a.collect(h),h=null}t&&(t().mousemove((function(e){a.collectInt(e.clientX,16),a.collectInt(e.clientY,16)})),t().keypress((function(e){a.collectInt(e.charCode,8)})))}if(r.random)for(var d in a)r.random[d]=a[d];else r.random=a;r.random.createInstance=s,e.exports=r.random}("undefined"!==typeof jQuery?jQuery:null)},1577:(e,t,n)=>{var r=n(45);n(3900);var i=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],o=[1,2,3,5],s=function(e,t){return e<<t&65535|(65535&e)>>16-t},a=function(e,t){return(65535&e)>>t|e<<16-t&65535};e.exports=r.rc2=r.rc2||{},r.rc2.expandKey=function(e,t){"string"===typeof e&&(e=r.util.createBuffer(e)),t=t||128;var n,o=e,s=e.length(),a=t,l=Math.ceil(a/8),c=255>>(7&a);for(n=s;n<128;n++)o.putByte(i[o.at(n-1)+o.at(n-s)&255]);for(o.setAt(128-l,i[o.at(128-l)&c]),n=127-l;n>=0;n--)o.setAt(n,i[o.at(n+1)^o.at(n+l)]);return o};var l=function(e,t,n){var i,l,c,u,h=!1,d=null,f=null,p=null,g=[];for(e=r.rc2.expandKey(e,t),c=0;c<64;c++)g.push(e.getInt16Le());n?(i=function(e){for(c=0;c<4;c++)e[c]+=g[u]+(e[(c+3)%4]&e[(c+2)%4])+(~e[(c+3)%4]&e[(c+1)%4]),e[c]=s(e[c],o[c]),u++},l=function(e){for(c=0;c<4;c++)e[c]+=g[63&e[(c+3)%4]]}):(i=function(e){for(c=3;c>=0;c--)e[c]=a(e[c],o[c]),e[c]-=g[u]+(e[(c+3)%4]&e[(c+2)%4])+(~e[(c+3)%4]&e[(c+1)%4]),u--},l=function(e){for(c=3;c>=0;c--)e[c]-=g[63&e[(c+3)%4]]});var y=function(e){var t=[];for(c=0;c<4;c++){var r=d.getInt16Le();null!==p&&(n?r^=p.getInt16Le():p.putInt16Le(r)),t.push(65535&r)}u=n?0:63;for(var i=0;i<e.length;i++)for(var o=0;o<e[i][0];o++)e[i][1](t);for(c=0;c<4;c++)null!==p&&(n?p.putInt16Le(t[c]):t[c]^=p.getInt16Le()),f.putInt16Le(t[c])},v=null;return v={start:function(e,t){e&&"string"===typeof e&&(e=r.util.createBuffer(e)),h=!1,d=r.util.createBuffer(),f=t||new r.util.createBuffer,p=e,v.output=f},update:function(e){for(h||d.putBuffer(e);d.length()>=8;)y([[5,i],[1,l],[6,i],[1,l],[5,i]])},finish:function(e){var t=!0;if(n)if(e)t=e(8,d,!n);else{var r=8===d.length()?8:8-d.length();d.fillWithByte(r,r)}if(t&&(h=!0,v.update()),!n&&(t=0===d.length()))if(e)t=e(8,f,!n);else{var i=f.length(),o=f.at(i-1);o>i?t=!1:f.truncate(o)}return t}}};r.rc2.startEncrypting=function(e,t,n){var i=r.rc2.createEncryptionCipher(e,128);return i.start(t,n),i},r.rc2.createEncryptionCipher=function(e,t){return l(e,t,!0)},r.rc2.startDecrypting=function(e,t,n){var i=r.rc2.createDecryptionCipher(e,128);return i.start(t,n),i},r.rc2.createDecryptionCipher=function(e,t){return l(e,t,!1)}},9408:(e,t,n)=>{var r=n(45);if(n(5465),n(9463),n(3225),n(7668),n(8353),n(2795),n(3900),"undefined"===typeof i)var i=r.jsbn.BigInteger;var o=r.util.isNodejs?n(310):null,s=r.asn1,a=r.util;r.pki=r.pki||{},e.exports=r.pki.rsa=r.rsa=r.rsa||{};var l=r.pki,c=[6,4,2,4,2,4,6,2],u={name:"PrivateKeyInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},h={name:"RSAPrivateKey",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},d={name:"RSAPublicKey",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},f=r.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:s.Class.UNIVERSAL,type:s.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},p={name:"DigestInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:s.Class.UNIVERSAL,type:s.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:s.Class.UNIVERSAL,type:s.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},g=function(e){var t;if(!(e.algorithm in l.oids)){var n=new Error("Unknown message digest algorithm.");throw n.algorithm=e.algorithm,n}t=l.oids[e.algorithm];var r=s.oidToDer(t).getBytes(),i=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]),o=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]);o.value.push(s.create(s.Class.UNIVERSAL,s.Type.OID,!1,r)),o.value.push(s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,""));var a=s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,e.digest().getBytes());return i.value.push(o),i.value.push(a),s.toDer(i).getBytes()},y=function(e,t,n){if(n)return e.modPow(t.e,t.n);if(!t.p||!t.q)return e.modPow(t.d,t.n);var o;t.dP||(t.dP=t.d.mod(t.p.subtract(i.ONE))),t.dQ||(t.dQ=t.d.mod(t.q.subtract(i.ONE))),t.qInv||(t.qInv=t.q.modInverse(t.p));do{o=new i(r.util.bytesToHex(r.random.getBytes(t.n.bitLength()/8)),16)}while(o.compareTo(t.n)>=0||!o.gcd(t.n).equals(i.ONE));for(var s=(e=e.multiply(o.modPow(t.e,t.n)).mod(t.n)).mod(t.p).modPow(t.dP,t.p),a=e.mod(t.q).modPow(t.dQ,t.q);s.compareTo(a)<0;)s=s.add(t.p);var l=s.subtract(a).multiply(t.qInv).mod(t.p).multiply(t.q).add(a);return l=l.multiply(o.modInverse(t.n)).mod(t.n)};function v(e,t,n){var i=r.util.createBuffer(),o=Math.ceil(t.n.bitLength()/8);if(e.length>o-11){var s=new Error("Message is too long for PKCS#1 v1.5 padding.");throw s.length=e.length,s.max=o-11,s}i.putByte(0),i.putByte(n);var a,l=o-3-e.length;if(0===n||1===n){a=0===n?0:255;for(var c=0;c<l;++c)i.putByte(a)}else for(;l>0;){var u=0,h=r.random.getBytes(l);for(c=0;c<l;++c)0===(a=h.charCodeAt(c))?++u:i.putByte(a);l=u}return i.putByte(0),i.putBytes(e),i}function m(e,t,n,i){var o=Math.ceil(t.n.bitLength()/8),s=r.util.createBuffer(e),a=s.getByte(),l=s.getByte();if(0!==a||n&&0!==l&&1!==l||!n&&2!=l||n&&0===l&&"undefined"===typeof i)throw new Error("Encryption block is invalid.");var c=0;if(0===l){c=o-3-i;for(var u=0;u<c;++u)if(0!==s.getByte())throw new Error("Encryption block is invalid.")}else if(1===l)for(c=0;s.length()>1;){if(255!==s.getByte()){--s.read;break}++c}else if(2===l)for(c=0;s.length()>1;){if(0===s.getByte()){--s.read;break}++c}if(0!==s.getByte()||c!==o-3-s.length())throw new Error("Encryption block is invalid.");return s.getBytes()}function w(e){var t=e.toString(16);t[0]>="8"&&(t="00"+t);var n=r.util.hexToBytes(t);return n.length>1&&(0===n.charCodeAt(0)&&0===(128&n.charCodeAt(1))||255===n.charCodeAt(0)&&128===(128&n.charCodeAt(1)))?n.substr(1):n}function b(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}function E(e){return r.util.isNodejs&&"function"===typeof o[e]}function _(e){return"undefined"!==typeof a.globalScope&&"object"===typeof a.globalScope.crypto&&"object"===typeof a.globalScope.crypto.subtle&&"function"===typeof a.globalScope.crypto.subtle[e]}function S(e){return"undefined"!==typeof a.globalScope&&"object"===typeof a.globalScope.msCrypto&&"object"===typeof a.globalScope.msCrypto.subtle&&"function"===typeof a.globalScope.msCrypto.subtle[e]}function k(e){for(var t=r.util.hexToBytes(e.toString(16)),n=new Uint8Array(t.length),i=0;i<t.length;++i)n[i]=t.charCodeAt(i);return n}l.rsa.encrypt=function(e,t,n){var o,s=n,a=Math.ceil(t.n.bitLength()/8);!1!==n&&!0!==n?(s=2===n,o=v(e,t,n)):(o=r.util.createBuffer()).putBytes(e);for(var l=new i(o.toHex(),16),c=y(l,t,s).toString(16),u=r.util.createBuffer(),h=a-Math.ceil(c.length/2);h>0;)u.putByte(0),--h;return u.putBytes(r.util.hexToBytes(c)),u.getBytes()},l.rsa.decrypt=function(e,t,n,o){var s=Math.ceil(t.n.bitLength()/8);if(e.length!==s){var a=new Error("Encrypted message length is invalid.");throw a.length=e.length,a.expected=s,a}var l=new i(r.util.createBuffer(e).toHex(),16);if(l.compareTo(t.n)>=0)throw new Error("Encrypted message is invalid.");for(var c=y(l,t,n).toString(16),u=r.util.createBuffer(),h=s-Math.ceil(c.length/2);h>0;)u.putByte(0),--h;return u.putBytes(r.util.hexToBytes(c)),!1!==o?m(u.getBytes(),t,n):u.getBytes()},l.rsa.createKeyPairGenerationState=function(e,t,n){"string"===typeof e&&(e=parseInt(e,10)),e=e||2048;var o,s=(n=n||{}).prng||r.random,a={nextBytes:function(e){for(var t=s.getBytesSync(e.length),n=0;n<e.length;++n)e[n]=t.charCodeAt(n)}},l=n.algorithm||"PRIMEINC";if("PRIMEINC"!==l)throw new Error("Invalid key generation algorithm: "+l);return(o={algorithm:l,state:0,bits:e,rng:a,eInt:t||65537,e:new i(null),p:null,q:null,qBits:e>>1,pBits:e-(e>>1),pqState:0,num:null,keys:null}).e.fromInt(o.eInt),o},l.rsa.stepKeyPairGenerationState=function(e,t){"algorithm"in e||(e.algorithm="PRIMEINC");var n=new i(null);n.fromInt(30);for(var r,o=0,s=function(e,t){return e|t},a=+new Date,u=0;null===e.keys&&(t<=0||u<t);){if(0===e.state){var h=null===e.p?e.pBits:e.qBits,d=h-1;0===e.pqState?(e.num=new i(h,e.rng),e.num.testBit(d)||e.num.bitwiseTo(i.ONE.shiftLeft(d),s,e.num),e.num.dAddOffset(31-e.num.mod(n).byteValue(),0),o=0,++e.pqState):1===e.pqState?e.num.bitLength()>h?e.pqState=0:e.num.isProbablePrime(b(e.num.bitLength()))?++e.pqState:e.num.dAddOffset(c[o++%8],0):2===e.pqState?e.pqState=0===e.num.subtract(i.ONE).gcd(e.e).compareTo(i.ONE)?3:0:3===e.pqState&&(e.pqState=0,null===e.p?e.p=e.num:e.q=e.num,null!==e.p&&null!==e.q&&++e.state,e.num=null)}else if(1===e.state)e.p.compareTo(e.q)<0&&(e.num=e.p,e.p=e.q,e.q=e.num),++e.state;else if(2===e.state)e.p1=e.p.subtract(i.ONE),e.q1=e.q.subtract(i.ONE),e.phi=e.p1.multiply(e.q1),++e.state;else if(3===e.state)0===e.phi.gcd(e.e).compareTo(i.ONE)?++e.state:(e.p=null,e.q=null,e.state=0);else if(4===e.state)e.n=e.p.multiply(e.q),e.n.bitLength()===e.bits?++e.state:(e.q=null,e.state=0);else if(5===e.state){var f=e.e.modInverse(e.phi);e.keys={privateKey:l.rsa.setPrivateKey(e.n,e.e,f,e.p,e.q,f.mod(e.p1),f.mod(e.q1),e.q.modInverse(e.p)),publicKey:l.rsa.setPublicKey(e.n,e.e)}}u+=(r=+new Date)-a,a=r}return null!==e.keys},l.rsa.generateKeyPair=function(e,t,n,c){if(1===arguments.length?"object"===typeof e?(n=e,e=void 0):"function"===typeof e&&(c=e,e=void 0):2===arguments.length?"number"===typeof e?"function"===typeof t?(c=t,t=void 0):"number"!==typeof t&&(n=t,t=void 0):(n=e,c=t,e=void 0,t=void 0):3===arguments.length&&("number"===typeof t?"function"===typeof n&&(c=n,n=void 0):(c=n,n=t,t=void 0)),n=n||{},void 0===e&&(e=n.bits||2048),void 0===t&&(t=n.e||65537),!r.options.usePureJavaScript&&!n.prng&&e>=256&&e<=16384&&(65537===t||3===t))if(c){if(E("generateKeyPair"))return o.generateKeyPair("rsa",{modulusLength:e,publicExponent:t,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},(function(e,t,n){if(e)return c(e);c(null,{privateKey:l.privateKeyFromPem(n),publicKey:l.publicKeyFromPem(t)})}));if(_("generateKey")&&_("exportKey"))return a.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:k(t),hash:{name:"SHA-256"}},!0,["sign","verify"]).then((function(e){return a.globalScope.crypto.subtle.exportKey("pkcs8",e.privateKey)})).then(void 0,(function(e){c(e)})).then((function(e){if(e){var t=l.privateKeyFromAsn1(s.fromDer(r.util.createBuffer(e)));c(null,{privateKey:t,publicKey:l.setRsaPublicKey(t.n,t.e)})}}));if(S("generateKey")&&S("exportKey")){var u=a.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:k(t),hash:{name:"SHA-256"}},!0,["sign","verify"]);return u.oncomplete=function(e){var t=e.target.result,n=a.globalScope.msCrypto.subtle.exportKey("pkcs8",t.privateKey);n.oncomplete=function(e){var t=e.target.result,n=l.privateKeyFromAsn1(s.fromDer(r.util.createBuffer(t)));c(null,{privateKey:n,publicKey:l.setRsaPublicKey(n.n,n.e)})},n.onerror=function(e){c(e)}},void(u.onerror=function(e){c(e)})}}else if(E("generateKeyPairSync")){var h=o.generateKeyPairSync("rsa",{modulusLength:e,publicExponent:t,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:l.privateKeyFromPem(h.privateKey),publicKey:l.publicKeyFromPem(h.publicKey)}}var d=l.rsa.createKeyPairGenerationState(e,t,n);if(!c)return l.rsa.stepKeyPairGenerationState(d,0),d.keys;!function(e,t,n){"function"===typeof t&&(n=t,t={});t=t||{};var o={algorithm:{name:t.algorithm||"PRIMEINC",options:{workers:t.workers||2,workLoad:t.workLoad||100,workerScript:t.workerScript}}};"prng"in t&&(o.prng=t.prng);function s(){a(e.pBits,(function(t,r){return t?n(t):(e.p=r,null!==e.q?c(t,e.q):void a(e.qBits,c))}))}function a(e,t){r.prime.generateProbablePrime(e,o,t)}function c(t,r){if(t)return n(t);if(e.q=r,e.p.compareTo(e.q)<0){var o=e.p;e.p=e.q,e.q=o}if(0!==e.p.subtract(i.ONE).gcd(e.e).compareTo(i.ONE))return e.p=null,void s();if(0!==e.q.subtract(i.ONE).gcd(e.e).compareTo(i.ONE))return e.q=null,void a(e.qBits,c);if(e.p1=e.p.subtract(i.ONE),e.q1=e.q.subtract(i.ONE),e.phi=e.p1.multiply(e.q1),0!==e.phi.gcd(e.e).compareTo(i.ONE))return e.p=e.q=null,void s();if(e.n=e.p.multiply(e.q),e.n.bitLength()!==e.bits)return e.q=null,void a(e.qBits,c);var u=e.e.modInverse(e.phi);e.keys={privateKey:l.rsa.setPrivateKey(e.n,e.e,u,e.p,e.q,u.mod(e.p1),u.mod(e.q1),e.q.modInverse(e.p)),publicKey:l.rsa.setPublicKey(e.n,e.e)},n(null,e.keys)}s()}(d,n,c)},l.setRsaPublicKey=l.rsa.setPublicKey=function(e,t){var n={n:e,e:t,encrypt:function(e,t,i){if("string"===typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5"),"RSAES-PKCS1-V1_5"===t)t={encode:function(e,t,n){return v(e,t,2).getBytes()}};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={encode:function(e,t){return r.pkcs1.encode_rsa_oaep(t,e,i)}};else if(-1!==["RAW","NONE","NULL",null].indexOf(t))t={encode:function(e){return e}};else if("string"===typeof t)throw new Error('Unsupported encryption scheme: "'+t+'".');var o=t.encode(e,n,!0);return l.rsa.encrypt(o,n,!0)},verify:function(e,t,i,o){"string"===typeof i?i=i.toUpperCase():void 0===i&&(i="RSASSA-PKCS1-V1_5"),void 0===o&&(o={_parseAllDigestBytes:!0}),"_parseAllDigestBytes"in o||(o._parseAllDigestBytes=!0),"RSASSA-PKCS1-V1_5"===i?i={verify:function(e,t){t=m(t,n,!0);var i=s.fromDer(t,{parseAllBytes:o._parseAllDigestBytes}),a={},l=[];if(!s.validate(i,p,a,l))throw(c=new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.")).errors=l,c;var c,u=s.derToOid(a.algorithmIdentifier);if(u!==r.oids.md2&&u!==r.oids.md5&&u!==r.oids.sha1&&u!==r.oids.sha224&&u!==r.oids.sha256&&u!==r.oids.sha384&&u!==r.oids.sha512&&u!==r.oids["sha512-224"]&&u!==r.oids["sha512-256"])throw(c=new Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.")).oid=u,c;if((u===r.oids.md2||u===r.oids.md5)&&!("parameters"in a))throw new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifer NULL parameters.");return e===a.digest}}:"NONE"!==i&&"NULL"!==i&&null!==i||(i={verify:function(e,t){return e===(t=m(t,n,!0))}});var a=l.rsa.decrypt(t,n,!0,!1);return i.verify(e,a,n.n.bitLength())}};return n},l.setRsaPrivateKey=l.rsa.setPrivateKey=function(e,t,n,i,o,s,a,c){var u={n:e,e:t,d:n,p:i,q:o,dP:s,dQ:a,qInv:c,decrypt:function(e,t,n){"string"===typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5");var i=l.rsa.decrypt(e,u,!1,!1);if("RSAES-PKCS1-V1_5"===t)t={decode:m};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={decode:function(e,t){return r.pkcs1.decode_rsa_oaep(t,e,n)}};else{if(-1===["RAW","NONE","NULL",null].indexOf(t))throw new Error('Unsupported encryption scheme: "'+t+'".');t={decode:function(e){return e}}}return t.decode(i,u,!1)},sign:function(e,t){var n=!1;"string"===typeof t&&(t=t.toUpperCase()),void 0===t||"RSASSA-PKCS1-V1_5"===t?(t={encode:g},n=1):"NONE"!==t&&"NULL"!==t&&null!==t||(t={encode:function(){return e}},n=1);var r=t.encode(e,u.n.bitLength());return l.rsa.encrypt(r,u,n)}};return u},l.wrapRsaPrivateKey=function(e){return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(0).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(l.oids.rsaEncryption).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")]),s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,s.toDer(e).getBytes())])},l.privateKeyFromAsn1=function(e){var t,n,o,a,c,d,f,p,g={},y=[];if(s.validate(e,u,g,y)&&(e=s.fromDer(r.util.createBuffer(g.privateKey))),g={},y=[],!s.validate(e,h,g,y)){var v=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw v.errors=y,v}return t=r.util.createBuffer(g.privateKeyModulus).toHex(),n=r.util.createBuffer(g.privateKeyPublicExponent).toHex(),o=r.util.createBuffer(g.privateKeyPrivateExponent).toHex(),a=r.util.createBuffer(g.privateKeyPrime1).toHex(),c=r.util.createBuffer(g.privateKeyPrime2).toHex(),d=r.util.createBuffer(g.privateKeyExponent1).toHex(),f=r.util.createBuffer(g.privateKeyExponent2).toHex(),p=r.util.createBuffer(g.privateKeyCoefficient).toHex(),l.setRsaPrivateKey(new i(t,16),new i(n,16),new i(o,16),new i(a,16),new i(c,16),new i(d,16),new i(f,16),new i(p,16))},l.privateKeyToAsn1=l.privateKeyToRSAPrivateKey=function(e){return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(0).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,w(e.n)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,w(e.e)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,w(e.d)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,w(e.p)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,w(e.q)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,w(e.dP)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,w(e.dQ)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,w(e.qInv))])},l.publicKeyFromAsn1=function(e){var t={},n=[];if(s.validate(e,f,t,n)){var o,a=s.derToOid(t.publicKeyOid);if(a!==l.oids.rsaEncryption)throw(o=new Error("Cannot read public key. Unknown OID.")).oid=a,o;e=t.rsaPublicKey}if(n=[],!s.validate(e,d,t,n))throw(o=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.")).errors=n,o;var c=r.util.createBuffer(t.publicKeyModulus).toHex(),u=r.util.createBuffer(t.publicKeyExponent).toHex();return l.setRsaPublicKey(new i(c,16),new i(u,16))},l.publicKeyToAsn1=l.publicKeyToSubjectPublicKeyInfo=function(e){return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(l.oids.rsaEncryption).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")]),s.create(s.Class.UNIVERSAL,s.Type.BITSTRING,!1,[l.publicKeyToRSAPublicKey(e)])])},l.publicKeyToRSAPublicKey=function(e){return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,w(e.n)),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,w(e.e))])}},3753:(e,t,n)=>{var r=n(45);n(5693),n(3900);var i=e.exports=r.sha1=r.sha1||{};r.md.sha1=r.md.algorithms.sha1=i,i.create=function(){s||(o=String.fromCharCode(128),o+=r.util.fillString(String.fromCharCode(0),64),s=!0);var e=null,t=r.util.createBuffer(),n=new Array(80),i={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){i.messageLength=0,i.fullMessageLength=i.messageLength64=[];for(var n=i.messageLengthSize/4,o=0;o<n;++o)i.fullMessageLength.push(0);return t=r.util.createBuffer(),e={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},i}};return i.start(),i.update=function(o,s){"utf8"===s&&(o=r.util.encodeUtf8(o));var l=o.length;i.messageLength+=l,l=[l/4294967296>>>0,l>>>0];for(var c=i.fullMessageLength.length-1;c>=0;--c)i.fullMessageLength[c]+=l[1],l[1]=l[0]+(i.fullMessageLength[c]/4294967296>>>0),i.fullMessageLength[c]=i.fullMessageLength[c]>>>0,l[0]=l[1]/4294967296>>>0;return t.putBytes(o),a(e,n,t),(t.read>2048||0===t.length())&&t.compact(),i},i.digest=function(){var s=r.util.createBuffer();s.putBytes(t.bytes());var l,c=i.fullMessageLength[i.fullMessageLength.length-1]+i.messageLengthSize&i.blockLength-1;s.putBytes(o.substr(0,i.blockLength-c));for(var u=8*i.fullMessageLength[0],h=0;h<i.fullMessageLength.length-1;++h)u+=(l=8*i.fullMessageLength[h+1])/4294967296>>>0,s.putInt32(u>>>0),u=l>>>0;s.putInt32(u);var d={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4};a(d,n,s);var f=r.util.createBuffer();return f.putInt32(d.h0),f.putInt32(d.h1),f.putInt32(d.h2),f.putInt32(d.h3),f.putInt32(d.h4),f},i};var o=null,s=!1;function a(e,t,n){for(var r,i,o,s,a,l,c,u=n.length();u>=64;){for(i=e.h0,o=e.h1,s=e.h2,a=e.h3,l=e.h4,c=0;c<16;++c)r=n.getInt32(),t[c]=r,r=(i<<5|i>>>27)+(a^o&(s^a))+l+1518500249+r,l=a,a=s,s=(o<<30|o>>>2)>>>0,o=i,i=r;for(;c<20;++c)r=(r=t[c-3]^t[c-8]^t[c-14]^t[c-16])<<1|r>>>31,t[c]=r,r=(i<<5|i>>>27)+(a^o&(s^a))+l+1518500249+r,l=a,a=s,s=(o<<30|o>>>2)>>>0,o=i,i=r;for(;c<32;++c)r=(r=t[c-3]^t[c-8]^t[c-14]^t[c-16])<<1|r>>>31,t[c]=r,r=(i<<5|i>>>27)+(o^s^a)+l+1859775393+r,l=a,a=s,s=(o<<30|o>>>2)>>>0,o=i,i=r;for(;c<40;++c)r=(r=t[c-6]^t[c-16]^t[c-28]^t[c-32])<<2|r>>>30,t[c]=r,r=(i<<5|i>>>27)+(o^s^a)+l+1859775393+r,l=a,a=s,s=(o<<30|o>>>2)>>>0,o=i,i=r;for(;c<60;++c)r=(r=t[c-6]^t[c-16]^t[c-28]^t[c-32])<<2|r>>>30,t[c]=r,r=(i<<5|i>>>27)+(o&s|a&(o^s))+l+2400959708+r,l=a,a=s,s=(o<<30|o>>>2)>>>0,o=i,i=r;for(;c<80;++c)r=(r=t[c-6]^t[c-16]^t[c-28]^t[c-32])<<2|r>>>30,t[c]=r,r=(i<<5|i>>>27)+(o^s^a)+l+3395469782+r,l=a,a=s,s=(o<<30|o>>>2)>>>0,o=i,i=r;e.h0=e.h0+i|0,e.h1=e.h1+o|0,e.h2=e.h2+s|0,e.h3=e.h3+a|0,e.h4=e.h4+l|0,u-=64}}},3899:(e,t,n)=>{var r=n(45);n(5693),n(3900);var i=e.exports=r.sha256=r.sha256||{};r.md.sha256=r.md.algorithms.sha256=i,i.create=function(){s||(o=String.fromCharCode(128),o+=r.util.fillString(String.fromCharCode(0),64),a=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],s=!0);var e=null,t=r.util.createBuffer(),n=new Array(64),i={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){i.messageLength=0,i.fullMessageLength=i.messageLength64=[];for(var n=i.messageLengthSize/4,o=0;o<n;++o)i.fullMessageLength.push(0);return t=r.util.createBuffer(),e={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},i}};return i.start(),i.update=function(o,s){"utf8"===s&&(o=r.util.encodeUtf8(o));var a=o.length;i.messageLength+=a,a=[a/4294967296>>>0,a>>>0];for(var c=i.fullMessageLength.length-1;c>=0;--c)i.fullMessageLength[c]+=a[1],a[1]=a[0]+(i.fullMessageLength[c]/4294967296>>>0),i.fullMessageLength[c]=i.fullMessageLength[c]>>>0,a[0]=a[1]/4294967296>>>0;return t.putBytes(o),l(e,n,t),(t.read>2048||0===t.length())&&t.compact(),i},i.digest=function(){var s=r.util.createBuffer();s.putBytes(t.bytes());var a,c=i.fullMessageLength[i.fullMessageLength.length-1]+i.messageLengthSize&i.blockLength-1;s.putBytes(o.substr(0,i.blockLength-c));for(var u=8*i.fullMessageLength[0],h=0;h<i.fullMessageLength.length-1;++h)u+=(a=8*i.fullMessageLength[h+1])/4294967296>>>0,s.putInt32(u>>>0),u=a>>>0;s.putInt32(u);var d={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4,h5:e.h5,h6:e.h6,h7:e.h7};l(d,n,s);var f=r.util.createBuffer();return f.putInt32(d.h0),f.putInt32(d.h1),f.putInt32(d.h2),f.putInt32(d.h3),f.putInt32(d.h4),f.putInt32(d.h5),f.putInt32(d.h6),f.putInt32(d.h7),f},i};var o=null,s=!1,a=null;function l(e,t,n){for(var r,i,o,s,l,c,u,h,d,f,p,g,y,v=n.length();v>=64;){for(l=0;l<16;++l)t[l]=n.getInt32();for(;l<64;++l)r=((r=t[l-2])>>>17|r<<15)^(r>>>19|r<<13)^r>>>10,i=((i=t[l-15])>>>7|i<<25)^(i>>>18|i<<14)^i>>>3,t[l]=r+t[l-7]+i+t[l-16]|0;for(c=e.h0,u=e.h1,h=e.h2,d=e.h3,f=e.h4,p=e.h5,g=e.h6,y=e.h7,l=0;l<64;++l)o=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),s=c&u|h&(c^u),r=y+((f>>>6|f<<26)^(f>>>11|f<<21)^(f>>>25|f<<7))+(g^f&(p^g))+a[l]+t[l],y=g,g=p,p=f,f=d+r>>>0,d=h,h=u,u=c,c=r+(i=o+s)>>>0;e.h0=e.h0+c|0,e.h1=e.h1+u|0,e.h2=e.h2+h|0,e.h3=e.h3+d|0,e.h4=e.h4+f|0,e.h5=e.h5+p|0,e.h6=e.h6+g|0,e.h7=e.h7+y|0,v-=64}}},8138:(e,t,n)=>{var r=n(45);n(5693),n(3900);var i=e.exports=r.sha512=r.sha512||{};r.md.sha512=r.md.algorithms.sha512=i;var o=r.sha384=r.sha512.sha384=r.sha512.sha384||{};o.create=function(){return i.create("SHA-384")},r.md.sha384=r.md.algorithms.sha384=o,r.sha512.sha256=r.sha512.sha256||{create:function(){return i.create("SHA-512/256")}},r.md["sha512/256"]=r.md.algorithms["sha512/256"]=r.sha512.sha256,r.sha512.sha224=r.sha512.sha224||{create:function(){return i.create("SHA-512/224")}},r.md["sha512/224"]=r.md.algorithms["sha512/224"]=r.sha512.sha224,i.create=function(e){if(a||(s=String.fromCharCode(128),s+=r.util.fillString(String.fromCharCode(0),128),l=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],(c={})["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],c["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],c["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],c["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],a=!0),"undefined"===typeof e&&(e="SHA-512"),!(e in c))throw new Error("Invalid SHA-512 algorithm: "+e);for(var t=c[e],n=null,i=r.util.createBuffer(),o=new Array(80),h=0;h<80;++h)o[h]=new Array(2);var d=64;switch(e){case"SHA-384":d=48;break;case"SHA-512/256":d=32;break;case"SHA-512/224":d=28}var f={algorithm:e.replace("-","").toLowerCase(),blockLength:128,digestLength:d,messageLength:0,fullMessageLength:null,messageLengthSize:16,start:function(){f.messageLength=0,f.fullMessageLength=f.messageLength128=[];for(var e=f.messageLengthSize/4,o=0;o<e;++o)f.fullMessageLength.push(0);i=r.util.createBuffer(),n=new Array(t.length);for(o=0;o<t.length;++o)n[o]=t[o].slice(0);return f}};return f.start(),f.update=function(e,t){"utf8"===t&&(e=r.util.encodeUtf8(e));var s=e.length;f.messageLength+=s,s=[s/4294967296>>>0,s>>>0];for(var a=f.fullMessageLength.length-1;a>=0;--a)f.fullMessageLength[a]+=s[1],s[1]=s[0]+(f.fullMessageLength[a]/4294967296>>>0),f.fullMessageLength[a]=f.fullMessageLength[a]>>>0,s[0]=s[1]/4294967296>>>0;return i.putBytes(e),u(n,o,i),(i.read>2048||0===i.length())&&i.compact(),f},f.digest=function(){var t=r.util.createBuffer();t.putBytes(i.bytes());var a,l=f.fullMessageLength[f.fullMessageLength.length-1]+f.messageLengthSize&f.blockLength-1;t.putBytes(s.substr(0,f.blockLength-l));for(var c=8*f.fullMessageLength[0],h=0;h<f.fullMessageLength.length-1;++h)c+=(a=8*f.fullMessageLength[h+1])/4294967296>>>0,t.putInt32(c>>>0),c=a>>>0;t.putInt32(c);var d=new Array(n.length);for(h=0;h<n.length;++h)d[h]=n[h].slice(0);u(d,o,t);var p,g=r.util.createBuffer();p="SHA-512"===e?d.length:"SHA-384"===e?d.length-2:d.length-4;for(h=0;h<p;++h)g.putInt32(d[h][0]),h===p-1&&"SHA-512/224"===e||g.putInt32(d[h][1]);return g},f};var s=null,a=!1,l=null,c=null;function u(e,t,n){for(var r,i,o,s,a,c,u,h,d,f,p,g,y,v,m,w,b,E,_,S,k,A,I,T,R,C,x,P,D,N,B,L,O,M=n.length();M>=128;){for(x=0;x<16;++x)t[x][0]=n.getInt32()>>>0,t[x][1]=n.getInt32()>>>0;for(;x<80;++x)r=(((P=(N=t[x-2])[0])>>>19|(D=N[1])<<13)^(D>>>29|P<<3)^P>>>6)>>>0,i=((P<<13|D>>>19)^(D<<3|P>>>29)^(P<<26|D>>>6))>>>0,o=(((P=(L=t[x-15])[0])>>>1|(D=L[1])<<31)^(P>>>8|D<<24)^P>>>7)>>>0,s=((P<<31|D>>>1)^(P<<24|D>>>8)^(P<<25|D>>>7))>>>0,B=t[x-7],O=t[x-16],D=i+B[1]+s+O[1],t[x][0]=r+B[0]+o+O[0]+(D/4294967296>>>0)>>>0,t[x][1]=D>>>0;for(p=e[0][0],g=e[0][1],y=e[1][0],v=e[1][1],m=e[2][0],w=e[2][1],b=e[3][0],E=e[3][1],_=e[4][0],S=e[4][1],k=e[5][0],A=e[5][1],I=e[6][0],T=e[6][1],R=e[7][0],C=e[7][1],x=0;x<80;++x)u=((_>>>14|S<<18)^(_>>>18|S<<14)^(S>>>9|_<<23))>>>0,h=(I^_&(k^I))>>>0,a=((p>>>28|g<<4)^(g>>>2|p<<30)^(g>>>7|p<<25))>>>0,c=((p<<4|g>>>28)^(g<<30|p>>>2)^(g<<25|p>>>7))>>>0,d=(p&y|m&(p^y))>>>0,f=(g&v|w&(g^v))>>>0,D=C+(((_<<18|S>>>14)^(_<<14|S>>>18)^(S<<23|_>>>9))>>>0)+((T^S&(A^T))>>>0)+l[x][1]+t[x][1],r=R+u+h+l[x][0]+t[x][0]+(D/4294967296>>>0)>>>0,i=D>>>0,o=a+d+((D=c+f)/4294967296>>>0)>>>0,s=D>>>0,R=I,C=T,I=k,T=A,k=_,A=S,_=b+r+((D=E+i)/4294967296>>>0)>>>0,S=D>>>0,b=m,E=w,m=y,w=v,y=p,v=g,p=r+o+((D=i+s)/4294967296>>>0)>>>0,g=D>>>0;D=e[0][1]+g,e[0][0]=e[0][0]+p+(D/4294967296>>>0)>>>0,e[0][1]=D>>>0,D=e[1][1]+v,e[1][0]=e[1][0]+y+(D/4294967296>>>0)>>>0,e[1][1]=D>>>0,D=e[2][1]+w,e[2][0]=e[2][0]+m+(D/4294967296>>>0)>>>0,e[2][1]=D>>>0,D=e[3][1]+E,e[3][0]=e[3][0]+b+(D/4294967296>>>0)>>>0,e[3][1]=D>>>0,D=e[4][1]+S,e[4][0]=e[4][0]+_+(D/4294967296>>>0)>>>0,e[4][1]=D>>>0,D=e[5][1]+A,e[5][0]=e[5][0]+k+(D/4294967296>>>0)>>>0,e[5][1]=D>>>0,D=e[6][1]+T,e[6][0]=e[6][0]+I+(D/4294967296>>>0)>>>0,e[6][1]=D>>>0,D=e[7][1]+C,e[7][0]=e[7][0]+R+(D/4294967296>>>0)>>>0,e[7][1]=D>>>0,M-=128}}},3900:(e,t,n)=>{var r=n(45),i=n(6407),o=e.exports=r.util=r.util||{};function s(e){if(8!==e&&16!==e&&24!==e&&32!==e)throw new Error("Only 8, 16, 24, or 32 bits supported: "+e)}function a(e){if(this.data="",this.read=0,"string"===typeof e)this.data=e;else if(o.isArrayBuffer(e)||o.isArrayBufferView(e))if("undefined"!==typeof Buffer&&e instanceof Buffer)this.data=e.toString("binary");else{var t=new Uint8Array(e);try{this.data=String.fromCharCode.apply(null,t)}catch(r){for(var n=0;n<t.length;++n)this.putByte(t[n])}}else(e instanceof a||"object"===typeof e&&"string"===typeof e.data&&"number"===typeof e.read)&&(this.data=e.data,this.read=e.read);this._constructedStringLength=0}!function(){if("undefined"!==typeof process&&process.nextTick&&!process.browser)return o.nextTick=process.nextTick,void("function"===typeof setImmediate?o.setImmediate=setImmediate:o.setImmediate=o.nextTick);if("function"===typeof setImmediate)return o.setImmediate=function(){return setImmediate.apply(void 0,arguments)},void(o.nextTick=function(e){return setImmediate(e)});if(o.setImmediate=function(e){setTimeout(e,0)},"undefined"!==typeof window&&"function"===typeof window.postMessage){var e="forge.setImmediate",t=[];o.setImmediate=function(n){t.push(n),1===t.length&&window.postMessage(e,"*")},window.addEventListener("message",(function(n){if(n.source===window&&n.data===e){n.stopPropagation();var r=t.slice();t.length=0,r.forEach((function(e){e()}))}}),!0)}if("undefined"!==typeof MutationObserver){var n=Date.now(),r=!0,i=document.createElement("div");t=[];new MutationObserver((function(){var e=t.slice();t.length=0,e.forEach((function(e){e()}))})).observe(i,{attributes:!0});var s=o.setImmediate;o.setImmediate=function(e){Date.now()-n>15?(n=Date.now(),s(e)):(t.push(e),1===t.length&&i.setAttribute("a",r=!r))}}o.nextTick=o.setImmediate}(),o.isNodejs="undefined"!==typeof process&&process.versions&&process.versions.node,o.globalScope=o.isNodejs?n.g:"undefined"===typeof self?window:self,o.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},o.isArrayBuffer=function(e){return"undefined"!==typeof ArrayBuffer&&e instanceof ArrayBuffer},o.isArrayBufferView=function(e){return e&&o.isArrayBuffer(e.buffer)&&void 0!==e.byteLength},o.ByteBuffer=a,o.ByteStringBuffer=a;o.ByteStringBuffer.prototype._optimizeConstructedString=function(e){this._constructedStringLength+=e,this._constructedStringLength>4096&&(this.data.substr(0,1),this._constructedStringLength=0)},o.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read},o.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0},o.ByteStringBuffer.prototype.putByte=function(e){return this.putBytes(String.fromCharCode(e))},o.ByteStringBuffer.prototype.fillWithByte=function(e,t){e=String.fromCharCode(e);for(var n=this.data;t>0;)1&t&&(n+=e),(t>>>=1)>0&&(e+=e);return this.data=n,this._optimizeConstructedString(t),this},o.ByteStringBuffer.prototype.putBytes=function(e){return this.data+=e,this._optimizeConstructedString(e.length),this},o.ByteStringBuffer.prototype.putString=function(e){return this.putBytes(o.encodeUtf8(e))},o.ByteStringBuffer.prototype.putInt16=function(e){return this.putBytes(String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},o.ByteStringBuffer.prototype.putInt24=function(e){return this.putBytes(String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},o.ByteStringBuffer.prototype.putInt32=function(e){return this.putBytes(String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},o.ByteStringBuffer.prototype.putInt16Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255))},o.ByteStringBuffer.prototype.putInt24Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255))},o.ByteStringBuffer.prototype.putInt32Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>24&255))},o.ByteStringBuffer.prototype.putInt=function(e,t){s(t);var n="";do{t-=8,n+=String.fromCharCode(e>>t&255)}while(t>0);return this.putBytes(n)},o.ByteStringBuffer.prototype.putSignedInt=function(e,t){return e<0&&(e+=2<<t-1),this.putInt(e,t)},o.ByteStringBuffer.prototype.putBuffer=function(e){return this.putBytes(e.getBytes())},o.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},o.ByteStringBuffer.prototype.getInt16=function(){var e=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,e},o.ByteStringBuffer.prototype.getInt24=function(){var e=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,e},o.ByteStringBuffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},o.ByteStringBuffer.prototype.getInt16Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,e},o.ByteStringBuffer.prototype.getInt24Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,e},o.ByteStringBuffer.prototype.getInt32Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,e},o.ByteStringBuffer.prototype.getInt=function(e){s(e);var t=0;do{t=(t<<8)+this.data.charCodeAt(this.read++),e-=8}while(e>0);return t},o.ByteStringBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),n=2<<e-2;return t>=n&&(t-=n<<1),t},o.ByteStringBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},o.ByteStringBuffer.prototype.bytes=function(e){return"undefined"===typeof e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},o.ByteStringBuffer.prototype.at=function(e){return this.data.charCodeAt(this.read+e)},o.ByteStringBuffer.prototype.setAt=function(e,t){return this.data=this.data.substr(0,this.read+e)+String.fromCharCode(t)+this.data.substr(this.read+e+1),this},o.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},o.ByteStringBuffer.prototype.copy=function(){var e=o.createBuffer(this.data);return e.read=this.read,e},o.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this},o.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this},o.ByteStringBuffer.prototype.truncate=function(e){var t=Math.max(0,this.length()-e);return this.data=this.data.substr(this.read,t),this.read=0,this},o.ByteStringBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.length;++t){var n=this.data.charCodeAt(t);n<16&&(e+="0"),e+=n.toString(16)}return e},o.ByteStringBuffer.prototype.toString=function(){return o.decodeUtf8(this.bytes())},o.DataBuffer=function(e,t){t=t||{},this.read=t.readOffset||0,this.growSize=t.growSize||1024;var n=o.isArrayBuffer(e),r=o.isArrayBufferView(e);if(n||r)return this.data=n?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),void(this.write="writeOffset"in t?t.writeOffset:this.data.byteLength);this.data=new DataView(new ArrayBuffer(0)),this.write=0,null!==e&&void 0!==e&&this.putBytes(e),"writeOffset"in t&&(this.write=t.writeOffset)},o.DataBuffer.prototype.length=function(){return this.write-this.read},o.DataBuffer.prototype.isEmpty=function(){return this.length()<=0},o.DataBuffer.prototype.accommodate=function(e,t){if(this.length()>=e)return this;t=Math.max(t||this.growSize,e);var n=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),r=new Uint8Array(this.length()+t);return r.set(n),this.data=new DataView(r.buffer),this},o.DataBuffer.prototype.putByte=function(e){return this.accommodate(1),this.data.setUint8(this.write++,e),this},o.DataBuffer.prototype.fillWithByte=function(e,t){this.accommodate(t);for(var n=0;n<t;++n)this.data.setUint8(e);return this},o.DataBuffer.prototype.putBytes=function(e,t){if(o.isArrayBufferView(e)){var n=(r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)).byteLength-r.byteOffset;return this.accommodate(n),new Uint8Array(this.data.buffer,this.write).set(r),this.write+=n,this}if(o.isArrayBuffer(e)){var r=new Uint8Array(e);return this.accommodate(r.byteLength),new Uint8Array(this.data.buffer).set(r,this.write),this.write+=r.byteLength,this}if(e instanceof o.DataBuffer||"object"===typeof e&&"number"===typeof e.read&&"number"===typeof e.write&&o.isArrayBufferView(e.data)){r=new Uint8Array(e.data.byteLength,e.read,e.length());return this.accommodate(r.byteLength),new Uint8Array(e.data.byteLength,this.write).set(r),this.write+=r.byteLength,this}if(e instanceof o.ByteStringBuffer&&(e=e.data,t="binary"),t=t||"binary","string"===typeof e){var i;if("hex"===t)return this.accommodate(Math.ceil(e.length/2)),i=new Uint8Array(this.data.buffer,this.write),this.write+=o.binary.hex.decode(e,i,this.write),this;if("base64"===t)return this.accommodate(3*Math.ceil(e.length/4)),i=new Uint8Array(this.data.buffer,this.write),this.write+=o.binary.base64.decode(e,i,this.write),this;if("utf8"===t&&(e=o.encodeUtf8(e),t="binary"),"binary"===t||"raw"===t)return this.accommodate(e.length),i=new Uint8Array(this.data.buffer,this.write),this.write+=o.binary.raw.decode(i),this;if("utf16"===t)return this.accommodate(2*e.length),i=new Uint16Array(this.data.buffer,this.write),this.write+=o.text.utf16.encode(i),this;throw new Error("Invalid encoding: "+t)}throw Error("Invalid parameter: "+e)},o.DataBuffer.prototype.putBuffer=function(e){return this.putBytes(e),e.clear(),this},o.DataBuffer.prototype.putString=function(e){return this.putBytes(e,"utf16")},o.DataBuffer.prototype.putInt16=function(e){return this.accommodate(2),this.data.setInt16(this.write,e),this.write+=2,this},o.DataBuffer.prototype.putInt24=function(e){return this.accommodate(3),this.data.setInt16(this.write,e>>8&65535),this.data.setInt8(this.write,e>>16&255),this.write+=3,this},o.DataBuffer.prototype.putInt32=function(e){return this.accommodate(4),this.data.setInt32(this.write,e),this.write+=4,this},o.DataBuffer.prototype.putInt16Le=function(e){return this.accommodate(2),this.data.setInt16(this.write,e,!0),this.write+=2,this},o.DataBuffer.prototype.putInt24Le=function(e){return this.accommodate(3),this.data.setInt8(this.write,e>>16&255),this.data.setInt16(this.write,e>>8&65535,!0),this.write+=3,this},o.DataBuffer.prototype.putInt32Le=function(e){return this.accommodate(4),this.data.setInt32(this.write,e,!0),this.write+=4,this},o.DataBuffer.prototype.putInt=function(e,t){s(t),this.accommodate(t/8);do{t-=8,this.data.setInt8(this.write++,e>>t&255)}while(t>0);return this},o.DataBuffer.prototype.putSignedInt=function(e,t){return s(t),this.accommodate(t/8),e<0&&(e+=2<<t-1),this.putInt(e,t)},o.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)},o.DataBuffer.prototype.getInt16=function(){var e=this.data.getInt16(this.read);return this.read+=2,e},o.DataBuffer.prototype.getInt24=function(){var e=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,e},o.DataBuffer.prototype.getInt32=function(){var e=this.data.getInt32(this.read);return this.read+=4,e},o.DataBuffer.prototype.getInt16Le=function(){var e=this.data.getInt16(this.read,!0);return this.read+=2,e},o.DataBuffer.prototype.getInt24Le=function(){var e=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,e},o.DataBuffer.prototype.getInt32Le=function(){var e=this.data.getInt32(this.read,!0);return this.read+=4,e},o.DataBuffer.prototype.getInt=function(e){s(e);var t=0;do{t=(t<<8)+this.data.getInt8(this.read++),e-=8}while(e>0);return t},o.DataBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),n=2<<e-2;return t>=n&&(t-=n<<1),t},o.DataBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},o.DataBuffer.prototype.bytes=function(e){return"undefined"===typeof e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},o.DataBuffer.prototype.at=function(e){return this.data.getUint8(this.read+e)},o.DataBuffer.prototype.setAt=function(e,t){return this.data.setUint8(e,t),this},o.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)},o.DataBuffer.prototype.copy=function(){return new o.DataBuffer(this)},o.DataBuffer.prototype.compact=function(){if(this.read>0){var e=new Uint8Array(this.data.buffer,this.read),t=new Uint8Array(e.byteLength);t.set(e),this.data=new DataView(t),this.write-=this.read,this.read=0}return this},o.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this},o.DataBuffer.prototype.truncate=function(e){return this.write=Math.max(0,this.length()-e),this.read=Math.min(this.read,this.write),this},o.DataBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.byteLength;++t){var n=this.data.getUint8(t);n<16&&(e+="0"),e+=n.toString(16)}return e},o.DataBuffer.prototype.toString=function(e){var t=new Uint8Array(this.data,this.read,this.length());if("binary"===(e=e||"utf8")||"raw"===e)return o.binary.raw.encode(t);if("hex"===e)return o.binary.hex.encode(t);if("base64"===e)return o.binary.base64.encode(t);if("utf8"===e)return o.text.utf8.decode(t);if("utf16"===e)return o.text.utf16.decode(t);throw new Error("Invalid encoding: "+e)},o.createBuffer=function(e,t){return t=t||"raw",void 0!==e&&"utf8"===t&&(e=o.encodeUtf8(e)),new o.ByteBuffer(e)},o.fillString=function(e,t){for(var n="";t>0;)1&t&&(n+=e),(t>>>=1)>0&&(e+=e);return n},o.xorBytes=function(e,t,n){for(var r="",i="",o="",s=0,a=0;n>0;--n,++s)i=e.charCodeAt(s)^t.charCodeAt(s),a>=10&&(r+=o,o="",a=0),o+=String.fromCharCode(i),++a;return r+=o},o.hexToBytes=function(e){var t="",n=0;for(!0&e.length&&(n=1,t+=String.fromCharCode(parseInt(e[0],16)));n<e.length;n+=2)t+=String.fromCharCode(parseInt(e.substr(n,2),16));return t},o.bytesToHex=function(e){return o.createBuffer(e).toHex()},o.int32ToBytes=function(e){return String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e)};var l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],u="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";o.encode64=function(e,t){for(var n,r,i,o="",s="",a=0;a<e.length;)n=e.charCodeAt(a++),r=e.charCodeAt(a++),i=e.charCodeAt(a++),o+=l.charAt(n>>2),o+=l.charAt((3&n)<<4|r>>4),isNaN(r)?o+="==":(o+=l.charAt((15&r)<<2|i>>6),o+=isNaN(i)?"=":l.charAt(63&i)),t&&o.length>t&&(s+=o.substr(0,t)+"\r\n",o=o.substr(t));return s+=o},o.decode64=function(e){e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var t,n,r,i,o="",s=0;s<e.length;)t=c[e.charCodeAt(s++)-43],n=c[e.charCodeAt(s++)-43],r=c[e.charCodeAt(s++)-43],i=c[e.charCodeAt(s++)-43],o+=String.fromCharCode(t<<2|n>>4),64!==r&&(o+=String.fromCharCode((15&n)<<4|r>>2),64!==i&&(o+=String.fromCharCode((3&r)<<6|i)));return o},o.encodeUtf8=function(e){return unescape(encodeURIComponent(e))},o.decodeUtf8=function(e){return decodeURIComponent(escape(e))},o.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:i.encode,decode:i.decode}},o.binary.raw.encode=function(e){return String.fromCharCode.apply(null,e)},o.binary.raw.decode=function(e,t,n){var r=t;r||(r=new Uint8Array(e.length));for(var i=n=n||0,o=0;o<e.length;++o)r[i++]=e.charCodeAt(o);return t?i-n:r},o.binary.hex.encode=o.bytesToHex,o.binary.hex.decode=function(e,t,n){var r=t;r||(r=new Uint8Array(Math.ceil(e.length/2)));var i=0,o=n=n||0;for(1&e.length&&(i=1,r[o++]=parseInt(e[0],16));i<e.length;i+=2)r[o++]=parseInt(e.substr(i,2),16);return t?o-n:r},o.binary.base64.encode=function(e,t){for(var n,r,i,o="",s="",a=0;a<e.byteLength;)n=e[a++],r=e[a++],i=e[a++],o+=l.charAt(n>>2),o+=l.charAt((3&n)<<4|r>>4),isNaN(r)?o+="==":(o+=l.charAt((15&r)<<2|i>>6),o+=isNaN(i)?"=":l.charAt(63&i)),t&&o.length>t&&(s+=o.substr(0,t)+"\r\n",o=o.substr(t));return s+=o},o.binary.base64.decode=function(e,t,n){var r,i,o,s,a=t;a||(a=new Uint8Array(3*Math.ceil(e.length/4))),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");for(var l=0,u=n=n||0;l<e.length;)r=c[e.charCodeAt(l++)-43],i=c[e.charCodeAt(l++)-43],o=c[e.charCodeAt(l++)-43],s=c[e.charCodeAt(l++)-43],a[u++]=r<<2|i>>4,64!==o&&(a[u++]=(15&i)<<4|o>>2,64!==s&&(a[u++]=(3&o)<<6|s));return t?u-n:a.subarray(0,u)},o.binary.base58.encode=function(e,t){return o.binary.baseN.encode(e,u,t)},o.binary.base58.decode=function(e,t){return o.binary.baseN.decode(e,u,t)},o.text={utf8:{},utf16:{}},o.text.utf8.encode=function(e,t,n){e=o.encodeUtf8(e);var r=t;r||(r=new Uint8Array(e.length));for(var i=n=n||0,s=0;s<e.length;++s)r[i++]=e.charCodeAt(s);return t?i-n:r},o.text.utf8.decode=function(e){return o.decodeUtf8(String.fromCharCode.apply(null,e))},o.text.utf16.encode=function(e,t,n){var r=t;r||(r=new Uint8Array(2*e.length));for(var i=new Uint16Array(r.buffer),o=n=n||0,s=n,a=0;a<e.length;++a)i[s++]=e.charCodeAt(a),o+=2;return t?o-n:r},o.text.utf16.decode=function(e){return String.fromCharCode.apply(null,new Uint16Array(e.buffer))},o.deflate=function(e,t,n){if(t=o.decode64(e.deflate(o.encode64(t)).rval),n){var r=2;32&t.charCodeAt(1)&&(r=6),t=t.substring(r,t.length-4)}return t},o.inflate=function(e,t,n){var r=e.inflate(o.encode64(t)).rval;return null===r?null:o.decode64(r)};var h=function(e,t,n){if(!e)throw new Error("WebStorage not available.");var r;if(null===n?r=e.removeItem(t):(n=o.encode64(JSON.stringify(n)),r=e.setItem(t,n)),"undefined"!==typeof r&&!0!==r.rval){var i=new Error(r.error.message);throw i.id=r.error.id,i.name=r.error.name,i}},d=function(e,t){if(!e)throw new Error("WebStorage not available.");var n=e.getItem(t);if(e.init)if(null===n.rval){if(n.error){var r=new Error(n.error.message);throw r.id=n.error.id,r.name=n.error.name,r}n=null}else n=n.rval;return null!==n&&(n=JSON.parse(o.decode64(n))),n},f=function(e,t,n,r){var i=d(e,t);null===i&&(i={}),i[n]=r,h(e,t,i)},p=function(e,t,n){var r=d(e,t);return null!==r&&(r=n in r?r[n]:null),r},g=function(e,t,n){var r=d(e,t);if(null!==r&&n in r){delete r[n];var i=!0;for(var o in r){i=!1;break}i&&(r=null),h(e,t,r)}},y=function(e,t){h(e,t,null)},v=function(e,t,n){var r,i=null;"undefined"===typeof n&&(n=["web","flash"]);var o=!1,s=null;for(var a in n){r=n[a];try{if("flash"===r||"both"===r){if(null===t[0])throw new Error("Flash local storage not available.");i=e.apply(this,t),o="flash"===r}"web"!==r&&"both"!==r||(t[0]=localStorage,i=e.apply(this,t),o=!0)}catch(l){s=l}if(o)break}if(!o)throw s;return i};o.setItem=function(e,t,n,r,i){v(f,arguments,i)},o.getItem=function(e,t,n,r){return v(p,arguments,r)},o.removeItem=function(e,t,n,r){v(g,arguments,r)},o.clearItems=function(e,t,n){v(y,arguments,n)},o.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},o.format=function(e){for(var t,n,r=/%./g,i=0,o=[],s=0;t=r.exec(e);){(n=e.substring(s,r.lastIndex-2)).length>0&&o.push(n),s=r.lastIndex;var a=t[0][1];switch(a){case"s":case"o":i<arguments.length?o.push(arguments[1+i++]):o.push("<?>");break;case"%":o.push("%");break;default:o.push("<%"+a+"?>")}}return o.push(e.substring(s)),o.join("")},o.formatNumber=function(e,t,n,r){var i=e,o=isNaN(t=Math.abs(t))?2:t,s=void 0===n?",":n,a=void 0===r?".":r,l=i<0?"-":"",c=parseInt(i=Math.abs(+i||0).toFixed(o),10)+"",u=c.length>3?c.length%3:0;return l+(u?c.substr(0,u)+a:"")+c.substr(u).replace(/(\d{3})(?=\d)/g,"$1"+a)+(o?s+Math.abs(i-c).toFixed(o).slice(2):"")},o.formatSize=function(e){return e=e>=1073741824?o.formatNumber(e/1073741824,2,".","")+" GiB":e>=1048576?o.formatNumber(e/1048576,2,".","")+" MiB":e>=1024?o.formatNumber(e/1024,0)+" KiB":o.formatNumber(e,0)+" bytes"},o.bytesFromIP=function(e){return-1!==e.indexOf(".")?o.bytesFromIPv4(e):-1!==e.indexOf(":")?o.bytesFromIPv6(e):null},o.bytesFromIPv4=function(e){if(4!==(e=e.split(".")).length)return null;for(var t=o.createBuffer(),n=0;n<e.length;++n){var r=parseInt(e[n],10);if(isNaN(r))return null;t.putByte(r)}return t.getBytes()},o.bytesFromIPv6=function(e){for(var t=0,n=2*(8-(e=e.split(":").filter((function(e){return 0===e.length&&++t,!0}))).length+t),r=o.createBuffer(),i=0;i<8;++i)if(e[i]&&0!==e[i].length){var s=o.hexToBytes(e[i]);s.length<2&&r.putByte(0),r.putBytes(s)}else r.fillWithByte(0,n),n=0;return r.getBytes()},o.bytesToIP=function(e){return 4===e.length?o.bytesToIPv4(e):16===e.length?o.bytesToIPv6(e):null},o.bytesToIPv4=function(e){if(4!==e.length)return null;for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t.join(".")},o.bytesToIPv6=function(e){if(16!==e.length)return null;for(var t=[],n=[],r=0,i=0;i<e.length;i+=2){for(var s=o.bytesToHex(e[i]+e[i+1]);"0"===s[0]&&"0"!==s;)s=s.substr(1);if("0"===s){var a=n[n.length-1],l=t.length;a&&l===a.end+1?(a.end=l,a.end-a.start>n[r].end-n[r].start&&(r=n.length-1)):n.push({start:l,end:l})}t.push(s)}if(n.length>0){var c=n[r];c.end-c.start>0&&(t.splice(c.start,c.end-c.start+1,""),0===c.start&&t.unshift(""),7===c.end&&t.push(""))}return t.join(":")},o.estimateCores=function(e,t){if("function"===typeof e&&(t=e,e={}),e=e||{},"cores"in o&&!e.update)return t(null,o.cores);if("undefined"!==typeof navigator&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return o.cores=navigator.hardwareConcurrency,t(null,o.cores);if("undefined"===typeof Worker)return o.cores=1,t(null,o.cores);if("undefined"===typeof Blob)return o.cores=2,t(null,o.cores);var n=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",(function(e){for(var t=Date.now(),n=t+4;Date.now()<n;);self.postMessage({st:t,et:n})}))}.toString(),")()"],{type:"application/javascript"}));!function e(r,i,s){if(0===i){var a=Math.floor(r.reduce((function(e,t){return e+t}),0)/r.length);return o.cores=Math.max(1,a),URL.revokeObjectURL(n),t(null,o.cores)}!function(e,t){for(var r=[],i=[],o=0;o<e;++o){var s=new Worker(n);s.addEventListener("message",(function(n){if(i.push(n.data),i.length===e){for(var o=0;o<e;++o)r[o].terminate();t(null,i)}})),r.push(s)}for(o=0;o<e;++o)r[o].postMessage(o)}(s,(function(t,n){r.push(function(e,t){for(var n=[],r=0;r<e;++r)for(var i=t[r],o=n[r]=[],s=0;s<e;++s)if(r!==s){var a=t[s];(i.st>a.st&&i.st<a.et||a.st>i.st&&a.st<i.et)&&o.push(s)}return n.reduce((function(e,t){return Math.max(e,t.length)}),0)}(s,n)),e(r,i-1,s)}))}([],5,16)}},8275:(e,t)=>{"use strict";class n{static isArrayBuffer(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const r=n.toUint8Array(e),i=n.toUint8Array(t);if(r.length!==i.byteLength)return!1;for(let n=0;n<r.length;n++)if(r[n]!==i[n])return!1;return!0}static concat(){let e;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];e=!Array.isArray(n[0])||n[1]instanceof Function?Array.isArray(n[0])&&n[1]instanceof Function?n[0]:n[n.length-1]instanceof Function?n.slice(0,n.length-1):n:n[0];let i=0;for(const a of e)i+=a.byteLength;const o=new Uint8Array(i);let s=0;for(const a of e){const e=this.toUint8Array(a);o.set(e,s),s+=e.length}return n[n.length-1]instanceof Function?this.toView(o,n[n.length-1]):o.buffer}}const r="string",i=/^[0-9a-f]+$/i,o=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,s=/^[a-zA-Z0-9-_]+$/;class a{static fromString(e){const t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n.buffer}static toString(e){const t=n.toUint8Array(e);let r="";for(let n=0;n<t.length;n++)r+=String.fromCharCode(t[n]);return decodeURIComponent(escape(r))}}class l{static toString(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=n.toArrayBuffer(e),i=new DataView(r);let o="";for(let n=0;n<r.byteLength;n+=2){const e=i.getUint16(n,t);o+=String.fromCharCode(e)}return o}static fromString(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=new ArrayBuffer(2*e.length),r=new DataView(n);for(let i=0;i<e.length;i++)r.setUint16(2*i,e.charCodeAt(i),t);return n}}class c{static isHex(e){return typeof e===r&&i.test(e)}static isBase64(e){return typeof e===r&&o.test(e)}static isBase64Url(e){return typeof e===r&&s.test(e)}static ToString(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";const r=n.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(r);case"binary":return this.ToBinary(r);case"hex":return this.ToHex(r);case"base64":return this.ToBase64(r);case"base64url":return this.ToBase64Url(r);case"utf16le":return l.toString(r,!0);case"utf16":case"utf16be":return l.toString(r);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}static FromString(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return l.fromString(e,!0);case"utf16":case"utf16be":return l.fromString(e);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}static ToBase64(e){const t=n.toUint8Array(e);if("undefined"!==typeof btoa){const e=this.ToString(t,"binary");return btoa(e)}return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!c.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return"undefined"!==typeof atob?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!c.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.DEFAULT_UTF8_ENCODING;switch(t){case"ascii":return this.FromBinary(e);case"utf8":return a.fromString(e);case"utf16":case"utf16be":return l.fromString(e);case"utf16le":case"usc2":return l.fromString(e,!0);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}static ToUtf8String(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:c.DEFAULT_UTF8_ENCODING;switch(t){case"ascii":return this.ToBinary(e);case"utf8":return a.toString(e);case"utf16":case"utf16be":return l.toString(e);case"utf16le":case"usc2":return l.toString(e,!0);default:throw new Error("Unknown type of encoding '".concat(t,"'"))}}static FromBinary(e){const t=e.length,n=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);return n.buffer}static ToBinary(e){const t=n.toUint8Array(e);let r="";for(let n=0;n<t.length;n++)r+=String.fromCharCode(t[n]);return r}static ToHex(e){const t=n.toUint8Array(e);let r="";const i=t.length;for(let n=0;n<i;n++){const e=t[n];e<16&&(r+="0"),r+=e.toString(16)}return r}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!c.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t="0".concat(t));const n=new Uint8Array(t.length/2);for(let r=0;r<t.length;r+=2){const e=t.slice(r,r+2);n[r/2]=parseInt(e,16)}return n.buffer}static ToUtf16String(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return l.toString(e,t)}static FromUtf16String(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return l.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let n=0;n<t;n++)e+="=";return e}static formatString(e){return(null===e||void 0===e?void 0:e.replace(/[\n\r\t ]/g,""))||""}}c.DEFAULT_UTF8_ENCODING="utf8",t._H=n,t.U$=c},4275:(e,t,n)=>{let r;e.exports="function"===typeof queueMicrotask?queueMicrotask.bind("undefined"!==typeof window?window:n.g):e=>(r||(r=Promise.resolve())).then(e).catch((e=>setTimeout((()=>{throw e}),0)))},2730:(e,t,n)=>{"use strict";var r=n(5043),i=n(8853);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,a={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(a[e]=t,e=0;e<t.length;e++)s.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,d=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,f={},p={};function g(e,t,n,r,i,o,s){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=s}var y={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){y[e]=new g(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];y[t]=new g(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){y[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){y[e]=new g(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){y[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){y[e]=new g(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){y[e]=new g(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){y[e]=new g(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){y[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)}));var v=/[\-:]([a-z])/g;function m(e){return e[1].toUpperCase()}function w(e,t,n,r){var i=y.hasOwnProperty(t)?y[t]:null;(null!==i?0!==i.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!h.call(p,e)||!h.call(f,e)&&(d.test(e)?p[e]=!0:(f[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(v,m);y[t]=new g(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(v,m);y[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(v,m);y[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){y[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)})),y.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){y[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)}));var b=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,E=Symbol.for("react.element"),_=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),A=Symbol.for("react.profiler"),I=Symbol.for("react.provider"),T=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),x=Symbol.for("react.suspense_list"),P=Symbol.for("react.memo"),D=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var N=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var B=Symbol.iterator;function L(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=B&&e[B]||e["@@iterator"])?e:null}var O,M=Object.assign;function U(e){if(void 0===O)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);O=t&&t[1]||""}return"\n"+O+e}var F=!1;function V(e,t){if(!e||F)return"";F=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var i=c.stack.split("\n"),o=r.stack.split("\n"),s=i.length-1,a=o.length-1;1<=s&&0<=a&&i[s]!==o[a];)a--;for(;1<=s&&0<=a;s--,a--)if(i[s]!==o[a]){if(1!==s||1!==a)do{if(s--,0>--a||i[s]!==o[a]){var l="\n"+i[s].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=s&&0<=a);break}}}finally{F=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?U(e):""}function z(e){switch(e.tag){case 5:return U(e.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return e=V(e.type,!1);case 11:return e=V(e.type.render,!1);case 1:return e=V(e.type,!0);default:return""}}function K(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case _:return"Portal";case A:return"Profiler";case k:return"StrictMode";case C:return"Suspense";case x:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case T:return(e.displayName||"Context")+".Consumer";case I:return(e._context.displayName||"Context")+".Provider";case R:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case P:return null!==(t=e.displayName||null)?t:K(e.type)||"Memo";case D:t=e._payload,e=e._init;try{return K(e(t))}catch(n){}}return null}function j(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return K(t);case 8:return t===k?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function q(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function W(e){e._valueTracker||(e._valueTracker=function(e){var t=q(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,o=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function G(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=q(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Y(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Q(e,t){var n=t.checked;return M({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function X(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=H(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function J(e,t){null!=(t=t.checked)&&w(e,"checked",t,!1)}function $(e,t){J(e,t);var n=H(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Z(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&Y(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+H(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return M({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(te(n)){if(1<n.length)throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:H(n)}}function oe(e,t){var n=H(t.value),r=H(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function se(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function ae(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?ae(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,he=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ue(e,t)}))}:ue);function de(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var fe={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function ge(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||fe.hasOwnProperty(e)&&fe[e]?(""+t).trim():t+"px"}function ye(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=ge(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(fe).forEach((function(e){pe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),fe[t]=fe[e]}))}));var ve=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function me(e,t){if(t){if(ve[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function we(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var be=null;function Ee(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var _e=null,Se=null,ke=null;function Ae(e){if(e=wi(e)){if("function"!==typeof _e)throw Error(o(280));var t=e.stateNode;t&&(t=Ei(t),_e(e.stateNode,e.type,t))}}function Ie(e){Se?ke?ke.push(e):ke=[e]:Se=e}function Te(){if(Se){var e=Se,t=ke;if(ke=Se=null,Ae(e),t)for(e=0;e<t.length;e++)Ae(t[e])}}function Re(e,t){return e(t)}function Ce(){}var xe=!1;function Pe(e,t,n){if(xe)return e(t,n);xe=!0;try{return Re(e,t,n)}finally{xe=!1,(null!==Se||null!==ke)&&(Ce(),Te())}}function De(e,t){var n=e.stateNode;if(null===n)return null;var r=Ei(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var Ne=!1;if(u)try{var Be={};Object.defineProperty(Be,"passive",{get:function(){Ne=!0}}),window.addEventListener("test",Be,Be),window.removeEventListener("test",Be,Be)}catch(ue){Ne=!1}function Le(e,t,n,r,i,o,s,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(u){this.onError(u)}}var Oe=!1,Me=null,Ue=!1,Fe=null,Ve={onError:function(e){Oe=!0,Me=e}};function ze(e,t,n,r,i,o,s,a,l){Oe=!1,Me=null,Le.apply(Ve,arguments)}function Ke(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function je(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(Ke(e)!==e)throw Error(o(188))}function qe(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ke(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var s=i.alternate;if(null===s){if(null!==(r=i.return)){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return He(i),e;if(s===r)return He(i),t;s=s.sibling}throw Error(o(188))}if(n.return!==r.return)n=i,r=s;else{for(var a=!1,l=i.child;l;){if(l===n){a=!0,n=i,r=s;break}if(l===r){a=!0,r=i,n=s;break}l=l.sibling}if(!a){for(l=s.child;l;){if(l===n){a=!0,n=s,r=i;break}if(l===r){a=!0,r=s,n=i;break}l=l.sibling}if(!a)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e))?We(e):null}function We(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=We(e);if(null!==t)return t;e=e.sibling}return null}var Ge=i.unstable_scheduleCallback,Ye=i.unstable_cancelCallback,Qe=i.unstable_shouldYield,Xe=i.unstable_requestPaint,Je=i.unstable_now,$e=i.unstable_getCurrentPriorityLevel,Ze=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,nt=i.unstable_LowPriority,rt=i.unstable_IdlePriority,it=null,ot=null;var st=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(at(e)/lt|0)|0},at=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function dt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,i=e.suspendedLanes,o=e.pingedLanes,s=268435455&n;if(0!==s){var a=s&~i;0!==a?r=ht(a):0!==(o&=s)&&(r=ht(o))}else 0!==(s=n&~i)?r=ht(s):0!==o&&(r=ht(o));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&i)&&((i=r&-r)>=(o=t&-t)||16===i&&0!==(4194240&o)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-st(t)),r|=e[n],t&=~i;return r}function ft(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function gt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function yt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function vt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-st(t)]=n}function mt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-st(n),i=1<<r;i&t|e[r]&t&&(e[r]|=t),n&=~i}}var wt=0;function bt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var Et,_t,St,kt,At,It=!1,Tt=[],Rt=null,Ct=null,xt=null,Pt=new Map,Dt=new Map,Nt=[],Bt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":Rt=null;break;case"dragenter":case"dragleave":Ct=null;break;case"mouseover":case"mouseout":xt=null;break;case"pointerover":case"pointerout":Pt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Dt.delete(t.pointerId)}}function Ot(e,t,n,r,i,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},null!==t&&(null!==(t=wi(t))&&_t(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Mt(e){var t=mi(e.target);if(null!==t){var n=Ke(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=je(n)))return e.blockedOn=t,void At(e.priority,(function(){St(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Ut(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Qt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=wi(n))&&_t(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);be=r,n.target.dispatchEvent(r),be=null,t.shift()}return!0}function Ft(e,t,n){Ut(e)&&n.delete(t)}function Vt(){It=!1,null!==Rt&&Ut(Rt)&&(Rt=null),null!==Ct&&Ut(Ct)&&(Ct=null),null!==xt&&Ut(xt)&&(xt=null),Pt.forEach(Ft),Dt.forEach(Ft)}function zt(e,t){e.blockedOn===t&&(e.blockedOn=null,It||(It=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Vt)))}function Kt(e){function t(t){return zt(t,e)}if(0<Tt.length){zt(Tt[0],e);for(var n=1;n<Tt.length;n++){var r=Tt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Rt&&zt(Rt,e),null!==Ct&&zt(Ct,e),null!==xt&&zt(xt,e),Pt.forEach(t),Dt.forEach(t),n=0;n<Nt.length;n++)(r=Nt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Nt.length&&null===(n=Nt[0]).blockedOn;)Mt(n),null===n.blockedOn&&Nt.shift()}var jt=b.ReactCurrentBatchConfig,Ht=!0;function qt(e,t,n,r){var i=wt,o=jt.transition;jt.transition=null;try{wt=1,Gt(e,t,n,r)}finally{wt=i,jt.transition=o}}function Wt(e,t,n,r){var i=wt,o=jt.transition;jt.transition=null;try{wt=4,Gt(e,t,n,r)}finally{wt=i,jt.transition=o}}function Gt(e,t,n,r){if(Ht){var i=Qt(e,t,n,r);if(null===i)Hr(e,t,r,Yt,n),Lt(e,r);else if(function(e,t,n,r,i){switch(t){case"focusin":return Rt=Ot(Rt,e,t,n,r,i),!0;case"dragenter":return Ct=Ot(Ct,e,t,n,r,i),!0;case"mouseover":return xt=Ot(xt,e,t,n,r,i),!0;case"pointerover":var o=i.pointerId;return Pt.set(o,Ot(Pt.get(o)||null,e,t,n,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Dt.set(o,Ot(Dt.get(o)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r))r.stopPropagation();else if(Lt(e,r),4&t&&-1<Bt.indexOf(e)){for(;null!==i;){var o=wi(i);if(null!==o&&Et(o),null===(o=Qt(e,t,n,r))&&Hr(e,t,r,Yt,n),o===i)break;i=o}null!==i&&r.stopPropagation()}else Hr(e,t,r,null,n)}}var Yt=null;function Qt(e,t,n,r){if(Yt=null,null!==(e=mi(e=Ee(r))))if(null===(t=Ke(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=je(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Yt=e,null}function Xt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch($e()){case Ze:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Jt=null,$t=null,Zt=null;function en(){if(Zt)return Zt;var e,t,n=$t,r=n.length,i="value"in Jt?Jt.value:Jt.textContent,o=i.length;for(e=0;e<r&&n[e]===i[e];e++);var s=r-e;for(t=1;t<=s&&n[r-t]===i[o-t];t++);return Zt=i.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function on(e){function t(t,n,r,i,o){for(var s in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(s)&&(t=e[s],this[s]=t?t(i):i[s]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return M(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var sn,an,ln,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},un=on(cn),hn=M({},cn,{view:0,detail:0}),dn=on(hn),fn=M({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:An,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ln&&(ln&&"mousemove"===e.type?(sn=e.screenX-ln.screenX,an=e.screenY-ln.screenY):an=sn=0,ln=e),sn)},movementY:function(e){return"movementY"in e?e.movementY:an}}),pn=on(fn),gn=on(M({},fn,{dataTransfer:0})),yn=on(M({},hn,{relatedTarget:0})),vn=on(M({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),mn=M({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),wn=on(mn),bn=on(M({},cn,{data:0})),En={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_n={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Sn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sn[e])&&!!t[e]}function An(){return kn}var In=M({},hn,{key:function(e){if(e.key){var t=En[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?_n[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:An,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Tn=on(In),Rn=on(M({},fn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Cn=on(M({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:An})),xn=on(M({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Pn=M({},fn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Dn=on(Pn),Nn=[9,13,27,32],Bn=u&&"CompositionEvent"in window,Ln=null;u&&"documentMode"in document&&(Ln=document.documentMode);var On=u&&"TextEvent"in window&&!Ln,Mn=u&&(!Bn||Ln&&8<Ln&&11>=Ln),Un=String.fromCharCode(32),Fn=!1;function Vn(e,t){switch(e){case"keyup":return-1!==Nn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function zn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Kn=!1;var jn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!jn[e.type]:"textarea"===t}function qn(e,t,n,r){Ie(r),0<(t=Wr(t,"onChange")).length&&(n=new un("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Wn=null,Gn=null;function Yn(e){Ur(e,0)}function Qn(e){if(G(bi(e)))return e}function Xn(e,t){if("change"===e)return t}var Jn=!1;if(u){var $n;if(u){var Zn="oninput"in document;if(!Zn){var er=document.createElement("div");er.setAttribute("oninput","return;"),Zn="function"===typeof er.oninput}$n=Zn}else $n=!1;Jn=$n&&(!document.documentMode||9<document.documentMode)}function tr(){Wn&&(Wn.detachEvent("onpropertychange",nr),Gn=Wn=null)}function nr(e){if("value"===e.propertyName&&Qn(Gn)){var t=[];qn(t,Gn,e,Ee(e)),Pe(Yn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Gn=n,(Wn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Qn(Gn)}function or(e,t){if("click"===e)return Qn(t)}function sr(e,t){if("input"===e||"change"===e)return Qn(t)}var ar="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function lr(e,t){if(ar(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!h.call(t,i)||!ar(e[i],t[i]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function ur(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function hr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function dr(){for(var e=window,t=Y();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=Y((e=t.contentWindow).document)}return t}function fr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=dr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hr(n.ownerDocument.documentElement,n)){if(null!==r&&fr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=n.textContent.length,o=Math.min(r.start,i);r=void 0===r.end?o:Math.min(r.end,i),!e.extend&&o>r&&(i=r,r=o,o=i),i=ur(n,o);var s=ur(n,r);i&&s&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==s.node||e.focusOffset!==s.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),o>r?(e.addRange(t),e.extend(s.node,s.offset)):(t.setEnd(s.node,s.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var gr=u&&"documentMode"in document&&11>=document.documentMode,yr=null,vr=null,mr=null,wr=!1;function br(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;wr||null==yr||yr!==Y(r)||("selectionStart"in(r=yr)&&fr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},mr&&lr(mr,r)||(mr=r,0<(r=Wr(vr,"onSelect")).length&&(t=new un("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=yr)))}function Er(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var _r={animationend:Er("Animation","AnimationEnd"),animationiteration:Er("Animation","AnimationIteration"),animationstart:Er("Animation","AnimationStart"),transitionend:Er("Transition","TransitionEnd")},Sr={},kr={};function Ar(e){if(Sr[e])return Sr[e];if(!_r[e])return e;var t,n=_r[e];for(t in n)if(n.hasOwnProperty(t)&&t in kr)return Sr[e]=n[t];return e}u&&(kr=document.createElement("div").style,"AnimationEvent"in window||(delete _r.animationend.animation,delete _r.animationiteration.animation,delete _r.animationstart.animation),"TransitionEvent"in window||delete _r.transitionend.transition);var Ir=Ar("animationend"),Tr=Ar("animationiteration"),Rr=Ar("animationstart"),Cr=Ar("transitionend"),xr=new Map,Pr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Dr(e,t){xr.set(e,t),l(t,[e])}for(var Nr=0;Nr<Pr.length;Nr++){var Br=Pr[Nr];Dr(Br.toLowerCase(),"on"+(Br[0].toUpperCase()+Br.slice(1)))}Dr(Ir,"onAnimationEnd"),Dr(Tr,"onAnimationIteration"),Dr(Rr,"onAnimationStart"),Dr("dblclick","onDoubleClick"),Dr("focusin","onFocus"),Dr("focusout","onBlur"),Dr(Cr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Lr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Or=new Set("cancel close invalid load scroll toggle".split(" ").concat(Lr));function Mr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,s,a,l,c){if(ze.apply(this,arguments),Oe){if(!Oe)throw Error(o(198));var u=Me;Oe=!1,Me=null,Ue||(Ue=!0,Fe=u)}}(r,t,void 0,e),e.currentTarget=null}function Ur(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var o=void 0;if(t)for(var s=r.length-1;0<=s;s--){var a=r[s],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&i.isPropagationStopped())break e;Mr(i,a,c),o=l}else for(s=0;s<r.length;s++){if(l=(a=r[s]).instance,c=a.currentTarget,a=a.listener,l!==o&&i.isPropagationStopped())break e;Mr(i,a,c),o=l}}}if(Ue)throw e=Fe,Ue=!1,Fe=null,e}function Fr(e,t){var n=t[gi];void 0===n&&(n=t[gi]=new Set);var r=e+"__bubble";n.has(r)||(jr(t,e,2,!1),n.add(r))}function Vr(e,t,n){var r=0;t&&(r|=4),jr(n,e,r,t)}var zr="_reactListening"+Math.random().toString(36).slice(2);function Kr(e){if(!e[zr]){e[zr]=!0,s.forEach((function(t){"selectionchange"!==t&&(Or.has(t)||Vr(t,!1,e),Vr(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[zr]||(t[zr]=!0,Vr("selectionchange",!1,t))}}function jr(e,t,n,r){switch(Xt(t)){case 1:var i=qt;break;case 4:i=Wt;break;default:i=Gt}n=i.bind(null,t,n,e),i=void 0,!Ne||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Hr(e,t,n,r,i){var o=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var s=r.tag;if(3===s||4===s){var a=r.stateNode.containerInfo;if(a===i||8===a.nodeType&&a.parentNode===i)break;if(4===s)for(s=r.return;null!==s;){var l=s.tag;if((3===l||4===l)&&((l=s.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;s=s.return}for(;null!==a;){if(null===(s=mi(a)))return;if(5===(l=s.tag)||6===l){r=o=s;continue e}a=a.parentNode}}r=r.return}Pe((function(){var r=o,i=Ee(n),s=[];e:{var a=xr.get(e);if(void 0!==a){var l=un,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":l=Tn;break;case"focusin":c="focus",l=yn;break;case"focusout":c="blur",l=yn;break;case"beforeblur":case"afterblur":l=yn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=gn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Cn;break;case Ir:case Tr:case Rr:l=vn;break;case Cr:l=xn;break;case"scroll":l=dn;break;case"wheel":l=Dn;break;case"copy":case"cut":case"paste":l=wn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Rn}var u=0!==(4&t),h=!u&&"scroll"===e,d=u?null!==a?a+"Capture":null:a;u=[];for(var f,p=r;null!==p;){var g=(f=p).stateNode;if(5===f.tag&&null!==g&&(f=g,null!==d&&(null!=(g=De(p,d))&&u.push(qr(p,g,f)))),h)break;p=p.return}0<u.length&&(a=new l(a,c,null,n,i),s.push({event:a,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||n===be||!(c=n.relatedTarget||n.fromElement)||!mi(c)&&!c[pi])&&(l||a)&&(a=i.window===i?i:(a=i.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=r,null!==(c=(c=n.relatedTarget||n.toElement)?mi(c):null)&&(c!==(h=Ke(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=r),l!==c)){if(u=pn,g="onMouseLeave",d="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(u=Rn,g="onPointerLeave",d="onPointerEnter",p="pointer"),h=null==l?a:bi(l),f=null==c?a:bi(c),(a=new u(g,p+"leave",l,n,i)).target=h,a.relatedTarget=f,g=null,mi(i)===r&&((u=new u(d,p+"enter",c,n,i)).target=f,u.relatedTarget=h,g=u),h=g,l&&c)e:{for(d=c,p=0,f=u=l;f;f=Gr(f))p++;for(f=0,g=d;g;g=Gr(g))f++;for(;0<p-f;)u=Gr(u),p--;for(;0<f-p;)d=Gr(d),f--;for(;p--;){if(u===d||null!==d&&u===d.alternate)break e;u=Gr(u),d=Gr(d)}u=null}else u=null;null!==l&&Yr(s,a,l,u,!1),null!==c&&null!==h&&Yr(s,h,c,u,!0)}if("select"===(l=(a=r?bi(r):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var y=Xn;else if(Hn(a))if(Jn)y=sr;else{y=ir;var v=rr}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(y=or);switch(y&&(y=y(e,r))?qn(s,y,n,i):(v&&v(e,a,r),"focusout"===e&&(v=a._wrapperState)&&v.controlled&&"number"===a.type&&ee(a,"number",a.value)),v=r?bi(r):window,e){case"focusin":(Hn(v)||"true"===v.contentEditable)&&(yr=v,vr=r,mr=null);break;case"focusout":mr=vr=yr=null;break;case"mousedown":wr=!0;break;case"contextmenu":case"mouseup":case"dragend":wr=!1,br(s,n,i);break;case"selectionchange":if(gr)break;case"keydown":case"keyup":br(s,n,i)}var m;if(Bn)e:{switch(e){case"compositionstart":var w="onCompositionStart";break e;case"compositionend":w="onCompositionEnd";break e;case"compositionupdate":w="onCompositionUpdate";break e}w=void 0}else Kn?Vn(e,n)&&(w="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(w="onCompositionStart");w&&(Mn&&"ko"!==n.locale&&(Kn||"onCompositionStart"!==w?"onCompositionEnd"===w&&Kn&&(m=en()):($t="value"in(Jt=i)?Jt.value:Jt.textContent,Kn=!0)),0<(v=Wr(r,w)).length&&(w=new bn(w,e,null,n,i),s.push({event:w,listeners:v}),m?w.data=m:null!==(m=zn(n))&&(w.data=m))),(m=On?function(e,t){switch(e){case"compositionend":return zn(t);case"keypress":return 32!==t.which?null:(Fn=!0,Un);case"textInput":return(e=t.data)===Un&&Fn?null:e;default:return null}}(e,n):function(e,t){if(Kn)return"compositionend"===e||!Bn&&Vn(e,t)?(e=en(),Zt=$t=Jt=null,Kn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Mn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Wr(r,"onBeforeInput")).length&&(i=new bn("onBeforeInput","beforeinput",null,n,i),s.push({event:i,listeners:r}),i.data=m))}Ur(s,t)}))}function qr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Wr(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,o=i.stateNode;5===i.tag&&null!==o&&(i=o,null!=(o=De(e,n))&&r.unshift(qr(e,o,i)),null!=(o=De(e,t))&&r.push(qr(e,o,i))),e=e.return}return r}function Gr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Yr(e,t,n,r,i){for(var o=t._reactName,s=[];null!==n&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(null!==l&&l===r)break;5===a.tag&&null!==c&&(a=c,i?null!=(l=De(n,o))&&s.unshift(qr(n,l,a)):i||null!=(l=De(n,o))&&s.push(qr(n,l,a))),n=n.return}0!==s.length&&e.push({event:t,listeners:s})}var Qr=/\r\n?/g,Xr=/\u0000|\uFFFD/g;function Jr(e){return("string"===typeof e?e:""+e).replace(Qr,"\n").replace(Xr,"")}function $r(e,t,n){if(t=Jr(t),Jr(e)!==t&&n)throw Error(o(425))}function Zr(){}var ei=null,ti=null;function ni(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ri="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,oi="function"===typeof Promise?Promise:void 0,si="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof oi?function(e){return oi.resolve(null).then(e).catch(ai)}:ri;function ai(e){setTimeout((function(){throw e}))}function li(e,t){var n=t,r=0;do{var i=n.nextSibling;if(e.removeChild(n),i&&8===i.nodeType)if("/$"===(n=i.data)){if(0===r)return e.removeChild(i),void Kt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=i}while(n);Kt(t)}function ci(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ui(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var hi=Math.random().toString(36).slice(2),di="__reactFiber$"+hi,fi="__reactProps$"+hi,pi="__reactContainer$"+hi,gi="__reactEvents$"+hi,yi="__reactListeners$"+hi,vi="__reactHandles$"+hi;function mi(e){var t=e[di];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pi]||n[di]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=ui(e);null!==e;){if(n=e[di])return n;e=ui(e)}return t}n=(e=n).parentNode}return null}function wi(e){return!(e=e[di]||e[pi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function bi(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function Ei(e){return e[fi]||null}var _i=[],Si=-1;function ki(e){return{current:e}}function Ai(e){0>Si||(e.current=_i[Si],_i[Si]=null,Si--)}function Ii(e,t){Si++,_i[Si]=e.current,e.current=t}var Ti={},Ri=ki(Ti),Ci=ki(!1),xi=Ti;function Pi(e,t){var n=e.type.contextTypes;if(!n)return Ti;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in n)o[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Di(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Ni(){Ai(Ci),Ai(Ri)}function Bi(e,t,n){if(Ri.current!==Ti)throw Error(o(168));Ii(Ri,t),Ii(Ci,n)}function Li(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var i in r=r.getChildContext())if(!(i in t))throw Error(o(108,j(e)||"Unknown",i));return M({},n,r)}function Oi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ti,xi=Ri.current,Ii(Ri,e),Ii(Ci,Ci.current),!0}function Mi(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=Li(e,t,xi),r.__reactInternalMemoizedMergedChildContext=e,Ai(Ci),Ai(Ri),Ii(Ri,e)):Ai(Ci),Ii(Ci,n)}var Ui=null,Fi=!1,Vi=!1;function zi(e){null===Ui?Ui=[e]:Ui.push(e)}function Ki(){if(!Vi&&null!==Ui){Vi=!0;var e=0,t=wt;try{var n=Ui;for(wt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Ui=null,Fi=!1}catch(i){throw null!==Ui&&(Ui=Ui.slice(e+1)),Ge(Ze,Ki),i}finally{wt=t,Vi=!1}}return null}var ji=[],Hi=0,qi=null,Wi=0,Gi=[],Yi=0,Qi=null,Xi=1,Ji="";function $i(e,t){ji[Hi++]=Wi,ji[Hi++]=qi,qi=e,Wi=t}function Zi(e,t,n){Gi[Yi++]=Xi,Gi[Yi++]=Ji,Gi[Yi++]=Qi,Qi=e;var r=Xi;e=Ji;var i=32-st(r)-1;r&=~(1<<i),n+=1;var o=32-st(t)+i;if(30<o){var s=i-i%5;o=(r&(1<<s)-1).toString(32),r>>=s,i-=s,Xi=1<<32-st(t)+i|n<<i|r,Ji=o+e}else Xi=1<<o|n<<i|r,Ji=e}function eo(e){null!==e.return&&($i(e,1),Zi(e,1,0))}function to(e){for(;e===qi;)qi=ji[--Hi],ji[Hi]=null,Wi=ji[--Hi],ji[Hi]=null;for(;e===Qi;)Qi=Gi[--Yi],Gi[Yi]=null,Ji=Gi[--Yi],Gi[Yi]=null,Xi=Gi[--Yi],Gi[Yi]=null}var no=null,ro=null,io=!1,oo=null;function so(e,t){var n=Dc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function ao(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,no=e,ro=ci(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,no=e,ro=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Qi?{id:Xi,overflow:Ji}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Dc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,no=e,ro=null,!0);default:return!1}}function lo(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function co(e){if(io){var t=ro;if(t){var n=t;if(!ao(e,t)){if(lo(e))throw Error(o(418));t=ci(n.nextSibling);var r=no;t&&ao(e,t)?so(r,n):(e.flags=-4097&e.flags|2,io=!1,no=e)}}else{if(lo(e))throw Error(o(418));e.flags=-4097&e.flags|2,io=!1,no=e}}}function uo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;no=e}function ho(e){if(e!==no)return!1;if(!io)return uo(e),io=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ni(e.type,e.memoizedProps)),t&&(t=ro)){if(lo(e))throw fo(),Error(o(418));for(;t;)so(e,t),t=ci(t.nextSibling)}if(uo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ro=ci(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ro=null}}else ro=no?ci(e.stateNode.nextSibling):null;return!0}function fo(){for(var e=ro;e;)e=ci(e.nextSibling)}function po(){ro=no=null,io=!1}function go(e){null===oo?oo=[e]:oo.push(e)}var yo=b.ReactCurrentBatchConfig;function vo(e,t){if(e&&e.defaultProps){for(var n in t=M({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var mo=ki(null),wo=null,bo=null,Eo=null;function _o(){Eo=bo=wo=null}function So(e){var t=mo.current;Ai(mo),e._currentValue=t}function ko(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ao(e,t){wo=e,Eo=bo=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(ba=!0),e.firstContext=null)}function Io(e){var t=e._currentValue;if(Eo!==e)if(e={context:e,memoizedValue:t,next:null},null===bo){if(null===wo)throw Error(o(308));bo=e,wo.dependencies={lanes:0,firstContext:e}}else bo=bo.next=e;return t}var To=null;function Ro(e){null===To?To=[e]:To.push(e)}function Co(e,t,n,r){var i=t.interleaved;return null===i?(n.next=n,Ro(t)):(n.next=i.next,i.next=n),t.interleaved=n,xo(e,r)}function xo(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Po=!1;function Do(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function No(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Bo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Lo(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Cl)){var i=r.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),r.pending=t,xo(e,n)}return null===(i=r.interleaved)?(t.next=t,Ro(r)):(t.next=i.next,i.next=t),r.interleaved=t,xo(e,n)}function Oo(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,mt(e,n)}}function Mo(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,o=null;if(null!==(n=n.firstBaseUpdate)){do{var s={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===o?i=o=s:o=o.next=s,n=n.next}while(null!==n);null===o?i=o=t:o=o.next=t}else i=o=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Uo(e,t,n,r){var i=e.updateQueue;Po=!1;var o=i.firstBaseUpdate,s=i.lastBaseUpdate,a=i.shared.pending;if(null!==a){i.shared.pending=null;var l=a,c=l.next;l.next=null,null===s?o=c:s.next=c,s=l;var u=e.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==s&&(null===a?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(null!==o){var h=i.baseState;for(s=0,u=c=l=null,a=o;;){var d=a.lane,f=a.eventTime;if((r&d)===d){null!==u&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=e,g=a;switch(d=t,f=n,g.tag){case 1:if("function"===typeof(p=g.payload)){h=p.call(f,h,d);break e}h=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(d="function"===typeof(p=g.payload)?p.call(f,h,d):p)||void 0===d)break e;h=M({},h,d);break e;case 2:Po=!0}}null!==a.callback&&0!==a.lane&&(e.flags|=64,null===(d=i.effects)?i.effects=[a]:d.push(a))}else f={eventTime:f,lane:d,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(c=u=f,l=h):u=u.next=f,s|=d;if(null===(a=a.next)){if(null===(a=i.shared.pending))break;a=(d=a).next,d.next=null,i.lastBaseUpdate=d,i.shared.pending=null}}if(null===u&&(l=h),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null!==(t=i.shared.interleaved)){i=t;do{s|=i.lane,i=i.next}while(i!==t)}else null===o&&(i.shared.lanes=0);Ml|=s,e.lanes=s,e.memoizedState=h}}function Fo(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(o(191,i));i.call(r)}}}var Vo=(new r.Component).refs;function zo(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:M({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Ko={isMounted:function(e){return!!(e=e._reactInternals)&&Ke(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=tc(),i=nc(e),o=Bo(r,i);o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Lo(e,o,i))&&(rc(t,e,i,r),Oo(t,e,i))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=tc(),i=nc(e),o=Bo(r,i);o.tag=1,o.payload=t,void 0!==n&&null!==n&&(o.callback=n),null!==(t=Lo(e,o,i))&&(rc(t,e,i,r),Oo(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=tc(),r=nc(e),i=Bo(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=Lo(e,i,r))&&(rc(t,e,r,n),Oo(t,e,r))}};function jo(e,t,n,r,i,o,s){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,o,s):!t.prototype||!t.prototype.isPureReactComponent||(!lr(n,r)||!lr(i,o))}function Ho(e,t,n){var r=!1,i=Ti,o=t.contextType;return"object"===typeof o&&null!==o?o=Io(o):(i=Di(t)?xi:Ri.current,o=(r=null!==(r=t.contextTypes)&&void 0!==r)?Pi(e,i):Ti),t=new t(n,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Ko,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function qo(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Ko.enqueueReplaceState(t,t.state,null)}function Wo(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=Vo,Do(e);var o=t.contextType;"object"===typeof o&&null!==o?i.context=Io(o):(o=Di(t)?xi:Ri.current,i.context=Pi(e,o)),i.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(zo(e,t,o,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&Ko.enqueueReplaceState(i,i.state,null),Uo(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function Go(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var i=r,s=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===s?t.ref:(t=function(e){var t=i.refs;t===Vo&&(t=i.refs={}),null===e?delete t[s]:t[s]=e},t._stringRef=s,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function Yo(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Qo(e){return(0,e._init)(e._payload)}function Xo(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Bc(e,t)).index=0,e.sibling=null,e}function s(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function a(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Uc(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){var o=n.type;return o===S?h(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===D&&Qo(o)===t.type)?((r=i(t,n.props)).ref=Go(e,t,n),r.return=e,r):((r=Lc(n.type,n.key,n.props,null,e.mode,r)).ref=Go(e,t,n),r.return=e,r)}function u(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Fc(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function h(e,t,n,r,o){return null===t||7!==t.tag?((t=Oc(n,e.mode,r,o)).return=e,t):((t=i(t,n)).return=e,t)}function d(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Uc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case E:return(n=Lc(t.type,t.key,t.props,null,e.mode,n)).ref=Go(e,null,t),n.return=e,n;case _:return(t=Fc(t,e.mode,n)).return=e,t;case D:return d(e,(0,t._init)(t._payload),n)}if(te(t)||L(t))return(t=Oc(t,e.mode,n,null)).return=e,t;Yo(e,t)}return null}function f(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==i?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case E:return n.key===i?c(e,t,n,r):null;case _:return n.key===i?u(e,t,n,r):null;case D:return f(e,t,(i=n._init)(n._payload),r)}if(te(n)||L(n))return null!==i?null:h(e,t,n,r,null);Yo(e,n)}return null}function p(e,t,n,r,i){if("string"===typeof r&&""!==r||"number"===typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case E:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i);case _:return u(t,e=e.get(null===r.key?n:r.key)||null,r,i);case D:return p(e,t,n,(0,r._init)(r._payload),i)}if(te(r)||L(r))return h(t,e=e.get(n)||null,r,i,null);Yo(t,r)}return null}function g(i,o,a,l){for(var c=null,u=null,h=o,g=o=0,y=null;null!==h&&g<a.length;g++){h.index>g?(y=h,h=null):y=h.sibling;var v=f(i,h,a[g],l);if(null===v){null===h&&(h=y);break}e&&h&&null===v.alternate&&t(i,h),o=s(v,o,g),null===u?c=v:u.sibling=v,u=v,h=y}if(g===a.length)return n(i,h),io&&$i(i,g),c;if(null===h){for(;g<a.length;g++)null!==(h=d(i,a[g],l))&&(o=s(h,o,g),null===u?c=h:u.sibling=h,u=h);return io&&$i(i,g),c}for(h=r(i,h);g<a.length;g++)null!==(y=p(h,i,g,a[g],l))&&(e&&null!==y.alternate&&h.delete(null===y.key?g:y.key),o=s(y,o,g),null===u?c=y:u.sibling=y,u=y);return e&&h.forEach((function(e){return t(i,e)})),io&&$i(i,g),c}function y(i,a,l,c){var u=L(l);if("function"!==typeof u)throw Error(o(150));if(null==(l=u.call(l)))throw Error(o(151));for(var h=u=null,g=a,y=a=0,v=null,m=l.next();null!==g&&!m.done;y++,m=l.next()){g.index>y?(v=g,g=null):v=g.sibling;var w=f(i,g,m.value,c);if(null===w){null===g&&(g=v);break}e&&g&&null===w.alternate&&t(i,g),a=s(w,a,y),null===h?u=w:h.sibling=w,h=w,g=v}if(m.done)return n(i,g),io&&$i(i,y),u;if(null===g){for(;!m.done;y++,m=l.next())null!==(m=d(i,m.value,c))&&(a=s(m,a,y),null===h?u=m:h.sibling=m,h=m);return io&&$i(i,y),u}for(g=r(i,g);!m.done;y++,m=l.next())null!==(m=p(g,i,y,m.value,c))&&(e&&null!==m.alternate&&g.delete(null===m.key?y:m.key),a=s(m,a,y),null===h?u=m:h.sibling=m,h=m);return e&&g.forEach((function(e){return t(i,e)})),io&&$i(i,y),u}return function e(r,o,s,l){if("object"===typeof s&&null!==s&&s.type===S&&null===s.key&&(s=s.props.children),"object"===typeof s&&null!==s){switch(s.$$typeof){case E:e:{for(var c=s.key,u=o;null!==u;){if(u.key===c){if((c=s.type)===S){if(7===u.tag){n(r,u.sibling),(o=i(u,s.props.children)).return=r,r=o;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===D&&Qo(c)===u.type){n(r,u.sibling),(o=i(u,s.props)).ref=Go(r,u,s),o.return=r,r=o;break e}n(r,u);break}t(r,u),u=u.sibling}s.type===S?((o=Oc(s.props.children,r.mode,l,s.key)).return=r,r=o):((l=Lc(s.type,s.key,s.props,null,r.mode,l)).ref=Go(r,o,s),l.return=r,r=l)}return a(r);case _:e:{for(u=s.key;null!==o;){if(o.key===u){if(4===o.tag&&o.stateNode.containerInfo===s.containerInfo&&o.stateNode.implementation===s.implementation){n(r,o.sibling),(o=i(o,s.children||[])).return=r,r=o;break e}n(r,o);break}t(r,o),o=o.sibling}(o=Fc(s,r.mode,l)).return=r,r=o}return a(r);case D:return e(r,o,(u=s._init)(s._payload),l)}if(te(s))return g(r,o,s,l);if(L(s))return y(r,o,s,l);Yo(r,s)}return"string"===typeof s&&""!==s||"number"===typeof s?(s=""+s,null!==o&&6===o.tag?(n(r,o.sibling),(o=i(o,s)).return=r,r=o):(n(r,o),(o=Uc(s,r.mode,l)).return=r,r=o),a(r)):n(r,o)}}var Jo=Xo(!0),$o=Xo(!1),Zo={},es=ki(Zo),ts=ki(Zo),ns=ki(Zo);function rs(e){if(e===Zo)throw Error(o(174));return e}function is(e,t){switch(Ii(ns,t),Ii(ts,e),Ii(es,Zo),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ai(es),Ii(es,t)}function os(){Ai(es),Ai(ts),Ai(ns)}function ss(e){rs(ns.current);var t=rs(es.current),n=le(t,e.type);t!==n&&(Ii(ts,e),Ii(es,n))}function as(e){ts.current===e&&(Ai(es),Ai(ts))}var ls=ki(0);function cs(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var us=[];function hs(){for(var e=0;e<us.length;e++)us[e]._workInProgressVersionPrimary=null;us.length=0}var ds=b.ReactCurrentDispatcher,fs=b.ReactCurrentBatchConfig,ps=0,gs=null,ys=null,vs=null,ms=!1,ws=!1,bs=0,Es=0;function _s(){throw Error(o(321))}function Ss(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!ar(e[n],t[n]))return!1;return!0}function ks(e,t,n,r,i,s){if(ps=s,gs=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ds.current=null===e||null===e.memoizedState?aa:la,e=n(r,i),ws){s=0;do{if(ws=!1,bs=0,25<=s)throw Error(o(301));s+=1,vs=ys=null,t.updateQueue=null,ds.current=ca,e=n(r,i)}while(ws)}if(ds.current=sa,t=null!==ys&&null!==ys.next,ps=0,vs=ys=gs=null,ms=!1,t)throw Error(o(300));return e}function As(){var e=0!==bs;return bs=0,e}function Is(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===vs?gs.memoizedState=vs=e:vs=vs.next=e,vs}function Ts(){if(null===ys){var e=gs.alternate;e=null!==e?e.memoizedState:null}else e=ys.next;var t=null===vs?gs.memoizedState:vs.next;if(null!==t)vs=t,ys=e;else{if(null===e)throw Error(o(310));e={memoizedState:(ys=e).memoizedState,baseState:ys.baseState,baseQueue:ys.baseQueue,queue:ys.queue,next:null},null===vs?gs.memoizedState=vs=e:vs=vs.next=e}return vs}function Rs(e,t){return"function"===typeof t?t(e):t}function Cs(e){var t=Ts(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=ys,i=r.baseQueue,s=n.pending;if(null!==s){if(null!==i){var a=i.next;i.next=s.next,s.next=a}r.baseQueue=i=s,n.pending=null}if(null!==i){s=i.next,r=r.baseState;var l=a=null,c=null,u=s;do{var h=u.lane;if((ps&h)===h)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),r=u.hasEagerState?u.eagerState:e(r,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=d,a=r):c=c.next=d,gs.lanes|=h,Ml|=h}u=u.next}while(null!==u&&u!==s);null===c?a=r:c.next=l,ar(r,t.memoizedState)||(ba=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){i=e;do{s=i.lane,gs.lanes|=s,Ml|=s,i=i.next}while(i!==e)}else null===i&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function xs(e){var t=Ts(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,s=t.memoizedState;if(null!==i){n.pending=null;var a=i=i.next;do{s=e(s,a.action),a=a.next}while(a!==i);ar(s,t.memoizedState)||(ba=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),n.lastRenderedState=s}return[s,r]}function Ps(){}function Ds(e,t){var n=gs,r=Ts(),i=t(),s=!ar(r.memoizedState,i);if(s&&(r.memoizedState=i,ba=!0),r=r.queue,Hs(Ls.bind(null,n,r,e),[e]),r.getSnapshot!==t||s||null!==vs&&1&vs.memoizedState.tag){if(n.flags|=2048,Fs(9,Bs.bind(null,n,r,i,t),void 0,null),null===xl)throw Error(o(349));0!==(30&ps)||Ns(n,t,i)}return i}function Ns(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=gs.updateQueue)?(t={lastEffect:null,stores:null},gs.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Bs(e,t,n,r){t.value=n,t.getSnapshot=r,Os(t)&&Ms(e)}function Ls(e,t,n){return n((function(){Os(t)&&Ms(e)}))}function Os(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!ar(e,n)}catch(r){return!0}}function Ms(e){var t=xo(e,1);null!==t&&rc(t,e,1,-1)}function Us(e){var t=Is();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Rs,lastRenderedState:e},t.queue=e,e=e.dispatch=na.bind(null,gs,e),[t.memoizedState,e]}function Fs(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=gs.updateQueue)?(t={lastEffect:null,stores:null},gs.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Vs(){return Ts().memoizedState}function zs(e,t,n,r){var i=Is();gs.flags|=e,i.memoizedState=Fs(1|t,n,void 0,void 0===r?null:r)}function Ks(e,t,n,r){var i=Ts();r=void 0===r?null:r;var o=void 0;if(null!==ys){var s=ys.memoizedState;if(o=s.destroy,null!==r&&Ss(r,s.deps))return void(i.memoizedState=Fs(t,n,o,r))}gs.flags|=e,i.memoizedState=Fs(1|t,n,o,r)}function js(e,t){return zs(8390656,8,e,t)}function Hs(e,t){return Ks(2048,8,e,t)}function qs(e,t){return Ks(4,2,e,t)}function Ws(e,t){return Ks(4,4,e,t)}function Gs(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ys(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Ks(4,4,Gs.bind(null,t,e),n)}function Qs(){}function Xs(e,t){var n=Ts();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Ss(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Js(e,t){var n=Ts();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Ss(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function $s(e,t,n){return 0===(21&ps)?(e.baseState&&(e.baseState=!1,ba=!0),e.memoizedState=n):(ar(n,t)||(n=gt(),gs.lanes|=n,Ml|=n,e.baseState=!0),t)}function Zs(e,t){var n=wt;wt=0!==n&&4>n?n:4,e(!0);var r=fs.transition;fs.transition={};try{e(!1),t()}finally{wt=n,fs.transition=r}}function ea(){return Ts().memoizedState}function ta(e,t,n){var r=nc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},ra(e))ia(t,n);else if(null!==(n=Co(e,t,n,r))){rc(n,e,r,tc()),oa(n,t,r)}}function na(e,t,n){var r=nc(e),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(ra(e))ia(t,i);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,a=o(s,n);if(i.hasEagerState=!0,i.eagerState=a,ar(a,s)){var l=t.interleaved;return null===l?(i.next=i,Ro(t)):(i.next=l.next,l.next=i),void(t.interleaved=i)}}catch(c){}null!==(n=Co(e,t,i,r))&&(rc(n,e,r,i=tc()),oa(n,t,r))}}function ra(e){var t=e.alternate;return e===gs||null!==t&&t===gs}function ia(e,t){ws=ms=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function oa(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,mt(e,n)}}var sa={readContext:Io,useCallback:_s,useContext:_s,useEffect:_s,useImperativeHandle:_s,useInsertionEffect:_s,useLayoutEffect:_s,useMemo:_s,useReducer:_s,useRef:_s,useState:_s,useDebugValue:_s,useDeferredValue:_s,useTransition:_s,useMutableSource:_s,useSyncExternalStore:_s,useId:_s,unstable_isNewReconciler:!1},aa={readContext:Io,useCallback:function(e,t){return Is().memoizedState=[e,void 0===t?null:t],e},useContext:Io,useEffect:js,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,zs(4194308,4,Gs.bind(null,t,e),n)},useLayoutEffect:function(e,t){return zs(4194308,4,e,t)},useInsertionEffect:function(e,t){return zs(4,2,e,t)},useMemo:function(e,t){var n=Is();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Is();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ta.bind(null,gs,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Is().memoizedState=e},useState:Us,useDebugValue:Qs,useDeferredValue:function(e){return Is().memoizedState=e},useTransition:function(){var e=Us(!1),t=e[0];return e=Zs.bind(null,e[1]),Is().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=gs,i=Is();if(io){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===xl)throw Error(o(349));0!==(30&ps)||Ns(r,t,n)}i.memoizedState=n;var s={value:n,getSnapshot:t};return i.queue=s,js(Ls.bind(null,r,s,e),[e]),r.flags|=2048,Fs(9,Bs.bind(null,r,s,n,t),void 0,null),n},useId:function(){var e=Is(),t=xl.identifierPrefix;if(io){var n=Ji;t=":"+t+"R"+(n=(Xi&~(1<<32-st(Xi)-1)).toString(32)+n),0<(n=bs++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=Es++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},la={readContext:Io,useCallback:Xs,useContext:Io,useEffect:Hs,useImperativeHandle:Ys,useInsertionEffect:qs,useLayoutEffect:Ws,useMemo:Js,useReducer:Cs,useRef:Vs,useState:function(){return Cs(Rs)},useDebugValue:Qs,useDeferredValue:function(e){return $s(Ts(),ys.memoizedState,e)},useTransition:function(){return[Cs(Rs)[0],Ts().memoizedState]},useMutableSource:Ps,useSyncExternalStore:Ds,useId:ea,unstable_isNewReconciler:!1},ca={readContext:Io,useCallback:Xs,useContext:Io,useEffect:Hs,useImperativeHandle:Ys,useInsertionEffect:qs,useLayoutEffect:Ws,useMemo:Js,useReducer:xs,useRef:Vs,useState:function(){return xs(Rs)},useDebugValue:Qs,useDeferredValue:function(e){var t=Ts();return null===ys?t.memoizedState=e:$s(t,ys.memoizedState,e)},useTransition:function(){return[xs(Rs)[0],Ts().memoizedState]},useMutableSource:Ps,useSyncExternalStore:Ds,useId:ea,unstable_isNewReconciler:!1};function ua(e,t){try{var n="",r=t;do{n+=z(r),r=r.return}while(r);var i=n}catch(o){i="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:i,digest:null}}function ha(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function da(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var fa="function"===typeof WeakMap?WeakMap:Map;function pa(e,t,n){(n=Bo(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){ql||(ql=!0,Wl=r),da(0,t)},n}function ga(e,t,n){(n=Bo(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return r(i)},n.callback=function(){da(0,t)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(n.callback=function(){da(0,t),"function"!==typeof r&&(null===Gl?Gl=new Set([this]):Gl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ya(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new fa;var i=new Set;r.set(t,i)}else void 0===(i=r.get(t))&&(i=new Set,r.set(t,i));i.has(n)||(i.add(n),e=Ic.bind(null,e,t,n),t.then(e,e))}function va(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ma(e,t,n,r,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Bo(-1,1)).tag=2,Lo(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var wa=b.ReactCurrentOwner,ba=!1;function Ea(e,t,n,r){t.child=null===e?$o(t,null,n,r):Jo(t,e.child,n,r)}function _a(e,t,n,r,i){n=n.render;var o=t.ref;return Ao(t,i),r=ks(e,t,n,r,o,i),n=As(),null===e||ba?(io&&n&&eo(t),t.flags|=1,Ea(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,qa(e,t,i))}function Sa(e,t,n,r,i){if(null===e){var o=n.type;return"function"!==typeof o||Nc(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Lc(n.type,null,r,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,ka(e,t,o,r,i))}if(o=e.child,0===(e.lanes&i)){var s=o.memoizedProps;if((n=null!==(n=n.compare)?n:lr)(s,r)&&e.ref===t.ref)return qa(e,t,i)}return t.flags|=1,(e=Bc(o,r)).ref=t.ref,e.return=t,t.child=e}function ka(e,t,n,r,i){if(null!==e){var o=e.memoizedProps;if(lr(o,r)&&e.ref===t.ref){if(ba=!1,t.pendingProps=r=o,0===(e.lanes&i))return t.lanes=e.lanes,qa(e,t,i);0!==(131072&e.flags)&&(ba=!0)}}return Ta(e,t,n,r,i)}function Aa(e,t,n){var r=t.pendingProps,i=r.children,o=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ii(Bl,Nl),Nl|=n;else{if(0===(1073741824&n))return e=null!==o?o.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ii(Bl,Nl),Nl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==o?o.baseLanes:n,Ii(Bl,Nl),Nl|=r}else null!==o?(r=o.baseLanes|n,t.memoizedState=null):r=n,Ii(Bl,Nl),Nl|=r;return Ea(e,t,i,n),t.child}function Ia(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ta(e,t,n,r,i){var o=Di(n)?xi:Ri.current;return o=Pi(t,o),Ao(t,i),n=ks(e,t,n,r,o,i),r=As(),null===e||ba?(io&&r&&eo(t),t.flags|=1,Ea(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,qa(e,t,i))}function Ra(e,t,n,r,i){if(Di(n)){var o=!0;Oi(t)}else o=!1;if(Ao(t,i),null===t.stateNode)Ha(e,t),Ho(t,n,r),Wo(t,n,r,i),r=!0;else if(null===e){var s=t.stateNode,a=t.memoizedProps;s.props=a;var l=s.context,c=n.contextType;"object"===typeof c&&null!==c?c=Io(c):c=Pi(t,c=Di(n)?xi:Ri.current);var u=n.getDerivedStateFromProps,h="function"===typeof u||"function"===typeof s.getSnapshotBeforeUpdate;h||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==r||l!==c)&&qo(t,s,r,c),Po=!1;var d=t.memoizedState;s.state=d,Uo(t,r,s,i),l=t.memoizedState,a!==r||d!==l||Ci.current||Po?("function"===typeof u&&(zo(t,n,u,r),l=t.memoizedState),(a=Po||jo(t,n,a,r,d,l,c))?(h||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=l),s.props=r,s.state=l,s.context=c,r=a):("function"===typeof s.componentDidMount&&(t.flags|=4194308),r=!1)}else{s=t.stateNode,No(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:vo(t.type,a),s.props=c,h=t.pendingProps,d=s.context,"object"===typeof(l=n.contextType)&&null!==l?l=Io(l):l=Pi(t,l=Di(n)?xi:Ri.current);var f=n.getDerivedStateFromProps;(u="function"===typeof f||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a!==h||d!==l)&&qo(t,s,r,l),Po=!1,d=t.memoizedState,s.state=d,Uo(t,r,s,i);var p=t.memoizedState;a!==h||d!==p||Ci.current||Po?("function"===typeof f&&(zo(t,n,f,r),p=t.memoizedState),(c=Po||jo(t,n,c,r,d,p,l)||!1)?(u||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(r,p,l),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(r,p,l)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),s.props=r,s.state=p,s.context=l,r=c):("function"!==typeof s.componentDidUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||a===e.memoizedProps&&d===e.memoizedState||(t.flags|=1024),r=!1)}return Ca(e,t,n,r,o,i)}function Ca(e,t,n,r,i,o){Ia(e,t);var s=0!==(128&t.flags);if(!r&&!s)return i&&Mi(t,n,!1),qa(e,t,o);r=t.stateNode,wa.current=t;var a=s&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&s?(t.child=Jo(t,e.child,null,o),t.child=Jo(t,null,a,o)):Ea(e,t,a,o),t.memoizedState=r.state,i&&Mi(t,n,!0),t.child}function xa(e){var t=e.stateNode;t.pendingContext?Bi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Bi(0,t.context,!1),is(e,t.containerInfo)}function Pa(e,t,n,r,i){return po(),go(i),t.flags|=256,Ea(e,t,n,r),t.child}var Da,Na,Ba,La,Oa={dehydrated:null,treeContext:null,retryLane:0};function Ma(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ua(e,t,n){var r,i=t.pendingProps,s=ls.current,a=!1,l=0!==(128&t.flags);if((r=l)||(r=(null===e||null!==e.memoizedState)&&0!==(2&s)),r?(a=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(s|=1),Ii(ls,1&s),null===e)return co(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=i.children,e=i.fallback,a?(i=t.mode,a=t.child,l={mode:"hidden",children:l},0===(1&i)&&null!==a?(a.childLanes=0,a.pendingProps=l):a=Mc(l,i,0,null),e=Oc(e,i,n,null),a.return=t,e.return=t,a.sibling=e,t.child=a,t.child.memoizedState=Ma(n),t.memoizedState=Oa,e):Fa(t,l));if(null!==(s=e.memoizedState)&&null!==(r=s.dehydrated))return function(e,t,n,r,i,s,a){if(n)return 256&t.flags?(t.flags&=-257,Va(e,t,a,r=ha(Error(o(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=r.fallback,i=t.mode,r=Mc({mode:"visible",children:r.children},i,0,null),(s=Oc(s,i,a,null)).flags|=2,r.return=t,s.return=t,r.sibling=s,t.child=r,0!==(1&t.mode)&&Jo(t,e.child,null,a),t.child.memoizedState=Ma(a),t.memoizedState=Oa,s);if(0===(1&t.mode))return Va(e,t,a,null);if("$!"===i.data){if(r=i.nextSibling&&i.nextSibling.dataset)var l=r.dgst;return r=l,Va(e,t,a,r=ha(s=Error(o(419)),r,void 0))}if(l=0!==(a&e.childLanes),ba||l){if(null!==(r=xl)){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(r.suspendedLanes|a))?0:i)&&i!==s.retryLane&&(s.retryLane=i,xo(e,i),rc(r,e,i,-1))}return yc(),Va(e,t,a,r=ha(Error(o(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Rc.bind(null,e),i._reactRetry=t,null):(e=s.treeContext,ro=ci(i.nextSibling),no=t,io=!0,oo=null,null!==e&&(Gi[Yi++]=Xi,Gi[Yi++]=Ji,Gi[Yi++]=Qi,Xi=e.id,Ji=e.overflow,Qi=t),t=Fa(t,r.children),t.flags|=4096,t)}(e,t,l,i,r,s,n);if(a){a=i.fallback,l=t.mode,r=(s=e.child).sibling;var c={mode:"hidden",children:i.children};return 0===(1&l)&&t.child!==s?((i=t.child).childLanes=0,i.pendingProps=c,t.deletions=null):(i=Bc(s,c)).subtreeFlags=14680064&s.subtreeFlags,null!==r?a=Bc(r,a):(a=Oc(a,l,n,null)).flags|=2,a.return=t,i.return=t,i.sibling=a,t.child=i,i=a,a=t.child,l=null===(l=e.child.memoizedState)?Ma(n):{baseLanes:l.baseLanes|n,cachePool:null,transitions:l.transitions},a.memoizedState=l,a.childLanes=e.childLanes&~n,t.memoizedState=Oa,i}return e=(a=e.child).sibling,i=Bc(a,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=i,t.memoizedState=null,i}function Fa(e,t){return(t=Mc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Va(e,t,n,r){return null!==r&&go(r),Jo(t,e.child,null,n),(e=Fa(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function za(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),ko(e.return,t,n)}function Ka(e,t,n,r,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i)}function ja(e,t,n){var r=t.pendingProps,i=r.revealOrder,o=r.tail;if(Ea(e,t,r.children,n),0!==(2&(r=ls.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&za(e,n,t);else if(19===e.tag)za(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ii(ls,r),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===cs(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),Ka(t,!1,i,n,o);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===cs(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}Ka(t,!0,n,null,o);break;case"together":Ka(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Ha(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function qa(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Ml|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Bc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Bc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Wa(e,t){if(!io)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Ga(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=14680064&i.subtreeFlags,r|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Ya(e,t,n){var r=t.pendingProps;switch(to(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ga(t),null;case 1:case 17:return Di(t.type)&&Ni(),Ga(t),null;case 3:return r=t.stateNode,os(),Ai(Ci),Ai(Ri),hs(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(ho(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==oo&&(ac(oo),oo=null))),Na(e,t),Ga(t),null;case 5:as(t);var i=rs(ns.current);if(n=t.type,null!==e&&null!=t.stateNode)Ba(e,t,n,r,i),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(o(166));return Ga(t),null}if(e=rs(es.current),ho(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[di]=t,r[fi]=s,e=0!==(1&t.mode),n){case"dialog":Fr("cancel",r),Fr("close",r);break;case"iframe":case"object":case"embed":Fr("load",r);break;case"video":case"audio":for(i=0;i<Lr.length;i++)Fr(Lr[i],r);break;case"source":Fr("error",r);break;case"img":case"image":case"link":Fr("error",r),Fr("load",r);break;case"details":Fr("toggle",r);break;case"input":X(r,s),Fr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Fr("invalid",r);break;case"textarea":ie(r,s),Fr("invalid",r)}for(var l in me(n,s),i=null,s)if(s.hasOwnProperty(l)){var c=s[l];"children"===l?"string"===typeof c?r.textContent!==c&&(!0!==s.suppressHydrationWarning&&$r(r.textContent,c,e),i=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==s.suppressHydrationWarning&&$r(r.textContent,c,e),i=["children",""+c]):a.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&Fr("scroll",r)}switch(n){case"input":W(r),Z(r,s,!0);break;case"textarea":W(r),se(r);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(r.onclick=Zr)}r=i,t.updateQueue=r,null!==r&&(t.flags|=4)}else{l=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=ae(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=l.createElement(n,{is:r.is}):(e=l.createElement(n),"select"===n&&(l=e,r.multiple?l.multiple=!0:r.size&&(l.size=r.size))):e=l.createElementNS(e,n),e[di]=t,e[fi]=r,Da(e,t,!1,!1),t.stateNode=e;e:{switch(l=we(n,r),n){case"dialog":Fr("cancel",e),Fr("close",e),i=r;break;case"iframe":case"object":case"embed":Fr("load",e),i=r;break;case"video":case"audio":for(i=0;i<Lr.length;i++)Fr(Lr[i],e);i=r;break;case"source":Fr("error",e),i=r;break;case"img":case"image":case"link":Fr("error",e),Fr("load",e),i=r;break;case"details":Fr("toggle",e),i=r;break;case"input":X(e,r),i=Q(e,r),Fr("invalid",e);break;case"option":default:i=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},i=M({},r,{value:void 0}),Fr("invalid",e);break;case"textarea":ie(e,r),i=re(e,r),Fr("invalid",e)}for(s in me(n,i),c=i)if(c.hasOwnProperty(s)){var u=c[s];"style"===s?ye(e,u):"dangerouslySetInnerHTML"===s?null!=(u=u?u.__html:void 0)&&he(e,u):"children"===s?"string"===typeof u?("textarea"!==n||""!==u)&&de(e,u):"number"===typeof u&&de(e,""+u):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(a.hasOwnProperty(s)?null!=u&&"onScroll"===s&&Fr("scroll",e):null!=u&&w(e,s,u,l))}switch(n){case"input":W(e),Z(e,r,!1);break;case"textarea":W(e),se(e);break;case"option":null!=r.value&&e.setAttribute("value",""+H(r.value));break;case"select":e.multiple=!!r.multiple,null!=(s=r.value)?ne(e,!!r.multiple,s,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=Zr)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Ga(t),null;case 6:if(e&&null!=t.stateNode)La(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(o(166));if(n=rs(ns.current),rs(es.current),ho(t)){if(r=t.stateNode,n=t.memoizedProps,r[di]=t,(s=r.nodeValue!==n)&&null!==(e=no))switch(e.tag){case 3:$r(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&$r(r.nodeValue,n,0!==(1&e.mode))}s&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[di]=t,t.stateNode=r}return Ga(t),null;case 13:if(Ai(ls),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(io&&null!==ro&&0!==(1&t.mode)&&0===(128&t.flags))fo(),po(),t.flags|=98560,s=!1;else if(s=ho(t),null!==r&&null!==r.dehydrated){if(null===e){if(!s)throw Error(o(318));if(!(s=null!==(s=t.memoizedState)?s.dehydrated:null))throw Error(o(317));s[di]=t}else po(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Ga(t),s=!1}else null!==oo&&(ac(oo),oo=null),s=!0;if(!s)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&ls.current)?0===Ll&&(Ll=3):yc())),null!==t.updateQueue&&(t.flags|=4),Ga(t),null);case 4:return os(),Na(e,t),null===e&&Kr(t.stateNode.containerInfo),Ga(t),null;case 10:return So(t.type._context),Ga(t),null;case 19:if(Ai(ls),null===(s=t.memoizedState))return Ga(t),null;if(r=0!==(128&t.flags),null===(l=s.rendering))if(r)Wa(s,!1);else{if(0!==Ll||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=cs(e))){for(t.flags|=128,Wa(s,!1),null!==(r=l.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(s=n).flags&=14680066,null===(l=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=l.childLanes,s.lanes=l.lanes,s.child=l.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=l.memoizedProps,s.memoizedState=l.memoizedState,s.updateQueue=l.updateQueue,s.type=l.type,e=l.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ii(ls,1&ls.current|2),t.child}e=e.sibling}null!==s.tail&&Je()>jl&&(t.flags|=128,r=!0,Wa(s,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=cs(l))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Wa(s,!0),null===s.tail&&"hidden"===s.tailMode&&!l.alternate&&!io)return Ga(t),null}else 2*Je()-s.renderingStartTime>jl&&1073741824!==n&&(t.flags|=128,r=!0,Wa(s,!1),t.lanes=4194304);s.isBackwards?(l.sibling=t.child,t.child=l):(null!==(n=s.last)?n.sibling=l:t.child=l,s.last=l)}return null!==s.tail?(t=s.tail,s.rendering=t,s.tail=t.sibling,s.renderingStartTime=Je(),t.sibling=null,n=ls.current,Ii(ls,r?1&n|2:1&n),t):(Ga(t),null);case 22:case 23:return dc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Nl)&&(Ga(t),6&t.subtreeFlags&&(t.flags|=8192)):Ga(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}function Qa(e,t){switch(to(t),t.tag){case 1:return Di(t.type)&&Ni(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return os(),Ai(Ci),Ai(Ri),hs(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return as(t),null;case 13:if(Ai(ls),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));po()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ai(ls),null;case 4:return os(),null;case 10:return So(t.type._context),null;case 22:case 23:return dc(),null;default:return null}}Da=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Na=function(){},Ba=function(e,t,n,r){var i=e.memoizedProps;if(i!==r){e=t.stateNode,rs(es.current);var o,s=null;switch(n){case"input":i=Q(e,i),r=Q(e,r),s=[];break;case"select":i=M({},i,{value:void 0}),r=M({},r,{value:void 0}),s=[];break;case"textarea":i=re(e,i),r=re(e,r),s=[];break;default:"function"!==typeof i.onClick&&"function"===typeof r.onClick&&(e.onclick=Zr)}for(u in me(n,r),n=null,i)if(!r.hasOwnProperty(u)&&i.hasOwnProperty(u)&&null!=i[u])if("style"===u){var l=i[u];for(o in l)l.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(a.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in r){var c=r[u];if(l=null!=i?i[u]:void 0,r.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(u,n)),n=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(s=s||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(s=s||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(a.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&Fr("scroll",e),s||l===c||(s=[])):(s=s||[]).push(u,c))}n&&(s=s||[]).push("style",n);var u=s;(t.updateQueue=u)&&(t.flags|=4)}},La=function(e,t,n,r){n!==r&&(t.flags|=4)};var Xa=!1,Ja=!1,$a="function"===typeof WeakSet?WeakSet:Set,Za=null;function el(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Ac(e,t,r)}else n.current=null}function tl(e,t,n){try{n()}catch(r){Ac(e,t,r)}}var nl=!1;function rl(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var i=r=r.next;do{if((i.tag&e)===e){var o=i.destroy;i.destroy=void 0,void 0!==o&&tl(t,n,o)}i=i.next}while(i!==r)}}function il(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function ol(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function sl(e){var t=e.alternate;null!==t&&(e.alternate=null,sl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[di],delete t[fi],delete t[gi],delete t[yi],delete t[vi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function al(e){return 5===e.tag||3===e.tag||4===e.tag}function ll(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||al(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function cl(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=Zr));else if(4!==r&&null!==(e=e.child))for(cl(e,t,n),e=e.sibling;null!==e;)cl(e,t,n),e=e.sibling}function ul(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(ul(e,t,n),e=e.sibling;null!==e;)ul(e,t,n),e=e.sibling}var hl=null,dl=!1;function fl(e,t,n){for(n=n.child;null!==n;)pl(e,t,n),n=n.sibling}function pl(e,t,n){if(ot&&"function"===typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(it,n)}catch(a){}switch(n.tag){case 5:Ja||el(n,t);case 6:var r=hl,i=dl;hl=null,fl(e,t,n),dl=i,null!==(hl=r)&&(dl?(e=hl,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):hl.removeChild(n.stateNode));break;case 18:null!==hl&&(dl?(e=hl,n=n.stateNode,8===e.nodeType?li(e.parentNode,n):1===e.nodeType&&li(e,n),Kt(e)):li(hl,n.stateNode));break;case 4:r=hl,i=dl,hl=n.stateNode.containerInfo,dl=!0,fl(e,t,n),hl=r,dl=i;break;case 0:case 11:case 14:case 15:if(!Ja&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){i=r=r.next;do{var o=i,s=o.destroy;o=o.tag,void 0!==s&&(0!==(2&o)||0!==(4&o))&&tl(n,t,s),i=i.next}while(i!==r)}fl(e,t,n);break;case 1:if(!Ja&&(el(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){Ac(n,t,a)}fl(e,t,n);break;case 21:fl(e,t,n);break;case 22:1&n.mode?(Ja=(r=Ja)||null!==n.memoizedState,fl(e,t,n),Ja=r):fl(e,t,n);break;default:fl(e,t,n)}}function gl(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new $a),t.forEach((function(t){var r=Cc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function yl(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var i=n[r];try{var s=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 5:hl=l.stateNode,dl=!1;break e;case 3:case 4:hl=l.stateNode.containerInfo,dl=!0;break e}l=l.return}if(null===hl)throw Error(o(160));pl(s,a,i),hl=null,dl=!1;var c=i.alternate;null!==c&&(c.return=null),i.return=null}catch(u){Ac(i,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)vl(t,e),t=t.sibling}function vl(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(yl(t,e),ml(e),4&r){try{rl(3,e,e.return),il(3,e)}catch(y){Ac(e,e.return,y)}try{rl(5,e,e.return)}catch(y){Ac(e,e.return,y)}}break;case 1:yl(t,e),ml(e),512&r&&null!==n&&el(n,n.return);break;case 5:if(yl(t,e),ml(e),512&r&&null!==n&&el(n,n.return),32&e.flags){var i=e.stateNode;try{de(i,"")}catch(y){Ac(e,e.return,y)}}if(4&r&&null!=(i=e.stateNode)){var s=e.memoizedProps,a=null!==n?n.memoizedProps:s,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===s.type&&null!=s.name&&J(i,s),we(l,a);var u=we(l,s);for(a=0;a<c.length;a+=2){var h=c[a],d=c[a+1];"style"===h?ye(i,d):"dangerouslySetInnerHTML"===h?he(i,d):"children"===h?de(i,d):w(i,h,d,u)}switch(l){case"input":$(i,s);break;case"textarea":oe(i,s);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var p=s.value;null!=p?ne(i,!!s.multiple,p,!1):f!==!!s.multiple&&(null!=s.defaultValue?ne(i,!!s.multiple,s.defaultValue,!0):ne(i,!!s.multiple,s.multiple?[]:"",!1))}i[fi]=s}catch(y){Ac(e,e.return,y)}}break;case 6:if(yl(t,e),ml(e),4&r){if(null===e.stateNode)throw Error(o(162));i=e.stateNode,s=e.memoizedProps;try{i.nodeValue=s}catch(y){Ac(e,e.return,y)}}break;case 3:if(yl(t,e),ml(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Kt(t.containerInfo)}catch(y){Ac(e,e.return,y)}break;case 4:default:yl(t,e),ml(e);break;case 13:yl(t,e),ml(e),8192&(i=e.child).flags&&(s=null!==i.memoizedState,i.stateNode.isHidden=s,!s||null!==i.alternate&&null!==i.alternate.memoizedState||(Kl=Je())),4&r&&gl(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?(Ja=(u=Ja)||h,yl(t,e),Ja=u):yl(t,e),ml(e),8192&r){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!h&&0!==(1&e.mode))for(Za=e,h=e.child;null!==h;){for(d=Za=h;null!==Za;){switch(p=(f=Za).child,f.tag){case 0:case 11:case 14:case 15:rl(4,f,f.return);break;case 1:el(f,f.return);var g=f.stateNode;if("function"===typeof g.componentWillUnmount){r=f,n=f.return;try{t=r,g.props=t.memoizedProps,g.state=t.memoizedState,g.componentWillUnmount()}catch(y){Ac(r,n,y)}}break;case 5:el(f,f.return);break;case 22:if(null!==f.memoizedState){_l(d);continue}}null!==p?(p.return=f,Za=p):_l(d)}h=h.sibling}e:for(h=null,d=e;;){if(5===d.tag){if(null===h){h=d;try{i=d.stateNode,u?"function"===typeof(s=i.style).setProperty?s.setProperty("display","none","important"):s.display="none":(l=d.stateNode,a=void 0!==(c=d.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=ge("display",a))}catch(y){Ac(e,e.return,y)}}}else if(6===d.tag){if(null===h)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(y){Ac(e,e.return,y)}}else if((22!==d.tag&&23!==d.tag||null===d.memoizedState||d===e)&&null!==d.child){d.child.return=d,d=d.child;continue}if(d===e)break e;for(;null===d.sibling;){if(null===d.return||d.return===e)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:yl(t,e),ml(e),4&r&&gl(e);case 21:}}function ml(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(al(n)){var r=n;break e}n=n.return}throw Error(o(160))}switch(r.tag){case 5:var i=r.stateNode;32&r.flags&&(de(i,""),r.flags&=-33),ul(e,ll(e),i);break;case 3:case 4:var s=r.stateNode.containerInfo;cl(e,ll(e),s);break;default:throw Error(o(161))}}catch(a){Ac(e,e.return,a)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function wl(e,t,n){Za=e,bl(e,t,n)}function bl(e,t,n){for(var r=0!==(1&e.mode);null!==Za;){var i=Za,o=i.child;if(22===i.tag&&r){var s=null!==i.memoizedState||Xa;if(!s){var a=i.alternate,l=null!==a&&null!==a.memoizedState||Ja;a=Xa;var c=Ja;if(Xa=s,(Ja=l)&&!c)for(Za=i;null!==Za;)l=(s=Za).child,22===s.tag&&null!==s.memoizedState?Sl(i):null!==l?(l.return=s,Za=l):Sl(i);for(;null!==o;)Za=o,bl(o,t,n),o=o.sibling;Za=i,Xa=a,Ja=c}El(e)}else 0!==(8772&i.subtreeFlags)&&null!==o?(o.return=i,Za=o):El(e)}}function El(e){for(;null!==Za;){var t=Za;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Ja||il(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Ja)if(null===n)r.componentDidMount();else{var i=t.elementType===t.type?n.memoizedProps:vo(t.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=t.updateQueue;null!==s&&Fo(t,s,r);break;case 3:var a=t.updateQueue;if(null!==a){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Fo(t,a,n)}break;case 5:var l=t.stateNode;if(null===n&&4&t.flags){n=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var h=u.memoizedState;if(null!==h){var d=h.dehydrated;null!==d&&Kt(d)}}}break;default:throw Error(o(163))}Ja||512&t.flags&&ol(t)}catch(f){Ac(t,t.return,f)}}if(t===e){Za=null;break}if(null!==(n=t.sibling)){n.return=t.return,Za=n;break}Za=t.return}}function _l(e){for(;null!==Za;){var t=Za;if(t===e){Za=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Za=n;break}Za=t.return}}function Sl(e){for(;null!==Za;){var t=Za;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{il(4,t)}catch(l){Ac(t,n,l)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var i=t.return;try{r.componentDidMount()}catch(l){Ac(t,i,l)}}var o=t.return;try{ol(t)}catch(l){Ac(t,o,l)}break;case 5:var s=t.return;try{ol(t)}catch(l){Ac(t,s,l)}}}catch(l){Ac(t,t.return,l)}if(t===e){Za=null;break}var a=t.sibling;if(null!==a){a.return=t.return,Za=a;break}Za=t.return}}var kl,Al=Math.ceil,Il=b.ReactCurrentDispatcher,Tl=b.ReactCurrentOwner,Rl=b.ReactCurrentBatchConfig,Cl=0,xl=null,Pl=null,Dl=0,Nl=0,Bl=ki(0),Ll=0,Ol=null,Ml=0,Ul=0,Fl=0,Vl=null,zl=null,Kl=0,jl=1/0,Hl=null,ql=!1,Wl=null,Gl=null,Yl=!1,Ql=null,Xl=0,Jl=0,$l=null,Zl=-1,ec=0;function tc(){return 0!==(6&Cl)?Je():-1!==Zl?Zl:Zl=Je()}function nc(e){return 0===(1&e.mode)?1:0!==(2&Cl)&&0!==Dl?Dl&-Dl:null!==yo.transition?(0===ec&&(ec=gt()),ec):0!==(e=wt)?e:e=void 0===(e=window.event)?16:Xt(e.type)}function rc(e,t,n,r){if(50<Jl)throw Jl=0,$l=null,Error(o(185));vt(e,n,r),0!==(2&Cl)&&e===xl||(e===xl&&(0===(2&Cl)&&(Ul|=n),4===Ll&&lc(e,Dl)),ic(e,r),1===n&&0===Cl&&0===(1&t.mode)&&(jl=Je()+500,Fi&&Ki()))}function ic(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var s=31-st(o),a=1<<s,l=i[s];-1===l?0!==(a&n)&&0===(a&r)||(i[s]=ft(a,t)):l<=t&&(e.expiredLanes|=a),o&=~a}}(e,t);var r=dt(e,e===xl?Dl:0);if(0===r)null!==n&&Ye(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ye(n),1===t)0===e.tag?function(e){Fi=!0,zi(e)}(cc.bind(null,e)):zi(cc.bind(null,e)),si((function(){0===(6&Cl)&&Ki()})),n=null;else{switch(bt(r)){case 1:n=Ze;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=xc(n,oc.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function oc(e,t){if(Zl=-1,ec=0,0!==(6&Cl))throw Error(o(327));var n=e.callbackNode;if(Sc()&&e.callbackNode!==n)return null;var r=dt(e,e===xl?Dl:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=vc(e,r);else{t=r;var i=Cl;Cl|=2;var s=gc();for(xl===e&&Dl===t||(Hl=null,jl=Je()+500,fc(e,t));;)try{wc();break}catch(l){pc(e,l)}_o(),Il.current=s,Cl=i,null!==Pl?t=0:(xl=null,Dl=0,t=Ll)}if(0!==t){if(2===t&&(0!==(i=pt(e))&&(r=i,t=sc(e,i))),1===t)throw n=Ol,fc(e,0),lc(e,r),ic(e,Je()),n;if(6===t)lc(e,r);else{if(i=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var i=n[r],o=i.getSnapshot;i=i.value;try{if(!ar(o(),i))return!1}catch(a){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=vc(e,r))&&(0!==(s=pt(e))&&(r=s,t=sc(e,s))),1===t))throw n=Ol,fc(e,0),lc(e,r),ic(e,Je()),n;switch(e.finishedWork=i,e.finishedLanes=r,t){case 0:case 1:throw Error(o(345));case 2:case 5:_c(e,zl,Hl);break;case 3:if(lc(e,r),(130023424&r)===r&&10<(t=Kl+500-Je())){if(0!==dt(e,0))break;if(((i=e.suspendedLanes)&r)!==r){tc(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ri(_c.bind(null,e,zl,Hl),t);break}_c(e,zl,Hl);break;case 4:if(lc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,i=-1;0<r;){var a=31-st(r);s=1<<a,(a=t[a])>i&&(i=a),r&=~s}if(r=i,10<(r=(120>(r=Je()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Al(r/1960))-r)){e.timeoutHandle=ri(_c.bind(null,e,zl,Hl),r);break}_c(e,zl,Hl);break;default:throw Error(o(329))}}}return ic(e,Je()),e.callbackNode===n?oc.bind(null,e):null}function sc(e,t){var n=Vl;return e.current.memoizedState.isDehydrated&&(fc(e,t).flags|=256),2!==(e=vc(e,t))&&(t=zl,zl=n,null!==t&&ac(t)),e}function ac(e){null===zl?zl=e:zl.push.apply(zl,e)}function lc(e,t){for(t&=~Fl,t&=~Ul,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-st(t),r=1<<n;e[n]=-1,t&=~r}}function cc(e){if(0!==(6&Cl))throw Error(o(327));Sc();var t=dt(e,0);if(0===(1&t))return ic(e,Je()),null;var n=vc(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=sc(e,r))}if(1===n)throw n=Ol,fc(e,0),lc(e,t),ic(e,Je()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,_c(e,zl,Hl),ic(e,Je()),null}function uc(e,t){var n=Cl;Cl|=1;try{return e(t)}finally{0===(Cl=n)&&(jl=Je()+500,Fi&&Ki())}}function hc(e){null!==Ql&&0===Ql.tag&&0===(6&Cl)&&Sc();var t=Cl;Cl|=1;var n=Rl.transition,r=wt;try{if(Rl.transition=null,wt=1,e)return e()}finally{wt=r,Rl.transition=n,0===(6&(Cl=t))&&Ki()}}function dc(){Nl=Bl.current,Ai(Bl)}function fc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,ii(n)),null!==Pl)for(n=Pl.return;null!==n;){var r=n;switch(to(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Ni();break;case 3:os(),Ai(Ci),Ai(Ri),hs();break;case 5:as(r);break;case 4:os();break;case 13:case 19:Ai(ls);break;case 10:So(r.type._context);break;case 22:case 23:dc()}n=n.return}if(xl=e,Pl=e=Bc(e.current,null),Dl=Nl=t,Ll=0,Ol=null,Fl=Ul=Ml=0,zl=Vl=null,null!==To){for(t=0;t<To.length;t++)if(null!==(r=(n=To[t]).interleaved)){n.interleaved=null;var i=r.next,o=n.pending;if(null!==o){var s=o.next;o.next=i,r.next=s}n.pending=r}To=null}return e}function pc(e,t){for(;;){var n=Pl;try{if(_o(),ds.current=sa,ms){for(var r=gs.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}ms=!1}if(ps=0,vs=ys=gs=null,ws=!1,bs=0,Tl.current=null,null===n||null===n.return){Ll=1,Ol=t,Pl=null;break}e:{var s=e,a=n.return,l=n,c=t;if(t=Dl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,h=l,d=h.tag;if(0===(1&h.mode)&&(0===d||11===d||15===d)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=va(a);if(null!==p){p.flags&=-257,ma(p,a,l,0,t),1&p.mode&&ya(s,u,t),c=u;var g=(t=p).updateQueue;if(null===g){var y=new Set;y.add(c),t.updateQueue=y}else g.add(c);break e}if(0===(1&t)){ya(s,u,t),yc();break e}c=Error(o(426))}else if(io&&1&l.mode){var v=va(a);if(null!==v){0===(65536&v.flags)&&(v.flags|=256),ma(v,a,l,0,t),go(ua(c,l));break e}}s=c=ua(c,l),4!==Ll&&(Ll=2),null===Vl?Vl=[s]:Vl.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,t&=-t,s.lanes|=t,Mo(s,pa(0,c,t));break e;case 1:l=c;var m=s.type,w=s.stateNode;if(0===(128&s.flags)&&("function"===typeof m.getDerivedStateFromError||null!==w&&"function"===typeof w.componentDidCatch&&(null===Gl||!Gl.has(w)))){s.flags|=65536,t&=-t,s.lanes|=t,Mo(s,ga(s,l,t));break e}}s=s.return}while(null!==s)}Ec(n)}catch(b){t=b,Pl===n&&null!==n&&(Pl=n=n.return);continue}break}}function gc(){var e=Il.current;return Il.current=sa,null===e?sa:e}function yc(){0!==Ll&&3!==Ll&&2!==Ll||(Ll=4),null===xl||0===(268435455&Ml)&&0===(268435455&Ul)||lc(xl,Dl)}function vc(e,t){var n=Cl;Cl|=2;var r=gc();for(xl===e&&Dl===t||(Hl=null,fc(e,t));;)try{mc();break}catch(i){pc(e,i)}if(_o(),Cl=n,Il.current=r,null!==Pl)throw Error(o(261));return xl=null,Dl=0,Ll}function mc(){for(;null!==Pl;)bc(Pl)}function wc(){for(;null!==Pl&&!Qe();)bc(Pl)}function bc(e){var t=kl(e.alternate,e,Nl);e.memoizedProps=e.pendingProps,null===t?Ec(e):Pl=t,Tl.current=null}function Ec(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Ya(n,t,Nl)))return void(Pl=n)}else{if(null!==(n=Qa(n,t)))return n.flags&=32767,void(Pl=n);if(null===e)return Ll=6,void(Pl=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Pl=t);Pl=t=e}while(null!==t);0===Ll&&(Ll=5)}function _c(e,t,n){var r=wt,i=Rl.transition;try{Rl.transition=null,wt=1,function(e,t,n,r){do{Sc()}while(null!==Ql);if(0!==(6&Cl))throw Error(o(327));n=e.finishedWork;var i=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var s=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var i=31-st(n),o=1<<i;t[i]=0,r[i]=-1,e[i]=-1,n&=~o}}(e,s),e===xl&&(Pl=xl=null,Dl=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Yl||(Yl=!0,xc(tt,(function(){return Sc(),null}))),s=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||s){s=Rl.transition,Rl.transition=null;var a=wt;wt=1;var l=Cl;Cl|=4,Tl.current=null,function(e,t){if(ei=Ht,fr(e=dr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch(E){n=null;break e}var a=0,l=-1,c=-1,u=0,h=0,d=e,f=null;t:for(;;){for(var p;d!==n||0!==i&&3!==d.nodeType||(l=a+i),d!==s||0!==r&&3!==d.nodeType||(c=a+r),3===d.nodeType&&(a+=d.nodeValue.length),null!==(p=d.firstChild);)f=d,d=p;for(;;){if(d===e)break t;if(f===n&&++u===i&&(l=a),f===s&&++h===r&&(c=a),null!==(p=d.nextSibling))break;f=(d=f).parentNode}d=p}n=-1===l||-1===c?null:{start:l,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ti={focusedElem:e,selectionRange:n},Ht=!1,Za=t;null!==Za;)if(e=(t=Za).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Za=e;else for(;null!==Za;){t=Za;try{var g=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==g){var y=g.memoizedProps,v=g.memoizedState,m=t.stateNode,w=m.getSnapshotBeforeUpdate(t.elementType===t.type?y:vo(t.type,y),v);m.__reactInternalSnapshotBeforeUpdate=w}break;case 3:var b=t.stateNode.containerInfo;1===b.nodeType?b.textContent="":9===b.nodeType&&b.documentElement&&b.removeChild(b.documentElement);break;default:throw Error(o(163))}}catch(E){Ac(t,t.return,E)}if(null!==(e=t.sibling)){e.return=t.return,Za=e;break}Za=t.return}g=nl,nl=!1}(e,n),vl(n,e),pr(ti),Ht=!!ei,ti=ei=null,e.current=n,wl(n,e,i),Xe(),Cl=l,wt=a,Rl.transition=s}else e.current=n;if(Yl&&(Yl=!1,Ql=e,Xl=i),s=e.pendingLanes,0===s&&(Gl=null),function(e){if(ot&&"function"===typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),ic(e,Je()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)i=t[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(ql)throw ql=!1,e=Wl,Wl=null,e;0!==(1&Xl)&&0!==e.tag&&Sc(),s=e.pendingLanes,0!==(1&s)?e===$l?Jl++:(Jl=0,$l=e):Jl=0,Ki()}(e,t,n,r)}finally{Rl.transition=i,wt=r}return null}function Sc(){if(null!==Ql){var e=bt(Xl),t=Rl.transition,n=wt;try{if(Rl.transition=null,wt=16>e?16:e,null===Ql)var r=!1;else{if(e=Ql,Ql=null,Xl=0,0!==(6&Cl))throw Error(o(331));var i=Cl;for(Cl|=4,Za=e.current;null!==Za;){var s=Za,a=s.child;if(0!==(16&Za.flags)){var l=s.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Za=u;null!==Za;){var h=Za;switch(h.tag){case 0:case 11:case 15:rl(8,h,s)}var d=h.child;if(null!==d)d.return=h,Za=d;else for(;null!==Za;){var f=(h=Za).sibling,p=h.return;if(sl(h),h===u){Za=null;break}if(null!==f){f.return=p,Za=f;break}Za=p}}}var g=s.alternate;if(null!==g){var y=g.child;if(null!==y){g.child=null;do{var v=y.sibling;y.sibling=null,y=v}while(null!==y)}}Za=s}}if(0!==(2064&s.subtreeFlags)&&null!==a)a.return=s,Za=a;else e:for(;null!==Za;){if(0!==(2048&(s=Za).flags))switch(s.tag){case 0:case 11:case 15:rl(9,s,s.return)}var m=s.sibling;if(null!==m){m.return=s.return,Za=m;break e}Za=s.return}}var w=e.current;for(Za=w;null!==Za;){var b=(a=Za).child;if(0!==(2064&a.subtreeFlags)&&null!==b)b.return=a,Za=b;else e:for(a=w;null!==Za;){if(0!==(2048&(l=Za).flags))try{switch(l.tag){case 0:case 11:case 15:il(9,l)}}catch(_){Ac(l,l.return,_)}if(l===a){Za=null;break e}var E=l.sibling;if(null!==E){E.return=l.return,Za=E;break e}Za=l.return}}if(Cl=i,Ki(),ot&&"function"===typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(it,e)}catch(_){}r=!0}return r}finally{wt=n,Rl.transition=t}}return!1}function kc(e,t,n){e=Lo(e,t=pa(0,t=ua(n,t),1),1),t=tc(),null!==e&&(vt(e,1,t),ic(e,t))}function Ac(e,t,n){if(3===e.tag)kc(e,e,n);else for(;null!==t;){if(3===t.tag){kc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Gl||!Gl.has(r))){t=Lo(t,e=ga(t,e=ua(n,e),1),1),e=tc(),null!==t&&(vt(t,1,e),ic(t,e));break}}t=t.return}}function Ic(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=tc(),e.pingedLanes|=e.suspendedLanes&n,xl===e&&(Dl&n)===n&&(4===Ll||3===Ll&&(130023424&Dl)===Dl&&500>Je()-Kl?fc(e,0):Fl|=n),ic(e,t)}function Tc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var n=tc();null!==(e=xo(e,t))&&(vt(e,t,n),ic(e,n))}function Rc(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Tc(e,n)}function Cc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,i=e.memoizedState;null!==i&&(n=i.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(o(314))}null!==r&&r.delete(t),Tc(e,n)}function xc(e,t){return Ge(e,t)}function Pc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Dc(e,t,n,r){return new Pc(e,t,n,r)}function Nc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Bc(e,t){var n=e.alternate;return null===n?((n=Dc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Lc(e,t,n,r,i,s){var a=2;if(r=e,"function"===typeof e)Nc(e)&&(a=1);else if("string"===typeof e)a=5;else e:switch(e){case S:return Oc(n.children,i,s,t);case k:a=8,i|=8;break;case A:return(e=Dc(12,n,t,2|i)).elementType=A,e.lanes=s,e;case C:return(e=Dc(13,n,t,i)).elementType=C,e.lanes=s,e;case x:return(e=Dc(19,n,t,i)).elementType=x,e.lanes=s,e;case N:return Mc(n,i,s,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case I:a=10;break e;case T:a=9;break e;case R:a=11;break e;case P:a=14;break e;case D:a=16,r=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Dc(a,n,t,i)).elementType=e,t.type=r,t.lanes=s,t}function Oc(e,t,n,r){return(e=Dc(7,e,r,t)).lanes=n,e}function Mc(e,t,n,r){return(e=Dc(22,e,r,t)).elementType=N,e.lanes=n,e.stateNode={isHidden:!1},e}function Uc(e,t,n){return(e=Dc(6,e,null,t)).lanes=n,e}function Fc(e,t,n){return(t=Dc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Vc(e,t,n,r,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=yt(0),this.expirationTimes=yt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=yt(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function zc(e,t,n,r,i,o,s,a,l){return e=new Vc(e,t,n,a,l),1===t?(t=1,!0===o&&(t|=8)):t=0,o=Dc(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Do(o),e}function Kc(e){if(!e)return Ti;e:{if(Ke(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Di(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(Di(n))return Li(e,n,t)}return t}function jc(e,t,n,r,i,o,s,a,l){return(e=zc(n,r,!0,e,0,o,0,a,l)).context=Kc(null),n=e.current,(o=Bo(r=tc(),i=nc(n))).callback=void 0!==t&&null!==t?t:null,Lo(n,o,i),e.current.lanes=i,vt(e,i,r),ic(e,r),e}function Hc(e,t,n,r){var i=t.current,o=tc(),s=nc(i);return n=Kc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Bo(o,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Lo(i,t,s))&&(rc(e,i,s,o),Oo(e,i,s)),s}function qc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Wc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Gc(e,t){Wc(e,t),(e=e.alternate)&&Wc(e,t)}kl=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ci.current)ba=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return ba=!1,function(e,t,n){switch(t.tag){case 3:xa(t),po();break;case 5:ss(t);break;case 1:Di(t.type)&&Oi(t);break;case 4:is(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,i=t.memoizedProps.value;Ii(mo,r._currentValue),r._currentValue=i;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ii(ls,1&ls.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Ua(e,t,n):(Ii(ls,1&ls.current),null!==(e=qa(e,t,n))?e.sibling:null);Ii(ls,1&ls.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return ja(e,t,n);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ii(ls,ls.current),r)break;return null;case 22:case 23:return t.lanes=0,Aa(e,t,n)}return qa(e,t,n)}(e,t,n);ba=0!==(131072&e.flags)}else ba=!1,io&&0!==(1048576&t.flags)&&Zi(t,Wi,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Ha(e,t),e=t.pendingProps;var i=Pi(t,Ri.current);Ao(t,n),i=ks(null,t,r,e,i,n);var s=As();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Di(r)?(s=!0,Oi(t)):s=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Do(t),i.updater=Ko,t.stateNode=i,i._reactInternals=t,Wo(t,r,e,n),t=Ca(null,t,r,!0,s,n)):(t.tag=0,io&&s&&eo(t),Ea(null,t,i,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Ha(e,t),e=t.pendingProps,r=(i=r._init)(r._payload),t.type=r,i=t.tag=function(e){if("function"===typeof e)return Nc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===R)return 11;if(e===P)return 14}return 2}(r),e=vo(r,e),i){case 0:t=Ta(null,t,r,e,n);break e;case 1:t=Ra(null,t,r,e,n);break e;case 11:t=_a(null,t,r,e,n);break e;case 14:t=Sa(null,t,r,vo(r.type,e),n);break e}throw Error(o(306,r,""))}return t;case 0:return r=t.type,i=t.pendingProps,Ta(e,t,r,i=t.elementType===r?i:vo(r,i),n);case 1:return r=t.type,i=t.pendingProps,Ra(e,t,r,i=t.elementType===r?i:vo(r,i),n);case 3:e:{if(xa(t),null===e)throw Error(o(387));r=t.pendingProps,i=(s=t.memoizedState).element,No(e,t),Uo(t,r,null,n);var a=t.memoizedState;if(r=a.element,s.isDehydrated){if(s={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Pa(e,t,r,n,i=ua(Error(o(423)),t));break e}if(r!==i){t=Pa(e,t,r,n,i=ua(Error(o(424)),t));break e}for(ro=ci(t.stateNode.containerInfo.firstChild),no=t,io=!0,oo=null,n=$o(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(po(),r===i){t=qa(e,t,n);break e}Ea(e,t,r,n)}t=t.child}return t;case 5:return ss(t),null===e&&co(t),r=t.type,i=t.pendingProps,s=null!==e?e.memoizedProps:null,a=i.children,ni(r,i)?a=null:null!==s&&ni(r,s)&&(t.flags|=32),Ia(e,t),Ea(e,t,a,n),t.child;case 6:return null===e&&co(t),null;case 13:return Ua(e,t,n);case 4:return is(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Jo(t,null,r,n):Ea(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,_a(e,t,r,i=t.elementType===r?i:vo(r,i),n);case 7:return Ea(e,t,t.pendingProps,n),t.child;case 8:case 12:return Ea(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,i=t.pendingProps,s=t.memoizedProps,a=i.value,Ii(mo,r._currentValue),r._currentValue=a,null!==s)if(ar(s.value,a)){if(s.children===i.children&&!Ci.current){t=qa(e,t,n);break e}}else for(null!==(s=t.child)&&(s.return=t);null!==s;){var l=s.dependencies;if(null!==l){a=s.child;for(var c=l.firstContext;null!==c;){if(c.context===r){if(1===s.tag){(c=Bo(-1,n&-n)).tag=2;var u=s.updateQueue;if(null!==u){var h=(u=u.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}s.lanes|=n,null!==(c=s.alternate)&&(c.lanes|=n),ko(s.return,n,t),l.lanes|=n;break}c=c.next}}else if(10===s.tag)a=s.type===t.type?null:s.child;else if(18===s.tag){if(null===(a=s.return))throw Error(o(341));a.lanes|=n,null!==(l=a.alternate)&&(l.lanes|=n),ko(a,n,t),a=s.sibling}else a=s.child;if(null!==a)a.return=s;else for(a=s;null!==a;){if(a===t){a=null;break}if(null!==(s=a.sibling)){s.return=a.return,a=s;break}a=a.return}s=a}Ea(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=t.pendingProps.children,Ao(t,n),r=r(i=Io(i)),t.flags|=1,Ea(e,t,r,n),t.child;case 14:return i=vo(r=t.type,t.pendingProps),Sa(e,t,r,i=vo(r.type,i),n);case 15:return ka(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:vo(r,i),Ha(e,t),t.tag=1,Di(r)?(e=!0,Oi(t)):e=!1,Ao(t,n),Ho(t,r,i),Wo(t,r,i,n),Ca(null,t,r,!0,e,n);case 19:return ja(e,t,n);case 22:return Aa(e,t,n)}throw Error(o(156,t.tag))};var Yc="function"===typeof reportError?reportError:function(e){console.error(e)};function Qc(e){this._internalRoot=e}function Xc(e){this._internalRoot=e}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function $c(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Zc(){}function eu(e,t,n,r,i){var o=n._reactRootContainer;if(o){var s=o;if("function"===typeof i){var a=i;i=function(){var e=qc(s);a.call(e)}}Hc(t,s,e,i)}else s=function(e,t,n,r,i){if(i){if("function"===typeof r){var o=r;r=function(){var e=qc(s);o.call(e)}}var s=jc(t,r,e,0,null,!1,0,"",Zc);return e._reactRootContainer=s,e[pi]=s.current,Kr(8===e.nodeType?e.parentNode:e),hc(),s}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof r){var a=r;r=function(){var e=qc(l);a.call(e)}}var l=zc(e,0,!1,null,0,!1,0,"",Zc);return e._reactRootContainer=l,e[pi]=l.current,Kr(8===e.nodeType?e.parentNode:e),hc((function(){Hc(t,l,n,r)})),l}(n,t,e,i,r);return qc(s)}Xc.prototype.render=Qc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));Hc(e,t,null,null)},Xc.prototype.unmount=Qc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;hc((function(){Hc(null,e,null,null)})),t[pi]=null}},Xc.prototype.unstable_scheduleHydration=function(e){if(e){var t=kt();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Nt.length&&0!==t&&t<Nt[n].priority;n++);Nt.splice(n,0,e),0===n&&Mt(e)}},Et=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(mt(t,1|n),ic(t,Je()),0===(6&Cl)&&(jl=Je()+500,Ki()))}break;case 13:hc((function(){var t=xo(e,1);if(null!==t){var n=tc();rc(t,e,1,n)}})),Gc(e,1)}},_t=function(e){if(13===e.tag){var t=xo(e,134217728);if(null!==t)rc(t,e,134217728,tc());Gc(e,134217728)}},St=function(e){if(13===e.tag){var t=nc(e),n=xo(e,t);if(null!==n)rc(n,e,t,tc());Gc(e,t)}},kt=function(){return wt},At=function(e,t){var n=wt;try{return wt=e,t()}finally{wt=n}},_e=function(e,t,n){switch(t){case"input":if($(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=Ei(r);if(!i)throw Error(o(90));G(r),$(r,i)}}}break;case"textarea":oe(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Re=uc,Ce=hc;var tu={usingClientEntryPoint:!1,Events:[wi,bi,Ei,Ie,Te,uc]},nu={findFiberByHostInstance:mi,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},ru={bundleType:nu.bundleType,version:nu.version,rendererPackageName:nu.rendererPackageName,rendererConfig:nu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=qe(e))?null:e.stateNode},findFiberByHostInstance:nu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var iu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!iu.isDisabled&&iu.supportsFiber)try{it=iu.inject(ru),ot=iu}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tu,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Jc(t))throw Error(o(200));return function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:_,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}(e,t,null,n)},t.createRoot=function(e,t){if(!Jc(e))throw Error(o(299));var n=!1,r="",i=Yc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=zc(e,1,!1,null,0,n,0,r,i),e[pi]=t.current,Kr(8===e.nodeType?e.parentNode:e),new Qc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=null===(e=qe(t))?null:e.stateNode},t.flushSync=function(e){return hc(e)},t.hydrate=function(e,t,n){if(!$c(t))throw Error(o(200));return eu(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Jc(e))throw Error(o(405));var r=null!=n&&n.hydratedSources||null,i=!1,s="",a=Yc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(i=!0),void 0!==n.identifierPrefix&&(s=n.identifierPrefix),void 0!==n.onRecoverableError&&(a=n.onRecoverableError)),t=jc(t,null,e,1,null!=n?n:null,i,0,s,a),e[pi]=t.current,Kr(e),r)for(e=0;e<r.length;e++)i=(i=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,i]:t.mutableSourceEagerHydrationData.push(n,i);return new Xc(t)},t.render=function(e,t,n){if(!$c(t))throw Error(o(200));return eu(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!$c(e))throw Error(o(40));return!!e._reactRootContainer&&(hc((function(){eu(null,null,e,!1,(function(){e._reactRootContainer=null,e[pi]=null}))})),!0)},t.unstable_batchedUpdates=uc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!$c(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return eu(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},4391:(e,t,n)=>{"use strict";var r=n(7950);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},7950:(e,t,n)=>{"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(2730)},1153:(e,t,n)=>{"use strict";var r=n(5043),i=Symbol.for("react.element"),o=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,o={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)s.call(t,r)&&!l.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===o[r]&&(o[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:u,props:o,_owner:a.current}}t.jsx=c,t.jsxs=c},4202:(e,t)=>{"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,y={};function v(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||p}function m(){}function w(e,t,n){this.props=e,this.context=t,this.refs=y,this.updater=n||p}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},m.prototype=v.prototype;var b=w.prototype=new m;b.constructor=w,g(b,v.prototype),b.isPureReactComponent=!0;var E=Array.isArray,_=Object.prototype.hasOwnProperty,S={current:null},k={key:!0,ref:!0,__self:!0,__source:!0};function A(e,t,r){var i,o={},s=null,a=null;if(null!=t)for(i in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)_.call(t,i)&&!k.hasOwnProperty(i)&&(o[i]=t[i]);var l=arguments.length-2;if(1===l)o.children=r;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}if(e&&e.defaultProps)for(i in l=e.defaultProps)void 0===o[i]&&(o[i]=l[i]);return{$$typeof:n,type:e,key:s,ref:a,props:o,_owner:S.current}}function I(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var T=/\/+/g;function R(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function C(e,t,i,o,s){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l=!1;if(null===e)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case n:case r:l=!0}}if(l)return s=s(l=e),e=""===o?"."+R(l,0):o,E(s)?(i="",null!=e&&(i=e.replace(T,"$&/")+"/"),C(s,t,i,"",(function(e){return e}))):null!=s&&(I(s)&&(s=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(s,i+(!s.key||l&&l.key===s.key?"":(""+s.key).replace(T,"$&/")+"/")+e)),t.push(s)),1;if(l=0,o=""===o?".":o+":",E(e))for(var c=0;c<e.length;c++){var u=o+R(a=e[c],c);l+=C(a,t,i,u,s)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(a=e.next()).done;)l+=C(a=a.value,t,i,u=o+R(a,c++),s);else if("object"===a)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function x(e,t,n){if(null==e)return e;var r=[],i=0;return C(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function P(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var D={current:null},N={transition:null},B={ReactCurrentDispatcher:D,ReactCurrentBatchConfig:N,ReactCurrentOwner:S};t.Children={map:x,forEach:function(e,t,n){x(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return x(e,(function(){t++})),t},toArray:function(e){return x(e,(function(e){return e}))||[]},only:function(e){if(!I(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=v,t.Fragment=i,t.Profiler=s,t.PureComponent=w,t.StrictMode=o,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=g({},e.props),o=e.key,s=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,a=S.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)_.call(t,c)&&!k.hasOwnProperty(c)&&(i[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)i.children=r;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:n,type:e.type,key:o,ref:s,props:i,_owner:a}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:a,_context:e},e.Consumer=e},t.createElement=A,t.createFactory=function(e){var t=A.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=I,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:P}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=N.transition;N.transition={};try{e()}finally{N.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return D.current.useCallback(e,t)},t.useContext=function(e){return D.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return D.current.useDeferredValue(e)},t.useEffect=function(e,t){return D.current.useEffect(e,t)},t.useId=function(){return D.current.useId()},t.useImperativeHandle=function(e,t,n){return D.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return D.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return D.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return D.current.useMemo(e,t)},t.useReducer=function(e,t,n){return D.current.useReducer(e,t,n)},t.useRef=function(e){return D.current.useRef(e)},t.useState=function(e){return D.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return D.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return D.current.useTransition()},t.version="18.2.0"},5043:(e,t,n)=>{"use strict";e.exports=n(4202)},579:(e,t,n)=>{"use strict";e.exports=n(1153)},6344:(e,t,n)=>{"use strict";const r=n(4988);class i{constructor(e,t,n){const i=this;this._started=r(),this._rescheduled=0,this._scheduled=t,this._args=n,this._triggered=!1,this._timerWrapper=()=>{i._rescheduled>0?(i._scheduled=i._rescheduled-(r()-i._started),i._schedule(i._scheduled)):(i._triggered=!0,e.apply(null,i._args))},this._timer=setTimeout(this._timerWrapper,t)}reschedule(e){e||(e=this._scheduled);const t=r();t+e-(this._started+this._scheduled)<0?(clearTimeout(this._timer),this._schedule(e)):this._triggered?this._schedule(e):(this._started=t,this._rescheduled=e)}_schedule(e){this._triggered=!1,this._started=r(),this._rescheduled=0,this._scheduled=e,this._timer=setTimeout(this._timerWrapper,e)}clear(){clearTimeout(this._timer)}}e.exports=function(){if("function"!==typeof arguments[0])throw new Error("callback needed");if("number"!==typeof arguments[1])throw new Error("timeout needed");let e;if(arguments.length>0){e=new Array(arguments.length-2);for(var t=0;t<e.length;t++)e[t]=arguments[t+2]}return new i(arguments[0],arguments[1],e)}},4988:e=>{"use strict";e.exports=function(){return Date.now()}},6845:(e,t,n)=>{e.exports=function(e,t,n){if("number"!==typeof t)throw new Error("second argument must be a Number");let i,o,s,a,l,c,u=!0;Array.isArray(e)?(i=[],s=o=e.length):(a=Object.keys(e),i={},s=o=a.length);function h(e){function t(){n&&n(e,i),n=null}u?r(t):t()}function d(t,n,r){if(i[t]=r,n&&(l=!0),0===--s||n)h(n);else if(!l&&c<o){let t;a?(t=a[c],c+=1,e[t]((function(e,n){d(t,e,n)}))):(t=c,c+=1,e[t]((function(e,n){d(t,e,n)})))}}c=t,s?a?a.some((function(n,r){return e[n]((function(e,t){d(n,e,t)})),r===t-1})):e.some((function(e,n){return e((function(e,t){d(n,e,t)})),n===t-1})):h(null);u=!1};const r=n(4275)},1287:(e,t,n)=>{"use strict";var r=n(3688),i=/[\/\?<>\\:\*\|"]/g,o=/[\x00-\x1f\x80-\x9f]/g,s=/^\.+$/,a=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,l=/[\. ]+$/;function c(e,t){if("string"!==typeof e)throw new Error("Input must be string");var n=e.replace(i,t).replace(o,t).replace(s,t).replace(a,t).replace(l,t);return r(n,255)}e.exports=function(e,t){var n=t&&t.replacement||"",r=c(e,n);return""===n?r:c(r,"")}},7234:(e,t)=>{"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<o(i,t)))break e;e[r]=t,e[n]=i,n=r}}function r(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,s=i>>>1;r<s;){var a=2*(r+1)-1,l=e[a],c=a+1,u=e[c];if(0>o(l,n))c<i&&0>o(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[a]=n,r=a);else{if(!(c<i&&0>o(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],h=1,d=null,f=3,p=!1,g=!1,y=!1,v="function"===typeof setTimeout?setTimeout:null,m="function"===typeof clearTimeout?clearTimeout:null,w="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=r(u);null!==t;){if(null===t.callback)i(u);else{if(!(t.startTime<=e))break;i(u),t.sortIndex=t.expirationTime,n(c,t)}t=r(u)}}function E(e){if(y=!1,b(e),!g)if(null!==r(c))g=!0,N(_);else{var t=r(u);null!==t&&B(E,t.startTime-e)}}function _(e,n){g=!1,y&&(y=!1,m(I),I=-1),p=!0;var o=f;try{for(b(n),d=r(c);null!==d&&(!(d.expirationTime>n)||e&&!C());){var s=d.callback;if("function"===typeof s){d.callback=null,f=d.priorityLevel;var a=s(d.expirationTime<=n);n=t.unstable_now(),"function"===typeof a?d.callback=a:d===r(c)&&i(c),b(n)}else i(c);d=r(c)}if(null!==d)var l=!0;else{var h=r(u);null!==h&&B(E,h.startTime-n),l=!1}return l}finally{d=null,f=o,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var S,k=!1,A=null,I=-1,T=5,R=-1;function C(){return!(t.unstable_now()-R<T)}function x(){if(null!==A){var e=t.unstable_now();R=e;var n=!0;try{n=A(!0,e)}finally{n?S():(k=!1,A=null)}}else k=!1}if("function"===typeof w)S=function(){w(x)};else if("undefined"!==typeof MessageChannel){var P=new MessageChannel,D=P.port2;P.port1.onmessage=x,S=function(){D.postMessage(null)}}else S=function(){v(x,0)};function N(e){A=e,k||(k=!0,S())}function B(e,n){I=v((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){g||p||(g=!0,N(_))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},t.unstable_scheduleCallback=function(e,i,o){var s=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?s+o:s:o=s,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:h++,callback:i,priorityLevel:e,startTime:o,expirationTime:a=o+a,sortIndex:-1},o>s?(e.sortIndex=o,n(u,e),null===r(c)&&e===r(u)&&(y?(m(I),I=-1):y=!0,B(E,o-s))):(e.sortIndex=a,n(c,e),g||p||(g=!0,N(_))),e},t.unstable_shouldYield=C,t.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}},8853:(e,t,n)=>{"use strict";e.exports=n(7234)},3836:e=>{"use strict";function t(e,t){return e+n(t)}function n(e){let t=e;return t-=t>>1&1431655765,t=(858993459&t)+(t>>2&858993459),16843009*(t+(t>>4)&252645135)>>24}function r(e,t){return e[0]-t[0]}function i(e){return e[1]}e.exports=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(e,t){let n=this._internalPositionFor(e,!1);if(void 0===t)-1!==n&&(this._unsetInternalPos(n),this._unsetBit(e),this._changedLength=!0,this._changedData=!0);else{let r=!1;-1===n?(n=this._data.length,this._setBit(e),this._changedData=!0):r=!0,this._setInternalPos(n,e,t,r),this._changedLength=!0}}unset(e){this.set(e,void 0)}get(e){this._sortData();const t=this._internalPositionFor(e,!0);if(-1!==t)return this._data[t][1]}push(e){return this.set(this.length,e),this.length}get length(){if(this._sortData(),this._changedLength){const e=this._data[this._data.length-1];this._length=e?e[0]+1:0,this._changedLength=!1}return this._length}forEach(e){let t=0;for(;t<this.length;)e(this.get(t),t,this),t++}map(e){let t=0,n=new Array(this.length);for(;t<this.length;)n[t]=e(this.get(t),t,this),t++;return n}reduce(e,t){let n=0,r=t;for(;n<this.length;){r=e(r,this.get(n),n),n++}return r}find(e){let t,n,r=0;for(;r<this.length&&!t;)n=this.get(r),t=e(n),r++;return t?n:void 0}_internalPositionFor(e,r){const i=this._bytePosFor(e,r);if(i>=this._bitArrays.length)return-1;const o=this._bitArrays[i],s=e-7*i;if(!((o&1<<s)>0))return-1;return this._bitArrays.slice(0,i).reduce(t,0)+n(o&~(4294967295<<s+1))-1}_bytePosFor(e,t){const n=Math.floor(e/7),r=n+1;for(;!t&&this._bitArrays.length<r;)this._bitArrays.push(0);return n}_setBit(e){const t=this._bytePosFor(e,!1);this._bitArrays[t]|=1<<e-7*t}_unsetBit(e){const t=this._bytePosFor(e,!1);this._bitArrays[t]&=~(1<<e-7*t)}_setInternalPos(e,t,n,r){const i=this._data,o=[t,n];if(r)this._sortData(),i[e]=o;else{if(i.length)if(i[i.length-1][0]>=t)i.push(o);else if(i[0][0]<=t)i.unshift(o);else{const e=Math.round(i.length/2);this._data=i.slice(0,e).concat(o).concat(i.slice(e))}else this._data.push(o);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(e){this._data.splice(e,1)}_sortData(){this._changedData&&this._data.sort(r),this._changedData=!1}bitField(){const e=[];let t,n=8,r=0,i=0;const o=this._bitArrays.slice();for(;o.length||r;){0===r&&(t=o.shift(),r=7);const s=Math.min(r,n);i|=(t&~(255<<s))<<8-n,t>>>=s,r-=s,n-=s,n&&(r||o.length)||(e.push(i),i=0,n=8)}for(var s=e.length-1;s>0;s--){if(0!==e[s])break;e.pop()}return e}compactArray(){return this._sortData(),this._data.map(i)}}},2947:(e,t,n)=>{"use strict";const{AbortController:r}=globalThis,i=n(6344);class o extends r{constructor(e){super(),this._ms=e,this._timer=i((()=>this.abort()),e),Object.setPrototypeOf(this,o.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=i((()=>this.abort()),this._ms)}}e.exports={TimeoutController:o}},3688:(e,t,n)=>{"use strict";var r=n(3748),i=n(6651);e.exports=r.bind(null,i)},3748:e=>{"use strict";function t(e){return e>=55296&&e<=56319}function n(e){return e>=56320&&e<=57343}e.exports=function(e,r,i){if("string"!==typeof r)throw new Error("Input must be string");for(var o,s,a=r.length,l=0,c=0;c<a;c+=1){if(o=r.charCodeAt(c),s=r[c],t(o)&&n(r.charCodeAt(c+1))&&(s+=r[c+=1]),(l+=e(s))===i)return r.slice(0,c+1);if(l>i)return r.slice(0,c-s.length+1)}return r}},5956:(e,t,n)=>{"use strict";var r=n(5043);var i="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},o=r.useState,s=r.useEffect,a=r.useLayoutEffect,l=r.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!i(e,n)}catch(r){return!0}}var u="undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),r=o({inst:{value:n,getSnapshot:t}}),i=r[0].inst,u=r[1];return a((function(){i.value=n,i.getSnapshot=t,c(i)&&u({inst:i})}),[e,n,t]),s((function(){return c(i)&&u({inst:i}),e((function(){c(i)&&u({inst:i})}))}),[e]),l(n),n};t.useSyncExternalStore=void 0!==r.useSyncExternalStore?r.useSyncExternalStore:u},9461:(e,t,n)=>{"use strict";e.exports=n(5956)},6651:e=>{"use strict";function t(e){return e>=55296&&e<=56319}function n(e){return e>=56320&&e<=57343}e.exports=function(e){if("string"!==typeof e)throw new Error("Input must be string");for(var r=e.length,i=0,o=null,s=null,a=0;a<r;a++)n(o=e.charCodeAt(a))?null!=s&&t(s)?i+=1:i+=3:o<=127?i+=1:o>=128&&o<=2047?i+=2:o>=2048&&o<=65535&&(i+=3),s=o;return i}},7531:e=>{e.exports=function e(r,i){var o,s=0,a=0,l=i=i||0,c=r.length;do{if(l>=c)throw e.bytes=0,new RangeError("Could not decode varint");o=r[l++],s+=a<28?(o&n)<<a:(o&n)*Math.pow(2,a),a+=7}while(o>=t);return e.bytes=l-i,s};var t=128,n=127},3543:e=>{e.exports=function e(i,o,s){o=o||[];var a=s=s||0;for(;i>=r;)o[s++]=255&i|t,i/=128;for(;i&n;)o[s++]=255&i|t,i>>>=7;return o[s]=0|i,e.bytes=s-a+1,o};var t=128,n=-128,r=Math.pow(2,31)},6297:(e,t,n)=>{e.exports={encode:n(3543),decode:n(7531),encodingLength:n(449)}},449:e=>{var t=Math.pow(2,7),n=Math.pow(2,14),r=Math.pow(2,21),i=Math.pow(2,28),o=Math.pow(2,35),s=Math.pow(2,42),a=Math.pow(2,49),l=Math.pow(2,56),c=Math.pow(2,63);e.exports=function(e){return e<t?1:e<n?2:e<r?3:e<i?4:e<o?5:e<s?6:e<a?7:e<l?8:e<c?9:10}},2370:(e,t,n)=>{"use strict";const r=n(6297);e.exports=e=>{if(!(e instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");const t=[];for(;e.length>0;){const n=r.decode(e);t.push(n),e=e.slice(r.decode.bytes)}return t}},1170:e=>{e.exports=function e(r,i){var o,s=0,a=0,l=i=i||0,c=r.length;do{if(l>=c||a>49)throw e.bytes=0,new RangeError("Could not decode varint");o=r[l++],s+=a<28?(o&n)<<a:(o&n)*Math.pow(2,a),a+=7}while(o>=t);return e.bytes=l-i,s};var t=128,n=127},2070:e=>{e.exports=function e(i,o,s){if(Number.MAX_SAFE_INTEGER&&i>Number.MAX_SAFE_INTEGER)throw e.bytes=0,new RangeError("Could not encode varint");o=o||[];var a=s=s||0;for(;i>=r;)o[s++]=255&i|t,i/=128;for(;i&n;)o[s++]=255&i|t,i>>>=7;return o[s]=0|i,e.bytes=s-a+1,o};var t=128,n=-128,r=Math.pow(2,31)},1870:(e,t,n)=>{e.exports={encode:n(2070),decode:n(1170),encodingLength:n(940)}},940:e=>{var t=Math.pow(2,7),n=Math.pow(2,14),r=Math.pow(2,21),i=Math.pow(2,28),o=Math.pow(2,35),s=Math.pow(2,42),a=Math.pow(2,49),l=Math.pow(2,56),c=Math.pow(2,63);e.exports=function(e){return e<t?1:e<n?2:e<r?3:e<i?4:e<o?5:e<s?6:e<a?7:e<l?8:e<c?9:10}},9712:()=>{},310:()=>{},7353:e=>{!function(){e.exports=y;var t=86400,n=3200,r=146097*n/400,i=t*r,o=1e3*i,s=864e13,a=4294967296,l=1e6,c="000000000",u=Math.trunc||function(e){var t=e-e%1;return 0==t&&(e<0||0===e&&1/e!=1/0)?-0:t},h=y.prototype,d=(y.fromDate=function(e){return new y(+e)},y.fromInt64BE=E(0,1,2,3,0,4),y.fromInt64LE=E(3,2,1,0,4,0),y.fromString=function(e){var t,n=new y;e=(e+="").replace(/^\s*[+\-]?\d+/,(function(e){var t=1970+((e=+e)-1970)%400;return n.year=e-t,t})).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,(function(e,n,r){return n<0&&(r*=-1),t=6e4*(60*+n+ +r),""})).replace(/\.\d+$/,(function(e){return n.nano=+(e+c).substr(1,9),""})).split(/\D+/);if(1<e.length?e[1]--:e[1]=0,n.time=t=Date.UTC.apply(Date,e)-(t||0),isNaN(t))throw new TypeError("Invalid Date");return v(n)},y.fromTimeT=function(e){return w(e,0)},h.year=0,h.time=0,h.nano=0,h.addNano=function(e){return this.nano+=+e||0,this},h.getNano=function(){var e=v(this);return(e.time%1e3*l+ +e.nano+1e9)%1e9},h.getTimeT=function(){var e=v(this),i=Math.floor(e.time/1e3);return(e=e.year)&&(i+=e*r*t/n),i},h.getYear=function(){return this.toDate().getUTCFullYear()+this.year},h.toDate=function(){return m(v(this).time)},h.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},h.toString=function(e){var t=this,n=t.toDate(),r={H:function(){return S(n.getUTCHours())},L:function(){return k(n.getUTCMilliseconds(),3)},M:function(){return S(n.getUTCMinutes())},N:function(){return k(t.getNano(),9)},S:function(){return S(n.getUTCSeconds())},Y:function(){var e=t.getYear();return 999999<e?"+"+e:9999<e?"+"+k(e,6):0<=e?k(e,4):-999999<=e?"-"+k(-e,6):e},a:function(){return p[n.getUTCDay()]},b:function(){return f[n.getUTCMonth()]},d:function(){return S(n.getUTCDate())},e:function(){return function(e){return(9<e?"":" ")+(0|e)}(n.getUTCDate())},m:function(){return S(n.getUTCMonth()+1)}};return function e(t){return t.replace(/%./g,(function(t){var n=t[1],i=g[n];n=r[n];return i?e(i):n?n():t}))}(e||d)},h.writeInt64BE=b(0,1,2,3,0,4),h.writeInt64LE=b(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),f=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],p=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],g={"%":"%",F:"%Y-%m-%d",n:"\n",R:"%H:%M",T:"%H:%M:%S",t:"\t",X:"%T",Z:"GMT",z:"+0000"};return y;function y(e,t,n){var r=this;if(!(r instanceof y))return new y(e,t,n);r.time=+e||0,r.nano=+t||0,r.year=+n||0,v(r)}function v(e){var t,r,i,a=e.year,c=e.time,h=e.nano,d=((h<0||l<=h)&&(h-=(r=Math.floor(h/l))*l,c+=r,r=1),a%n);return(c<-s||s<c||d)&&((t=u(c/o))&&(a+=t*n,c-=t*o),(i=m(c)).setUTCFullYear(d+i.getUTCFullYear()),i=(c=+i)+(t=u((a-=d)/n))*o,t&&-s<=i&&i<=s&&(a-=t*n,c=i),r=1),r&&(e.year=a,e.time=c,e.nano=h),e}function m(e){var t=new Date(0);return t.setTime(e),t}function w(e,t){e=+e||0;var r=u((t=(0|t)*a)/i)+u(e/i);return(e=u((t=t%i+e%i)/i))&&(r+=e,t-=e*i),new y(1e3*t,0,r*n)}function b(e,i,o,s,l,c){return function(e,i){var o=v(this);_(e=e||new Array(8),i|=0);var s=Math.floor(o.time/1e3),d=(o=o.year*(r*t/n),u(o/a)+u(s/a));o=o%a+s%a;return(s=Math.floor(o/a))&&(d+=s,o-=s*a),h(e,i+l,d),h(e,i+c,o),e};function h(t,n,r){t[n+e]=r>>24&255,t[n+i]=r>>16&255,t[n+o]=r>>8&255,t[n+s]=255&r}}function E(e,t,n,r,i,o){return function(e,t){_(e,t|=0);var n=s(e,t+i);return w(s(e,t+o),n)};function s(i,o){return 16777216*i[o+e]+(i[o+t]<<16|i[o+n]<<8|i[o+r])}}function _(e,t){if(null==(e=e&&e.length))throw new TypeError("Invalid Buffer");if(e<t+8)throw new RangeError("Out of range")}function S(e){return(9<e?"":"0")+(0|e)}function k(e,t){return(c+(0|e)).substr(-t)}}()},6260:(e,t,n)=>{"use strict";n.d(t,{K:()=>i});var r=n(8320);function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?(0,r.o)(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}},17:(e,t,n)=>{"use strict";n.r(t),n.d(t,{concat:()=>o});var r=n(6260),i=n(8320);function o(e,t){t||(t=e.reduce(((e,t)=>e+t.length),0));const n=(0,r.K)(t);let o=0;for(const r of e)n.set(r,o),o+=r.length;return(0,i.o)(n)}},223:(e,t,n)=>{"use strict";n.r(t),n.d(t,{fromString:()=>o});var r=n(9673),i=n(8320);function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";const n=r.A[t];if(!n)throw new Error('Unsupported encoding "'.concat(t,'"'));return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?n.decoder.decode("".concat(n.prefix).concat(e)):(0,i.o)(globalThis.Buffer.from(e,"utf-8"))}},6232:(e,t,n)=>{"use strict";n.r(t),n.d(t,{toString:()=>i});var r=n(9673);function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";const n=r.A[t];if(!n)throw new Error('Unsupported encoding "'.concat(t,'"'));return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?n.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}},8320:(e,t,n)=>{"use strict";function r(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}n.d(t,{o:()=>r})},9673:(e,t,n)=>{"use strict";n.d(t,{A:()=>He});var r={};n.r(r),n.d(r,{identity:()=>R});var i={};n.r(i),n.d(i,{base2:()=>C});var o={};n.r(o),n.d(o,{base8:()=>x});var s={};n.r(s),n.d(s,{base10:()=>P});var a={};n.r(a),n.d(a,{base16:()=>D,base16upper:()=>N});var l={};n.r(l),n.d(l,{base32:()=>B,base32hex:()=>U,base32hexpad:()=>V,base32hexpadupper:()=>z,base32hexupper:()=>F,base32pad:()=>O,base32padupper:()=>M,base32upper:()=>L,base32z:()=>K});var c={};n.r(c),n.d(c,{base36:()=>j,base36upper:()=>H});var u={};n.r(u),n.d(u,{base58btc:()=>q,base58flickr:()=>W});var h={};n.r(h),n.d(h,{base64:()=>G,base64pad:()=>Y,base64url:()=>Q,base64urlpad:()=>X});var d={};n.r(d),n.d(d,{base256emoji:()=>ee});var f={};n.r(f),n.d(f,{sha256:()=>Ae,sha512:()=>Ie});var p={};n.r(p),n.d(p,{identity:()=>Re});var g={};n.r(g),n.d(g,{code:()=>xe,decode:()=>De,encode:()=>Pe,name:()=>Ce});var y={};n.r(y),n.d(y,{code:()=>Oe,decode:()=>Ue,encode:()=>Me,name:()=>Le});var v=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var o=e.charAt(i),s=o.charCodeAt(0);if(255!==n[s])throw new TypeError(o+" is ambiguous");n[s]=i}var a=e.length,l=e.charAt(0),c=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if("string"!==typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var r=0,i=0;e[t]===l;)r++,t++;for(var o=(e.length-t)*c+1>>>0,s=new Uint8Array(o);e[t];){var u=n[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=o-1;(0!==u||h<i)&&-1!==d;d--,h++)u+=a*s[d]>>>0,s[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=o-i;f!==o&&0===s[f];)f++;for(var p=new Uint8Array(r+(o-f)),g=r;f!==o;)p[g++]=s[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,i=0,o=t.length;i!==o&&0===t[i];)i++,n++;for(var s=(o-i)*u+1>>>0,c=new Uint8Array(s);i!==o;){for(var h=t[i],d=0,f=s-1;(0!==h||d<r)&&-1!==f;f--,d++)h+=256*c[f]>>>0,c[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");r=d,i++}for(var p=s-r;p!==s&&0===c[p];)p++;for(var g=l.repeat(n);p<s;++p)g+=e.charAt(c[p]);return g},decodeUnsafe:h,decode:function(e){var n=h(e);if(n)return n;throw new Error("Non-".concat(t," character"))}}};const m=v,w=(new Uint8Array(0),e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")});class b{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return"".concat(this.prefix).concat(this.baseEncode(e));throw Error("Unknown type, must be binary type")}}class E{constructor(e,t,n){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if("string"===typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error("Unable to decode multibase string ".concat(JSON.stringify(e),", ").concat(this.name," decoder only supports inputs prefixed with ").concat(this.prefix));return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return S(this,e)}}class _{constructor(e){this.decoders=e}or(e){return S(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError("Unable to decode multibase string ".concat(JSON.stringify(e),", only inputs prefixed with ").concat(Object.keys(this.decoders)," are supported"))}}const S=(e,t)=>new _({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class k{constructor(e,t,n,r){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new b(e,t,n),this.decoder=new E(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const A=e=>{let{name:t,prefix:n,encode:r,decode:i}=e;return new k(t,n,r,i)},I=e=>{let{prefix:t,name:n,alphabet:r}=e;const{encode:i,decode:o}=m(r,n);return A({prefix:t,name:n,encode:i,decode:e=>w(o(e))})},T=e=>{let{name:t,prefix:n,bitsPerChar:r,alphabet:i}=e;return A({prefix:n,name:t,encode:e=>((e,t,n)=>{const r="="===t[t.length-1],i=(1<<n)-1;let o="",s=0,a=0;for(let l=0;l<e.length;++l)for(a=a<<8|e[l],s+=8;s>n;)s-=n,o+=t[i&a>>s];if(s&&(o+=t[i&a<<n-s]),r)for(;o.length*n&7;)o+="=";return o})(e,i,r),decode:e=>((e,t,n,r)=>{const i={};for(let u=0;u<t.length;++u)i[t[u]]=u;let o=e.length;for(;"="===e[o-1];)--o;const s=new Uint8Array(o*n/8|0);let a=0,l=0,c=0;for(let u=0;u<o;++u){const t=i[e[u]];if(void 0===t)throw new SyntaxError("Non-".concat(r," character"));l=l<<n|t,a+=n,a>=8&&(a-=8,s[c++]=255&l>>a)}if(a>=n||255&l<<8-a)throw new SyntaxError("Unexpected end of data");return s})(e,i,r,t)})},R=A({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>(e=>(new TextEncoder).encode(e))(e)}),C=T({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),x=T({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),P=I({prefix:"9",name:"base10",alphabet:"0123456789"}),D=T({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),N=T({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),B=T({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),L=T({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),O=T({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),M=T({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),U=T({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),F=T({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),V=T({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),z=T({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),K=T({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),j=I({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),H=I({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),q=I({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),W=I({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),G=T({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Y=T({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Q=T({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),X=T({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),J=Array.from("\ud83d\ude80\ud83e\ude90\u2604\ud83d\udef0\ud83c\udf0c\ud83c\udf11\ud83c\udf12\ud83c\udf13\ud83c\udf14\ud83c\udf15\ud83c\udf16\ud83c\udf17\ud83c\udf18\ud83c\udf0d\ud83c\udf0f\ud83c\udf0e\ud83d\udc09\u2600\ud83d\udcbb\ud83d\udda5\ud83d\udcbe\ud83d\udcbf\ud83d\ude02\u2764\ud83d\ude0d\ud83e\udd23\ud83d\ude0a\ud83d\ude4f\ud83d\udc95\ud83d\ude2d\ud83d\ude18\ud83d\udc4d\ud83d\ude05\ud83d\udc4f\ud83d\ude01\ud83d\udd25\ud83e\udd70\ud83d\udc94\ud83d\udc96\ud83d\udc99\ud83d\ude22\ud83e\udd14\ud83d\ude06\ud83d\ude44\ud83d\udcaa\ud83d\ude09\u263a\ud83d\udc4c\ud83e\udd17\ud83d\udc9c\ud83d\ude14\ud83d\ude0e\ud83d\ude07\ud83c\udf39\ud83e\udd26\ud83c\udf89\ud83d\udc9e\u270c\u2728\ud83e\udd37\ud83d\ude31\ud83d\ude0c\ud83c\udf38\ud83d\ude4c\ud83d\ude0b\ud83d\udc97\ud83d\udc9a\ud83d\ude0f\ud83d\udc9b\ud83d\ude42\ud83d\udc93\ud83e\udd29\ud83d\ude04\ud83d\ude00\ud83d\udda4\ud83d\ude03\ud83d\udcaf\ud83d\ude48\ud83d\udc47\ud83c\udfb6\ud83d\ude12\ud83e\udd2d\u2763\ud83d\ude1c\ud83d\udc8b\ud83d\udc40\ud83d\ude2a\ud83d\ude11\ud83d\udca5\ud83d\ude4b\ud83d\ude1e\ud83d\ude29\ud83d\ude21\ud83e\udd2a\ud83d\udc4a\ud83e\udd73\ud83d\ude25\ud83e\udd24\ud83d\udc49\ud83d\udc83\ud83d\ude33\u270b\ud83d\ude1a\ud83d\ude1d\ud83d\ude34\ud83c\udf1f\ud83d\ude2c\ud83d\ude43\ud83c\udf40\ud83c\udf37\ud83d\ude3b\ud83d\ude13\u2b50\u2705\ud83e\udd7a\ud83c\udf08\ud83d\ude08\ud83e\udd18\ud83d\udca6\u2714\ud83d\ude23\ud83c\udfc3\ud83d\udc90\u2639\ud83c\udf8a\ud83d\udc98\ud83d\ude20\u261d\ud83d\ude15\ud83c\udf3a\ud83c\udf82\ud83c\udf3b\ud83d\ude10\ud83d\udd95\ud83d\udc9d\ud83d\ude4a\ud83d\ude39\ud83d\udde3\ud83d\udcab\ud83d\udc80\ud83d\udc51\ud83c\udfb5\ud83e\udd1e\ud83d\ude1b\ud83d\udd34\ud83d\ude24\ud83c\udf3c\ud83d\ude2b\u26bd\ud83e\udd19\u2615\ud83c\udfc6\ud83e\udd2b\ud83d\udc48\ud83d\ude2e\ud83d\ude46\ud83c\udf7b\ud83c\udf43\ud83d\udc36\ud83d\udc81\ud83d\ude32\ud83c\udf3f\ud83e\udde1\ud83c\udf81\u26a1\ud83c\udf1e\ud83c\udf88\u274c\u270a\ud83d\udc4b\ud83d\ude30\ud83e\udd28\ud83d\ude36\ud83e\udd1d\ud83d\udeb6\ud83d\udcb0\ud83c\udf53\ud83d\udca2\ud83e\udd1f\ud83d\ude41\ud83d\udea8\ud83d\udca8\ud83e\udd2c\u2708\ud83c\udf80\ud83c\udf7a\ud83e\udd13\ud83d\ude19\ud83d\udc9f\ud83c\udf31\ud83d\ude16\ud83d\udc76\ud83e\udd74\u25b6\u27a1\u2753\ud83d\udc8e\ud83d\udcb8\u2b07\ud83d\ude28\ud83c\udf1a\ud83e\udd8b\ud83d\ude37\ud83d\udd7a\u26a0\ud83d\ude45\ud83d\ude1f\ud83d\ude35\ud83d\udc4e\ud83e\udd32\ud83e\udd20\ud83e\udd27\ud83d\udccc\ud83d\udd35\ud83d\udc85\ud83e\uddd0\ud83d\udc3e\ud83c\udf52\ud83d\ude17\ud83e\udd11\ud83c\udf0a\ud83e\udd2f\ud83d\udc37\u260e\ud83d\udca7\ud83d\ude2f\ud83d\udc86\ud83d\udc46\ud83c\udfa4\ud83d\ude47\ud83c\udf51\u2744\ud83c\udf34\ud83d\udca3\ud83d\udc38\ud83d\udc8c\ud83d\udccd\ud83e\udd40\ud83e\udd22\ud83d\udc45\ud83d\udca1\ud83d\udca9\ud83d\udc50\ud83d\udcf8\ud83d\udc7b\ud83e\udd10\ud83e\udd2e\ud83c\udfbc\ud83e\udd75\ud83d\udea9\ud83c\udf4e\ud83c\udf4a\ud83d\udc7c\ud83d\udc8d\ud83d\udce3\ud83e\udd42"),$=J.reduce(((e,t,n)=>(e[n]=t,e)),[]),Z=J.reduce(((e,t,n)=>(e[t.codePointAt(0)]=n,e)),[]);const ee=A({prefix:"\ud83d\ude80",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=$[t]),"")},decode:function(e){const t=[];for(const n of e){const e=Z[n.codePointAt(0)];if(void 0===e)throw new Error("Non-base256emoji character: ".concat(n));t.push(e)}return new Uint8Array(t)}});var te=function e(t,n,r){n=n||[];var i=r=r||0;for(;t>=ie;)n[r++]=255&t|ne,t/=128;for(;t&re;)n[r++]=255&t|ne,t>>>=7;return n[r]=0|t,e.bytes=r-i+1,n},ne=128,re=-128,ie=Math.pow(2,31);var oe=function e(t,n){var r,i=0,o=0,s=n=n||0,a=t.length;do{if(s>=a)throw e.bytes=0,new RangeError("Could not decode varint");r=t[s++],i+=o<28?(r&ae)<<o:(r&ae)*Math.pow(2,o),o+=7}while(r>=se);return e.bytes=s-n,i},se=128,ae=127;var le=Math.pow(2,7),ce=Math.pow(2,14),ue=Math.pow(2,21),he=Math.pow(2,28),de=Math.pow(2,35),fe=Math.pow(2,42),pe=Math.pow(2,49),ge=Math.pow(2,56),ye=Math.pow(2,63);const ve={encode:te,decode:oe,encodingLength:function(e){return e<le?1:e<ce?2:e<ue?3:e<he?4:e<de?5:e<fe?6:e<pe?7:e<ge?8:e<ye?9:10}},me=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return ve.encode(e,t,n),t},we=e=>ve.encodingLength(e),be=(e,t)=>{const n=t.byteLength,r=we(e),i=r+we(n),o=new Uint8Array(i+n);return me(e,o,0),me(n,o,r),o.set(t,i),new Ee(e,n,t,o)};class Ee{constructor(e,t,n,r){this.code=e,this.size=t,this.digest=n,this.bytes=r}}const _e=e=>{let{name:t,code:n,encode:r}=e;return new Se(t,n,r)};class Se{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?be(this.code,t):t.then((e=>be(this.code,e)))}throw Error("Unknown type, must be binary type")}}const ke=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),Ae=_e({name:"sha2-256",code:18,encode:ke("SHA-256")}),Ie=_e({name:"sha2-512",code:19,encode:ke("SHA-512")}),Te=w,Re={code:0,name:"identity",encode:Te,digest:e=>be(0,Te(e))},Ce="raw",xe=85,Pe=e=>w(e),De=e=>w(e),Ne=new TextEncoder,Be=new TextDecoder,Le="json",Oe=512,Me=e=>Ne.encode(JSON.stringify(e)),Ue=e=>JSON.parse(Be.decode(e));Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom");Symbol.for("@ipld/js-cid/CID");const Fe={...r,...i,...o,...s,...a,...l,...c,...u,...h,...d};var Ve=n(6260);function ze(e,t,n,r){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:n},decoder:{decode:r}}}const Ke=ze("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),je=ze("ascii","a",(e=>{let t="a";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}),(e=>{e=e.substring(1);const t=(0,Ve.K)(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t})),He={utf8:Ke,"utf-8":Ke,hex:Fe.base16,latin1:je,ascii:je,binary:je,...Fe}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r].call(o.exports,o,o.exports,n),o.exports}n.m=e,(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;n.t=function(r,i){if(1&i&&(r=this(r)),8&i)return r;if("object"===typeof r&&r){if(4&i&&r.__esModule)return r;if(16&i&&"function"===typeof r.then)return r}var o=Object.create(null);n.r(o);var s={};e=e||[null,t({}),t([]),t(t)];for(var a=2&i&&r;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>s[e]=()=>r[e]));return s.default=()=>r,n.d(o,s),o}})(),n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((t,r)=>(n.f[r](e,t),t)),[])),n.u=e=>"static/js/"+e+".806c8a16.chunk.js",n.miniCssF=e=>{},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="web3-workshop:";n.l=(r,i,o,s)=>{if(e[r])e[r].push(i);else{var a,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==r||h.getAttribute("data-webpack")==t+o){a=h;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",t+o),a.src=r),e[r]=[i];var d=(t,n)=>{a.onerror=a.onload=null,clearTimeout(f);var i=e[r];if(delete e[r],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((e=>e(n))),t)return t(n)},f=setTimeout(d.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=d.bind(null,a.onerror),a.onload=d.bind(null,a.onload),l&&document.head.appendChild(a)}}})(),n.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="/",(()=>{var e={792:0};n.f.j=(t,r)=>{var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)r.push(i[2]);else{var o=new Promise(((n,r)=>i=e[t]=[n,r]));r.push(i[2]=o);var s=n.p+n.u(t),a=new Error;n.l(s,(r=>{if(n.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var o=r&&("load"===r.type?"missing":r.type),s=r&&r.target&&r.target.src;a.message="Loading chunk "+t+" failed.\n("+o+": "+s+")",a.name="ChunkLoadError",a.type=o,a.request=s,i[1](a)}}),"chunk-"+t,t)}};var t=(t,r)=>{var i,o,s=r[0],a=r[1],l=r[2],c=0;if(s.some((t=>0!==e[t]))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(l)l(n)}for(t&&t(r);c<s.length;c++)o=s[c],n.o(e,o)&&e[o]&&e[o][0](),e[o]=0},r=self.webpackChunkweb3_workshop=self.webpackChunkweb3_workshop||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),(()=>{"use strict";var e={};n.r(e),n.d(e,{abortedError:()=>Ze,closeFailedError:()=>Ge,deleteFailedError:()=>Xe,getFailedError:()=>Qe,hasFailedError:()=>Je,notFoundError:()=>$e,openFailedError:()=>We,putFailedError:()=>Ye});var t={};n.r(t),n.d(t,{base32:()=>pt,base32hex:()=>mt,base32hexpad:()=>bt,base32hexpadupper:()=>Et,base32hexupper:()=>wt,base32pad:()=>yt,base32padupper:()=>vt,base32upper:()=>gt,base32z:()=>_t});var r={};n.r(r),n.d(r,{base58btc:()=>St,base58flickr:()=>kt});var i={};n.r(i),n.d(i,{code:()=>rn,decode:()=>sn,encode:()=>on,name:()=>nn});var o={};n.r(o),n.d(o,{base64:()=>cn,base64pad:()=>un,base64url:()=>hn,base64urlpad:()=>dn});var s={};n.r(s),n.d(s,{base10:()=>Un});var a={};n.r(a),n.d(a,{base16:()=>Fn,base16upper:()=>Vn});var l={};n.r(l),n.d(l,{base2:()=>zn});var c={};n.r(c),n.d(c,{base256emoji:()=>qn});var u={};n.r(u),n.d(u,{base36:()=>Wn,base36upper:()=>Gn});var h={};n.r(h),n.d(h,{base8:()=>Yn});var d={};n.r(d),n.d(d,{identity:()=>Qn});var f={};n.r(f),n.d(f,{code:()=>Zn,decode:()=>tr,encode:()=>er,name:()=>$n});var p={};n.r(p),n.d(p,{identity:()=>rr});var g={};n.r(g),n.d(g,{sha256:()=>ar,sha512:()=>lr});var y={};n.r(y),n.d(y,{DO:()=>Ti,OG:()=>Vi,My:()=>Ci,bytesToNumberBE:()=>Bi,lX:()=>Li,Id:()=>Fi,fg:()=>ji,qj:()=>Ui,hexToBytes:()=>Ni,aY:()=>Ii,lq:()=>Oi,z:()=>Mi,Q5:()=>qi});var v={};n.r(v),n.d(v,{Ed25519PrivateKey:()=>Js,Ed25519PublicKey:()=>Xs,generateKeyPair:()=>ea,generateKeyPairFromSeed:()=>ta,unmarshalEd25519PrivateKey:()=>$s,unmarshalEd25519PublicKey:()=>Zs});var m={};n.r(m),n.d(m,{MAX_RSA_KEY_SIZE:()=>Ic,RsaPrivateKey:()=>Rc,RsaPublicKey:()=>Tc,fromJwk:()=>Pc,generateKeyPair:()=>Dc,unmarshalRsaPrivateKey:()=>Cc,unmarshalRsaPublicKey:()=>xc});var w={};n.r(w),n.d(w,{Secp256k1PrivateKey:()=>ru,Secp256k1PublicKey:()=>nu,generateKeyPair:()=>su,unmarshalSecp256k1PrivateKey:()=>iu,unmarshalSecp256k1PublicKey:()=>ou});var b={};n.r(b),n.d(b,{code:()=>zm,decode:()=>jm,decodeOptions:()=>Fm,encode:()=>Km,encodeOptions:()=>Mm,name:()=>Vm,toByteView:()=>Lm});var E={};n.r(E),n.d(E,{code:()=>Ew,createLink:()=>ww,createNode:()=>mw,decode:()=>Sw,encode:()=>_w,name:()=>bw,prepare:()=>yw,validate:()=>vw});var _={};n.r(_),n.d(_,{Ed25519PrivateKey:()=>eL,Ed25519PublicKey:()=>ZB,generateKeyPair:()=>rL,generateKeyPairFromSeed:()=>iL,unmarshalEd25519PrivateKey:()=>tL,unmarshalEd25519PublicKey:()=>nL});var S={};n.r(S),n.d(S,{MAX_KEY_SIZE:()=>fL,RsaPrivateKey:()=>gL,RsaPublicKey:()=>pL,fromJwk:()=>mL,generateKeyPair:()=>wL,unmarshalRsaPrivateKey:()=>yL,unmarshalRsaPublicKey:()=>vL});var k={};n.r(k),n.d(k,{Secp256k1PrivateKey:()=>_L,Secp256k1PublicKey:()=>EL,generateKeyPair:()=>AL,unmarshalSecp256k1PrivateKey:()=>SL,unmarshalSecp256k1PublicKey:()=>kL});var A,I=n(5043),T=n.t(I,2),R=n(4391);function C(){return C=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},C.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(A||(A={}));const x="popstate";function P(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function D(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function N(e,t){return{usr:e.state,key:e.key,idx:t}}function B(e,t,n,r){return void 0===n&&(n=null),C({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?O(t):t,{state:n,key:t&&t.key||r||Math.random().toString(36).substr(2,8)})}function L(e){let{pathname:t="/",search:n="",hash:r=""}=e;return n&&"?"!==n&&(t+="?"===n.charAt(0)?n:"?"+n),r&&"#"!==r&&(t+="#"===r.charAt(0)?r:"#"+r),t}function O(e){let t={};if(e){let n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));let r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function M(e,t,n,r){void 0===r&&(r={});let{window:i=document.defaultView,v5Compat:o=!1}=r,s=i.history,a=A.Pop,l=null,c=u();function u(){return(s.state||{idx:null}).idx}function h(){a=A.Pop;let e=u(),t=null==e?null:e-c;c=e,l&&l({action:a,location:f.location,delta:t})}function d(e){let t="null"!==i.location.origin?i.location.origin:i.location.href,n="string"===typeof e?e:L(e);return n=n.replace(/ $/,"%20"),P(t,"No window.location.(origin|href) available to create URL for href: "+n),new URL(n,t)}null==c&&(c=0,s.replaceState(C({},s.state,{idx:c}),""));let f={get action(){return a},get location(){return e(i,s)},listen(e){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(x,h),l=e,()=>{i.removeEventListener(x,h),l=null}},createHref:e=>t(i,e),createURL:d,encodeLocation(e){let t=d(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){a=A.Push;let r=B(f.location,e,t);n&&n(r,e),c=u()+1;let h=N(r,c),d=f.createHref(r);try{s.pushState(h,"",d)}catch(p){if(p instanceof DOMException&&"DataCloneError"===p.name)throw p;i.location.assign(d)}o&&l&&l({action:a,location:f.location,delta:1})},replace:function(e,t){a=A.Replace;let r=B(f.location,e,t);n&&n(r,e),c=u();let i=N(r,c),h=f.createHref(r);s.replaceState(i,"",h),o&&l&&l({action:a,location:f.location,delta:0})},go:e=>s.go(e)};return f}var U;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(U||(U={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function F(e,t,n){void 0===n&&(n="/");let r=Z(("string"===typeof t?O(t):t).pathname||"/",n);if(null==r)return null;let i=V(e);!function(e){e.sort(((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let n=e.length===t.length&&e.slice(0,-1).every(((e,n)=>e===t[n]));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((e=>e.childrenIndex)),t.routesMeta.map((e=>e.childrenIndex)))))}(i);let o=null;for(let s=0;null==o&&s<i.length;++s){let e=$(r);o=X(i[s],e)}return o}function V(e,t,n,r){void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r="");let i=(e,i,o)=>{let s={relativePath:void 0===o?e.path||"":o,caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};s.relativePath.startsWith("/")&&(P(s.relativePath.startsWith(r),'Absolute route path "'+s.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),s.relativePath=s.relativePath.slice(r.length));let a=ie([r,s.relativePath]),l=n.concat(s);e.children&&e.children.length>0&&(P(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+a+'".'),V(e.children,t,l,a)),(null!=e.path||e.index)&&t.push({path:a,score:Q(a,e.index),routesMeta:l})};return e.forEach(((e,t)=>{var n;if(""!==e.path&&null!=(n=e.path)&&n.includes("?"))for(let r of z(e.path))i(e,t,r);else i(e,t)})),t}function z(e){let t=e.split("/");if(0===t.length)return[];let[n,...r]=t,i=n.endsWith("?"),o=n.replace(/\?$/,"");if(0===r.length)return i?[o,""]:[o];let s=z(r.join("/")),a=[];return a.push(...s.map((e=>""===e?o:[o,e].join("/")))),i&&a.push(...s),a.map((t=>e.startsWith("/")&&""===t?"/":t))}const K=/^:[\w-]+$/,j=3,H=2,q=1,W=10,G=-2,Y=e=>"*"===e;function Q(e,t){let n=e.split("/"),r=n.length;return n.some(Y)&&(r+=G),t&&(r+=H),n.filter((e=>!Y(e))).reduce(((e,t)=>e+(K.test(t)?j:""===t?q:W)),r)}function X(e,t){let{routesMeta:n}=e,r={},i="/",o=[];for(let s=0;s<n.length;++s){let e=n[s],a=s===n.length-1,l="/"===i?t:t.slice(i.length)||"/",c=J({path:e.relativePath,caseSensitive:e.caseSensitive,end:a},l);if(!c)return null;Object.assign(r,c.params);let u=e.route;o.push({params:r,pathname:ie([i,c.pathname]),pathnameBase:oe(ie([i,c.pathnameBase])),route:u}),"/"!==c.pathnameBase&&(i=ie([i,c.pathnameBase]))}return o}function J(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[n,r]=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);D("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let r=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,((e,t,n)=>(r.push({paramName:t,isOptional:null!=n}),n?"/?([^\\/]+)?":"/([^\\/]+)")));e.endsWith("*")?(r.push({paramName:"*"}),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))");let o=new RegExp(i,t?void 0:"i");return[o,r]}(e.path,e.caseSensitive,e.end),i=t.match(n);if(!i)return null;let o=i[0],s=o.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:r.reduce(((e,t,n)=>{let{paramName:r,isOptional:i}=t;if("*"===r){let e=a[n]||"";s=o.slice(0,o.length-e.length).replace(/(.)\/+$/,"$1")}const l=a[n];return e[r]=i&&!l?void 0:(l||"").replace(/%2F/g,"/"),e}),{}),pathname:o,pathnameBase:s,pattern:e}}function $(e){try{return e.split("/").map((e=>decodeURIComponent(e).replace(/\//g,"%2F"))).join("/")}catch(t){return D(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function Z(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function ee(e,t,n,r){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(r)+"].  Please separate it out to the `to."+n+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function te(e){return e.filter(((e,t)=>0===t||e.route.path&&e.route.path.length>0))}function ne(e,t){let n=te(e);return t?n.map(((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)):n.map((e=>e.pathnameBase))}function re(e,t,n,r){let i;void 0===r&&(r=!1),"string"===typeof e?i=O(e):(i=C({},e),P(!i.pathname||!i.pathname.includes("?"),ee("?","pathname","search",i)),P(!i.pathname||!i.pathname.includes("#"),ee("#","pathname","hash",i)),P(!i.search||!i.search.includes("#"),ee("#","search","hash",i)));let o,s=""===e||""===i.pathname,a=s?"/":i.pathname;if(null==a)o=n;else{let e=t.length-1;if(!r&&a.startsWith("..")){let t=a.split("/");for(;".."===t[0];)t.shift(),e-=1;i.pathname=t.join("/")}o=e>=0?t[e]:"/"}let l=function(e,t){void 0===t&&(t="/");let{pathname:n,search:r="",hash:i=""}="string"===typeof e?O(e):e,o=n?n.startsWith("/")?n:function(e,t){let n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((e=>{".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(n,t):t;return{pathname:o,search:se(r),hash:ae(i)}}(i,o),c=a&&"/"!==a&&a.endsWith("/"),u=(s||"."===a)&&n.endsWith("/");return l.pathname.endsWith("/")||!c&&!u||(l.pathname+="/"),l}const ie=e=>e.join("/").replace(/\/\/+/g,"/"),oe=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),se=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",ae=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function le(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const ce=["post","put","patch","delete"],ue=(new Set(ce),["get",...ce]);new Set(ue),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function he(){return he=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},he.apply(this,arguments)}const de=I.createContext(null);const fe=I.createContext(null);const pe=I.createContext(null);const ge=I.createContext(null);const ye=I.createContext({outlet:null,matches:[],isDataRoute:!1});const ve=I.createContext(null);function me(){return null!=I.useContext(ge)}function we(){return me()||P(!1),I.useContext(ge).location}function be(e){I.useContext(pe).static||I.useLayoutEffect(e)}function Ee(){let{isDataRoute:e}=I.useContext(ye);return e?function(){let{router:e}=Pe(Ce.UseNavigateStable),t=Ne(xe.UseNavigateStable),n=I.useRef(!1);return be((()=>{n.current=!0})),I.useCallback((function(r,i){void 0===i&&(i={}),n.current&&("number"===typeof r?e.navigate(r):e.navigate(r,he({fromRouteId:t},i)))}),[e,t])}():function(){me()||P(!1);let e=I.useContext(de),{basename:t,future:n,navigator:r}=I.useContext(pe),{matches:i}=I.useContext(ye),{pathname:o}=we(),s=JSON.stringify(ne(i,n.v7_relativeSplatPath)),a=I.useRef(!1);return be((()=>{a.current=!0})),I.useCallback((function(n,i){if(void 0===i&&(i={}),!a.current)return;if("number"===typeof n)return void r.go(n);let l=re(n,JSON.parse(s),o,"path"===i.relative);null==e&&"/"!==t&&(l.pathname="/"===l.pathname?t:ie([t,l.pathname])),(i.replace?r.replace:r.push)(l,i.state,i)}),[t,r,s,o,e])}()}function _e(e,t){let{relative:n}=void 0===t?{}:t,{future:r}=I.useContext(pe),{matches:i}=I.useContext(ye),{pathname:o}=we(),s=JSON.stringify(ne(i,r.v7_relativeSplatPath));return I.useMemo((()=>re(e,JSON.parse(s),o,"path"===n)),[e,s,o,n])}function Se(e,t,n,r){me()||P(!1);let{navigator:i}=I.useContext(pe),{matches:o}=I.useContext(ye),s=o[o.length-1],a=s?s.params:{},l=(s&&s.pathname,s?s.pathnameBase:"/");s&&s.route;let c,u=we();if(t){var h;let e="string"===typeof t?O(t):t;"/"===l||(null==(h=e.pathname)?void 0:h.startsWith(l))||P(!1),c=e}else c=u;let d=c.pathname||"/",f=d;if("/"!==l){let e=l.replace(/^\//,"").split("/");f="/"+d.replace(/^\//,"").split("/").slice(e.length).join("/")}let p=F(e,{pathname:f});let g=Re(p&&p.map((e=>Object.assign({},e,{params:Object.assign({},a,e.params),pathname:ie([l,i.encodeLocation?i.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?l:ie([l,i.encodeLocation?i.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])}))),o,n,r);return t&&g?I.createElement(ge.Provider,{value:{location:he({pathname:"/",search:"",hash:"",state:null,key:"default"},c),navigationType:A.Pop}},g):g}function ke(){let e=function(){var e;let t=I.useContext(ve),n=De(xe.UseRouteError),r=Ne(xe.UseRouteError);if(void 0!==t)return t;return null==(e=n.errors)?void 0:e[r]}(),t=le(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,r="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:r};return I.createElement(I.Fragment,null,I.createElement("h2",null,"Unexpected Application Error!"),I.createElement("h3",{style:{fontStyle:"italic"}},t),n?I.createElement("pre",{style:i},n):null,null)}const Ae=I.createElement(ke,null);class Ie extends I.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?I.createElement(ye.Provider,{value:this.props.routeContext},I.createElement(ve.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Te(e){let{routeContext:t,match:n,children:r}=e,i=I.useContext(de);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),I.createElement(ye.Provider,{value:t},r)}function Re(e,t,n,r){var i;if(void 0===t&&(t=[]),void 0===n&&(n=null),void 0===r&&(r=null),null==e){var o;if(null==(o=n)||!o.errors)return null;e=n.matches}let s=e,a=null==(i=n)?void 0:i.errors;if(null!=a){let e=s.findIndex((e=>e.route.id&&(null==a?void 0:a[e.route.id])));e>=0||P(!1),s=s.slice(0,Math.min(s.length,e+1))}let l=!1,c=-1;if(n&&r&&r.v7_partialHydration)for(let u=0;u<s.length;u++){let e=s[u];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(c=u),e.route.id){let{loaderData:t,errors:r}=n,i=e.route.loader&&void 0===t[e.route.id]&&(!r||void 0===r[e.route.id]);if(e.route.lazy||i){l=!0,s=c>=0?s.slice(0,c+1):[s[0]];break}}}return s.reduceRight(((e,r,i)=>{let o,u=!1,h=null,d=null;var f;n&&(o=a&&r.route.id?a[r.route.id]:void 0,h=r.route.errorElement||Ae,l&&(c<0&&0===i?(f="route-fallback",!1||Be[f]||(Be[f]=!0),u=!0,d=null):c===i&&(u=!0,d=r.route.hydrateFallbackElement||null)));let p=t.concat(s.slice(0,i+1)),g=()=>{let t;return t=o?h:u?d:r.route.Component?I.createElement(r.route.Component,null):r.route.element?r.route.element:e,I.createElement(Te,{match:r,routeContext:{outlet:e,matches:p,isDataRoute:null!=n},children:t})};return n&&(r.route.ErrorBoundary||r.route.errorElement||0===i)?I.createElement(Ie,{location:n.location,revalidation:n.revalidation,component:h,error:o,children:g(),routeContext:{outlet:null,matches:p,isDataRoute:!0}}):g()}),null)}var Ce=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(Ce||{}),xe=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(xe||{});function Pe(e){let t=I.useContext(de);return t||P(!1),t}function De(e){let t=I.useContext(fe);return t||P(!1),t}function Ne(e){let t=function(e){let t=I.useContext(ye);return t||P(!1),t}(),n=t.matches[t.matches.length-1];return n.route.id||P(!1),n.route.id}const Be={};T.startTransition;function Le(e){P(!1)}function Oe(e){let{basename:t="/",children:n=null,location:r,navigationType:i=A.Pop,navigator:o,static:s=!1,future:a}=e;me()&&P(!1);let l=t.replace(/^\/*/,"/"),c=I.useMemo((()=>({basename:l,navigator:o,static:s,future:he({v7_relativeSplatPath:!1},a)})),[l,a,o,s]);"string"===typeof r&&(r=O(r));let{pathname:u="/",search:h="",hash:d="",state:f=null,key:p="default"}=r,g=I.useMemo((()=>{let e=Z(u,l);return null==e?null:{location:{pathname:e,search:h,hash:d,state:f,key:p},navigationType:i}}),[l,u,h,d,f,p,i]);return null==g?null:I.createElement(pe.Provider,{value:c},I.createElement(ge.Provider,{children:n,value:g}))}function Me(e){let{children:t,location:n}=e;return Se(Ue(t),n)}new Promise((()=>{}));I.Component;function Ue(e,t){void 0===t&&(t=[]);let n=[];return I.Children.forEach(e,((e,r)=>{if(!I.isValidElement(e))return;let i=[...t,r];if(e.type===I.Fragment)return void n.push.apply(n,Ue(e.props.children,i));e.type!==Le&&P(!1),e.props.index&&e.props.children&&P(!1);let o={id:e.props.id||i.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(o.children=Ue(e.props.children,i)),n.push(o)})),n}function Fe(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function Ve(e,t){Fe(e,t),t.add(e)}function ze(e){return ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ze(e)}function Ke(e){var t=function(e,t){if("object"!=ze(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=ze(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==ze(t)?t:t+""}function je(e,t,n){return(t=Ke(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function He(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var qe=n(4823);function We(e){var t;return e=null!==(t=e)&&void 0!==t?t:new Error("Open failed"),qe(e,"ERR_OPEN_FAILED")}function Ge(e){var t;return e=null!==(t=e)&&void 0!==t?t:new Error("Close failed"),qe(e,"ERR_CLOSE_FAILED")}function Ye(e){var t;return e=null!==(t=e)&&void 0!==t?t:new Error("Put failed"),qe(e,"ERR_PUT_FAILED")}function Qe(e){var t;return e=null!==(t=e)&&void 0!==t?t:new Error("Get failed"),qe(e,"ERR_GET_FAILED")}function Xe(e){var t;return e=null!==(t=e)&&void 0!==t?t:new Error("Delete failed"),qe(e,"ERR_DELETE_FAILED")}function Je(e){var t;return e=null!==(t=e)&&void 0!==t?t:new Error("Has failed"),qe(e,"ERR_HAS_FAILED")}function $e(e){var t;return e=null!==(t=e)&&void 0!==t?t:new Error("Not Found"),qe(e,"ERR_NOT_FOUND")}function Ze(e){var t;return e=null!==(t=e)&&void 0!==t?t:new Error("Aborted"),qe(e,"ERR_ABORTED")}class et{has(e,t){return Promise.reject(new Error(".has is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}async*putMany(e,t){for await(const{cid:n,block:r}of e)await this.put(n,r,t),yield n}get(e,t){return Promise.reject(new Error(".get is not implemented"))}async*getMany(e,t){for await(const n of e)yield{cid:n,block:await this.get(n,t)}}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*deleteMany(e,t){for await(const n of e)await this.delete(n,t),yield n}async*getAll(e){throw new Error(".getAll is not implemented")}}const tt=new Uint8Array(0);function nt(e){const t=e.match(/../g);return null!=t?new Uint8Array(t.map((e=>parseInt(e,16)))):tt}function rt(e){if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}var it=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var o=e.charAt(i),s=o.charCodeAt(0);if(255!==n[s])throw new TypeError(o+" is ambiguous");n[s]=i}var a=e.length,l=e.charAt(0),c=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if("string"!==typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var r=0,i=0;e[t]===l;)r++,t++;for(var o=(e.length-t)*c+1>>>0,s=new Uint8Array(o);e[t];){var u=n[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=o-1;(0!==u||h<i)&&-1!==d;d--,h++)u+=a*s[d]>>>0,s[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=o-i;f!==o&&0===s[f];)f++;for(var p=new Uint8Array(r+(o-f)),g=r;f!==o;)p[g++]=s[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,i=0,o=t.length;i!==o&&0===t[i];)i++,n++;for(var s=(o-i)*u+1>>>0,c=new Uint8Array(s);i!==o;){for(var h=t[i],d=0,f=s-1;(0!==h||d<r)&&-1!==f;f--,d++)h+=256*c[f]>>>0,c[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");r=d,i++}for(var p=s-r;p!==s&&0===c[p];)p++;for(var g=l.repeat(n);p<s;++p)g+=e.charAt(c[p]);return g},decodeUnsafe:h,decode:function(e){var n=h(e);if(n)return n;throw new Error("Non-".concat(t," character"))}}};const ot=it;class st{constructor(e,t,n){je(this,"name",void 0),je(this,"prefix",void 0),je(this,"baseEncode",void 0),this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return"".concat(this.prefix).concat(this.baseEncode(e));throw Error("Unknown type, must be binary type")}}class at{constructor(e,t,n){if(je(this,"name",void 0),je(this,"prefix",void 0),je(this,"baseDecode",void 0),je(this,"prefixCodePoint",void 0),this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if("string"===typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error("Unable to decode multibase string ".concat(JSON.stringify(e),", ").concat(this.name," decoder only supports inputs prefixed with ").concat(this.prefix));return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return ct(this,e)}}class lt{constructor(e){je(this,"decoders",void 0),this.decoders=e}or(e){return ct(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(null!=n)return n.decode(e);throw RangeError("Unable to decode multibase string ".concat(JSON.stringify(e),", only inputs prefixed with ").concat(Object.keys(this.decoders)," are supported"))}}function ct(e,t){var n,r;return new lt({...null!==(n=e.decoders)&&void 0!==n?n:{[e.prefix]:e},...null!==(r=t.decoders)&&void 0!==r?r:{[t.prefix]:t}})}class ut{constructor(e,t,n,r){je(this,"name",void 0),je(this,"prefix",void 0),je(this,"baseEncode",void 0),je(this,"baseDecode",void 0),je(this,"encoder",void 0),je(this,"decoder",void 0),this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new st(e,t,n),this.decoder=new at(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function ht(e){let{name:t,prefix:n,encode:r,decode:i}=e;return new ut(t,n,r,i)}function dt(e){let{name:t,prefix:n,alphabet:r}=e;const{encode:i,decode:o}=ot(r,t);return ht({prefix:n,name:t,encode:i,decode:e=>rt(o(e))})}function ft(e){let{name:t,prefix:n,bitsPerChar:r,alphabet:i}=e;return ht({prefix:n,name:t,encode:e=>function(e,t,n){const r="="===t[t.length-1],i=(1<<n)-1;let o="",s=0,a=0;for(let l=0;l<e.length;++l)for(a=a<<8|e[l],s+=8;s>n;)s-=n,o+=t[i&a>>s];if(0!==s&&(o+=t[i&a<<n-s]),r)for(;0!==(o.length*n&7);)o+="=";return o}(e,i,r),decode:e=>function(e,t,n,r){const i={};for(let u=0;u<t.length;++u)i[t[u]]=u;let o=e.length;for(;"="===e[o-1];)--o;const s=new Uint8Array(o*n/8|0);let a=0,l=0,c=0;for(let u=0;u<o;++u){const t=i[e[u]];if(void 0===t)throw new SyntaxError("Non-".concat(r," character"));l=l<<n|t,a+=n,a>=8&&(a-=8,s[c++]=255&l>>a)}if(a>=n||0!==(255&l<<8-a))throw new SyntaxError("Unexpected end of data");return s}(e,i,r,t)})}const pt=ft({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),gt=ft({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),yt=ft({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),vt=ft({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),mt=ft({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),wt=ft({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),bt=ft({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Et=ft({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),_t=ft({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),St=dt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),kt=dt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var At=function e(t,n,r){n=n||[];var i=r=r||0;for(;t>=Rt;)n[r++]=255&t|It,t/=128;for(;t&Tt;)n[r++]=255&t|It,t>>>=7;return n[r]=0|t,e.bytes=r-i+1,n},It=128,Tt=-128,Rt=Math.pow(2,31);var Ct=function e(t,n){var r,i=0,o=0,s=n=n||0,a=t.length;do{if(s>=a)throw e.bytes=0,new RangeError("Could not decode varint");r=t[s++],i+=o<28?(r&Pt)<<o:(r&Pt)*Math.pow(2,o),o+=7}while(r>=xt);return e.bytes=s-n,i},xt=128,Pt=127;var Dt=Math.pow(2,7),Nt=Math.pow(2,14),Bt=Math.pow(2,21),Lt=Math.pow(2,28),Ot=Math.pow(2,35),Mt=Math.pow(2,42),Ut=Math.pow(2,49),Ft=Math.pow(2,56),Vt=Math.pow(2,63);const zt={encode:At,decode:Ct,encodingLength:function(e){return e<Dt?1:e<Nt?2:e<Bt?3:e<Lt?4:e<Ot?5:e<Mt?6:e<Ut?7:e<Ft?8:e<Vt?9:10}};function Kt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return[zt.decode(e,t),zt.decode.bytes]}function jt(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return zt.encode(e,t,n),t}function Ht(e){return zt.encodingLength(e)}function qt(e,t){const n=t.byteLength,r=Ht(e),i=r+Ht(n),o=new Uint8Array(i+n);return jt(e,o,0),jt(n,o,r),o.set(t,i),new Gt(e,n,t,o)}function Wt(e){const t=rt(e),[n,r]=Kt(t),[i,o]=Kt(t.subarray(r)),s=t.subarray(r+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new Gt(n,i,s,t)}class Gt{constructor(e,t,n,r){je(this,"code",void 0),je(this,"size",void 0),je(this,"digest",void 0),je(this,"bytes",void 0),this.code=e,this.size=t,this.digest=n,this.bytes=r}}function Yt(e,t){const{bytes:n,version:r}=e;return 0===r?function(e,t,n){const{prefix:r}=n;if(r!==St.prefix)throw Error("Cannot string encode V0 in ".concat(n.name," encoding"));const i=t.get(r);if(null==i){const i=n.encode(e).slice(1);return t.set(r,i),i}return i}(n,Xt(e),null!==t&&void 0!==t?t:St.encoder):function(e,t,n){const{prefix:r}=n,i=t.get(r);if(null==i){const i=n.encode(e);return t.set(r,i),i}return i}(n,Xt(e),null!==t&&void 0!==t?t:pt.encoder)}const Qt=new WeakMap;function Xt(e){const t=Qt.get(e);if(null==t){const t=new Map;return Qt.set(e,t),t}return t}class Jt{constructor(e,t,n,r){je(this,"code",void 0),je(this,"version",void 0),je(this,"multihash",void 0),je(this,"bytes",void 0),je(this,"/",void 0),je(this,Symbol.toStringTag,"CID"),this.code=t,this.version=e,this.multihash=n,this.bytes=r,this["/"]=r}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==$t)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Zt)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Jt.createV0(t)}default:throw Error("Can not convert CID version ".concat(this.version," to version 0. This is a bug please report"))}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=qt(e,t);return Jt.createV1(this.code,n)}case 1:return this;default:throw Error("Can not convert CID version ".concat(this.version," to version 1. This is a bug please report"))}}equals(e){return Jt.equals(this,e)}static equals(e,t){const n=t;return null!=n&&e.code===n.code&&e.version===n.version&&function(e,t){if(e===t)return!0;{const n=t;return e.code===n.code&&e.size===n.size&&n.bytes instanceof Uint8Array&&function(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0}(e.bytes,n.bytes)}}(e.multihash,n.multihash)}toString(e){return Yt(this,e)}toJSON(){return{"/":Yt(this)}}link(){return this}[Symbol.for("nodejs.util.inspect.custom")](){return"CID(".concat(this.toString(),")")}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Jt)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:n,multihash:r,bytes:i}=t;return new Jt(e,n,r,null!==i&&void 0!==i?i:en(e,n,r.bytes))}if(!0===t[tn]){const{version:e,multihash:n,code:r}=t,i=Wt(n);return Jt.create(e,r,i)}return null}static create(e,t,n){if("number"!==typeof t)throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==$t)throw new Error("Version 0 CID must use dag-pb (code: ".concat($t,") block encoding"));return new Jt(e,t,n,n.bytes);case 1:{const r=en(e,t,n.bytes);return new Jt(e,t,n,r)}default:throw new Error("Invalid version")}}static createV0(e){return Jt.create(0,$t,e)}static createV1(e,t){return Jt.create(1,e,t)}static decode(e){const[t,n]=Jt.decodeFirst(e);if(0!==n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Jt.inspectBytes(e),n=t.size-t.multihashSize,r=rt(e.subarray(n,n+t.multihashSize));if(r.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=r.subarray(t.multihashSize-t.digestSize),o=new Gt(t.multihashCode,t.digestSize,i,r);return[0===t.version?Jt.createV0(o):Jt.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[n,r]=Kt(e.subarray(t));return t+=r,n};let r=n(),i=$t;if(18===r?(r=0,t=0):i=n(),0!==r&&1!==r)throw new RangeError("Invalid CID version ".concat(r));const o=t,s=n(),a=n(),l=t+a;return{version:r,codec:i,multihashCode:s,digestSize:a,multihashSize:l-o,size:l}}static parse(e,t){const[n,r]=function(e,t){switch(e[0]){case"Q":{const n=null!==t&&void 0!==t?t:St;return[St.prefix,n.decode("".concat(St.prefix).concat(e))]}case St.prefix:{const n=null!==t&&void 0!==t?t:St;return[St.prefix,n.decode(e)]}case pt.prefix:{const n=null!==t&&void 0!==t?t:pt;return[pt.prefix,n.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}}(e,t),i=Jt.decode(r);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return Xt(i).set(n,e),i}}const $t=112,Zt=18;function en(e,t,n){const r=Ht(e),i=r+Ht(t),o=new Uint8Array(i+n.byteLength);return jt(e,o,0),jt(t,o,r),o.set(n,i),o}const tn=Symbol.for("@ipld/js-cid/CID"),nn="raw",rn=85;function on(e){return rt(e)}function sn(e){return rt(e)}class an extends et{constructor(){super(),je(this,"data",void 0),this.data=new Map}put(e,t){return this.data.set(pt.encode(e.multihash.bytes),t),e}get(e){const t=this.data.get(pt.encode(e.multihash.bytes));if(null==t)throw $e();return t}has(e){return this.data.has(pt.encode(e.multihash.bytes))}async delete(e){this.data.delete(pt.encode(e.multihash.bytes))}async*getAll(){for(const[e,t]of this.data.entries())yield{cid:Jt.createV1(rn,Wt(pt.decode(e))),block:t}}}var ln=n(6522);const cn=ft({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),un=ft({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),hn=ft({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),dn=ft({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function fn(){return{forComponent:e=>pn(e)}}function pn(e){let t=function(e){const t=()=>{};return t.enabled=!1,t.color="",t.diff=0,t.log=()=>{},t.namespace=e,t.destroy=()=>!0,t.extend=()=>t,t}("".concat(e,":trace"));return ln.enabled("".concat(e,":trace"))&&null!=ln.names.map((e=>e.toString())).find((e=>e.includes(":trace")))&&(t=ln("".concat(e,":trace"))),Object.assign(ln(e),{error:ln("".concat(e,":error")),trace:t})}ln.formatters.b=e=>null==e?"undefined":St.baseEncode(e),ln.formatters.t=e=>null==e?"undefined":pt.baseEncode(e),ln.formatters.m=e=>null==e?"undefined":cn.baseEncode(e),ln.formatters.p=e=>null==e?"undefined":e.toString(),ln.formatters.c=e=>null==e?"undefined":e.toString(),ln.formatters.k=e=>null==e?"undefined":e.toString(),ln.formatters.a=e=>null==e?"undefined":e.toString();const gn=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e);})();for(const t of e);};const yn=function(e){const[t,n]=null!=e[Symbol.asyncIterator]?[e[Symbol.asyncIterator](),Symbol.asyncIterator]:[e[Symbol.iterator](),Symbol.iterator],r=[];return{peek:()=>t.next(),push:e=>{r.push(e)},next:()=>r.length>0?{done:!1,value:r.shift()}:t.next(),[n](){return this}}};const vn=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const n of e)await t(n)&&(yield n)}();const n=yn(e),{value:r,done:i}=n.next();if(!0===i)return function*(){}();const o=t(r);if("function"===typeof o.then)return async function*(){await o&&(yield r);for await(const e of n)await t(e)&&(yield e)}();const s=t;return function*(){!0===o&&(yield r);for(const e of n)s(e)&&(yield e)}()};function mn(){const e={};return e.promise=new Promise(((t,n)=>{e.resolve=t,e.reject=n})),e}class wn{constructor(e){if(je(this,"buffer",void 0),je(this,"mask",void 0),je(this,"top",void 0),je(this,"btm",void 0),je(this,"next",void 0),!(e>0)||0!==(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class bn{constructor(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};je(this,"size",void 0),je(this,"hwm",void 0),je(this,"head",void 0),je(this,"tail",void 0),this.hwm=null!==(e=t.splitLimit)&&void 0!==e?e:16,this.head=new wn(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=(null===e||void 0===e?void 0:e.byteLength)?e.byteLength:1}push(e){if(null!=(null===e||void 0===e?void 0:e.value)&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new wn(2*this.head.buffer.length),this.head.push(e)}}shift(){var e;let t=this.tail.shift();if(void 0===t&&null!=this.tail.next){const e=this.tail.next;this.tail.next=null,this.tail=e,t=this.tail.shift()}return null!=(null===(e=t)||void 0===e?void 0:e.value)&&(this.size-=this.calculateSize(t.value)),t}isEmpty(){return this.head.isEmpty()}}class En extends Error{constructor(e,t){super(null!==e&&void 0!==e?e:"The operation was aborted"),je(this,"type",void 0),je(this,"code",void 0),this.type="aborted",this.code=null!==t&&void 0!==t?t:"ABORT_ERR"}}function _n(){return Sn((e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}}),arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}function Sn(e,t){var n;let r,i,o,s=(t=null!==(n=t)&&void 0!==n?n:{}).onEnd,a=new bn,l=mn();const c=e=>null!=i?i(e):(a.push(e),r),u=e=>{var n;if(o)return r;if(!0!==(null===(n=t)||void 0===n?void 0:n.objectMode)&&null==(null===e||void 0===e?void 0:e.byteLength))throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:e})},h=e=>o?r:(o=!0,null!=e?(e=>(a=new bn,null!=i?i({error:e}):(a.push({error:e}),r)))(e):c({done:!0}));if(r={[Symbol.asyncIterator](){return this},next:async()=>{try{return a.isEmpty()?o?{done:!0}:await new Promise(((t,n)=>{i=o=>{i=null,a.push(o);try{t(e(a))}catch(s){n(s)}return r}})):e(a)}finally{a.isEmpty()&&queueMicrotask((()=>{l.resolve(),l=mn()}))}},return:()=>(a=new bn,h(),{done:!0}),throw:e=>(h(e),{done:!0}),push:u,end:h,get readableLength(){return a.size},onEmpty:async e=>{const t=null===e||void 0===e?void 0:e.signal;if(null===t||void 0===t||t.throwIfAborted(),a.isEmpty())return;let n,r;null!=t&&(n=new Promise(((e,n)=>{r=()=>{n(new En)},t.addEventListener("abort",r)})));try{await Promise.race([l.promise,n])}finally{null!=r&&null!=t&&(null===t||void 0===t||t.removeEventListener("abort",r))}}},null==s)return r;const d=r;return r={[Symbol.asyncIterator](){return this},next:()=>d.next(),throw:e=>(d.throw(e),null!=s&&(s(e),s=void 0),{done:!0}),return:()=>(d.return(),null!=s&&(s(),s=void 0),{done:!0}),push:u,end:e=>(d.end(e),null!=s&&(s(e),s=void 0),r),get readableLength(){return d.readableLength},onEmpty:e=>d.onEmpty(e)},r}const kn=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[];for(const i of t)null==i[Symbol.asyncIterator]&&r.push(i);return r.length===t.length?function*(){for(const e of r)yield*e}():async function*(){const e=_n({objectMode:!0});Promise.resolve().then((async()=>{try{await Promise.all(t.map((async t=>{for await(const n of t)e.push(n)}))),e.end()}catch(n){e.end(n)}})),yield*e}()},An=pn("blockstore:core:tiered");class In extends et{constructor(e){super(),je(this,"stores",void 0),this.stores=e.slice()}async put(e,t,n){try{return await Promise.all(this.stores.map((async r=>{await r.put(e,t,n)}))),e}catch(r){throw Ye(r)}}async get(e,t){for(const r of this.stores)try{const n=await r.get(e,t);if(null!=n)return n}catch(n){An.error(n)}throw $e()}async has(e,t){for(const n of this.stores)if(await n.has(e,t))return!0;return!1}async delete(e,t){try{await Promise.all(this.stores.map((async n=>{await n.delete(e,t)})))}catch(n){throw Xe(n)}}putMany(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){let r;const i=t.stores.map((e=>{const t=_n({objectMode:!0});return gn(e.putMany(t,n)).catch((e=>{r=e})),t}));try{for await(const t of e){if(null!=r)throw r;i.forEach((e=>e.push(t))),yield t.cid}}finally{i.forEach((e=>e.end()))}}()}catch(n){return Promise.reject(n)}}deleteMany(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){let r;const i=t.stores.map((e=>{const t=_n({objectMode:!0});return gn(e.deleteMany(t,n)).catch((e=>{r=e})),t}));try{for await(const t of e){if(null!=r)throw r;i.forEach((e=>e.push(t))),yield t}}finally{i.forEach((e=>e.end()))}}()}catch(n){return Promise.reject(n)}}async*getAll(e){const t=new Set;yield*vn(kn(...this.stores.map((t=>t.getAll(e)))),(e=>{const n=e.cid.toString();return!t.has(n)&&(t.add(n),!0)}))}}const Tn={...e};var Rn=n(1602),Cn=new WeakSet;class xn extends et{constructor(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),Ve(this,Cn),je(this,"db",void 0),je(this,"opts",void 0),je(this,"base",void 0),this.db="string"===typeof e?new Rn.Level(e,{...n,keyEncoding:"utf8",valueEncoding:"view"}):e,this.opts={createIfMissing:!0,compression:!1,...n},this.base=null!==(t=n.base)&&void 0!==t?t:gt}async open(){try{await this.db.open(this.opts)}catch(e){throw Tn.openFailedError(e)}}async put(e,t){try{return await this.db.put(He(Cn,this,Pn).call(this,e),t),e}catch(n){throw Tn.putFailedError(n)}}async get(e){let t;try{t=await this.db.get(He(Cn,this,Pn).call(this,e))}catch(n){if(null!=n.notFound)throw Tn.notFoundError(n);throw Tn.getFailedError(n)}return t}async has(e){try{await this.db.get(He(Cn,this,Pn).call(this,e))}catch(t){if(null!=t.notFound)return!1;throw t}return!0}async delete(e){try{await this.db.del(He(Cn,this,Pn).call(this,e))}catch(t){throw Tn.deleteFailedError(t)}}async close(){await this.db.close()}async*getAll(e){for await(const{key:t,value:n}of He(Cn,this,Nn).call(this,{values:!0}))yield{cid:He(Cn,this,Dn).call(this,t),block:n}}}function Pn(e){return"/".concat(this.base.encoder.encode(e.multihash.bytes))}function Dn(e){return Jt.createV1(rn,Wt(this.base.decoder.decode(e.substring(1))))}async function*Nn(e){const t={keys:!0,keyEncoding:"buffer",values:e.values};if(null!=e.prefix){const n=e.prefix.toString();t.gte=n,t.lt=n+"\xff"}const n=this.db.iterator(t);try{for await(const[e,t]of n)yield{key:(new TextDecoder).decode(e),value:t}}finally{await n.close()}}function Bn(e){var t;return e=null!==(t=e)&&void 0!==t?t:new Error("Cannot open database"),qe(e,"ERR_DB_OPEN_FAILED")}function Ln(e){var t;return e=null!==(t=e)&&void 0!==t?t:new Error("Delete failed"),qe(e,"ERR_DB_DELETE_FAILED")}function On(e){var t;return e=null!==(t=e)&&void 0!==t?t:new Error("Write failed"),qe(e,"ERR_DB_WRITE_FAILED")}function Mn(e){var t;return e=null!==(t=e)&&void 0!==t?t:new Error("Not Found"),qe(e,"ERR_NOT_FOUND")}const Un=dt({prefix:"9",name:"base10",alphabet:"0123456789"}),Fn=ft({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Vn=ft({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),zn=ft({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Kn=Array.from("\ud83d\ude80\ud83e\ude90\u2604\ud83d\udef0\ud83c\udf0c\ud83c\udf11\ud83c\udf12\ud83c\udf13\ud83c\udf14\ud83c\udf15\ud83c\udf16\ud83c\udf17\ud83c\udf18\ud83c\udf0d\ud83c\udf0f\ud83c\udf0e\ud83d\udc09\u2600\ud83d\udcbb\ud83d\udda5\ud83d\udcbe\ud83d\udcbf\ud83d\ude02\u2764\ud83d\ude0d\ud83e\udd23\ud83d\ude0a\ud83d\ude4f\ud83d\udc95\ud83d\ude2d\ud83d\ude18\ud83d\udc4d\ud83d\ude05\ud83d\udc4f\ud83d\ude01\ud83d\udd25\ud83e\udd70\ud83d\udc94\ud83d\udc96\ud83d\udc99\ud83d\ude22\ud83e\udd14\ud83d\ude06\ud83d\ude44\ud83d\udcaa\ud83d\ude09\u263a\ud83d\udc4c\ud83e\udd17\ud83d\udc9c\ud83d\ude14\ud83d\ude0e\ud83d\ude07\ud83c\udf39\ud83e\udd26\ud83c\udf89\ud83d\udc9e\u270c\u2728\ud83e\udd37\ud83d\ude31\ud83d\ude0c\ud83c\udf38\ud83d\ude4c\ud83d\ude0b\ud83d\udc97\ud83d\udc9a\ud83d\ude0f\ud83d\udc9b\ud83d\ude42\ud83d\udc93\ud83e\udd29\ud83d\ude04\ud83d\ude00\ud83d\udda4\ud83d\ude03\ud83d\udcaf\ud83d\ude48\ud83d\udc47\ud83c\udfb6\ud83d\ude12\ud83e\udd2d\u2763\ud83d\ude1c\ud83d\udc8b\ud83d\udc40\ud83d\ude2a\ud83d\ude11\ud83d\udca5\ud83d\ude4b\ud83d\ude1e\ud83d\ude29\ud83d\ude21\ud83e\udd2a\ud83d\udc4a\ud83e\udd73\ud83d\ude25\ud83e\udd24\ud83d\udc49\ud83d\udc83\ud83d\ude33\u270b\ud83d\ude1a\ud83d\ude1d\ud83d\ude34\ud83c\udf1f\ud83d\ude2c\ud83d\ude43\ud83c\udf40\ud83c\udf37\ud83d\ude3b\ud83d\ude13\u2b50\u2705\ud83e\udd7a\ud83c\udf08\ud83d\ude08\ud83e\udd18\ud83d\udca6\u2714\ud83d\ude23\ud83c\udfc3\ud83d\udc90\u2639\ud83c\udf8a\ud83d\udc98\ud83d\ude20\u261d\ud83d\ude15\ud83c\udf3a\ud83c\udf82\ud83c\udf3b\ud83d\ude10\ud83d\udd95\ud83d\udc9d\ud83d\ude4a\ud83d\ude39\ud83d\udde3\ud83d\udcab\ud83d\udc80\ud83d\udc51\ud83c\udfb5\ud83e\udd1e\ud83d\ude1b\ud83d\udd34\ud83d\ude24\ud83c\udf3c\ud83d\ude2b\u26bd\ud83e\udd19\u2615\ud83c\udfc6\ud83e\udd2b\ud83d\udc48\ud83d\ude2e\ud83d\ude46\ud83c\udf7b\ud83c\udf43\ud83d\udc36\ud83d\udc81\ud83d\ude32\ud83c\udf3f\ud83e\udde1\ud83c\udf81\u26a1\ud83c\udf1e\ud83c\udf88\u274c\u270a\ud83d\udc4b\ud83d\ude30\ud83e\udd28\ud83d\ude36\ud83e\udd1d\ud83d\udeb6\ud83d\udcb0\ud83c\udf53\ud83d\udca2\ud83e\udd1f\ud83d\ude41\ud83d\udea8\ud83d\udca8\ud83e\udd2c\u2708\ud83c\udf80\ud83c\udf7a\ud83e\udd13\ud83d\ude19\ud83d\udc9f\ud83c\udf31\ud83d\ude16\ud83d\udc76\ud83e\udd74\u25b6\u27a1\u2753\ud83d\udc8e\ud83d\udcb8\u2b07\ud83d\ude28\ud83c\udf1a\ud83e\udd8b\ud83d\ude37\ud83d\udd7a\u26a0\ud83d\ude45\ud83d\ude1f\ud83d\ude35\ud83d\udc4e\ud83e\udd32\ud83e\udd20\ud83e\udd27\ud83d\udccc\ud83d\udd35\ud83d\udc85\ud83e\uddd0\ud83d\udc3e\ud83c\udf52\ud83d\ude17\ud83e\udd11\ud83c\udf0a\ud83e\udd2f\ud83d\udc37\u260e\ud83d\udca7\ud83d\ude2f\ud83d\udc86\ud83d\udc46\ud83c\udfa4\ud83d\ude47\ud83c\udf51\u2744\ud83c\udf34\ud83d\udca3\ud83d\udc38\ud83d\udc8c\ud83d\udccd\ud83e\udd40\ud83e\udd22\ud83d\udc45\ud83d\udca1\ud83d\udca9\ud83d\udc50\ud83d\udcf8\ud83d\udc7b\ud83e\udd10\ud83e\udd2e\ud83c\udfbc\ud83e\udd75\ud83d\udea9\ud83c\udf4e\ud83c\udf4a\ud83d\udc7c\ud83d\udc8d\ud83d\udce3\ud83e\udd42"),jn=Kn.reduce(((e,t,n)=>(e[n]=t,e)),[]),Hn=Kn.reduce(((e,t,n)=>(e[t.codePointAt(0)]=n,e)),[]);const qn=ht({prefix:"\ud83d\ude80",name:"base256emoji",encode:function(e){return e.reduce(((e,t)=>e+=jn[t]),"")},decode:function(e){const t=[];for(const n of e){const e=Hn[n.codePointAt(0)];if(void 0===e)throw new Error("Non-base256emoji character: ".concat(n));t.push(e)}return new Uint8Array(t)}}),Wn=dt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Gn=dt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Yn=ft({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Qn=ht({prefix:"\0",name:"identity",encode:e=>{return t=e,(new TextDecoder).decode(t);var t},decode:e=>function(e){return(new TextEncoder).encode(e)}(e)}),Xn=new TextEncoder,Jn=new TextDecoder,$n="json",Zn=512;function er(e){return Xn.encode(JSON.stringify(e))}function tr(e){return JSON.parse(Jn.decode(e))}const nr=rt;const rr={code:0,name:"identity",encode:nr,digest:function(e){return qt(0,nr(e))}};function ir(e){let{name:t,code:n,encode:r}=e;return new or(t,n,r)}class or{constructor(e,t,n){je(this,"name",void 0),je(this,"code",void 0),je(this,"encode",void 0),this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?qt(this.code,t):t.then((e=>qt(this.code,e)))}throw Error("Unknown type, must be binary type")}}function sr(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}const ar=ir({name:"sha2-256",code:18,encode:sr("SHA-256")}),lr=ir({name:"sha2-512",code:19,encode:sr("SHA-512")}),cr={...d,...l,...h,...s,...a,...t,...u,...r,...o,...c};function ur(){return new Uint8Array(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)}function hr(){return new Uint8Array(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)}function dr(e,t,n,r){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:n},decoder:{decode:r}}}const fr=dr("utf8","u",(e=>"u"+new TextDecoder("utf8").decode(e)),(e=>(new TextEncoder).encode(e.substring(1)))),pr=dr("ascii","a",(e=>{let t="a";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}),(e=>{const t=hr((e=e.substring(1)).length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t})),gr={utf8:fr,"utf-8":fr,hex:cr.base16,latin1:pr,ascii:pr,binary:pr,...cr};function yr(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";const n=gr[t];if(null==n)throw new Error('Unsupported encoding "'.concat(t,'"'));return n.decoder.decode("".concat(n.prefix).concat(e))}function vr(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8";const n=gr[t];if(null==n)throw new Error('Unsupported encoding "'.concat(t,'"'));return n.encoder.encode(e).substring(1)}const mr="/",wr=(new TextEncoder).encode(mr),br=wr[0];class Er{constructor(e,t){if(je(this,"_buf",void 0),"string"===typeof e)this._buf=yr(e);else{if(!(e instanceof Uint8Array))throw new Error("Invalid key, should be String of Uint8Array");this._buf=e}if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==br)throw new Error("Invalid key")}toString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"utf8";return vr(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return"Key(".concat(this.toString(),")")}static withNamespaces(e){return new Er(e.join(mr))}static random(){return new Er(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||"string"===typeof e?new Er(e):"function"===typeof e.uint8Array?new Er(e.uint8Array()):null}clean(){if(null!=this._buf&&0!==this._buf.byteLength||(this._buf=wr),this._buf[0]!==br){const e=new Uint8Array(this._buf.byteLength+1);e.fill(br,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===br;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),n=e.list();for(let r=0;r<t.length;r++){if(n.length<r+1)return!1;const e=t[r],i=n[r];if(e<i)return!0;if(e>i)return!1}return t.length<n.length}reverse(){return Er.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(mr).slice(1)}type(){return function(e){const t=e.split(":");if(t.length<2)return"";return t.slice(0,-1).join(":")}(this.baseNamespace())}name(){return function(e){const t=e.split(":");return t[t.length-1]}(this.baseNamespace())}instance(e){return new Er(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(mr)||(e+=mr),e+=this.type(),new Er(e)}parent(){const e=this.list();return 1===e.length?new Er(mr):new Er(e.slice(0,-1).join(mr))}child(e){return this.toString()===mr?e:e.toString()===mr?this:new Er(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Er.withNamespaces([...this.namespaces(),...(r=t.map((e=>e.namespaces())),[].concat(...r))]);var r}}const _r="SHARDING";const Sr=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{const t=[];for await(const n of e)t.push(n);return t})();const t=[];for(const n of e)t.push(n);return t};const kr=function(e,t){return null!=e[Symbol.asyncIterator]?async function*(){const n=await Sr(e);yield*n.sort(t)}():function*(){const n=Sr(e);yield*n.sort(t)}()};const Ar=function(e,t){return null!=e[Symbol.asyncIterator]?async function*(){let n=0;if(!(t<1))for await(const r of e)if(yield r,n++,n===t)return}():function*(){let n=0;if(!(t<1))for(const r of e)if(yield r,n++,n===t)return}()};class Ir{put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}putMany(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){for await(const{key:r,value:i}of e)await t.put(r,i,n),yield r}()}catch(n){return Promise.reject(n)}}getMany(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){for await(const r of e)yield{key:r,value:await t.get(r,n)}}()}catch(n){return Promise.reject(n)}}deleteMany(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){for await(const r of e)await t.delete(r,n),yield r}()}catch(n){return Promise.reject(n)}}batch(){let e=[],t=[];return{put(t,n){e.push({key:t,value:n})},delete(e){t.push(e)},commit:async n=>{await gn(this.putMany(e,n)),e=[],await gn(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(null!=e.prefix){const t=e.prefix;n=vn(n,(e=>e.key.toString().startsWith(t)))}if(Array.isArray(e.filters)&&(n=e.filters.reduce(((e,t)=>vn(e,t)),n)),Array.isArray(e.orders)&&(n=e.orders.reduce(((e,t)=>kr(e,t)),n)),null!=e.offset){let t=0;const r=e.offset;n=vn(n,(()=>t++>=r))}return null!=e.limit&&(n=Ar(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(null!=e.prefix){const t=e.prefix;n=vn(n,(e=>e.toString().startsWith(t)))}if(Array.isArray(e.filters)&&(n=e.filters.reduce(((e,t)=>vn(e,t)),n)),Array.isArray(e.orders)&&(n=e.orders.reduce(((e,t)=>kr(e,t)),n)),null!=e.offset){const t=e.offset;let r=0;n=vn(n,(()=>r++>=t))}return null!=e.limit&&(n=Ar(n,e.limit)),n}}class Tr extends Ir{constructor(){super(),je(this,"data",void 0),this.data=new Map}put(e,t){return this.data.set(e.toString(),t),e}get(e){const t=this.data.get(e.toString());if(null==t)throw Mn();return t}has(e){return this.data.has(e.toString())}delete(e){this.data.delete(e.toString())}*_all(){for(const[e,t]of this.data.entries())yield{key:new Er(e),value:t}}*_allKeys(){for(const e of this.data.keys())yield new Er(e)}}const Rr=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const n of e)yield t(n)}();const n=yn(e),{value:r,done:i}=n.next();if(!0===i)return function*(){}();const o=t(r);if("function"===typeof o.then)return async function*(){yield await o;for await(const e of n)yield t(e)}();const s=t;return function*(){yield o;for(const e of n)yield s(e)}()};function Cr(e){if(null==e)throw new Error("Empty pipeline");if(Nr(e)){const t=e;e=()=>t.source}else if(Dr(e)||Pr(e)){const t=e;e=()=>t}for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const i=[e,...n];if(i.length>1&&Nr(i[i.length-1])&&(i[i.length-1]=i[i.length-1].sink),i.length>2)for(let o=1;o<i.length-1;o++)Nr(i[o])&&(i[o]=Br(i[o]));return xr(...i)}const xr=function(){let e;for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(;n.length>0;)e=n.shift()(e);return e},Pr=e=>null!=(null===e||void 0===e?void 0:e[Symbol.asyncIterator]),Dr=e=>null!=(null===e||void 0===e?void 0:e[Symbol.iterator]),Nr=e=>null!=e&&(null!=e.sink&&null!=e.source),Br=e=>t=>{const n=e.sink(t);if(null!=(null===n||void 0===n?void 0:n.then)){const t=_n({objectMode:!0});let r;n.then((()=>{t.end()}),(e=>{t.end(e)}));const i=e.source;if(Pr(i))r=async function*(){yield*i,t.end()};else{if(!Dr(i))throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");r=function*(){yield*i,t.end()}}return kn(t,r())}return e.source};new Er(_r);pn("datastore:core:tiered");class Lr extends Ir{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),je(this,"db",void 0),je(this,"opts",void 0),this.db="string"===typeof e?new Rn.Level(e,{...t,keyEncoding:"utf8",valueEncoding:"view"}):e,this.opts={createIfMissing:!0,compression:!1,...t}}async open(){try{await this.db.open(this.opts)}catch(e){throw Bn(e)}}async put(e,t){try{return await this.db.put(e.toString(),t),e}catch(n){throw On(n)}}async get(e){let t;try{t=await this.db.get(e.toString())}catch(n){if(null!=n.notFound)throw Mn(n);throw function(e){var t;return e=null!==(t=e)&&void 0!==t?t:new Error("Read failed"),qe(e,"ERR_DB_READ_FAILED")}(n)}return t}async has(e){try{await this.db.get(e.toString())}catch(t){if(null!=t.notFound)return!1;throw t}return!0}async delete(e){try{await this.db.del(e.toString())}catch(t){throw Ln(t)}}async close(){await this.db.close()}batch(){const e=[];return{put:(t,n)=>{e.push({type:"put",key:t.toString(),value:n})},delete:t=>{e.push({type:"del",key:t.toString()})},commit:async()=>{if(null==this.db.batch)throw new Error("Batch operations unsupported by underlying Level");await this.db.batch(e)}}}query(e){let t=this._query({values:!0,prefix:e.prefix});Array.isArray(e.filters)&&(t=e.filters.reduce(((e,t)=>vn(e,t)),t)),Array.isArray(e.orders)&&(t=e.orders.reduce(((e,t)=>kr(e,t)),t));const{offset:n,limit:r}=e;if(null!=n){let e=0;t=vn(t,(()=>e++>=n))}return null!=r&&(t=Ar(t,r)),t}queryKeys(e){let t=Rr(this._query({values:!1,prefix:e.prefix}),(e=>{let{key:t}=e;return t}));Array.isArray(e.filters)&&(t=e.filters.reduce(((e,t)=>vn(e,t)),t)),Array.isArray(e.orders)&&(t=e.orders.reduce(((e,t)=>kr(e,t)),t));const{offset:n,limit:r}=e;if(null!=n){let e=0;t=vn(t,(()=>e++>=n))}return null!=r&&(t=Ar(t,r)),t}_query(e){const t={keys:!0,keyEncoding:"buffer",values:e.values};if(null!=e.prefix){const n=e.prefix.toString();t.gte=n,t.lt=n+"\xff"}const n=this.db.iterator(t);if(null!=n[Symbol.asyncIterator])return async function*(e){for await(const[t,n]of e)yield{key:new Er(t,!1),value:n};await e.close()}(n);if(null!=n.next&&null!=n.end)return r=n,{[Symbol.asyncIterator]:()=>({next:async()=>new Promise(((e,t)=>{r.next(((n,i,o)=>{null==n?null!=i?e({done:!1,value:{key:new Er(i,!1),value:o}}):r.end((n=>{null==n?e({done:!0,value:void 0}):t(n)})):t(n)}))})),return:async()=>new Promise(((e,t)=>{r.end((n=>{null==n?e({done:!0,value:void 0}):t(n)}))}))})};var r;throw new Error("Level returned incompatible iterator")}}class Or extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"The operation was aborted"),je(this,"code",void 0),je(this,"type",void 0),this.name="AbortError",this.code=Or.code,this.type=Or.type}}je(Or,"code","ABORT_ERR"),je(Or,"type","aborted");class Mr extends Error{constructor(e,t,n){var r;super(e),je(this,"code",void 0),je(this,"props",void 0),this.code=t,this.name=null!==(r=null===n||void 0===n?void 0:n.name)&&void 0!==r?r:"CodeError",this.props=null!==n&&void 0!==n?n:{}}}class Ur extends AggregateError{constructor(e,t,n,r){var i;super(e,t),je(this,"code",void 0),je(this,"props",void 0),this.code=n,this.name=null!==(i=null===r||void 0===r?void 0:r.name)&&void 0!==i?i:"AggregateCodeError",this.props=null!==r&&void 0!==r?r:{}}}class Fr extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected Peer"),je(this,"code",void 0),this.name="UnexpectedPeerError",this.code=Fr.code}}je(Fr,"code","ERR_UNEXPECTED_PEER");class Vr extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Invalid crypto exchange"),je(this,"code",void 0),this.name="InvalidCryptoExchangeError",this.code=Vr.code}}je(Vr,"code","ERR_INVALID_CRYPTO_EXCHANGE");class zr extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Invalid crypto transmission"),je(this,"code",void 0),this.name="InvalidCryptoTransmissionError",this.code=zr.code}}je(zr,"code","ERR_INVALID_CRYPTO_TRANSMISSION");const Kr="ERR_TIMEOUT",jr="ERR_INVALID_MESSAGE";function Hr(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0}function qr(e){return null!=e&&("function"===typeof e.then&&"function"===typeof e.catch&&"function"===typeof e.finally)}function Wr(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("positive integer expected, not ".concat(e))}function Gr(e){if(!((t=e)instanceof Uint8Array||null!=t&&"object"===typeof t&&"Uint8Array"===t.constructor.name))throw new Error("Uint8Array expected");for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];if(r.length>0&&!r.includes(e.length))throw new Error("Uint8Array expected of length ".concat(r,", not of length=").concat(e.length))}function Yr(e){if("function"!==typeof e||"function"!==typeof e.create)throw new Error("Hash should be wrapped by utils.wrapConstructor");Wr(e.outputLen),Wr(e.blockLen)}function Qr(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Xr(e,t){Gr(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least ".concat(n))}const Jr="object"===typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;const $r=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),Zr=(e,t)=>e<<32-t|e>>>t,ei=(e,t)=>e<<t|e>>>32-t>>>0;new Uint8Array(new Uint32Array([287454020]).buffer)[0];const ti=async()=>{};async function ni(e,t,n){let r=Date.now();for(let i=0;i<e;i++){n(i);const e=Date.now()-r;e>=0&&e<t||(await ti(),r+=e)}}function ri(e){if("string"!==typeof e)throw new Error("utf8ToBytes expected string, got ".concat(typeof e));return new Uint8Array((new TextEncoder).encode(e))}function ii(e){return"string"===typeof e&&(e=ri(e)),Gr(e),e}function oi(){let e=0;for(let n=0;n<arguments.length;n++){const t=n<0||arguments.length<=n?void 0:arguments[n];Gr(t),e+=t.length}const t=new Uint8Array(e);for(let n=0,r=0;n<arguments.length;n++){const e=n<0||arguments.length<=n?void 0:arguments[n];t.set(e,r),r+=e.length}return t}class si{clone(){return this._cloneInto()}}const ai={}.toString;function li(e){const t=t=>e().update(ii(t)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function ci(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32;if(Jr&&"function"===typeof Jr.getRandomValues)return Jr.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}const ui=(e,t,n)=>e&t^~e&n,hi=(e,t,n)=>e&t^e&n^t&n;class di extends si{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=$r(this.buffer)}update(e){Qr(this);const{view:t,buffer:n,blockLen:r}=this,i=(e=ii(e)).length;for(let o=0;o<i;){const s=Math.min(r-this.pos,i-o);if(s!==r)n.set(e.subarray(o,o+s),this.pos),this.pos+=s,o+=s,this.pos===r&&(this.process(t,0),this.pos=0);else{const t=$r(e);for(;r<=i-o;o+=r)this.process(t,o)}}return this.length+=e.length,this.roundClean(),this}digestInto(e){Qr(this),Xr(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:r,isLE:i}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>r-o&&(this.process(n,0),o=0);for(let u=o;u<r;u++)t[u]=0;!function(e,t,n,r){if("function"===typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),o=BigInt(4294967295),s=Number(n>>i&o),a=Number(n&o),l=r?4:0,c=r?0:4;e.setUint32(t+l,s,r),e.setUint32(t+c,a,r)}(n,r-8,BigInt(8*this.length),i),this.process(n,0);const s=$r(e),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=a/4,c=this.get();if(l>c.length)throw new Error("_sha2: outputLen bigger than state");for(let u=0;u<l;u++)s.setUint32(4*u,c[u],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:r,finished:i,destroyed:o,pos:s}=this;return e.length=r,e.pos=s,e.finished=i,e.destroyed=o,r%t&&e.buffer.set(n),e}}const fi=BigInt(2**32-1),pi=BigInt(32);function gi(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]?{h:Number(e&fi),l:Number(e>>pi&fi)}:{h:0|Number(e>>pi&fi),l:0|Number(e&fi)}}const yi={fromBig:gi,split:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new Uint32Array(e.length),r=new Uint32Array(e.length);for(let i=0;i<e.length;i++){const{h:o,l:s}=gi(e[i],t);[n[i],r[i]]=[o,s]}return[n,r]},toBig:(e,t)=>BigInt(e>>>0)<<pi|BigInt(t>>>0),shrSH:(e,t,n)=>e>>>n,shrSL:(e,t,n)=>e<<32-n|t>>>n,rotrSH:(e,t,n)=>e>>>n|t<<32-n,rotrSL:(e,t,n)=>e<<32-n|t>>>n,rotrBH:(e,t,n)=>e<<64-n|t>>>n-32,rotrBL:(e,t,n)=>e>>>n-32|t<<64-n,rotr32H:(e,t)=>t,rotr32L:(e,t)=>e,rotlSH:(e,t,n)=>e<<n|t>>>32-n,rotlSL:(e,t,n)=>t<<n|e>>>32-n,rotlBH:(e,t,n)=>t<<n-32|e>>>64-n,rotlBL:(e,t,n)=>e<<n-32|t>>>64-n,add:function(e,t,n,r){const i=(t>>>0)+(r>>>0);return{h:e+n+(i/2**32|0)|0,l:0|i}},add3L:(e,t,n)=>(e>>>0)+(t>>>0)+(n>>>0),add3H:(e,t,n,r)=>t+n+r+(e/2**32|0)|0,add4L:(e,t,n,r)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0),add4H:(e,t,n,r,i)=>t+n+r+i+(e/2**32|0)|0,add5H:(e,t,n,r,i,o)=>t+n+r+i+o+(e/2**32|0)|0,add5L:(e,t,n,r,i)=>(e>>>0)+(t>>>0)+(n>>>0)+(r>>>0)+(i>>>0)},vi=yi,[mi,wi]=(()=>vi.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map((e=>BigInt(e)))))(),bi=new Uint32Array(80),Ei=new Uint32Array(80);class _i extends di{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:r,Ch:i,Cl:o,Dh:s,Dl:a,Eh:l,El:c,Fh:u,Fl:h,Gh:d,Gl:f,Hh:p,Hl:g}=this;return[e,t,n,r,i,o,s,a,l,c,u,h,d,f,p,g]}set(e,t,n,r,i,o,s,a,l,c,u,h,d,f,p,g){this.Ah=0|e,this.Al=0|t,this.Bh=0|n,this.Bl=0|r,this.Ch=0|i,this.Cl=0|o,this.Dh=0|s,this.Dl=0|a,this.Eh=0|l,this.El=0|c,this.Fh=0|u,this.Fl=0|h,this.Gh=0|d,this.Gl=0|f,this.Hh=0|p,this.Hl=0|g}process(e,t){for(let m=0;m<16;m++,t+=4)bi[m]=e.getUint32(t),Ei[m]=e.getUint32(t+=4);for(let m=16;m<80;m++){const e=0|bi[m-15],t=0|Ei[m-15],n=vi.rotrSH(e,t,1)^vi.rotrSH(e,t,8)^vi.shrSH(e,t,7),r=vi.rotrSL(e,t,1)^vi.rotrSL(e,t,8)^vi.shrSL(e,t,7),i=0|bi[m-2],o=0|Ei[m-2],s=vi.rotrSH(i,o,19)^vi.rotrBH(i,o,61)^vi.shrSH(i,o,6),a=vi.rotrSL(i,o,19)^vi.rotrBL(i,o,61)^vi.shrSL(i,o,6),l=vi.add4L(r,a,Ei[m-7],Ei[m-16]),c=vi.add4H(l,n,s,bi[m-7],bi[m-16]);bi[m]=0|c,Ei[m]=0|l}let{Ah:n,Al:r,Bh:i,Bl:o,Ch:s,Cl:a,Dh:l,Dl:c,Eh:u,El:h,Fh:d,Fl:f,Gh:p,Gl:g,Hh:y,Hl:v}=this;for(let m=0;m<80;m++){const e=vi.rotrSH(u,h,14)^vi.rotrSH(u,h,18)^vi.rotrBH(u,h,41),t=vi.rotrSL(u,h,14)^vi.rotrSL(u,h,18)^vi.rotrBL(u,h,41),w=u&d^~u&p,b=h&f^~h&g,E=vi.add5L(v,t,b,wi[m],Ei[m]),_=vi.add5H(E,y,e,w,mi[m],bi[m]),S=0|E,k=vi.rotrSH(n,r,28)^vi.rotrBH(n,r,34)^vi.rotrBH(n,r,39),A=vi.rotrSL(n,r,28)^vi.rotrBL(n,r,34)^vi.rotrBL(n,r,39),I=n&i^n&s^i&s,T=r&o^r&a^o&a;y=0|p,v=0|g,p=0|d,g=0|f,d=0|u,f=0|h,({h:u,l:h}=vi.add(0|l,0|c,0|_,0|S)),l=0|s,c=0|a,s=0|i,a=0|o,i=0|n,o=0|r;const R=vi.add3L(S,A,T);n=vi.add3H(R,_,k,I),r=0|R}({h:n,l:r}=vi.add(0|this.Ah,0|this.Al,0|n,0|r)),({h:i,l:o}=vi.add(0|this.Bh,0|this.Bl,0|i,0|o)),({h:s,l:a}=vi.add(0|this.Ch,0|this.Cl,0|s,0|a)),({h:l,l:c}=vi.add(0|this.Dh,0|this.Dl,0|l,0|c)),({h:u,l:h}=vi.add(0|this.Eh,0|this.El,0|u,0|h)),({h:d,l:f}=vi.add(0|this.Fh,0|this.Fl,0|d,0|f)),({h:p,l:g}=vi.add(0|this.Gh,0|this.Gl,0|p,0|g)),({h:y,l:v}=vi.add(0|this.Hh,0|this.Hl,0|y,0|v)),this.set(n,r,i,o,s,a,l,c,u,h,d,f,p,g,y,v)}roundClean(){bi.fill(0),Ei.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Si=li((()=>new _i)),ki=(BigInt(0),BigInt(1)),Ai=BigInt(2);function Ii(e){return e instanceof Uint8Array||null!=e&&"object"===typeof e&&"Uint8Array"===e.constructor.name}function Ti(e){if(!Ii(e))throw new Error("Uint8Array expected")}const Ri=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function Ci(e){Ti(e);let t="";for(let n=0;n<e.length;n++)t+=Ri[e[n]];return t}function xi(e){if("string"!==typeof e)throw new Error("hex string expected, got "+typeof e);return BigInt(""===e?"0":"0x".concat(e))}const Pi={_0:48,_9:57,_A:65,_F:70,_a:97,_f:102};function Di(e){return e>=Pi._0&&e<=Pi._9?e-Pi._0:e>=Pi._A&&e<=Pi._F?e-(Pi._A-10):e>=Pi._a&&e<=Pi._f?e-(Pi._a-10):void 0}function Ni(e){if("string"!==typeof e)throw new Error("hex string expected, got "+typeof e);const t=e.length,n=t/2;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const r=new Uint8Array(n);for(let i=0,o=0;i<n;i++,o+=2){const t=Di(e.charCodeAt(o)),n=Di(e.charCodeAt(o+1));if(void 0===t||void 0===n){const t=e[o]+e[o+1];throw new Error('hex string expected, got non-hex character "'+t+'" at index '+o)}r[i]=16*t+n}return r}function Bi(e){return xi(Ci(e))}function Li(e){return Ti(e),xi(Ci(Uint8Array.from(e).reverse()))}function Oi(e,t){return Ni(e.toString(16).padStart(2*t,"0"))}function Mi(e,t){return Oi(e,t).reverse()}function Ui(e,t,n){let r;if("string"===typeof t)try{r=Ni(t)}catch(o){throw new Error("".concat(e,' must be valid hex string, got "').concat(t,'". Cause: ').concat(o))}else{if(!Ii(t))throw new Error("".concat(e," must be hex string or Uint8Array"));r=Uint8Array.from(t)}const i=r.length;if("number"===typeof n&&i!==n)throw new Error("".concat(e," expected ").concat(n," bytes, got ").concat(i));return r}function Fi(){let e=0;for(let n=0;n<arguments.length;n++){const t=n<0||arguments.length<=n?void 0:arguments[n];Ti(t),e+=t.length}const t=new Uint8Array(e);for(let n=0,r=0;n<arguments.length;n++){const e=n<0||arguments.length<=n?void 0:arguments[n];t.set(e,r),r+=e.length}return t}const Vi=e=>(Ai<<BigInt(e-1))-ki,zi=e=>new Uint8Array(e),Ki=e=>Uint8Array.from(e);function ji(e,t,n){if("number"!==typeof e||e<2)throw new Error("hashLen must be a number");if("number"!==typeof t||t<2)throw new Error("qByteLen must be a number");if("function"!==typeof n)throw new Error("hmacFn must be a function");let r=zi(e),i=zi(e),o=0;const s=()=>{r.fill(1),i.fill(0),o=0},a=function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];return n(i,r,...t)},l=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:zi();i=a(Ki([0]),e),r=a(),0!==e.length&&(i=a(Ki([1]),e),r=a())},c=()=>{if(o++>=1e3)throw new Error("drbg: tried 1000 values");let e=0;const n=[];for(;e<t;){r=a();const t=r.slice();n.push(t),e+=r.length}return Fi(...n)};return(e,t)=>{let n;for(s(),l(e);!(n=t(c()));)l();return s(),n}}const Hi={bigint:e=>"bigint"===typeof e,function:e=>"function"===typeof e,boolean:e=>"boolean"===typeof e,string:e=>"string"===typeof e,stringOrUint8Array:e=>"string"===typeof e||Ii(e),isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>"function"===typeof e&&Number.isSafeInteger(e.outputLen)};function qi(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=(t,n,r)=>{const i=Hi[n];if("function"!==typeof i)throw new Error('Invalid validator "'.concat(n,'", expected function'));const o=e[t];if((!r||void 0!==o)&&!i(o,e))throw new Error("Invalid param ".concat(String(t),"=").concat(o," (").concat(typeof o,"), expected ").concat(n))};for(const[i,o]of Object.entries(t))r(i,o,!1);for(const[i,o]of Object.entries(n))r(i,o,!0);return e}const Wi=BigInt(0),Gi=BigInt(1),Yi=BigInt(2),Qi=BigInt(3),Xi=BigInt(4),Ji=BigInt(5),$i=BigInt(8);BigInt(9),BigInt(16);function Zi(e,t){const n=e%t;return n>=Wi?n:t+n}function eo(e,t,n){if(n<=Wi||t<Wi)throw new Error("Expected power/modulo > 0");if(n===Gi)return Wi;let r=Gi;for(;t>Wi;)t&Gi&&(r=r*e%n),e=e*e%n,t>>=Gi;return r}function to(e,t,n){let r=e;for(;t-- >Wi;)r*=r,r%=n;return r}function no(e,t){if(e===Wi||t<=Wi)throw new Error("invert: expected positive integers, got n=".concat(e," mod=").concat(t));let n=Zi(e,t),r=t,i=Wi,o=Gi,s=Gi,a=Wi;for(;n!==Wi;){const e=r/n,t=r%n,l=i-s*e,c=o-a*e;r=n,n=t,i=s,o=a,s=l,a=c}if(r!==Gi)throw new Error("invert: does not exist");return Zi(i,t)}function ro(e){if(e%Xi===Qi){const t=(e+Gi)/Xi;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}if(e%$i===Ji){const t=(e-Ji)/$i;return function(e,n){const r=e.mul(n,Yi),i=e.pow(r,t),o=e.mul(n,i),s=e.mul(e.mul(o,Yi),i),a=e.mul(o,e.sub(s,e.ONE));if(!e.eql(e.sqr(a),n))throw new Error("Cannot find square root");return a}}return function(e){const t=(e-Gi)/Yi;let n,r,i;for(n=e-Gi,r=0;n%Yi===Wi;n/=Yi,r++);for(i=Yi;i<e&&eo(i,t,e)!==e-Gi;i++);if(1===r){const t=(e+Gi)/Xi;return function(e,n){const r=e.pow(n,t);if(!e.eql(e.sqr(r),n))throw new Error("Cannot find square root");return r}}const o=(n+Gi)/Yi;return function(e,s){if(e.pow(s,t)===e.neg(e.ONE))throw new Error("Cannot find square root");let a=r,l=e.pow(e.mul(e.ONE,i),n),c=e.pow(s,o),u=e.pow(s,n);for(;!e.eql(u,e.ONE);){if(e.eql(u,e.ZERO))return e.ZERO;let t=1;for(let r=e.sqr(u);t<a&&!e.eql(r,e.ONE);t++)r=e.sqr(r);const n=e.pow(l,Gi<<BigInt(a-t-1));l=e.sqr(n),c=e.mul(c,n),u=e.mul(u,l),a=t}return c}}(e)}const io=(e,t)=>(Zi(e,t)&Gi)===Gi,oo=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function so(e,t){const n=void 0!==t?t:e.toString(2).length;return{nBitLength:n,nByteLength:Math.ceil(n/8)}}function ao(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(e<=Wi)throw new Error("Expected Field ORDER > 0, got ".concat(e));const{nBitLength:i,nByteLength:o}=so(e,t);if(o>2048)throw new Error("Field lengths over 2048 bytes are not supported");const s=ro(e),a=Object.freeze({ORDER:e,BITS:i,BYTES:o,MASK:Vi(i),ZERO:Wi,ONE:Gi,create:t=>Zi(t,e),isValid:t=>{if("bigint"!==typeof t)throw new Error("Invalid field element: expected bigint, got ".concat(typeof t));return Wi<=t&&t<e},is0:e=>e===Wi,isOdd:e=>(e&Gi)===Gi,neg:t=>Zi(-t,e),eql:(e,t)=>e===t,sqr:t=>Zi(t*t,e),add:(t,n)=>Zi(t+n,e),sub:(t,n)=>Zi(t-n,e),mul:(t,n)=>Zi(t*n,e),pow:(e,t)=>function(e,t,n){if(n<Wi)throw new Error("Expected power > 0");if(n===Wi)return e.ONE;if(n===Gi)return t;let r=e.ONE,i=t;for(;n>Wi;)n&Gi&&(r=e.mul(r,i)),i=e.sqr(i),n>>=Gi;return r}(a,e,t),div:(t,n)=>Zi(t*no(n,e),e),sqrN:e=>e*e,addN:(e,t)=>e+t,subN:(e,t)=>e-t,mulN:(e,t)=>e*t,inv:t=>no(t,e),sqrt:r.sqrt||(e=>s(a,e)),invertBatch:e=>function(e,t){const n=new Array(t.length),r=t.reduce(((t,r,i)=>e.is0(r)?t:(n[i]=t,e.mul(t,r))),e.ONE),i=e.inv(r);return t.reduceRight(((t,r,i)=>e.is0(r)?t:(n[i]=e.mul(t,n[i]),e.mul(t,r))),i),n}(a,e),cmov:(e,t,n)=>n?t:e,toBytes:e=>n?Mi(e,o):Oi(e,o),fromBytes:e=>{if(e.length!==o)throw new Error("Fp.fromBytes: expected ".concat(o,", got ").concat(e.length));return n?Li(e):Bi(e)}});return Object.freeze(a)}function lo(e){if("bigint"!==typeof e)throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function co(e){const t=lo(e);return t+Math.ceil(t/2)}const uo=BigInt(0),ho=BigInt(1);function fo(e,t){const n=(e,t)=>{const n=t.negate();return e?n:t},r=e=>({windows:Math.ceil(t/e)+1,windowSize:2**(e-1)});return{constTimeNegate:n,unsafeLadder(t,n){let r=e.ZERO,i=t;for(;n>uo;)n&ho&&(r=r.add(i)),i=i.double(),n>>=ho;return r},precomputeWindow(e,t){const{windows:n,windowSize:i}=r(t),o=[];let s=e,a=s;for(let r=0;r<n;r++){a=s,o.push(a);for(let e=1;e<i;e++)a=a.add(s),o.push(a);s=a.double()}return o},wNAF(t,i,o){const{windows:s,windowSize:a}=r(t);let l=e.ZERO,c=e.BASE;const u=BigInt(2**t-1),h=2**t,d=BigInt(t);for(let e=0;e<s;e++){const t=e*a;let r=Number(o&u);o>>=d,r>a&&(r-=h,o+=ho);const s=t,f=t+Math.abs(r)-1,p=e%2!==0,g=r<0;0===r?c=c.add(n(p,i[s])):l=l.add(n(g,i[f]))}return{p:l,f:c}},wNAFCached(e,t,n,r){const i=e._WINDOW_SIZE||1;let o=t.get(e);return o||(o=this.precomputeWindow(e,i),1!==i&&t.set(e,r(o))),this.wNAF(i,o,n)}}}function po(e){return function(e){const t=oo.reduce(((e,t)=>(e[t]="function",e)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"});qi(e,t)}(e.Fp),qi(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...so(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}const go=BigInt(0),yo=BigInt(1),vo=BigInt(2),mo=BigInt(8),wo={zip215:!0};function bo(e){const t=function(e){const t=po(e);return qi(e,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...t})}(e),{Fp:n,n:r,prehash:i,hash:o,randomBytes:s,nByteLength:a,h:l}=t,c=vo<<BigInt(8*a)-yo,u=n.create,h=t.uvRatio||((e,t)=>{try{return{isValid:!0,value:n.sqrt(e*n.inv(t))}}catch(r){return{isValid:!1,value:go}}}),d=t.adjustScalarBytes||(e=>e),f=t.domain||((e,t,n)=>{if(t.length||n)throw new Error("Contexts/pre-hash are not supported");return e}),p=e=>"bigint"===typeof e&&go<e,g=(e,t)=>p(e)&&p(t)&&e<t,y=e=>e===go||g(e,c);function v(e,t){if(g(e,t))return e;throw new Error("Expected valid scalar < ".concat(t,", got ").concat(typeof e," ").concat(e))}function m(e){return e===go?e:v(e,r)}const w=new Map;function b(e){if(!(e instanceof E))throw new Error("ExtendedPoint expected")}class E{constructor(e,t,n,r){if(this.ex=e,this.ey=t,this.ez=n,this.et=r,!y(e))throw new Error("x required");if(!y(t))throw new Error("y required");if(!y(n))throw new Error("z required");if(!y(r))throw new Error("t required")}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(e){if(e instanceof E)throw new Error("extended point not allowed");const{x:t,y:n}=e||{};if(!y(t)||!y(n))throw new Error("invalid affine point");return new E(t,n,yo,u(t*n))}static normalizeZ(e){const t=n.invertBatch(e.map((e=>e.ez)));return e.map(((e,n)=>e.toAffine(t[n]))).map(E.fromAffine)}_setWindowSize(e){this._WINDOW_SIZE=e,w.delete(this)}assertValidity(){const{a:e,d:n}=t;if(this.is0())throw new Error("bad point: ZERO");const{ex:r,ey:i,ez:o,et:s}=this,a=u(r*r),l=u(i*i),c=u(o*o),h=u(c*c),d=u(a*e);if(u(c*u(d+l))!==u(h+u(n*u(a*l))))throw new Error("bad point: equation left != right (1)");if(u(r*i)!==u(o*s))throw new Error("bad point: equation left != right (2)")}equals(e){b(e);const{ex:t,ey:n,ez:r}=this,{ex:i,ey:o,ez:s}=e,a=u(t*s),l=u(i*r),c=u(n*s),h=u(o*r);return a===l&&c===h}is0(){return this.equals(E.ZERO)}negate(){return new E(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:e}=t,{ex:n,ey:r,ez:i}=this,o=u(n*n),s=u(r*r),a=u(vo*u(i*i)),l=u(e*o),c=n+r,h=u(u(c*c)-o-s),d=l+s,f=d-a,p=l-s,g=u(h*f),y=u(d*p),v=u(h*p),m=u(f*d);return new E(g,y,m,v)}add(e){b(e);const{a:n,d:r}=t,{ex:i,ey:o,ez:s,et:a}=this,{ex:l,ey:c,ez:h,et:d}=e;if(n===BigInt(-1)){const e=u((o-i)*(c+l)),t=u((o+i)*(c-l)),n=u(t-e);if(n===go)return this.double();const r=u(s*vo*d),f=u(a*vo*h),p=f+r,g=t+e,y=f-r,v=u(p*n),m=u(g*y),w=u(p*y),b=u(n*g);return new E(v,m,b,w)}const f=u(i*l),p=u(o*c),g=u(a*r*d),y=u(s*h),v=u((i+o)*(l+c)-f-p),m=y-g,w=y+g,_=u(p-n*f),S=u(v*m),k=u(w*_),A=u(v*_),I=u(m*w);return new E(S,k,I,A)}subtract(e){return this.add(e.negate())}wNAF(e){return k.wNAFCached(this,w,e,E.normalizeZ)}multiply(e){const{p:t,f:n}=this.wNAF(v(e,r));return E.normalizeZ([t,n])[0]}multiplyUnsafe(e){let t=m(e);return t===go?S:this.equals(S)||t===yo?this:this.equals(_)?this.wNAF(t).p:k.unsafeLadder(this,t)}isSmallOrder(){return this.multiplyUnsafe(l).is0()}isTorsionFree(){return k.unsafeLadder(this,r).is0()}toAffine(e){const{ex:t,ey:r,ez:i}=this,o=this.is0();null==e&&(e=o?mo:n.inv(i));const s=u(t*e),a=u(r*e),l=u(i*e);if(o)return{x:go,y:yo};if(l!==yo)throw new Error("invZ was invalid");return{x:s,y:a}}clearCofactor(){const{h:e}=t;return e===yo?this:this.multiplyUnsafe(e)}static fromHex(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{d:i,a:o}=t,s=n.BYTES,a=(e=Ui("pointHex",e,s)).slice(),l=e[s-1];a[s-1]=-129&l;const d=Li(a);d===go||v(d,r?c:n.ORDER);const f=u(d*d),p=u(f-yo),g=u(i*f-o);let{isValid:y,value:m}=h(p,g);if(!y)throw new Error("Point.fromHex: invalid y coordinate");const w=(m&yo)===yo,b=0!==(128&l);if(!r&&m===go&&b)throw new Error("Point.fromHex: x=0 and x_0=1");return b!==w&&(m=u(-m)),E.fromAffine({x:m,y:d})}static fromPrivateKey(e){return T(e).point}toRawBytes(){const{x:e,y:t}=this.toAffine(),r=Mi(t,n.BYTES);return r[r.length-1]|=e&yo?128:0,r}toHex(){return Ci(this.toRawBytes())}}E.BASE=new E(t.Gx,t.Gy,yo,u(t.Gx*t.Gy)),E.ZERO=new E(go,yo,yo,go);const{BASE:_,ZERO:S}=E,k=fo(E,8*a);function A(e){return Zi(e,r)}function I(e){return A(Li(e))}function T(e){const t=a;e=Ui("private key",e,t);const n=Ui("hashed private key",o(e),2*t),r=d(n.slice(0,t)),i=n.slice(t,2*t),s=I(r),l=_.multiply(s),c=l.toRawBytes();return{head:r,prefix:i,scalar:s,point:l,pointBytes:c}}function R(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uint8Array;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const s=Fi(...n);return I(o(f(s,Ui("context",e),!!i)))}const C=wo;_._setWindowSize(8);const x={getExtendedPublicKey:T,randomPrivateKey:()=>s(n.BYTES),precompute(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:E.BASE;return t._setWindowSize(e),t.multiply(BigInt(3)),t}};return{CURVE:t,getPublicKey:function(e){return T(e).pointBytes},sign:function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e=Ui("message",e),i&&(e=i(e));const{prefix:o,scalar:s,pointBytes:l}=T(t),c=R(r.context,o,e),u=_.multiply(c).toRawBytes(),h=A(c+R(r.context,u,l,e)*s);return m(h),Ui("result",Fi(u,Mi(h,n.BYTES)),2*a)},verify:function(e,t,r){let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:C;const{context:s,zip215:a}=o,l=n.BYTES;e=Ui("signature",e,2*l),t=Ui("message",t),i&&(t=i(t));const c=Li(e.slice(l,2*l));let u,h,d;try{u=E.fromHex(r,a),h=E.fromHex(e.slice(0,l),a),d=_.multiplyUnsafe(c)}catch(p){return!1}if(!a&&u.isSmallOrder())return!1;const f=R(s,h.toRawBytes(),u.toRawBytes(),t);return h.add(u.multiplyUnsafe(f)).subtract(d).clearCofactor().equals(E.ZERO)},ExtendedPoint:E,utils:x}}const Eo=BigInt(0),_o=BigInt(1);function So(e){const t=(qi(n=e,{a:"bigint"},{montgomeryBits:"isSafeInteger",nByteLength:"isSafeInteger",adjustScalarBytes:"function",domain:"function",powPminus2:"function",Gu:"bigint"}),Object.freeze({...n}));var n;const{P:r}=t,i=e=>Zi(e,r),o=t.montgomeryBits,s=Math.ceil(o/8),a=t.nByteLength,l=t.adjustScalarBytes||(e=>e),c=t.powPminus2||(e=>eo(e,r-BigInt(2),r));function u(e,t,n){const r=i(e*(t-n));return[t=i(t-r),n=i(n+r)]}function h(e){if("bigint"===typeof e&&Eo<=e&&e<r)return e;throw new Error("Expected valid scalar 0 < scalar < CURVE.P")}const d=(t.a-BigInt(2))/BigInt(4);function f(e){return Mi(i(e),s)}function p(e,t){const n=function(e){const t=Ui("u coordinate",e,s);return 32===a&&(t[31]&=127),Li(t)}(t),r=function(e){const t=Ui("scalar",e),n=t.length;if(n!==s&&n!==a)throw new Error("Expected ".concat(s," or ").concat(a," bytes, got ").concat(n));return Li(l(t))}(e),p=function(e,t){const n=h(e),r=h(t),s=n;let a,l=_o,f=Eo,p=n,g=_o,y=Eo;for(let c=BigInt(o-1);c>=Eo;c--){const e=r>>c&_o;y^=e,a=u(y,l,p),l=a[0],p=a[1],a=u(y,f,g),f=a[0],g=a[1],y=e;const t=l+f,n=i(t*t),o=l-f,h=i(o*o),v=n-h,m=p+g,w=i((p-g)*t),b=i(m*o),E=w+b,_=w-b;p=i(E*E),g=i(s*i(_*_)),l=i(n*h),f=i(v*(n+i(d*v)))}a=u(y,l,p),l=a[0],p=a[1],a=u(y,f,g),f=a[0],g=a[1];const v=c(f);return i(l*v)}(n,r);if(p===Eo)throw new Error("Invalid private or public key received");return f(p)}const g=f(t.Gu);function y(e){return p(e,g)}return{scalarMult:p,scalarMultBase:y,getSharedSecret:(e,t)=>p(e,t),getPublicKey:e=>y(e),utils:{randomPrivateKey:()=>t.randomBytes(t.nByteLength)},GuBytes:g}}const ko=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Ao=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),Io=(BigInt(0),BigInt(1)),To=BigInt(2),Ro=BigInt(5),Co=BigInt(10),xo=BigInt(20),Po=BigInt(40),Do=BigInt(80);function No(e){const t=ko,n=e*e%t*e%t,r=to(n,To,t)*n%t,i=to(r,Io,t)*e%t,o=to(i,Ro,t)*i%t,s=to(o,Co,t)*o%t,a=to(s,xo,t)*s%t,l=to(a,Po,t)*a%t,c=to(l,Do,t)*l%t,u=to(c,Do,t)*l%t,h=to(u,Co,t)*o%t;return{pow_p_5_8:to(h,To,t)*e%t,b2:n}}function Bo(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}function Lo(e,t){const n=ko,r=Zi(t*t*t,n),i=Zi(r*r*t,n);let o=Zi(e*r*No(e*i).pow_p_5_8,n);const s=Zi(t*o*o,n),a=o,l=Zi(o*Ao,n),c=s===e,u=s===Zi(-e,n),h=s===Zi(-e*Ao,n);return c&&(o=a),(u||h)&&(o=l),io(o,n)&&(o=Zi(-o,n)),{isValid:c||u,value:o}}const Oo=ao(ko,void 0,!0),Mo={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:Oo,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:Si,randomBytes:ci,adjustScalarBytes:Bo,uvRatio:Lo},Uo=bo(Mo);function Fo(e,t,n){if(t.length>255)throw new Error("Context is too big");return oi(ri("SigEd25519 no Ed25519 collisions"),new Uint8Array([n?1:0,t.length]),t,e)}const Vo=(()=>So({P:ko,a:BigInt(486662),montgomeryBits:255,nByteLength:32,Gu:BigInt(9),powPminus2:e=>{const t=ko,{pow_p_5_8:n,b2:r}=No(e);return Zi(to(n,BigInt(3),t)*r,t)},adjustScalarBytes:Bo,randomBytes:ci}))();const zo=(Oo.ORDER+BigInt(3))/BigInt(8);Oo.pow(To,zo),Oo.sqrt(Oo.neg(Oo.ONE)),Oo.ORDER,BigInt(5),BigInt(8),BigInt(486662);!function(e,t){if(!e.isOdd)throw new Error("Field doesn't have isOdd");const n=e.sqrt(t);e.isOdd(n)&&e.neg(n)}(Oo,Oo.neg(BigInt(486664)));BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235"),BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952"),BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");const Ko=32,jo=64,Ho=32;function qo(e,t){const n=new Uint8Array(jo);for(let r=0;r<Ho;r++)n[r]=e[r],n[Ho+r]=t[r];return n}function Wo(e,t){null==t&&(t=e.reduce(((e,t)=>e+t.length),0));const n=hr(t);let r=0;for(const i of e)n.set(i,r),r+=i.length;return n}const Go={get(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:globalThis).crypto;if(null==e||null==e.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}},Yo={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function Qo(e){var t,n,r,i,o,s;const a=null!==(t=null===e||void 0===e?void 0:e.algorithm)&&void 0!==t?t:"AES-GCM";let l=null!==(n=null===e||void 0===e?void 0:e.keyLength)&&void 0!==n?n:16;const c=null!==(r=null===e||void 0===e?void 0:e.nonceLength)&&void 0!==r?r:12,u=null!==(i=null===e||void 0===e?void 0:e.digest)&&void 0!==i?i:"SHA-256",h=null!==(o=null===e||void 0===e?void 0:e.saltLength)&&void 0!==o?o:16,d=null!==(s=null===e||void 0===e?void 0:e.iterations)&&void 0!==s?s:32767,f=Go.get();l*=8;return{encrypt:async function(e,t){const n=f.getRandomValues(new Uint8Array(h)),r=f.getRandomValues(new Uint8Array(c)),i={name:a,iv:r};let o;if("string"===typeof t&&(t=yr(t)),0===t.length){o=await f.subtle.importKey("jwk",Yo,{name:"AES-GCM"},!0,["encrypt"]);try{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);o=await f.subtle.deriveKey(e,r,{name:a,length:l},!0,["encrypt"])}catch{o=await f.subtle.importKey("jwk",Yo,{name:"AES-GCM"},!0,["encrypt"])}}else{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);o=await f.subtle.deriveKey(e,r,{name:a,length:l},!0,["encrypt"])}const s=await f.subtle.encrypt(i,o,e);return Wo([n,i.iv,new Uint8Array(s)])},decrypt:async function(e,t){const n=e.subarray(0,h),r=e.subarray(h,h+c),i=e.subarray(h+c),o={name:a,iv:r};let s;if("string"===typeof t&&(t=yr(t)),0===t.length)try{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);s=await f.subtle.deriveKey(e,r,{name:a,length:l},!0,["decrypt"])}catch{s=await f.subtle.importKey("jwk",Yo,{name:"AES-GCM"},!0,["decrypt"])}else{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);s=await f.subtle.deriveKey(e,r,{name:a,length:l},!0,["decrypt"])}const p=await f.subtle.decrypt(o,s,i);return new Uint8Array(p)}}}async function Xo(e,t){const n=Qo(),r=await n.encrypt(e,t);return cn.encode(r)}const Jo=Math.pow(2,7),$o=Math.pow(2,14),Zo=Math.pow(2,21),es=Math.pow(2,28),ts=Math.pow(2,35),ns=Math.pow(2,42),rs=Math.pow(2,49),is=128,os=127;function ss(e){if(e<Jo)return 1;if(e<$o)return 2;if(e<Zo)return 3;if(e<es)return 4;if(e<ts)return 5;if(e<ns)return 6;if(e<rs)return 7;if(null!=Number.MAX_SAFE_INTEGER&&e>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function as(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;switch(ss(e)){case 8:t[n++]=255&e|is,e/=128;case 7:t[n++]=255&e|is,e/=128;case 6:t[n++]=255&e|is,e/=128;case 5:t[n++]=255&e|is,e/=128;case 4:t[n++]=255&e|is,e>>>=7;case 3:t[n++]=255&e|is,e>>>=7;case 2:t[n++]=255&e|is,e>>>=7;case 1:t[n++]=255&e,e>>>=7;break;default:throw new Error("unreachable")}return t}function ls(e,t){let n=e[t],r=0;if(r+=n&os,n<is)return r;if(n=e[t+1],r+=(n&os)<<7,n<is)return r;if(n=e[t+2],r+=(n&os)<<14,n<is)return r;if(n=e[t+3],r+=(n&os)<<21,n<is)return r;if(n=e[t+4],r+=(n&os)*es,n<is)return r;if(n=e[t+5],r+=(n&os)*ts,n<is)return r;if(n=e[t+6],r+=(n&os)*ns,n<is)return r;if(n=e[t+7],r+=(n&os)*rs,n<is)return r;throw new RangeError("Could not decode varint")}function cs(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return null==t&&(t=hr(ss(e))),t instanceof Uint8Array?as(e,t,n):function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;switch(ss(e)){case 8:t.set(n++,255&e|is),e/=128;case 7:t.set(n++,255&e|is),e/=128;case 6:t.set(n++,255&e|is),e/=128;case 5:t.set(n++,255&e|is),e/=128;case 4:t.set(n++,255&e|is),e>>>=7;case 3:t.set(n++,255&e|is),e>>>=7;case 2:t.set(n++,255&e|is),e>>>=7;case 1:t.set(n++,255&e),e>>>=7;break;default:throw new Error("unreachable")}return t}(e,t,n)}function us(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e instanceof Uint8Array?ls(e,t):function(e,t){let n=e.get(t),r=0;if(r+=n&os,n<is)return r;if(n=e.get(t+1),r+=(n&os)<<7,n<is)return r;if(n=e.get(t+2),r+=(n&os)<<14,n<is)return r;if(n=e.get(t+3),r+=(n&os)<<21,n<is)return r;if(n=e.get(t+4),r+=(n&os)*es,n<is)return r;if(n=e.get(t+5),r+=(n&os)*ts,n<is)return r;if(n=e.get(t+6),r+=(n&os)*ns,n<is)return r;if(n=e.get(t+7),r+=(n&os)*rs,n<is)return r;throw new RangeError("Could not decode varint")}(e,t)}const hs=new Float32Array([-0]),ds=new Uint8Array(hs.buffer);function fs(e,t,n){hs[0]=e,t[n]=ds[0],t[n+1]=ds[1],t[n+2]=ds[2],t[n+3]=ds[3]}const ps=new Float64Array([-0]),gs=new Uint8Array(ps.buffer);function ys(e,t,n){ps[0]=e,t[n]=gs[0],t[n+1]=gs[1],t[n+2]=gs[2],t[n+3]=gs[3],t[n+4]=gs[4],t[n+5]=gs[5],t[n+6]=gs[6],t[n+7]=gs[7]}const vs=BigInt(Number.MAX_SAFE_INTEGER),ms=BigInt(Number.MIN_SAFE_INTEGER);class ws{constructor(e,t){je(this,"lo",void 0),je(this,"hi",void 0),this.lo=0|e,this.hi=0|t}toNumber(){if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&this.hi>>>31>0){const e=1+~this.lo>>>0;let t=~this.hi>>>0;return 0===e&&(t=t+1>>>0),-(e+4294967296*t)}return this.lo+4294967296*this.hi}toBigInt(){if(arguments.length>0&&void 0!==arguments[0]&&arguments[0])return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31!==0){const e=1+~this.lo>>>0;let t=~this.hi>>>0;return 0===e&&(t=t+1>>>0),-(BigInt(e)+(BigInt(t)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}static fromBigInt(e){if(0n===e)return bs;if(e<vs&&e>ms)return this.fromNumber(Number(e));const t=e<0n;t&&(e=-e);let n=e>>32n,r=e-(n<<32n);return t&&(n=0n|~n,r=0n|~r,++r>Es&&(r=0n,++n>Es&&(n=0n))),new ws(Number(r),Number(n))}static fromNumber(e){if(0===e)return bs;const t=e<0;t&&(e=-e);let n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new ws(n,r)}static from(e){return"number"===typeof e?ws.fromNumber(e):"bigint"===typeof e?ws.fromBigInt(e):"string"===typeof e?ws.fromBigInt(BigInt(e)):null!=e.low||null!=e.high?new ws(e.low>>>0,e.high>>>0):bs}}const bs=new ws(0,0);bs.toBigInt=function(){return 0n},bs.zzEncode=bs.zzDecode=function(){return this},bs.length=function(){return 1};const Es=4294967296n;function _s(e,t,n){const r=n;let i,o;for(let s=0;s<e.length;++s)i=e.charCodeAt(s),i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&56320===(64512&(o=e.charCodeAt(s+1)))?(i=65536+((1023&i)<<10)+(1023&o),++s,t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128);return n-r}function Ss(e,t){return RangeError("index out of range: ".concat(e.pos," + ").concat(null!==t&&void 0!==t?t:1," > ").concat(e.len))}function ks(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}class As{constructor(e){je(this,"buf",void 0),je(this,"pos",void 0),je(this,"len",void 0),je(this,"_slice",Uint8Array.prototype.subarray),this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Ss(this,10);return e}int32(){return 0|this.uint32()}sint32(){const e=this.uint32();return e>>>1^-(1&e)}bool(){return 0!==this.uint32()}fixed32(){if(this.pos+4>this.len)throw Ss(this,4);return ks(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw Ss(this,4);return 0|ks(this.buf,this.pos+=4)}float(){if(this.pos+4>this.len)throw Ss(this,4);const e=function(e,t){return ds[0]=e[t],ds[1]=e[t+1],ds[2]=e[t+2],ds[3]=e[t+3],hs[0]}(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw Ss(this,4);const e=function(e,t){return gs[0]=e[t],gs[1]=e[t+1],gs[2]=e[t+2],gs[3]=e[t+3],gs[4]=e[t+4],gs[5]=e[t+5],gs[6]=e[t+6],gs[7]=e[t+7],ps[0]}(this.buf,this.pos);return this.pos+=8,e}bytes(){const e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw Ss(this,e);return this.pos+=e,t===n?new Uint8Array(0):this.buf.subarray(t,n)}string(){const e=this.bytes();return function(e,t,n){if(n-t<1)return"";let r;const i=[];let o,s=0;for(;t<n;){var a;o=e[t++],o<128?i[s++]=o:o>191&&o<224?i[s++]=(31&o)<<6|63&e[t++]:o>239&&o<365?(o=((7&o)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,i[s++]=55296+(o>>10),i[s++]=56320+(1023&o)):i[s++]=(15&o)<<12|(63&e[t++])<<6|63&e[t++],s>8191&&((null!==(a=r)&&void 0!==a?a:r=[]).push(String.fromCharCode.apply(String,i)),s=0)}return null!=r?(s>0&&r.push(String.fromCharCode.apply(String,i.slice(0,s))),r.join("")):String.fromCharCode.apply(String,i.slice(0,s))}(e,0,e.length)}skip(e){if("number"===typeof e){if(this.pos+e>this.len)throw Ss(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw Ss(this)}while(0!==(128&this.buf[this.pos++]));return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!==(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type ".concat(e," at offset ").concat(this.pos))}return this}readLongVarint(){const e=new ws(0,0);let t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw Ss(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw Ss(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw Ss(this,8);const e=ks(this.buf,this.pos+=4),t=ks(this.buf,this.pos+=4);return new ws(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=ls(this.buf,this.pos);return this.pos+=ss(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function Is(e,t,n){const r=function(e){return new As(e instanceof Uint8Array?e:e.subarray())}(e);return t.decode(r,void 0,n)}class Ts{constructor(e,t,n){je(this,"fn",void 0),je(this,"len",void 0),je(this,"next",void 0),je(this,"val",void 0),this.fn=e,this.len=t,this.next=void 0,this.val=n}}function Rs(){}class Cs{constructor(e){je(this,"head",void 0),je(this,"tail",void 0),je(this,"len",void 0),je(this,"next",void 0),this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}const xs=function(e){const t=null!==e&&void 0!==e?e:8192,n=t>>>1;let r,i=t;return function(e){if(e<1||e>n)return hr(e);i+e>t&&(r=hr(t),i=0);const o=r.subarray(i,i+=e);return 0!==(7&i)&&(i=1+(7|i)),o}}();class Ps{constructor(){je(this,"len",void 0),je(this,"head",void 0),je(this,"tail",void 0),je(this,"states",void 0),this.len=0,this.head=new Ts(Rs,0,0),this.tail=this.head,this.states=null}_push(e,t,n){return this.tail=this.tail.next=new Ts(e,t,n),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new Bs((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(Ls,10,ws.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const t=ws.fromBigInt(e);return this._push(Ls,t.length(),t)}uint64Number(e){return this._push(as,ss(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const t=ws.fromBigInt(e).zzEncode();return this._push(Ls,t.length(),t)}sint64Number(e){const t=ws.fromNumber(e).zzEncode();return this._push(Ls,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(Ds,1,e?1:0)}fixed32(e){return this._push(Os,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const t=ws.fromBigInt(e);return this._push(Os,4,t.lo)._push(Os,4,t.hi)}fixed64Number(e){const t=ws.fromNumber(e);return this._push(Os,4,t.lo)._push(Os,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(fs,4,e)}double(e){return this._push(ys,8,e)}bytes(e){const t=e.length>>>0;return 0===t?this._push(Ds,1,0):this.uint32(t)._push(Ms,t,e)}string(e){const t=function(e){let t=0,n=0;for(let r=0;r<e.length;++r)n=e.charCodeAt(r),n<128?t+=1:n<2048?t+=2:55296===(64512&n)&&56320===(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t}(e);return 0!==t?this.uint32(t)._push(_s,t,e):this._push(Ds,1,0)}fork(){return this.states=new Cs(this),this.head=this.tail=new Ts(Rs,0,0),this.len=0,this}reset(){return null!=this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Ts(Rs,0,0),this.len=0),this}ldelim(){const e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),0!==n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this}finish(){let e=this.head.next;const t=(n=this.len,null!=globalThis.Buffer?hr(n):xs(n));var n;let r=0;for(;null!=e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t}}function Ds(e,t,n){t[n]=255&e}function Ns(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e}class Bs extends Ts{constructor(e,t){super(Ns,e,t),je(this,"next",void 0),this.next=void 0}}function Ls(e,t,n){for(;0!==e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function Os(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function Ms(e,t,n){t.set(e,n)}function Us(e,t,n){t.set(e,n)}function Fs(e,t,n){e.length<40?_s(e,t,n):null!=t.utf8Write?t.utf8Write(e,n):t.set(yr(e),n)}function Vs(e,t){const n=new Ps;return t.encode(e,n,{lengthDelimited:!1}),n.finish()}var zs,Ks,js,Hs,qs;function Ws(e,t,n,r){return{name:e,type:t,encode:n,decode:r}}function Gs(e){function t(t){if(null==e[t.toString()])throw new Error("Invalid enum value");return e[t]}return Ws("enum",zs.VARINT,(function(e,n){const r=t(e);n.int32(r)}),(function(e){return t(e.int32())}))}function Ys(e,t){return Ws("message",zs.LENGTH_DELIMITED,e,t)}null!=globalThis.Buffer&&(Ps.prototype.bytes=function(e){const t=e.length>>>0;return this.uint32(t),t>0&&this._push(Us,t,e),this},Ps.prototype.string=function(e){const t=globalThis.Buffer.byteLength(e);return this.uint32(t),t>0&&this._push(Fs,t,e),this}),function(e){e[e.VARINT=0]="VARINT",e[e.BIT64=1]="BIT64",e[e.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",e[e.START_GROUP=3]="START_GROUP",e[e.END_GROUP=4]="END_GROUP",e[e.BIT32=5]="BIT32"}(zs||(zs={}));class Qs extends Error{constructor(e,t,n){super(e,n),je(this,"code",void 0),this.code=t}}!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(Ks||(Ks={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(js||(js={})),function(e){e.codec=()=>Gs(js)}(Ks||(Ks={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),Ks.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.Type=Ks.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(Hs||(Hs={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),Ks.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.Type=Ks.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(qs||(qs={}));class Xs{constructor(e){je(this,"_key",void 0),this._key=na(e,Ko)}verify(e,t){return function(e,t,n){return Uo.verify(t,n instanceof Uint8Array?n:n.subarray(),e)}(this._key,t,e)}marshal(){return this._key}get bytes(){return Hs.encode({Type:Ks.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Hr(this.bytes,e.bytes)}hash(){const e=ar.digest(this.bytes);return qr(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}}class Js{constructor(e,t){je(this,"_key",void 0),je(this,"_publicKey",void 0),this._key=na(e,jo),this._publicKey=na(t,Ko)}sign(e){return function(e,t){const n=e.subarray(0,Ho);return Uo.sign(t instanceof Uint8Array?t:t.subarray(),n)}(this._key,e)}get public(){return new Xs(this._publicKey)}marshal(){return this._key}get bytes(){return qs.encode({Type:Ks.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Hr(this.bytes,e.bytes)}async hash(){const e=ar.digest(this.bytes);let t;return qr(e)?({bytes:t}=await e):t=e.bytes,t}async id(){const e=rr.digest(this.public.bytes);return St.encode(e.bytes).substring(1)}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"libp2p-key";if("libp2p-key"===t)return Xo(this.bytes,e);throw new Mr("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}function $s(e){if(e.length>jo){const t=(e=na(e,jo+Ko)).subarray(0,jo),n=e.subarray(jo,e.length);return new Js(t,n)}const t=(e=na(e,jo)).subarray(0,jo),n=e.subarray(Ko);return new Js(t,n)}function Zs(e){return e=na(e,Ko),new Xs(e)}async function ea(){const{privateKey:e,publicKey:t}=function(){const e=Uo.utils.randomPrivateKey(),t=Uo.getPublicKey(e);return{privateKey:qo(e,t),publicKey:t}}();return new Js(e,t)}async function ta(e){const{privateKey:t,publicKey:n}=function(e){if(e.length!==Ho)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,n=Uo.getPublicKey(t);return{privateKey:qo(t,n),publicKey:n}}(e);return new Js(t,n)}function na(e,t){var n;if((e=Uint8Array.from(null!==(n=e)&&void 0!==n?n:[])).length!==t)throw new Mr("Key must be a Uint8Array of length ".concat(t,", got ").concat(e.length),"ERR_INVALID_KEY_TYPE");return e}async function ra(e){const t=[await Go.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await oa(e)],n=await ia({privateKey:t[0],publicKey:t[1]});return{privateKey:n[0],publicKey:n[1]}}async function ia(e){if(null==e.privateKey||null==e.publicKey)throw new Mr("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([Go.get().subtle.exportKey("jwk",e.privateKey),Go.get().subtle.exportKey("jwk",e.publicKey)])}async function oa(e){return Go.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function sa(e){if("RSA"!==e.kty)throw new Mr("invalid key type","ERR_INVALID_KEY_TYPE");if(null==e.n)throw new Mr("invalid key modulus","ERR_INVALID_KEY_MODULUS");return 8*yr(e.n,"base64url").length}class aa extends si{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Yr(e);const n=ii(t);if(this.iHash=e.create(),"function"!==typeof this.iHash.update)throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const r=this.blockLen,i=new Uint8Array(r);i.set(n.length>r?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),i.fill(0)}update(e){return Qr(this),this.iHash.update(e),this}digestInto(e){Qr(this),Gr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:r,destroyed:i,blockLen:o,outputLen:s}=this;return e.finished=r,e.destroyed=i,e.blockLen=o,e.outputLen=s,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const la=(e,t,n)=>new aa(e,t).update(n).digest();function ca(e,t,n,r){Yr(e);const i=function(e,t){if(void 0!==t&&"[object Object]"!==ai.call(t))throw new Error("Options should be object or undefined");return Object.assign(e,t)}({dkLen:32,asyncTick:10},r),{c:o,dkLen:s,asyncTick:a}=i;if(Wr(o),Wr(s),Wr(a),o<1)throw new Error("PBKDF2: iterations (c) should be >= 1");const l=ii(t),c=ii(n),u=new Uint8Array(s),h=la.create(e,l),d=h._cloneInto().update(c);return{c:o,dkLen:s,asyncTick:a,DK:u,PRF:h,PRFSalt:d}}function ua(e,t,n,r,i){return e.destroy(),t.destroy(),r&&r.destroy(),i.fill(0),n}async function ha(e,t,n,r){const{c:i,dkLen:o,asyncTick:s,DK:a,PRF:l,PRFSalt:c}=ca(e,t,n,r);let u;const h=new Uint8Array(4),d=$r(h),f=new Uint8Array(l.outputLen);for(let p=1,g=0;g<o;p++,g+=l.outputLen){const e=a.subarray(g,g+l.outputLen);d.setInt32(0,p,!1),(u=c._cloneInto(u)).update(h).digestInto(f),e.set(f.subarray(0,e.length)),await ni(i-1,s,(()=>{l._cloneInto(u).update(f).digestInto(f);for(let t=0;t<e.length;t++)e[t]^=f[t]}))}return ua(l,c,a,u,f)}la.create=(e,t)=>new aa(e,t);var da=n(8275);function fa(e,t){let n=0;if(1===e.length)return e[0];for(let r=e.length-1;r>=0;r--)n+=e[e.length-1-r]*Math.pow(2,t*r);return n}function pa(e,t){const n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;let r=e,i=0,o=Math.pow(2,t);for(let s=1;s<8;s++){if(e<o){let e;if(n<0)e=new ArrayBuffer(s),i=s;else{if(n<s)return new ArrayBuffer(0);e=new ArrayBuffer(n),i=n}const o=new Uint8Array(e);for(let n=s-1;n>=0;n--){const e=Math.pow(2,n*t);o[i-n-1]=Math.floor(r/e),r-=o[i-n-1]*e}return e}o*=Math.pow(2,t)}return new ArrayBuffer(0)}function ga(){let e=0,t=0;for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];for(const a of r)e+=a.length;const o=new ArrayBuffer(e),s=new Uint8Array(o);for(const a of r)s.set(a,t),t+=a.length;return s}function ya(){const e=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const t=255===e[0]&&128&e[1],n=0===e[0]&&0===(128&e[1]);(t||n)&&this.warnings.push("Needlessly long format")}const t=new ArrayBuffer(this.valueHex.byteLength),n=new Uint8Array(t);for(let s=0;s<this.valueHex.byteLength;s++)n[s]=0;n[0]=128&e[0];const r=fa(n,8),i=new ArrayBuffer(this.valueHex.byteLength),o=new Uint8Array(i);for(let s=0;s<this.valueHex.byteLength;s++)o[s]=e[s];o[0]&=127;return fa(o,8)-r}function va(e,t){const n=e.toString(10);if(t<n.length)return"";const r=t-n.length,i=new Array(r);for(let o=0;o<r;o++)i[o]="0";return i.join("").concat(n)}Math.log(2);function ma(){if("undefined"===typeof BigInt)throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function wa(e){let t=0,n=0;for(let i=0;i<e.length;i++){t+=e[i].byteLength}const r=new Uint8Array(t);for(let i=0;i<e.length;i++){const t=e[i];r.set(new Uint8Array(t),n),n+=t.byteLength}return r.buffer}function ba(e,t,n,r){return t instanceof Uint8Array?t.byteLength?n<0?(e.error="Wrong parameter: inputOffset less than zero",!1):r<0?(e.error="Wrong parameter: inputLength less than zero",!1):!(t.byteLength-n-r<0)||(e.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):(e.error="Wrong parameter: inputBuffer has zero length",!1):(e.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class Ea{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return wa(this.items)}}const _a=[new Uint8Array([1])],Sa="0123456789",ka="",Aa=new ArrayBuffer(0),Ia=new Uint8Array(0),Ta="EndOfContent",Ra="OCTET STRING",Ca="BIT STRING";function xa(e){var t;return t=class extends e{constructor(){var e;super(...arguments);const t=(arguments.length<=0?void 0:arguments[0])||{};this.isHexOnly=null!==(e=t.isHexOnly)&&void 0!==e&&e,this.valueHexView=t.valueHex?da._H.toUint8Array(t.valueHex):Ia}get valueHex(){return this.valueHexView.slice().buffer}set valueHex(e){this.valueHexView=new Uint8Array(e)}fromBER(e,t,n){const r=e instanceof ArrayBuffer?new Uint8Array(e):e;if(!ba(this,r,t,n))return-1;const i=t+n;return this.valueHexView=r.subarray(t,i),this.valueHexView.length?(this.blockLength=n,i):(this.warnings.push("Zero buffer length"),t)}toBER(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.isHexOnly?e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",Aa)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:da.U$.ToHex(this.valueHexView)}}},t.NAME="hexBlock",t}class Pa{constructor(){let{blockLength:e=0,error:t=ka,warnings:n=[],valueBeforeDecode:r=Ia}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.blockLength=e,this.error=t,this.warnings=n,this.valueBeforeDecodeView=da._H.toUint8Array(r)}static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:da.U$.ToHex(this.valueBeforeDecodeView)}}}Pa.NAME="baseBlock";class Da extends Pa{fromBER(e,t,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}Da.NAME="valueBlock";class Na extends(xa(Pa)){constructor(){let{idBlock:e={}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t,n,r,i;super(),e?(this.isHexOnly=null!==(t=e.isHexOnly)&&void 0!==t&&t,this.valueHexView=e.valueHex?da._H.toUint8Array(e.valueHex):Ia,this.tagClass=null!==(n=e.tagClass)&&void 0!==n?n:-1,this.tagNumber=null!==(r=e.tagNumber)&&void 0!==r?r:-1,this.isConstructed=null!==(i=e.isConstructed)&&void 0!==i&&i):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",Aa}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const n=new Uint8Array(1);if(!e){let e=this.tagNumber;e&=31,t|=e,n[0]=t}return n.buffer}if(!this.isHexOnly){const n=pa(this.tagNumber,7),r=new Uint8Array(n),i=n.byteLength,o=new Uint8Array(i+1);if(o[0]=31|t,!e){for(let e=0;e<i-1;e++)o[e+1]=128|r[e];o[i]=r[i-1]}return o.buffer}const n=new Uint8Array(this.valueHexView.byteLength+1);if(n[0]=31|t,!e){const e=this.valueHexView;for(let t=0;t<e.length-1;t++)n[t+1]=128|e[t];n[this.valueHexView.byteLength]=e[e.length-1]}return n.buffer}fromBER(e,t,n){const r=da._H.toUint8Array(e);if(!ba(this,r,t,n))return-1;const i=r.subarray(t,t+n);if(0===i.length)return this.error="Zero buffer length",-1;switch(192&i[0]){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=32===(32&i[0]),this.isHexOnly=!1;const o=31&i[0];if(31!==o)this.tagNumber=o,this.blockLength=1;else{let e=1,t=this.valueHexView=new Uint8Array(255),n=255;for(;128&i[e];){if(t[e-1]=127&i[e],e++,e>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(e===n){n+=255;const e=new Uint8Array(n);for(let n=0;n<t.length;n++)e[n]=t[n];t=this.valueHexView=new Uint8Array(n)}}this.blockLength=e+1,t[e-1]=127&i[e];const r=new Uint8Array(e);for(let i=0;i<e;i++)r[i]=t[i];t=this.valueHexView=new Uint8Array(e),t.set(r),this.blockLength<=9?this.tagNumber=fa(t,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(1===this.tagClass&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}Na.NAME="identificationBlock";class Ba extends Pa{constructor(){let{lenBlock:e={}}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t,n,r;super(),this.isIndefiniteForm=null!==(t=e.isIndefiniteForm)&&void 0!==t&&t,this.longFormUsed=null!==(n=e.longFormUsed)&&void 0!==n&&n,this.length=null!==(r=e.length)&&void 0!==r?r:0}fromBER(e,t,n){const r=da._H.toUint8Array(e);if(!ba(this,r,t,n))return-1;const i=r.subarray(t,t+n);if(0===i.length)return this.error="Zero buffer length",-1;if(255===i[0])return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=128===i[0],this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(128&i[0]),!1===this.longFormUsed)return this.length=i[0],this.blockLength=1,t+this.blockLength;const o=127&i[0];if(o>8)return this.error="Too big integer",-1;if(o+1>i.length)return this.error="End of input reached before message was fully decoded",-1;const s=t+1,a=r.subarray(s,s+o);return 0===a[o-1]&&this.warnings.push("Needlessly long encoded length"),this.length=fa(a,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=o+1,t+this.blockLength}toBER(){let e,t,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return e=new ArrayBuffer(1),!1===n&&(t=new Uint8Array(e),t[0]=128),e;if(this.longFormUsed){const r=pa(this.length,8);if(r.byteLength>127)return this.error="Too big length",Aa;if(e=new ArrayBuffer(r.byteLength+1),n)return e;const i=new Uint8Array(r);t=new Uint8Array(e),t[0]=128|r.byteLength;for(let e=0;e<r.byteLength;e++)t[e+1]=i[e];return e}return e=new ArrayBuffer(1),!1===n&&(t=new Uint8Array(e),t[0]=this.length),e}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}Ba.NAME="lengthBlock";const La={};class Oa extends Pa{constructor(){let{name:e=ka,optional:t=!1,primitiveSchema:n,...r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;super(r),this.name=e,this.optional=t,n&&(this.primitiveSchema=n),this.idBlock=new Na(r),this.lenBlock=new Ba(r),this.valueBlock=i?new i(r):new Da(r)}fromBER(e,t,n){const r=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return-1===r?(this.error=this.valueBlock.error,r):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),r)}toBER(e,t){const n=t||new Ea;t||Ma(this);const r=this.idBlock.toBER(e);if(n.write(r),this.lenBlock.isIndefiniteForm)n.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,n),n.write(new ArrayBuffer(2));else{const t=this.valueBlock.toBER(e);this.lenBlock.length=t.byteLength;const r=this.lenBlock.toBER(e);n.write(r),n.write(t)}return t?Aa:n.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(){return"ascii"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ascii")?this.onAsciiEncoding():da.U$.ToHex(this.toBER())}onAsciiEncoding(){return"".concat(this.constructor.NAME," : ").concat(da.U$.ToHex(this.valueBlock.valueBeforeDecodeView))}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;return function(e,t){if(e.byteLength!==t.byteLength)return!1;const n=new Uint8Array(e),r=new Uint8Array(t);for(let i=0;i<n.length;i++)if(n[i]!==r[i])return!1;return!0}(this.toBER(),e.toBER())}}function Ma(e){if(e instanceof La.Constructed)for(const t of e.valueBlock.value)Ma(t)&&(e.lenBlock.isIndefiniteForm=!0);return!!e.lenBlock.isIndefiniteForm}Oa.NAME="BaseBlock";class Ua extends Oa{constructor(){let{value:e=ka,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t,arguments.length>1?arguments[1]:void 0),e&&this.fromString(e)}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}fromBER(e,t,n){const r=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return-1===r?(this.error=this.valueBlock.error,r):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),r)}onAsciiEncoding(){return"".concat(this.constructor.NAME," : '").concat(this.valueBlock.value,"'")}}Ua.NAME="BaseStringBlock";class Fa extends(xa(Da)){constructor(){let{isHexOnly:e=!0,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t),this.isHexOnly=e}}var Va,za,Ka,ja,Ha,qa,Wa,Ga,Ya,Qa,Xa,Ja,$a,Za,el,tl,nl,rl,il,ol,sl,al,ll,cl,ul,hl,dl,fl,pl,gl,yl,vl,ml;Fa.NAME="PrimitiveValueBlock";class wl extends Oa{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Fa),this.idBlock.isConstructed=!1}}function bl(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length;const r=t;let i=new Oa({},Da);const o=new Pa;if(!ba(o,e,t,n))return i.error=o.error,{offset:-1,result:i};if(!e.subarray(t,t+n).length)return i.error="Zero buffer length",{offset:-1,result:i};let s=i.idBlock.fromBER(e,t,n);if(i.idBlock.warnings.length&&i.warnings.concat(i.idBlock.warnings),-1===s)return i.error=i.idBlock.error,{offset:-1,result:i};if(t=s,n-=i.idBlock.blockLength,s=i.lenBlock.fromBER(e,t,n),i.lenBlock.warnings.length&&i.warnings.concat(i.lenBlock.warnings),-1===s)return i.error=i.lenBlock.error,{offset:-1,result:i};if(t=s,n-=i.lenBlock.blockLength,!i.idBlock.isConstructed&&i.lenBlock.isIndefiniteForm)return i.error="Indefinite length form used for primitive encoding form",{offset:-1,result:i};let a=Oa;if(1===i.idBlock.tagClass){if(i.idBlock.tagNumber>=37&&!1===i.idBlock.isHexOnly)return i.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:i};switch(i.idBlock.tagNumber){case 0:if(i.idBlock.isConstructed&&i.lenBlock.length>0)return i.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:i};a=La.EndOfContent;break;case 1:a=La.Boolean;break;case 2:a=La.Integer;break;case 3:a=La.BitString;break;case 4:a=La.OctetString;break;case 5:a=La.Null;break;case 6:a=La.ObjectIdentifier;break;case 10:a=La.Enumerated;break;case 12:a=La.Utf8String;break;case 13:a=La.RelativeObjectIdentifier;break;case 14:a=La.TIME;break;case 15:return i.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:i};case 16:a=La.Sequence;break;case 17:a=La.Set;break;case 18:a=La.NumericString;break;case 19:a=La.PrintableString;break;case 20:a=La.TeletexString;break;case 21:a=La.VideotexString;break;case 22:a=La.IA5String;break;case 23:a=La.UTCTime;break;case 24:a=La.GeneralizedTime;break;case 25:a=La.GraphicString;break;case 26:a=La.VisibleString;break;case 27:a=La.GeneralString;break;case 28:a=La.UniversalString;break;case 29:a=La.CharacterString;break;case 30:a=La.BmpString;break;case 31:a=La.DATE;break;case 32:a=La.TimeOfDay;break;case 33:a=La.DateTime;break;case 34:a=La.Duration;break;default:{const e=i.idBlock.isConstructed?new La.Constructed:new La.Primitive;e.idBlock=i.idBlock,e.lenBlock=i.lenBlock,e.warnings=i.warnings,i=e}}}else a=i.idBlock.isConstructed?La.Constructed:La.Primitive;return i=function(e,t){if(e instanceof t)return e;const n=new t;return n.idBlock=e.idBlock,n.lenBlock=e.lenBlock,n.warnings=e.warnings,n.valueBeforeDecodeView=e.valueBeforeDecodeView,n}(i,a),s=i.fromBER(e,t,i.lenBlock.isIndefiniteForm?n:i.lenBlock.length),i.valueBeforeDecodeView=e.subarray(r,r+i.blockLength),{offset:s,result:i}}function El(e){if(!e.byteLength){const e=new Oa({},Da);return e.error="Input buffer has zero length",{offset:-1,result:e}}return bl(da._H.toUint8Array(e).slice(),0,e.byteLength)}Va=wl,La.Primitive=Va,wl.NAME="PRIMITIVE";class _l extends Da{constructor(){let{value:e=[],isIndefiniteForm:t=!1,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(n),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,n){const r=da._H.toUint8Array(e);if(!ba(this,r,t,n))return-1;if(this.valueBeforeDecodeView=r.subarray(t,t+n),0===this.valueBeforeDecodeView.length)return this.warnings.push("Zero buffer length"),t;let i=t;for(;o=this.isIndefiniteForm,s=n,(o?1:s)>0;){const e=bl(r,i,n);if(-1===e.offset)return this.error=e.result.error,this.warnings.concat(e.result.warnings),-1;if(i=e.offset,this.blockLength+=e.result.blockLength,n-=e.result.blockLength,this.value.push(e.result),this.isIndefiniteForm&&e.result.constructor.NAME===Ta)break}var o,s;return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===Ta?this.value.pop():this.warnings.push("No EndOfContent block encoded")),i}toBER(e,t){const n=t||new Ea;for(let r=0;r<this.value.length;r++)this.value[r].toBER(e,n);return t?Aa:n.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}_l.NAME="ConstructedValueBlock";class Sl extends Oa{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},_l),this.idBlock.isConstructed=!0}fromBER(e,t,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const r=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return-1===r?(this.error=this.valueBlock.error,r):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),r)}onAsciiEncoding(){const e=[];for(const n of this.valueBlock.value)e.push(n.toString("ascii").split("\n").map((e=>"  ".concat(e))).join("\n"));const t=3===this.idBlock.tagClass?"[".concat(this.idBlock.tagNumber,"]"):this.constructor.NAME;return e.length?"".concat(t," :\n").concat(e.join("\n")):"".concat(t," :")}}za=Sl,La.Constructed=za,Sl.NAME="CONSTRUCTED";class kl extends Da{fromBER(e,t,n){return t}toBER(e){return Aa}}kl.override="EndOfContentValueBlock";class Al extends Oa{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},kl),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}Ka=Al,La.EndOfContent=Ka,Al.NAME=Ta;class Il extends Oa{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Da),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,t+n>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+n}toBER(e,t){const n=new ArrayBuffer(2);if(!e){const e=new Uint8Array(n);e[0]=5,e[1]=0}return t&&t.write(n),n}onAsciiEncoding(){return"".concat(this.constructor.NAME)}}ja=Il,La.Null=ja,Il.NAME="NULL";class Tl extends(xa(Da)){constructor(){let{value:e,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t),t.valueHex?this.valueHexView=da._H.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}fromBER(e,t,n){const r=da._H.toUint8Array(e);return ba(this,r,t,n)?(this.valueHexView=r.subarray(t,t+n),n>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,ya.call(this),this.blockLength=n,t+n):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}Tl.NAME="BooleanValueBlock";class Rl extends Oa{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Tl),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}onAsciiEncoding(){return"".concat(this.constructor.NAME," : ").concat(this.getValue)}}Ha=Rl,La.Boolean=Ha,Rl.NAME="BOOLEAN";class Cl extends(xa(_l)){constructor(){let{isConstructed:e=!1,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t),this.isConstructed=e}fromBER(e,t,n){let r=0;if(this.isConstructed){if(this.isHexOnly=!1,r=_l.prototype.fromBER.call(this,e,t,n),-1===r)return r;for(let e=0;e<this.value.length;e++){const t=this.value[e].constructor.NAME;if(t===Ta){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(t!==Ra)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,r=super.fromBER(e,t,n),this.blockLength=n;return r}toBER(e,t){return this.isConstructed?_l.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}Cl.NAME="OctetStringValueBlock";class xl extends Oa{constructor(){let{idBlock:e={},lenBlock:t={},...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var r,i;null!==(r=n.isConstructed)&&void 0!==r||(n.isConstructed=!!(null===(i=n.value)||void 0===i?void 0:i.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},Cl),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,0===n)return 0===this.idBlock.error.length&&(this.blockLength+=this.idBlock.blockLength),0===this.lenBlock.error.length&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const i=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+n);try{if(i.byteLength){const e=bl(i,0,i.byteLength);-1!==e.offset&&e.offset===n&&(this.valueBlock.value=[e.result])}}catch(r){}}return super.fromBER(e,t,n)}onAsciiEncoding(){return this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length?Sl.prototype.onAsciiEncoding.call(this):"".concat(this.constructor.NAME," : ").concat(da.U$.ToHex(this.valueBlock.valueHexView))}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof xl&&e.push(t.valueBlock.valueHexView);return da._H.concat(e)}}qa=xl,La.OctetString=qa,xl.NAME=Ra;class Pl extends(xa(_l)){constructor(){let{unusedBits:e=0,isConstructed:t=!1,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(n),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,n){if(!n)return t;let r=-1;if(this.isConstructed){if(r=_l.prototype.fromBER.call(this,e,t,n),-1===r)return r;for(const e of this.value){const t=e.constructor.NAME;if(t===Ta){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(t!==Ca)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const n=e.valueBlock;if(this.unusedBits>0&&n.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=n.unusedBits}return r}const i=da._H.toUint8Array(e);if(!ba(this,i,t,n))return-1;const o=i.subarray(t,t+n);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const e=o.subarray(1);try{if(e.byteLength){const t=bl(e,0,e.byteLength);-1!==t.offset&&t.offset===n-1&&(this.value=[t.result])}}catch(s){}}return this.valueHexView=o.subarray(1),this.blockLength=o.length,t+n}toBER(e,t){if(this.isConstructed)return _l.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return Aa;const n=new Uint8Array(this.valueHexView.length+1);return n[0]=this.unusedBits,n.set(this.valueHexView,1),n.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}Pl.NAME="BitStringValueBlock";class Dl extends Oa{constructor(){let{idBlock:e={},lenBlock:t={},...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var r,i;null!==(r=n.isConstructed)&&void 0!==r||(n.isConstructed=!!(null===(i=n.value)||void 0===i?void 0:i.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},Pl),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Sl.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const r of t)e.push(r.toString(2).padStart(8,"0"));const n=e.join("");return"".concat(this.constructor.NAME," : ").concat(n.substring(0,n.length-this.valueBlock.unusedBits))}}}function Nl(e,t){const n=new Uint8Array([0]),r=new Uint8Array(e),i=new Uint8Array(t);let o=r.slice(0);const s=o.length-1,a=i.slice(0),l=a.length-1;let c=0;let u=0;for(let h=l<s?s:l;h>=0;h--,u++){if(!0===u<a.length)c=o[s-u]+a[l-u]+n[0];else c=o[s-u]+n[0];if(n[0]=c/10,!0===u>=o.length)o=ga(new Uint8Array([c%10]),o);else o[s-u]=c%10}return n[0]>0&&(o=ga(n,o)),o}function Bl(e){if(e>=_a.length)for(let t=_a.length;t<=e;t++){const e=new Uint8Array([0]);let n=_a[t-1].slice(0);for(let t=n.length-1;t>=0;t--){const r=new Uint8Array([(n[t]<<1)+e[0]]);e[0]=r[0]/10,n[t]=r[0]%10}e[0]>0&&(n=ga(e,n)),_a.push(n)}return _a[e]}function Ll(e,t){let n=0;const r=new Uint8Array(e),i=new Uint8Array(t),o=r.slice(0),s=o.length-1,a=i.slice(0),l=a.length-1;let c,u=0;for(let h=l;h>=0;h--,u++)if(c=o[s-u]-a[l-u]-n,!0===c<0)n=1,o[s-u]=c+10;else n=0,o[s-u]=c;if(n>0)for(let h=s-l+1;h>=0;h--,u++){if(c=o[s-u]-n,!(c<0)){n=0,o[s-u]=c;break}n=1,o[s-u]=c+10}return o.slice()}Wa=Dl,La.BitString=Wa,Dl.NAME=Ca;class Ol extends(xa(Da)){constructor(){let{value:e,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),void 0!==e&&(this.valueDec=e)}setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=ya.call(this)))}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(function(e){const t=e<0?-1*e:e;let n=128;for(let r=1;r<8;r++){if(t<=n){if(e<0){const e=pa(n-t,8,r);return new Uint8Array(e)[0]|=128,e}let i=pa(t,8,r),o=new Uint8Array(i);if(128&o[0]){const e=i.slice(0),t=new Uint8Array(e);i=new ArrayBuffer(i.byteLength+1),o=new Uint8Array(i);for(let n=0;n<e.byteLength;n++)o[n+1]=t[n];o[0]=0}return i}n*=Math.pow(2,8)}return new ArrayBuffer(0)}(e))}get valueDec(){return this._valueDec}fromDER(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const i=this.fromBER(e,t,n);if(-1===i)return i;const o=this.valueHexView;return 0===o[0]&&0!==(128&o[1])?this.valueHexView=o.subarray(1):0!==r&&o.length<r&&(r-o.length>1&&(r=o.length+1),this.valueHexView=o.subarray(r-o.length)),i}toDER(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const t=this.valueHexView;switch(!0){case 0!==(128&t[0]):{const e=new Uint8Array(this.valueHexView.length+1);e[0]=0,e.set(t,1),this.valueHexView=e}break;case 0===t[0]&&0===(128&t[1]):this.valueHexView=this.valueHexView.subarray(1)}return this.toBER(e)}fromBER(e,t,n){const r=super.fromBER(e,t,n);return-1===r||this.setValueHex(),r}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=8*this.valueHexView.length-1;let t,n=new Uint8Array(8*this.valueHexView.length/3),r=0;const i=this.valueHexView;let o="",s=!1;for(let a=i.byteLength-1;a>=0;a--){t=i[a];for(let i=0;i<8;i++){if(1===(1&t))if(r===e)n=Ll(Bl(r),n),o="-";else n=Nl(n,Bl(r));r++,t>>=1}}for(let a=0;a<n.length;a++)n[a]&&(s=!0),s&&(o+=Sa.charAt(n[a]));return!1===s&&(o+=Sa.charAt(0)),o}}Ga=Ol,Ol.NAME="IntegerValueBlock",Object.defineProperty(Ga.prototype,"valueHex",{set:function(e){this.valueHexView=new Uint8Array(e),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});class Ml extends Oa{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Ol),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return ma(),BigInt(this.valueBlock.toString())}static fromBigInt(e){ma();const t=BigInt(e),n=new Ea,r=t.toString(16).replace(/^-/,""),i=new Uint8Array(da.U$.FromHex(r));if(t<0){const e=new Uint8Array(i.length+(128&i[0]?1:0));e[0]|=128;const r=BigInt("0x".concat(da.U$.ToHex(e)))+t,o=da._H.toUint8Array(da.U$.FromHex(r.toString(16)));o[0]|=128,n.write(o)}else 128&i[0]&&n.write(new Uint8Array([0])),n.write(i);return new Ml({valueHex:n.final()})}convertToDER(){const e=new Ml({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new Ml({valueHex:0===this.valueBlock.valueHexView[0]?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return"".concat(this.constructor.NAME," : ").concat(this.valueBlock.toString())}}Ya=Ml,La.Integer=Ya,Ml.NAME="INTEGER";class Ul extends Ml{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}Qa=Ul,La.Enumerated=Qa,Ul.NAME="ENUMERATED";class Fl extends(xa(Da)){constructor(){let{valueDec:e=-1,isFirstSid:t=!1,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(n),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,n){if(!n)return t;const r=da._H.toUint8Array(e);if(!ba(this,r,t,n))return-1;const i=r.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let s=0;s<n&&(this.valueHexView[s]=127&i[s],this.blockLength++,0!==(128&i[s]));s++);const o=new Uint8Array(this.blockLength);for(let s=0;s<this.blockLength;s++)o[s]=this.valueHexView[s];return this.valueHexView=o,0!==(128&i[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=fa(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){ma();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const n=new Uint8Array(t.length/7);for(let r=0;r<n.length;r++)n[r]=parseInt(t.slice(7*r,7*r+7),2)+(r+1<n.length?128:0);this.fromBER(n.buffer,0,n.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const t=this.valueHexView,n=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)n[e]=128|t[e];return n[this.blockLength-1]=t[this.blockLength-1],n.buffer}const t=pa(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",Aa;const n=new Uint8Array(t.byteLength);if(!e){const e=new Uint8Array(t),r=t.byteLength-1;for(let t=0;t<r;t++)n[t]=128|e[t];n[r]=e[r]}return n}toString(){let e="";if(this.isHexOnly)e=da.U$.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}Fl.NAME="sidBlock";class Vl extends Da{constructor(){let{value:e=ka,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let r=t;for(;n>0;){const t=new Fl;if(r=t.fromBER(e,r,n),-1===r)return this.blockLength=0,this.error=t.error,r;0===this.value.length&&(t.isFirstSid=!0),this.blockLength+=t.blockLength,n-=t.blockLength,this.value.push(t)}return r}toBER(e){const t=[];for(let n=0;n<this.value.length;n++){const r=this.value[n].toBER(e);if(0===r.byteLength)return this.error=this.value[n].error,Aa;t.push(r)}return wa(t)}fromString(e){this.value=[];let t=0,n=0,r="",i=!1;do{if(n=e.indexOf(".",t),r=-1===n?e.substring(t):e.substring(t,n),t=n+1,i){const e=this.value[0];let t=0;switch(e.valueDec){case 0:break;case 1:t=40;break;case 2:t=80;break;default:return void(this.value=[])}const n=parseInt(r,10);if(isNaN(n))return;e.valueDec=n+t,i=!1}else{const e=new Fl;if(r>Number.MAX_SAFE_INTEGER){ma();const t=BigInt(r);e.valueBigInt=t}else if(e.valueDec=parseInt(r,10),isNaN(e.valueDec))return;this.value.length||(e.isFirstSid=!0,i=!0),this.value.push(e)}}while(-1!==n)}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let r=this.value[n].toString();0!==n&&(e="".concat(e,".")),t?(r="{".concat(r,"}"),this.value[n].isFirstSid?e="2.{".concat(r," - 80}"):e+=r):e+=r}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}Vl.NAME="ObjectIdentifierValueBlock";class zl extends Oa{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},Vl),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return"".concat(this.constructor.NAME," : ").concat(this.valueBlock.toString()||"empty")}toJSON(){return{...super.toJSON(),value:this.getValue()}}}Xa=zl,La.ObjectIdentifier=Xa,zl.NAME="OBJECT IDENTIFIER";class Kl extends(xa(Pa)){constructor(){let{valueDec:e=0,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t),this.valueDec=e}fromBER(e,t,n){if(0===n)return t;const r=da._H.toUint8Array(e);if(!ba(this,r,t,n))return-1;const i=r.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let s=0;s<n&&(this.valueHexView[s]=127&i[s],this.blockLength++,0!==(128&i[s]));s++);const o=new Uint8Array(this.blockLength);for(let s=0;s<this.blockLength;s++)o[s]=this.valueHexView[s];return this.valueHexView=o,0!==(128&i[this.blockLength-1])?(this.error="End of input reached before message was fully decoded",-1):(0===this.valueHexView[0]&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=fa(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const t=this.valueHexView,n=new Uint8Array(this.blockLength);for(let e=0;e<this.blockLength-1;e++)n[e]=128|t[e];return n[this.blockLength-1]=t[this.blockLength-1],n.buffer}const t=pa(this.valueDec,7);if(0===t.byteLength)return this.error="Error during encoding SID value",Aa;const n=new Uint8Array(t.byteLength);if(!e){const e=new Uint8Array(t),r=t.byteLength-1;for(let t=0;t<r;t++)n[t]=128|e[t];n[r]=e[r]}return n.buffer}toString(){let e="";return e=this.isHexOnly?da.U$.ToHex(this.valueHexView):this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}Kl.NAME="relativeSidBlock";class jl extends Da{constructor(){let{value:e=ka,...t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let r=t;for(;n>0;){const t=new Kl;if(r=t.fromBER(e,r,n),-1===r)return this.blockLength=0,this.error=t.error,r;this.blockLength+=t.blockLength,n-=t.blockLength,this.value.push(t)}return r}toBER(e,t){const n=[];for(let r=0;r<this.value.length;r++){const t=this.value[r].toBER(e);if(0===t.byteLength)return this.error=this.value[r].error,Aa;n.push(t)}return wa(n)}fromString(e){this.value=[];let t=0,n=0,r="";do{n=e.indexOf(".",t),r=-1===n?e.substring(t):e.substring(t,n),t=n+1;const i=new Kl;if(i.valueDec=parseInt(r,10),isNaN(i.valueDec))return!0;this.value.push(i)}while(-1!==n);return!0}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let r=this.value[n].toString();0!==n&&(e="".concat(e,".")),t?(r="{".concat(r,"}"),e+=r):e+=r}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}jl.NAME="RelativeObjectIdentifierValueBlock";class Hl extends Oa{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},jl),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}onAsciiEncoding(){return"".concat(this.constructor.NAME," : ").concat(this.valueBlock.toString()||"empty")}toJSON(){return{...super.toJSON(),value:this.getValue()}}}Ja=Hl,La.RelativeObjectIdentifier=Ja,Hl.NAME="RelativeObjectIdentifier";class ql extends Sl{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}$a=ql,La.Sequence=$a,ql.NAME="SEQUENCE";class Wl extends Sl{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}}Za=Wl,La.Set=Za,Wl.NAME="SET";class Gl extends(xa(Da)){constructor(){let{...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e),this.isHexOnly=!0,this.value=ka}toJSON(){return{...super.toJSON(),value:this.value}}}Gl.NAME="StringValueBlock";class Yl extends Gl{}Yl.NAME="SimpleStringValueBlock";class Ql extends Ua{constructor(){let{...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e,Yl)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,da._H.toUint8Array(e))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);this.valueBlock.value=e}}Ql.NAME="SIMPLE STRING";class Xl extends Ql{fromBuffer(e){this.valueBlock.valueHexView=da._H.toUint8Array(e);try{this.valueBlock.value=da.U$.ToUtf8String(e)}catch(t){this.warnings.push('Error during "decodeURIComponent": '.concat(t,", using raw string")),this.valueBlock.value=da.U$.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(da.U$.FromUtf8String(e)),this.valueBlock.value=e}}Xl.NAME="Utf8StringValueBlock";class Jl extends Xl{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}el=Jl,La.Utf8String=el,Jl.NAME="UTF8String";class $l extends Ql{fromBuffer(e){this.valueBlock.value=da.U$.ToUtf16String(e),this.valueBlock.valueHexView=da._H.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(da.U$.FromUtf16String(e))}}$l.NAME="BmpStringValueBlock";class Zl extends $l{constructor(){let{...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}tl=Zl,La.BmpString=tl,Zl.NAME="BMPString";class ec extends Ql{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),n=new Uint8Array(t);for(let r=0;r<n.length;r+=4)n[r]=n[r+3],n[r+1]=n[r+2],n[r+2]=0,n[r+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(4*t);for(let r=0;r<t;r++){const t=pa(e.charCodeAt(r),8),i=new Uint8Array(t);if(i.length>4)continue;const o=4-i.length;for(let e=i.length-1;e>=0;e--)n[4*r+e+o]=i[e]}this.valueBlock.value=e}}ec.NAME="UniversalStringValueBlock";class tc extends ec{constructor(){let{...e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}nl=tc,La.UniversalString=nl,tc.NAME="UniversalString";class nc extends Ql{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}rl=nc,La.NumericString=rl,nc.NAME="NumericString";class rc extends Ql{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}il=rc,La.PrintableString=il,rc.NAME="PrintableString";class ic extends Ql{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}ol=ic,La.TeletexString=ol,ic.NAME="TeletexString";class oc extends Ql{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}sl=oc,La.VideotexString=sl,oc.NAME="VideotexString";class sc extends Ql{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}al=sc,La.IA5String=al,sc.NAME="IA5String";class ac extends Ql{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}ll=ac,La.GraphicString=ll,ac.NAME="GraphicString";class lc extends Ql{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}cl=lc,La.VisibleString=cl,lc.NAME="VisibleString";class cc extends Ql{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}ul=cc,La.GeneralString=ul,cc.NAME="GeneralString";class uc extends Ql{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}hl=uc,La.CharacterString=hl,uc.NAME="CharacterString";class hc extends lc{constructor(){let{value:e,valueDate:t,...n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let t=0;t<e.length;t++)this.valueBlock.valueHexView[t]=e.charCodeAt(t)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,da._H.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const t=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/gi.exec(e);if(null===t)return void(this.error="Wrong input string for conversion");const n=parseInt(t[1],10);this.year=n>=50?1900+n:2e3+n,this.month=parseInt(t[2],10),this.day=parseInt(t[3],10),this.hour=parseInt(t[4],10),this.minute=parseInt(t[5],10),this.second=parseInt(t[6],10)}toString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"iso";if("iso"===e){const e=new Array(7);return e[0]=va(this.year<2e3?this.year-1900:this.year-2e3,2),e[1]=va(this.month,2),e[2]=va(this.day,2),e[3]=va(this.hour,2),e[4]=va(this.minute,2),e[5]=va(this.second,2),e[6]="Z",e.join("")}return super.toString(e)}onAsciiEncoding(){return"".concat(this.constructor.NAME," : ").concat(this.toDate().toISOString())}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}dl=hc,La.UTCTime=dl,hc.NAME="UTCTime";class dc extends hc{constructor(){var e;super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),null!==(e=this.millisecond)&&void 0!==e||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond))}fromString(e){let t,n=!1,r="",i="",o=0,s=0,a=0;if("Z"===e[e.length-1])r=e.substring(0,e.length-1),n=!0;else{const t=new Number(e[e.length-1]);if(isNaN(t.valueOf()))throw new Error("Wrong input string for conversion");r=e}if(n){if(-1!==r.indexOf("+"))throw new Error("Wrong input string for conversion");if(-1!==r.indexOf("-"))throw new Error("Wrong input string for conversion")}else{let e=1,t=r.indexOf("+"),n="";if(-1===t&&(t=r.indexOf("-"),e=-1),-1!==t){if(n=r.substring(t+1),r=r.substring(0,t),2!==n.length&&4!==n.length)throw new Error("Wrong input string for conversion");let i=parseInt(n.substring(0,2),10);if(isNaN(i.valueOf()))throw new Error("Wrong input string for conversion");if(s=e*i,4===n.length){if(i=parseInt(n.substring(2,4),10),isNaN(i.valueOf()))throw new Error("Wrong input string for conversion");a=e*i}}}let l=r.indexOf(".");if(-1===l&&(l=r.indexOf(",")),-1!==l){const e=new Number("0".concat(r.substring(l)));if(isNaN(e.valueOf()))throw new Error("Wrong input string for conversion");o=e.valueOf(),i=r.substring(0,l)}else i=r;switch(!0){case 8===i.length:if(t=/(\d{4})(\d{2})(\d{2})/gi,-1!==l)throw new Error("Wrong input string for conversion");break;case 10===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})/gi,-1!==l){let e=60*o;this.minute=Math.floor(e),e=60*(e-this.minute),this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 12===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==l){let e=60*o;this.second=Math.floor(e),e=1e3*(e-this.second),this.millisecond=Math.floor(e)}break;case 14===i.length:if(t=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/gi,-1!==l){const e=1e3*o;this.millisecond=Math.floor(e)}break;default:throw new Error("Wrong input string for conversion")}const c=t.exec(i);if(null===c)throw new Error("Wrong input string for conversion");for(let u=1;u<c.length;u++)switch(u){case 1:this.year=parseInt(c[u],10);break;case 2:this.month=parseInt(c[u],10);break;case 3:this.day=parseInt(c[u],10);break;case 4:this.hour=parseInt(c[u],10)+s;break;case 5:this.minute=parseInt(c[u],10)+a;break;case 6:this.second=parseInt(c[u],10);break;default:throw new Error("Wrong input string for conversion")}if(!1===n){const e=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=e.getUTCFullYear(),this.month=e.getUTCMonth(),this.day=e.getUTCDay(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds(),this.millisecond=e.getUTCMilliseconds()}}toString(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"iso";if("iso"===e){const e=[];return e.push(va(this.year,4)),e.push(va(this.month,2)),e.push(va(this.day,2)),e.push(va(this.hour,2)),e.push(va(this.minute,2)),e.push(va(this.second,2)),0!==this.millisecond&&(e.push("."),e.push(va(this.millisecond,3))),e.push("Z"),e.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}fl=dc,La.GeneralizedTime=fl,dc.NAME="GeneralizedTime";class fc extends Jl{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}pl=fc,La.DATE=pl,fc.NAME="DATE";class pc extends Jl{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}gl=pc,La.TimeOfDay=gl,pc.NAME="TimeOfDay";class gc extends Jl{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}yl=gc,La.DateTime=yl,gc.NAME="DateTime";class yc extends Jl{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}vl=yc,La.Duration=vl,yc.NAME="Duration";class vc extends Jl{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}ml=vc,La.TIME=ml,vc.NAME="TIME";function mc(e){if(isNaN(e)||e<=0)throw new Mr("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return ci(e)}function wc(e){let t=e.toString(16);t.length%2>0&&(t="0".concat(t));const n=t.length/2,r=new Uint8Array(n);let i=0,o=0;for(;i<n;)r[i]=parseInt(t.slice(o,o+2),16),i+=1,o+=2;return r}function bc(e){const t=[];return e.forEach((function(e){let n=e.toString(16);n.length%2>0&&(n="0".concat(n)),t.push(n)})),BigInt("0x"+t.join(""))}const Ec=32,_c=1e4;async function Sc(e,t){const n=Go.get();let r;if(e.includes("-----BEGIN ENCRYPTED PRIVATE KEY-----")){const i=yr(e.replace("-----BEGIN ENCRYPTED PRIVATE KEY-----","").replace("-----END ENCRYPTED PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:o}=El(i),{iv:s,salt:a,iterations:l,keySize:c,cipherText:u}=function(e){const t=e.valueBlock.value[0];if("OBJECT IDENTIFIER : 1.2.840.113549.1.5.13"!==t.valueBlock.value[0].toString())throw new Mr("Only pkcs5PBES2 encrypted private keys are supported","ERR_INVALID_PARAMS");const n=t.valueBlock.value[1].valueBlock.value[0];if("OBJECT IDENTIFIER : 1.2.840.113549.1.5.12"!==n.valueBlock.value[0].toString())throw new Mr("Only pkcs5PBKDF2 key derivation functions are supported","ERR_INVALID_PARAMS");const r=n.valueBlock.value[1],i=Ac(r.valueBlock.value[0].getValue());let o=_c,s=Ec;if(3===r.valueBlock.value.length)o=Number(r.valueBlock.value[1].toBigInt()),s=Number(r.valueBlock.value[2].toBigInt());else if(2===r.valueBlock.value.length)throw new Mr("Could not derive key size and iterations from PEM file - please use @libp2p/rsa to re-import your key","ERR_INVALID_PARAMS");const a=t.valueBlock.value[1].valueBlock.value[1],l=a.valueBlock.value[0].toString();if("OBJECT IDENTIFIER : 1.2.840.113549.3.7"===l);else if("OBJECT IDENTIFIER : 1.3.14.3.2.7"===l);else if("OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.2"===l);else if("OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.22"===l);else if("OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.42"!==l)throw new Mr("Only AES-CBC encryption schemes are supported","ERR_INVALID_PARAMS");const c=Ac(a.valueBlock.value[1].getValue());return{cipherText:Ac(e.valueBlock.value[1].getValue()),salt:i,iterations:o,keySize:s,iv:c}}(o),h=await ha(Si,t,a,{c:l,dkLen:c}),d=await n.subtle.importKey("raw",h,"AES-CBC",!1,["decrypt"]),f=Ac(await n.subtle.decrypt({name:"AES-CBC",iv:s},d,u)),{result:p}=El(f);r=kc(p)}else{if(!e.includes("-----BEGIN PRIVATE KEY-----"))throw new Mr("Could not parse private key from PEM data","ERR_INVALID_PARAMETERS");{const t=yr(e.replace("-----BEGIN PRIVATE KEY-----","").replace("-----END PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:n}=El(t);r=kc(n)}}return Cc(r)}function kc(e){return Ac(e.valueBlock.value[2].getValue())}function Ac(e){return new Uint8Array(e,0,e.byteLength)}const Ic=8192;class Tc{constructor(e){je(this,"_key",void 0),this._key=e}verify(e,t){return async function(e,t,n){const r=await Go.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return Go.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},r,t,n instanceof Uint8Array?n:n.subarray())}(this._key,t,e)}marshal(){return function(e){if(null==e.n||null==e.e)throw new Mr("JWK was missing components","ERR_INVALID_PARAMETERS");const t=new ql({value:[new ql({value:[new zl({value:"1.2.840.113549.1.1.1"}),new Il]}),new Dl({valueHex:new ql({value:[Ml.fromBigInt(bc(yr(e.n,"base64url"))),Ml.fromBigInt(bc(yr(e.e,"base64url")))]}).toBER()})]}).toBER();return new Uint8Array(t,0,t.byteLength)}(this._key)}get bytes(){return Hs.encode({Type:Ks.RSA,Data:this.marshal()}).subarray()}equals(e){return Hr(this.bytes,e.bytes)}hash(){const e=ar.digest(this.bytes);return qr(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}}class Rc{constructor(e,t){je(this,"_key",void 0),je(this,"_publicKey",void 0),this._key=e,this._publicKey=t}genSecret(){return mc(16)}sign(e){return async function(e,t){const n=await Go.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),r=await Go.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,t instanceof Uint8Array?t:t.subarray());return new Uint8Array(r,0,r.byteLength)}(this._key,e)}get public(){if(null==this._publicKey)throw new Mr("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new Tc(this._publicKey)}marshal(){return function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new Mr("JWK was missing components","ERR_INVALID_PARAMETERS");const t=new ql({value:[new Ml({value:0}),Ml.fromBigInt(bc(yr(e.n,"base64url"))),Ml.fromBigInt(bc(yr(e.e,"base64url"))),Ml.fromBigInt(bc(yr(e.d,"base64url"))),Ml.fromBigInt(bc(yr(e.p,"base64url"))),Ml.fromBigInt(bc(yr(e.q,"base64url"))),Ml.fromBigInt(bc(yr(e.dp,"base64url"))),Ml.fromBigInt(bc(yr(e.dq,"base64url"))),Ml.fromBigInt(bc(yr(e.qi,"base64url")))]}).toBER();return new Uint8Array(t,0,t.byteLength)}(this._key)}get bytes(){return qs.encode({Type:Ks.RSA,Data:this.marshal()}).subarray()}equals(e){return Hr(this.bytes,e.bytes)}hash(){const e=ar.digest(this.bytes);return qr(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}async id(){return vr(await this.public.hash(),"base58btc")}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pkcs-8";if("pkcs-8"===t)return async function(e,t){const n=Go.get(),r=new ql({value:[new Ml({value:0}),new ql({value:[new zl({value:"1.2.840.113549.1.1.1"}),new Il]}),new xl({valueHex:e.marshal()})]}).toBER(),i=new Uint8Array(r,0,r.byteLength),o=mc(16),s=await ha(Si,t,o,{c:_c,dkLen:Ec}),a=mc(16),l=await n.subtle.importKey("raw",s,"AES-CBC",!1,["encrypt"]),c=await n.subtle.encrypt({name:"AES-CBC",iv:a},l,i),u=new ql({value:[new xl({valueHex:o}),new Ml({value:_c}),new Ml({value:Ec}),new ql({value:[new zl({value:"1.2.840.113549.2.11"}),new Il]})]}),h=new ql({value:[new zl({value:"1.2.840.113549.1.5.13"}),new ql({value:[new ql({value:[new zl({value:"1.2.840.113549.1.5.12"}),u]}),new ql({value:[new zl({value:"2.16.840.1.101.3.4.1.42"}),new xl({valueHex:a})]})]})]}),d=new ql({value:[h,new xl({valueHex:c})]}).toBER();return["-----BEGIN ENCRYPTED PRIVATE KEY-----",...vr(new Uint8Array(d,0,d.byteLength),"base64pad").split(/(.{64})/).filter(Boolean),"-----END ENCRYPTED PRIVATE KEY-----"].join("\n")}(this,e);if("libp2p-key"===t)return Xo(this.bytes,e);throw new Mr("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}async function Cc(e){const t=function(e){const{result:t}=El(e),n=t.valueBlock.value;return{n:vr(wc(n[1].toBigInt()),"base64url"),e:vr(wc(n[2].toBigInt()),"base64url"),d:vr(wc(n[3].toBigInt()),"base64url"),p:vr(wc(n[4].toBigInt()),"base64url"),q:vr(wc(n[5].toBigInt()),"base64url"),dp:vr(wc(n[6].toBigInt()),"base64url"),dq:vr(wc(n[7].toBigInt()),"base64url"),qi:vr(wc(n[8].toBigInt()),"base64url"),kty:"RSA",alg:"RS256"}}(e);if(sa(t)>Ic)throw new Mr("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const n=await ra(t);return new Rc(n.privateKey,n.publicKey)}function xc(e){const t=function(e){const{result:t}=El(e),n=t.valueBlock.value[1].valueBlock.value[0].valueBlock.value;return{kty:"RSA",n:vr(wc(n[0].toBigInt()),"base64url"),e:vr(wc(n[1].toBigInt()),"base64url")}}(e);if(sa(t)>Ic)throw new Mr("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new Tc(t)}async function Pc(e){if(sa(e)>Ic)throw new Mr("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await ra(e);return new Rc(t.privateKey,t.publicKey)}async function Dc(e){if(e>Ic)throw new Mr("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await async function(e){const t=await Go.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),n=await ia(t);return{privateKey:n[0],publicKey:n[1]}}(e);return new Rc(t.privateKey,t.publicKey)}const Nc=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Bc=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Lc=new Uint32Array(64);class Oc extends di{constructor(){super(64,32,8,!1),this.A=0|Bc[0],this.B=0|Bc[1],this.C=0|Bc[2],this.D=0|Bc[3],this.E=0|Bc[4],this.F=0|Bc[5],this.G=0|Bc[6],this.H=0|Bc[7]}get(){const{A:e,B:t,C:n,D:r,E:i,F:o,G:s,H:a}=this;return[e,t,n,r,i,o,s,a]}set(e,t,n,r,i,o,s,a){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i,this.F=0|o,this.G=0|s,this.H=0|a}process(e,t){for(let u=0;u<16;u++,t+=4)Lc[u]=e.getUint32(t,!1);for(let u=16;u<64;u++){const e=Lc[u-15],t=Lc[u-2],n=Zr(e,7)^Zr(e,18)^e>>>3,r=Zr(t,17)^Zr(t,19)^t>>>10;Lc[u]=r+Lc[u-7]+n+Lc[u-16]|0}let{A:n,B:r,C:i,D:o,E:s,F:a,G:l,H:c}=this;for(let u=0;u<64;u++){const e=c+(Zr(s,6)^Zr(s,11)^Zr(s,25))+ui(s,a,l)+Nc[u]+Lc[u]|0,t=(Zr(n,2)^Zr(n,13)^Zr(n,22))+hi(n,r,i)|0;c=l,l=a,a=s,s=o+e|0,o=i,i=r,r=n,n=e+t|0}n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,o=o+this.D|0,s=s+this.E|0,a=a+this.F|0,l=l+this.G|0,c=c+this.H|0,this.set(n,r,i,o,s,a,l,c)}roundClean(){Lc.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const Mc=li((()=>new Oc));const{bytesToNumberBE:Uc,hexToBytes:Fc}=y,Vc={Err:class extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")}},_parseInt(e){const{Err:t}=Vc;if(e.length<2||2!==e[0])throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(128&r[0])throw new t("Invalid signature integer: negative");if(0===r[0]&&!(128&r[1]))throw new t("Invalid signature integer: unnecessary leading zero");return{d:Uc(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=Vc,n="string"===typeof e?Fc(e):e;Ti(n);let r=n.length;if(r<2||48!=n[0])throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:i,l:o}=Vc._parseInt(n.subarray(2)),{d:s,l:a}=Vc._parseInt(o);if(a.length)throw new t("Invalid signature: left bytes after parsing");return{r:i,s:s}},hexFromSig(e){const t=e=>8&Number.parseInt(e[0],16)?"00"+e:e,n=e=>{const t=e.toString(16);return 1&t.length?"0".concat(t):t},r=t(n(e.s)),i=t(n(e.r)),o=r.length/2,s=i.length/2,a=n(o),l=n(s);return"30".concat(n(s+o+4),"02").concat(l).concat(i,"02").concat(a).concat(r)}},zc=BigInt(0),Kc=BigInt(1),jc=(BigInt(2),BigInt(3));BigInt(4);function Hc(e){const t=function(e){const t=po(e);qi(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:i}=t;if(n){if(!r.eql(i,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if("object"!==typeof n||"bigint"!==typeof n.beta||"function"!==typeof n.splitScalar)throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}(e),{Fp:n}=t,r=t.toBytes||((e,t,r)=>{const i=t.toAffine();return Fi(Uint8Array.from([4]),n.toBytes(i.x),n.toBytes(i.y))}),i=t.fromBytes||(e=>{const t=e.subarray(1);return{x:n.fromBytes(t.subarray(0,n.BYTES)),y:n.fromBytes(t.subarray(n.BYTES,2*n.BYTES))}});function o(e){const{a:r,b:i}=t,o=n.sqr(e),s=n.mul(o,e);return n.add(n.add(s,n.mul(e,r)),i)}if(!n.eql(n.sqr(t.Gy),o(t.Gx)))throw new Error("bad generator point: equation left != right");function s(e){return"bigint"===typeof e&&zc<e&&e<t.n}function a(e){if(!s(e))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function l(e){const{allowedPrivateKeyLengths:n,nByteLength:r,wrapPrivateKey:i,n:o}=t;if(n&&"bigint"!==typeof e){if(Ii(e)&&(e=Ci(e)),"string"!==typeof e||!n.includes(e.length))throw new Error("Invalid key");e=e.padStart(2*r,"0")}let s;try{s="bigint"===typeof e?e:Bi(Ui("private key",e,r))}catch(l){throw new Error("private key must be ".concat(r," bytes, hex or bigint, not ").concat(typeof e))}return i&&(s=Zi(s,o)),a(s),s}const c=new Map;function u(e){if(!(e instanceof h))throw new Error("ProjectivePoint expected")}class h{constructor(e,t,r){if(this.px=e,this.py=t,this.pz=r,null==e||!n.isValid(e))throw new Error("x required");if(null==t||!n.isValid(t))throw new Error("y required");if(null==r||!n.isValid(r))throw new Error("z required")}static fromAffine(e){const{x:t,y:r}=e||{};if(!e||!n.isValid(t)||!n.isValid(r))throw new Error("invalid affine point");if(e instanceof h)throw new Error("projective point not allowed");const i=e=>n.eql(e,n.ZERO);return i(t)&&i(r)?h.ZERO:new h(t,r,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(e){const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(h.fromAffine)}static fromHex(e){const t=h.fromAffine(i(Ui("pointHex",e)));return t.assertValidity(),t}static fromPrivateKey(e){return h.BASE.multiply(l(e))}_setWindowSize(e){this._WINDOW_SIZE=e,c.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:e,y:r}=this.toAffine();if(!n.isValid(e)||!n.isValid(r))throw new Error("bad point: x or y not FE");const i=n.sqr(r),s=o(e);if(!n.eql(i,s))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:e}=this.toAffine();if(n.isOdd)return!n.isOdd(e);throw new Error("Field doesn't support isOdd")}equals(e){u(e);const{px:t,py:r,pz:i}=this,{px:o,py:s,pz:a}=e,l=n.eql(n.mul(t,a),n.mul(o,i)),c=n.eql(n.mul(r,a),n.mul(s,i));return l&&c}negate(){return new h(this.px,n.neg(this.py),this.pz)}double(){const{a:e,b:r}=t,i=n.mul(r,jc),{px:o,py:s,pz:a}=this;let l=n.ZERO,c=n.ZERO,u=n.ZERO,d=n.mul(o,o),f=n.mul(s,s),p=n.mul(a,a),g=n.mul(o,s);return g=n.add(g,g),u=n.mul(o,a),u=n.add(u,u),l=n.mul(e,u),c=n.mul(i,p),c=n.add(l,c),l=n.sub(f,c),c=n.add(f,c),c=n.mul(l,c),l=n.mul(g,l),u=n.mul(i,u),p=n.mul(e,p),g=n.sub(d,p),g=n.mul(e,g),g=n.add(g,u),u=n.add(d,d),d=n.add(u,d),d=n.add(d,p),d=n.mul(d,g),c=n.add(c,d),p=n.mul(s,a),p=n.add(p,p),d=n.mul(p,g),l=n.sub(l,d),u=n.mul(p,f),u=n.add(u,u),u=n.add(u,u),new h(l,c,u)}add(e){u(e);const{px:r,py:i,pz:o}=this,{px:s,py:a,pz:l}=e;let c=n.ZERO,d=n.ZERO,f=n.ZERO;const p=t.a,g=n.mul(t.b,jc);let y=n.mul(r,s),v=n.mul(i,a),m=n.mul(o,l),w=n.add(r,i),b=n.add(s,a);w=n.mul(w,b),b=n.add(y,v),w=n.sub(w,b),b=n.add(r,o);let E=n.add(s,l);return b=n.mul(b,E),E=n.add(y,m),b=n.sub(b,E),E=n.add(i,o),c=n.add(a,l),E=n.mul(E,c),c=n.add(v,m),E=n.sub(E,c),f=n.mul(p,b),c=n.mul(g,m),f=n.add(c,f),c=n.sub(v,f),f=n.add(v,f),d=n.mul(c,f),v=n.add(y,y),v=n.add(v,y),m=n.mul(p,m),b=n.mul(g,b),v=n.add(v,m),m=n.sub(y,m),m=n.mul(p,m),b=n.add(b,m),y=n.mul(v,b),d=n.add(d,y),y=n.mul(E,b),c=n.mul(w,c),c=n.sub(c,y),y=n.mul(w,v),f=n.mul(E,f),f=n.add(f,y),new h(c,d,f)}subtract(e){return this.add(e.negate())}is0(){return this.equals(h.ZERO)}wNAF(e){return f.wNAFCached(this,c,e,(e=>{const t=n.invertBatch(e.map((e=>e.pz)));return e.map(((e,n)=>e.toAffine(t[n]))).map(h.fromAffine)}))}multiplyUnsafe(e){const r=h.ZERO;if(e===zc)return r;if(a(e),e===Kc)return this;const{endo:i}=t;if(!i)return f.unsafeLadder(this,e);let{k1neg:o,k1:s,k2neg:l,k2:c}=i.splitScalar(e),u=r,d=r,p=this;for(;s>zc||c>zc;)s&Kc&&(u=u.add(p)),c&Kc&&(d=d.add(p)),p=p.double(),s>>=Kc,c>>=Kc;return o&&(u=u.negate()),l&&(d=d.negate()),d=new h(n.mul(d.px,i.beta),d.py,d.pz),u.add(d)}multiply(e){a(e);let r,i,o=e;const{endo:s}=t;if(s){const{k1neg:e,k1:t,k2neg:a,k2:l}=s.splitScalar(o);let{p:c,f:u}=this.wNAF(t),{p:d,f:p}=this.wNAF(l);c=f.constTimeNegate(e,c),d=f.constTimeNegate(a,d),d=new h(n.mul(d.px,s.beta),d.py,d.pz),r=c.add(d),i=u.add(p)}else{const{p:e,f:t}=this.wNAF(o);r=e,i=t}return h.normalizeZ([r,i])[0]}multiplyAndAddUnsafe(e,t,n){const r=h.BASE,i=(e,t)=>t!==zc&&t!==Kc&&e.equals(r)?e.multiply(t):e.multiplyUnsafe(t),o=i(this,t).add(i(e,n));return o.is0()?void 0:o}toAffine(e){const{px:t,py:r,pz:i}=this,o=this.is0();null==e&&(e=o?n.ONE:n.inv(i));const s=n.mul(t,e),a=n.mul(r,e),l=n.mul(i,e);if(o)return{x:n.ZERO,y:n.ZERO};if(!n.eql(l,n.ONE))throw new Error("invZ was invalid");return{x:s,y:a}}isTorsionFree(){const{h:e,isTorsionFree:n}=t;if(e===Kc)return!0;if(n)return n(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:e,clearCofactor:n}=t;return e===Kc?this:n?n(h,this):this.multiplyUnsafe(t.h)}toRawBytes(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.assertValidity(),r(h,this,e)}toHex(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return Ci(this.toRawBytes(e))}}h.BASE=new h(t.Gx,t.Gy,n.ONE),h.ZERO=new h(n.ZERO,n.ONE,n.ZERO);const d=t.nBitLength,f=fo(h,t.endo?Math.ceil(d/2):d);return{CURVE:t,ProjectivePoint:h,normPrivateKeyToScalar:l,weierstrassEquation:o,isWithinCurveOrder:s}}function qc(e){const t=function(e){const t=po(e);return qi(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}(e),{Fp:n,n:r}=t,i=n.BYTES+1,o=2*n.BYTES+1;function s(e){return Zi(e,r)}function a(e){return no(e,r)}const{ProjectivePoint:l,normPrivateKeyToScalar:c,weierstrassEquation:u,isWithinCurveOrder:h}=Hc({...t,toBytes(e,t,r){const i=t.toAffine(),o=n.toBytes(i.x),s=Fi;return r?s(Uint8Array.from([t.hasEvenY()?2:3]),o):s(Uint8Array.from([4]),o,n.toBytes(i.y))},fromBytes(e){const t=e.length,r=e[0],s=e.subarray(1);if(t!==i||2!==r&&3!==r){if(t===o&&4===r){return{x:n.fromBytes(s.subarray(0,n.BYTES)),y:n.fromBytes(s.subarray(n.BYTES,2*n.BYTES))}}throw new Error("Point of length ".concat(t," was invalid. Expected ").concat(i," compressed bytes or ").concat(o," uncompressed bytes"))}{const e=Bi(s);if(!(zc<(a=e)&&a<n.ORDER))throw new Error("Point is not on curve");const t=u(e);let i;try{i=n.sqrt(t)}catch(l){const e=l instanceof Error?": "+l.message:"";throw new Error("Point is not on curve"+e)}return 1===(1&r)!==((i&Kc)===Kc)&&(i=n.neg(i)),{x:e,y:i}}var a}}),d=e=>Ci(Oi(e,t.nByteLength));function f(e){return e>r>>Kc}const p=(e,t,n)=>Bi(e.slice(t,n));class g{constructor(e,t,n){this.r=e,this.s=t,this.recovery=n,this.assertValidity()}static fromCompact(e){const n=t.nByteLength;return e=Ui("compactSignature",e,2*n),new g(p(e,0,n),p(e,n,2*n))}static fromDER(e){const{r:t,s:n}=Vc.toSig(Ui("DER",e));return new g(t,n)}assertValidity(){if(!h(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!h(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(e){return new g(this.r,this.s,e)}recoverPublicKey(e){const{r:r,s:i,recovery:o}=this,c=w(Ui("msgHash",e));if(null==o||![0,1,2,3].includes(o))throw new Error("recovery id invalid");const u=2===o||3===o?r+t.n:r;if(u>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const h=0===(1&o)?"02":"03",f=l.fromHex(h+d(u)),p=a(u),g=s(-c*p),y=s(i*p),v=l.BASE.multiplyAndAddUnsafe(f,g,y);if(!v)throw new Error("point at infinify");return v.assertValidity(),v}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,s(-this.s),this.recovery):this}toDERRawBytes(){return Ni(this.toDERHex())}toDERHex(){return Vc.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Ni(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const y={isValidPrivateKey(e){try{return c(e),!0}catch(t){return!1}},normPrivateKeyToScalar:c,randomPrivateKey:()=>{const e=co(t.n);return function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const r=e.length,i=lo(t),o=co(t);if(r<16||r<o||r>1024)throw new Error("expected ".concat(o,"-1024 bytes of input, got ").concat(r));const s=Zi(n?Bi(e):Li(e),t-Gi)+Gi;return n?Mi(s,i):Oi(s,i)}(t.randomBytes(e),t.n)},precompute(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l.BASE;return t._setWindowSize(e),t.multiply(BigInt(3)),t}};function v(e){const t=Ii(e),n="string"===typeof e,r=(t||n)&&e.length;return t?r===i||r===o:n?r===2*i||r===2*o:e instanceof l}const m=t.bits2int||function(e){const n=Bi(e),r=8*e.length-t.nBitLength;return r>0?n>>BigInt(r):n},w=t.bits2int_modN||function(e){return s(m(e))},b=Vi(t.nBitLength);function E(e){if("bigint"!==typeof e)throw new Error("bigint expected");if(!(zc<=e&&e<b))throw new Error("bigint expected < 2^".concat(t.nBitLength));return Oi(e,t.nByteLength)}function _(e,r){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S;if(["recovered","canonical"].some((e=>e in i)))throw new Error("sign() legacy options not supported");const{hash:o,randomBytes:u}=t;let{lowS:d,prehash:p,extraEntropy:y}=i;null==d&&(d=!0),e=Ui("msgHash",e),p&&(e=Ui("prehashed msgHash",o(e)));const v=w(e),b=c(r),_=[E(b),E(v)];if(null!=y&&!1!==y){const e=!0===y?u(n.BYTES):y;_.push(Ui("extraEntropy",e))}const k=Fi(..._),A=v;return{seed:k,k2sig:function(e){const t=m(e);if(!h(t))return;const n=a(t),r=l.BASE.multiply(t).toAffine(),i=s(r.x);if(i===zc)return;const o=s(n*s(A+i*b));if(o===zc)return;let c=(r.x===i?0:2)|Number(r.y&Kc),u=o;return d&&f(o)&&(u=function(e){return f(e)?s(-e):e}(o),c^=1),new g(i,u,c)}}}const S={lowS:t.lowS,prehash:!1},k={lowS:t.lowS,prehash:!1};return l.BASE._setWindowSize(8),{CURVE:t,getPublicKey:function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return l.fromPrivateKey(e).toRawBytes(t)},getSharedSecret:function(e,t){let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(v(e))throw new Error("first arg must be private key");if(!v(t))throw new Error("second arg must be public key");return l.fromHex(t).multiply(c(e)).toRawBytes(n)},sign:function(e,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S;const{seed:i,k2sig:o}=_(e,n,r),s=t;return ji(s.hash.outputLen,s.nByteLength,s.hmac)(i,o)},verify:function(e,n,r){var i;let o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:k;const c=e;if(n=Ui("msgHash",n),r=Ui("publicKey",r),"strict"in o)throw new Error("options.strict was renamed to lowS");const{lowS:u,prehash:h}=o;let d,f;try{if("string"===typeof c||Ii(c))try{d=g.fromDER(c)}catch(S){if(!(S instanceof Vc.Err))throw S;d=g.fromCompact(c)}else{if("object"!==typeof c||"bigint"!==typeof c.r||"bigint"!==typeof c.s)throw new Error("PARSE");{const{r:e,s:t}=c;d=new g(e,t)}}f=l.fromHex(r)}catch(A){if("PARSE"===A.message)throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(u&&d.hasHighS())return!1;h&&(n=t.hash(n));const{r:p,s:y}=d,v=w(n),m=a(y),b=s(v*m),E=s(p*m),_=null===(i=l.BASE.multiplyAndAddUnsafe(f,b,E))||void 0===i?void 0:i.toAffine();return!!_&&s(_.x)===p},ProjectivePoint:l,Signature:g,utils:y}}function Wc(e){return{hash:e,hmac:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return la(e,t,oi(...r))},randomBytes:ci}}const Gc=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Yc=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Qc=BigInt(1),Xc=BigInt(2),Jc=(e,t)=>(e+t/Xc)/t;function $c(e){const t=Gc,n=BigInt(3),r=BigInt(6),i=BigInt(11),o=BigInt(22),s=BigInt(23),a=BigInt(44),l=BigInt(88),c=e*e*e%t,u=c*c*e%t,h=to(u,n,t)*u%t,d=to(h,n,t)*u%t,f=to(d,Xc,t)*c%t,p=to(f,i,t)*f%t,g=to(p,o,t)*p%t,y=to(g,a,t)*g%t,v=to(y,l,t)*y%t,m=to(v,a,t)*g%t,w=to(m,n,t)*u%t,b=to(w,s,t)*p%t,E=to(b,r,t)*c%t,_=to(E,Xc,t);if(!Zc.eql(Zc.sqr(_),e))throw new Error("Cannot find square root");return _}const Zc=ao(Gc,void 0,void 0,{sqrt:$c}),eu=function(e,t){const n=t=>qc({...e,...Wc(t)});return Object.freeze({...n(t),create:n})}({a:BigInt(0),b:BigInt(7),Fp:Zc,n:Yc,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=Yc,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Qc*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),o=n,s=BigInt("0x100000000000000000000000000000000"),a=Jc(o*e,t),l=Jc(-r*e,t);let c=Zi(e-a*n-l*i,t),u=Zi(-a*r-l*o,t);const h=c>s,d=u>s;if(h&&(c=t-c),d&&(u=t-u),c>s||u>s)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:h,k1:c,k2neg:d,k2:u}}}},Mc);BigInt(0);eu.ProjectivePoint;function tu(e){try{eu.ProjectivePoint.fromHex(e)}catch(t){throw new Mr(String(t),"ERR_INVALID_PUBLIC_KEY")}}class nu{constructor(e){je(this,"_key",void 0),tu(e),this._key=e}verify(e,t){return function(e,t,n){const r=ar.digest(n instanceof Uint8Array?n:n.subarray());if(qr(r))return r.then((n=>{let{digest:r}=n;return eu.verify(t,r,e)})).catch((e=>{throw new Mr(String(e),"ERR_INVALID_INPUT")}));try{return eu.verify(t,r.digest,e)}catch(i){throw new Mr(String(i),"ERR_INVALID_INPUT")}}(this._key,t,e)}marshal(){return e=this._key,eu.ProjectivePoint.fromHex(e).toRawBytes(!0);var e}get bytes(){return Hs.encode({Type:Ks.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Hr(this.bytes,e.bytes)}async hash(){const e=ar.digest(this.bytes);let t;return qr(e)?({bytes:t}=await e):t=e.bytes,t}}class ru{constructor(e,t){je(this,"_key",void 0),je(this,"_publicKey",void 0),this._key=e,this._publicKey=null!==t&&void 0!==t?t:function(e){try{return eu.getPublicKey(e,!0)}catch(t){throw new Mr(String(t),"ERR_INVALID_PRIVATE_KEY")}}(e),function(e){try{eu.getPublicKey(e,!0)}catch(t){throw new Mr(String(t),"ERR_INVALID_PRIVATE_KEY")}}(this._key),tu(this._publicKey)}sign(e){return function(e,t){const n=ar.digest(t instanceof Uint8Array?t:t.subarray());if(qr(n))return n.then((t=>{let{digest:n}=t;return eu.sign(n,e).toDERRawBytes()})).catch((e=>{throw new Mr(String(e),"ERR_INVALID_INPUT")}));try{return eu.sign(n.digest,e).toDERRawBytes()}catch(r){throw new Mr(String(r),"ERR_INVALID_INPUT")}}(this._key,e)}get public(){return new nu(this._publicKey)}marshal(){return this._key}get bytes(){return qs.encode({Type:Ks.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Hr(this.bytes,e.bytes)}hash(){const e=ar.digest(this.bytes);return qr(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}async id(){return vr(await this.public.hash(),"base58btc")}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"libp2p-key";if("libp2p-key"===t)return Xo(this.bytes,e);throw new Mr("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}function iu(e){return new ru(e)}function ou(e){return new nu(e)}async function su(){const e=eu.utils.randomPrivateKey();return new ru(e)}const au={rsa:m,ed25519:v,secp256k1:w};function lu(e){const t=Object.keys(au).join(" / ");return new Mr("invalid or unsupported key type ".concat(e,". Must be ").concat(t),"ERR_UNSUPPORTED_KEY_TYPE")}function cu(e){if("rsa"===(e=e.toLowerCase())||"ed25519"===e||"secp256k1"===e)return au[e];throw lu(e)}async function uu(e,t){return cu(e).generateKeyPair(null!==t&&void 0!==t?t:2048)}function hu(e){var t,n;const r=Hs.decode(e),i=null!==(t=r.Data)&&void 0!==t?t:new Uint8Array;switch(r.Type){case Ks.RSA:return au.rsa.unmarshalRsaPublicKey(i);case Ks.Ed25519:return au.ed25519.unmarshalEd25519PublicKey(i);case Ks.Secp256k1:return au.secp256k1.unmarshalSecp256k1PublicKey(i);default:throw lu(null!==(n=r.Type)&&void 0!==n?n:"unknown")}}function du(e,t){var n;return cu(t=(null!==(n=t)&&void 0!==n?n:"rsa").toLowerCase()),e.bytes}async function fu(e){var t,n;const r=qs.decode(e),i=null!==(t=r.Data)&&void 0!==t?t:new Uint8Array;switch(r.Type){case Ks.RSA:return au.rsa.unmarshalRsaPrivateKey(i);case Ks.Ed25519:return au.ed25519.unmarshalEd25519PrivateKey(i);case Ks.Secp256k1:return au.secp256k1.unmarshalSecp256k1PrivateKey(i);default:throw lu(null!==(n=r.Type)&&void 0!==n?n:"RSA")}}async function pu(e,t){try{const n=await async function(e,t){const n=cn.decode(e);return Qo().decrypt(n,t)}(e,t);return await fu(n)}catch(n){}if(!e.includes("BEGIN"))throw new Mr("Encrypted key was not a libp2p-key or a PEM file","ERR_INVALID_IMPORT_FORMAT");return Sc(e,t)}function gu(e,t,n){Fe(e,t),t.set(e,n)}function yu(e,t){return e.get(He(e,t))}const vu=function(e){try{for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r]}catch{}};var mu,wu=new WeakMap;class bu extends EventTarget{constructor(){super(),gu(this,wu,new Map),vu(1/0,this)}listenerCount(e){const t=yu(wu,this).get(e);return null==t?0:t.length}addEventListener(e,t,n){var r;super.addEventListener(e,t,n);let i=yu(wu,this).get(e);null==i&&(i=[],yu(wu,this).set(e,i)),i.push({callback:t,once:null!==(r=!0!==n&&!1!==n&&(null===n||void 0===n?void 0:n.once))&&void 0!==r&&r})}removeEventListener(e,t,n){super.removeEventListener(e.toString(),null!==t&&void 0!==t?t:null,n);let r=yu(wu,this).get(e);null!=r&&(r=r.filter((e=>{let{callback:n}=e;return n!==t})),yu(wu,this).set(e,r))}dispatchEvent(e){const t=super.dispatchEvent(e);let n=yu(wu,this).get(e.type);return null==n||(n=n.filter((e=>{let{once:t}=e;return!t})),yu(wu,this).set(e.type,n)),t}safeDispatchEvent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.dispatchEvent(new _u(e,t))}}class Eu extends Event{constructor(e,t){super(e,t),je(this,"detail",void 0),this.detail=null===t||void 0===t?void 0:t.detail}}const _u=null!==(mu=globalThis.CustomEvent)&&void 0!==mu?mu:Eu,Su=Symbol.for("@libp2p/content-routing"),ku=Symbol.for("@libp2p/peer-routing"),Au=Symbol.for("@libp2p/peer-discovery"),Iu=Symbol.for("@libp2p/peer-id");function Tu(e){return null!=e&&Boolean(e[Iu])}const Ru=Symbol.for("nodejs.util.inspect.custom"),Cu=Object.values(cr).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),cr.identity.decoder),xu=114,Pu=36,Du=37;class Nu{constructor(e){je(this,"type",void 0),je(this,"multihash",void 0),je(this,"privateKey",void 0),je(this,"publicKey",void 0),je(this,"string",void 0),je(this,Iu,!0),this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return"PeerId(".concat(this.toString(),")")}toString(){return null==this.string&&(this.string=St.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Jt.createV1(xu,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){var t;if(null==e)return!1;if(e instanceof Uint8Array)return Hr(this.multihash.bytes,e);if("string"===typeof e)return Mu(e).equals(this);if(null!=(null===e||void 0===e||null===(t=e.multihash)||void 0===t?void 0:t.bytes))return Hr(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[Ru](){return"PeerId(".concat(this.toString(),")")}}class Bu extends Nu{constructor(e){super({...e,type:"RSA"}),je(this,"type","RSA"),je(this,"publicKey",void 0),this.publicKey=e.publicKey}}class Lu extends Nu{constructor(e){super({...e,type:"Ed25519"}),je(this,"type","Ed25519"),je(this,"publicKey",void 0),this.publicKey=e.multihash.digest}}class Ou extends Nu{constructor(e){super({...e,type:"secp256k1"}),je(this,"type","secp256k1"),je(this,"publicKey",void 0),this.publicKey=e.multihash.digest}}function Mu(e,t){var n;if(t=null!==(n=t)&&void 0!==n?n:Cu,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=Wt(St.decode("z".concat(e)));return e.startsWith("12D")?new Lu({multihash:t}):e.startsWith("16U")?new Ou({multihash:t}):new Bu({multihash:t})}return Uu(Cu.decode(e))}function Uu(e){try{const t=Wt(e);if(t.code===rr.code){if(t.digest.length===Pu)return new Lu({multihash:t});if(t.digest.length===Du)return new Ou({multihash:t})}if(t.code===ar.code)return new Bu({multihash:t})}catch{return function(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==xu)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===ar.code)return new Bu({multihash:e.multihash});if(t.code===rr.code){if(t.digest.length===Pu)return new Lu({multihash:e.multihash});if(t.digest.length===Du)return new Ou({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}(Jt.decode(e))}throw new Error("Supplied PeerID CID is invalid")}async function Fu(e,t){return e.length===Pu?new Lu({multihash:qt(rr.code,e),privateKey:t}):e.length===Du?new Ou({multihash:qt(rr.code,e),privateKey:t}):new Bu({multihash:await ar.digest(e),publicKey:e,privateKey:t})}function Vu(e,t){const n={[Symbol.iterator]:()=>n,next:()=>{const n=e.next(),r=n.value;if(!0===n.done||null==r){return{done:!0,value:void 0}}return{done:!1,value:t(r)}}};return n}class zu{constructor(e){if(je(this,"set",void 0),this.set=new Set,null!=e)for(const t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return Vu(this.set.entries(),(e=>{const t=Mu(e[0]);return[t,t]}))}forEach(e){this.set.forEach((t=>{const n=Mu(t);e(n,n,this)}))}has(e){return this.set.has(e.toString())}values(){return Vu(this.set.values(),(e=>Mu(e)))}intersection(e){const t=new zu;for(const n of e)this.has(n)&&t.add(n);return t}difference(e){const t=new zu;for(const n of this)e.has(n)||t.add(n);return t}union(e){const t=new zu;for(const n of e)t.add(n);for(const n of this)t.add(n);return t}}const Ku=async()=>{const e=await uu("Ed25519"),t=await ju(e);if("Ed25519"===t.type)return t;throw new Error('Generated unexpected PeerId type "'.concat(t.type,'"'))};async function ju(e){return Fu(du(e.public),function(e,t){var n;return cu(t=(null!==(n=t)&&void 0!==n?n:"rsa").toLowerCase()),e.bytes}(e))}const Hu=Symbol.for("@achingbrain/uint8arraylist");function qu(e,t){if(null==t||t<0)throw new RangeError("index is out of bounds");let n=0;for(const r of e){const e=n+r.byteLength;if(t<e)return{buf:r,index:t-n};n=e}throw new RangeError("index is out of bounds")}function Wu(e){return Boolean(null===e||void 0===e?void 0:e[Hu])}class Gu{constructor(){je(this,"bufs",void 0),je(this,"length",void 0),je(this,Hu,!0),this.bufs=[],this.length=0;for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.length>0&&this.appendAll(t)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.appendAll(t)}appendAll(e){let t=0;for(const n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else{if(!Wu(n))throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");t+=n.byteLength,this.bufs.push(...n.bufs)}this.length+=t}prepend(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this.prependAll(t)}prependAll(e){let t=0;for(const n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else{if(!Wu(n))throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");t+=n.byteLength,this.bufs.unshift(...n.bufs)}this.length+=t}get(e){const t=qu(this.bufs,e);return t.buf[t.index]}set(e,t){const n=qu(this.bufs,e);n.buf[n.index]=t}write(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else{if(!Wu(e))throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList");for(let n=0;n<e.length;n++)this.set(t+n,e.get(n))}}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength)return this.bufs=[],void(this.length=0);for(;this.bufs.length>0;){if(!(e>=this.bufs[0].byteLength)){this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift()}}}slice(e,t){const{bufs:n,length:r}=this._subList(e,t);return Wo(n,r)}subarray(e,t){const{bufs:n,length:r}=this._subList(e,t);return 1===n.length?n[0]:Wo(n,r)}sublist(e,t){const{bufs:n,length:r}=this._subList(e,t),i=new Gu;return i.length=r,i.bufs=[...n],i}_subList(e,t){var n,r;if(e=null!==(n=e)&&void 0!==n?n:0,t=null!==(r=t)&&void 0!==r?r:this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(0===e&&t===this.length)return{bufs:this.bufs,length:this.length};const i=[];let o=0;for(let s=0;s<this.bufs.length;s++){const n=this.bufs[s],r=o,a=r+n.byteLength;if(o=a,e>=a)continue;const l=e>=r&&e<a,c=t>r&&t<=a;if(l&&c){if(e===r&&t===a){i.push(n);break}const o=e-r;i.push(n.subarray(o,o+(t-e)));break}if(l){if(0===e){i.push(n);continue}i.push(n.subarray(e-r))}else{if(c){if(t===a){i.push(n);break}i.push(n.subarray(0,t-r));break}i.push(n)}}return{bufs:i,length:t-e}}indexOf(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!Wu(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const r=e instanceof Uint8Array?e:e.subarray();if(n=Number(null!==(t=n)&&void 0!==t?t:0),isNaN(n)&&(n=0),n<0&&(n=this.length+n),n<0&&(n=0),0===e.length)return n>this.length?this.length:n;const i=r.byteLength;if(0===i)throw new TypeError("search must be at least 1 byte long");const o=new Int32Array(256);for(let u=0;u<256;u++)o[u]=-1;for(let u=0;u<i;u++)o[r[u]]=u;const s=o,a=this.byteLength-r.byteLength,l=r.byteLength-1;let c;for(let u=n;u<=a;u+=c){c=0;for(let e=l;e>=0;e--){const t=this.get(u+e);if(r[e]!==t){c=Math.max(1,e-s[t]);break}}if(0===c)return u}return-1}getInt8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){const n=hr(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){const r=ur(2);new DataView(r.buffer,r.byteOffset,r.byteLength).setInt16(0,t,n),this.write(r,e)}getInt32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){const r=ur(4);new DataView(r.buffer,r.byteOffset,r.byteLength).setInt32(0,t,n),this.write(r,e)}getBigInt64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){const r=ur(8);new DataView(r.buffer,r.byteOffset,r.byteLength).setBigInt64(0,t,n),this.write(r,e)}getUint8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){const n=hr(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){const r=ur(2);new DataView(r.buffer,r.byteOffset,r.byteLength).setUint16(0,t,n),this.write(r,e)}getUint32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){const r=ur(4);new DataView(r.buffer,r.byteOffset,r.byteLength).setUint32(0,t,n),this.write(r,e)}getBigUint64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){const r=ur(8);new DataView(r.buffer,r.byteOffset,r.byteLength).setBigUint64(0,t,n),this.write(r,e)}getFloat32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){const r=ur(4);new DataView(r.buffer,r.byteOffset,r.byteLength).setFloat32(0,t,n),this.write(r,e)}getFloat64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){const r=ur(8);new DataView(r.buffer,r.byteOffset,r.byteLength).setFloat64(0,t,n),this.write(r,e)}equals(e){if(null==e)return!1;if(!(e instanceof Gu))return!1;if(e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!Hr(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const n=new Gu;return n.bufs=e,null==t&&(t=e.reduce(((e,t)=>e+t.byteLength),0)),n.length=t,n}}const Yu="ERR_SIGNATURE_NOT_VALID";var Qu,Xu;!function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.publicKey&&e.publicKey.byteLength>0&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.payloadType&&e.payloadType.byteLength>0&&(t.uint32(18),t.bytes(e.payloadType)),null!=e.payload&&e.payload.byteLength>0&&(t.uint32(26),t.bytes(e.payload)),null!=e.signature&&e.signature.byteLength>0&&(t.uint32(42),t.bytes(e.signature)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={publicKey:new Uint8Array(0),payloadType:new Uint8Array(0),payload:new Uint8Array(0),signature:new Uint8Array(0)},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.publicKey=e.bytes();break;case 2:n.payloadType=e.bytes();break;case 3:n.payload=e.bytes();break;case 5:n.signature=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(Qu||(Qu={}));class Ju{constructor(e){je(this,"peerId",void 0),je(this,"payloadType",void 0),je(this,"payload",void 0),je(this,"signature",void 0),je(this,"marshaled",void 0);const{peerId:t,payloadType:n,payload:r,signature:i}=e;this.peerId=t,this.payloadType=n,this.payload=r,this.signature=i}marshal(){if(null==this.peerId.publicKey)throw new Error("Missing public key");return null==this.marshaled&&(this.marshaled=Qu.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return Hr(this.marshal(),e.marshal())}async validate(e){const t=$u(e,this.payloadType,this.payload);if(null==this.peerId.publicKey)throw new Error("Missing public key");return hu(this.peerId.publicKey).verify(t.subarray(),this.signature)}}Xu=Ju,je(Ju,"createFromProtobuf",(async e=>{const t=Qu.decode(e),n=await Fu(t.publicKey);return new Xu({peerId:n,payloadType:t.payloadType,payload:t.payload,signature:t.signature})})),je(Ju,"seal",(async(e,t)=>{if(null==t.privateKey)throw new Error("Missing private key");const n=e.domain,r=e.codec,i=e.marshal(),o=$u(n,r,i),s=await fu(t.privateKey),a=await s.sign(o.subarray());return new Xu({peerId:t,payloadType:r,payload:i,signature:a})})),je(Ju,"openAndCertify",(async(e,t)=>{const n=await Xu.createFromProtobuf(e);if(!await n.validate(t))throw new Mr("envelope signature is not valid for the given domain",Yu);return n}));const $u=(e,t,n)=>{const r=yr(e),i=cs(r.byteLength),o=cs(t.length),s=cs(n.length);return new Gu(i,r,o,t,s,n)};function Zu(e,t,n){return e.set(He(e,t),n),n}const eh=45,th=15,nh=new class{constructor(){je(this,"index",0),je(this,"input","")}new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,n=e();return void 0===n&&(this.index=t),n}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically((()=>{const t=this.readChar();if(t===e)return t}))}readSeparator(e,t,n){return this.readAtomically((()=>{if(!(t>0&&void 0===this.readGivenChar(e)))return n()}))}readNumber(e,t,n,r){return this.readAtomically((()=>{let i=0,o=0;const s=this.peekChar();if(void 0===s)return;const a="0"===s,l=2**(8*r)-1;for(;;){const n=this.readAtomically((()=>{const t=this.readChar();if(void 0===t)return;const n=Number.parseInt(t,e);return Number.isNaN(n)?void 0:n}));if(void 0===n)break;if(i*=e,i+=n,i>l)return;if(o+=1,void 0!==t&&o>t)return}return 0===o||!n&&a&&o>1?void 0:i}))}readIPv4Addr(){return this.readAtomically((()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const n=this.readSeparator(".",t,(()=>this.readNumber(10,3,!1,1)));if(void 0===n)return;e[t]=n}return e}))}readIPv6Addr(){const e=e=>{for(let t=0;t<e.length/2;t++){const n=2*t;if(t<e.length-3){const r=this.readSeparator(":",t,(()=>this.readIPv4Addr()));if(void 0!==r)return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],[n+4,!0]}const r=this.readSeparator(":",t,(()=>this.readNumber(16,4,!0,2)));if(void 0===r)return[n,!1];e[n]=r>>8,e[n+1]=255&r}return[e.length,!1]};return this.readAtomically((()=>{const t=new Uint8Array(16),[n,r]=e(t);if(16===n)return t;if(r)return;if(void 0===this.readGivenChar(":"))return;if(void 0===this.readGivenChar(":"))return;const i=new Uint8Array(14),o=16-(n+2),[s]=e(i.subarray(0,o));return t.set(i.subarray(0,s),16-s),t}))}readIPAddr(){var e;return null!==(e=this.readIPv4Addr())&&void 0!==e?e:this.readIPv6Addr()}};parseInt("0xFFFF",16),new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function rh(e){return Boolean(function(e){if(!(e.length>th))return nh.new(e).parseWith((()=>nh.readIPv4Addr()))}(e))}function ih(e){return Boolean(function(e){if(e.includes("%")&&(e=e.split("%")[0]),!(e.length>eh))return nh.new(e).parseWith((()=>nh.readIPv6Addr()))}(e))}function oh(e){return Boolean(function(e){if(e.includes("%")&&(e=e.split("%")[0]),!(e.length>eh))return nh.new(e).parseWith((()=>nh.readIPAddr()))}(e))}const sh=rh,ah=ih,lh=function(e){let t=0;if(e=e.toString().trim(),sh(e)){const n=new Uint8Array(t+4);return e.split(/\./g).forEach((e=>{n[t++]=255&parseInt(e,10)})),n}if(ah(e)){const n=e.split(":",8);let r;for(r=0;r<n.length;r++){let e;sh(n[r])&&(e=lh(n[r]),n[r]=vr(e.slice(0,2),"base16")),null!=e&&++r<8&&n.splice(r,0,vr(e.slice(2,4),"base16"))}if(""===n[0])for(;n.length<8;)n.unshift("0");else if(""===n[n.length-1])for(;n.length<8;)n.push("0");else if(n.length<8){for(r=0;r<n.length&&""!==n[r];r++);const e=[r,1];for(r=9-n.length;r>0;r--)e.push("0");n.splice.apply(n,e)}const i=new Uint8Array(t+16);for(r=0;r<n.length;r++){const e=parseInt(n[r],16);i[t++]=e>>8&255,i[t++]=255&e}return i}throw new Error("invalid ip address")},ch=function(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;n=~~n,r=null!==(t=r)&&void 0!==t?t:e.length-n;const i=new DataView(e.buffer);if(4===r){const t=[];for(let i=0;i<r;i++)t.push(e[n+i]);return t.join(".")}if(16===r){const e=[];for(let t=0;t<r;t+=2)e.push(i.getUint16(n+t).toString(16));return e.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},uh=-1,hh={},dh={};function fh(e){if("number"===typeof e){if(null!=dh[e])return dh[e];throw new Error("no protocol with code: ".concat(e))}if("string"===typeof e){if(null!=hh[e])return hh[e];throw new Error("no protocol with name: ".concat(e))}throw new Error("invalid protocol id type: ".concat(typeof e))}[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,uh,"ip6zone"],[43,8,"ipcidr"],[53,uh,"dns",!0],[54,uh,"dns4",!0],[55,uh,"dns6",!0],[56,uh,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,uh,"unix",!1,!0],[421,uh,"ipfs"],[421,uh,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,uh,"garlic64"],[448,0,"tls"],[449,uh,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,uh,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,uh,"memory"]].forEach((e=>{const t=function(e,t,n,r,i){return{code:e,size:t,name:n,resolvable:Boolean(r),path:Boolean(i)}}(...e);dh[t.code]=t,hh[t.name]=t}));fh("ip4"),fh("ip6"),fh("ipcidr");function ph(e,t){switch(fh(e).code){case 4:case 41:return function(e){const t=ch(e,0,e.length);if(null==t)throw new Error("ipBuff is required");if(!oh(t))throw new Error("invalid ip address");return t}(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return _h(t);case 6:case 273:case 33:case 132:return bh(t).toString();case 421:return function(e){const t=us(e),n=e.slice(ss(t));if(n.length!==t)throw new Error("inconsistent lengths");return vr(n,"base58btc")}(t);case 444:case 445:return Sh(t);case 466:return function(e){const t=us(e),n=e.slice(ss(t));if(n.length!==t)throw new Error("inconsistent lengths");return"u"+vr(n,"base64url")}(t);default:return vr(t,"base16")}}function gh(e,t){switch(fh(e).code){case 4:case 41:return mh(t);case 42:case 53:case 54:case 55:case 56:case 400:case 449:case 777:return Eh(t);case 6:case 273:case 33:case 132:return wh(parseInt(t,10));case 421:return function(e){let t;t="Q"===e[0]||"1"===e[0]?Wt(St.decode("z".concat(e))).bytes:Jt.parse(e).multihash.bytes;const n=Uint8Array.from(cs(t.length));return Wo([n,t],n.length+t.length)}(t);case 444:return function(e){const t=e.split(":");if(2!==t.length)throw new Error("failed to parse onion addr: [\"'".concat(t.join('", "'),"'\"]' does not contain a port number"));if(16!==t[0].length)throw new Error("failed to parse onion addr: ".concat(t[0]," not a Tor onion address."));const n=pt.decode("b"+t[0]),r=parseInt(t[1],10);if(r<1||r>65536)throw new Error("Port number is not in range(1, 65536)");const i=wh(r);return Wo([n,i],n.length+i.length)}(t);case 445:return function(e){const t=e.split(":");if(2!==t.length)throw new Error("failed to parse onion addr: [\"'".concat(t.join('", "'),"'\"]' does not contain a port number"));if(56!==t[0].length)throw new Error("failed to parse onion addr: ".concat(t[0]," not a Tor onion3 address."));const n=pt.decode("b".concat(t[0])),r=parseInt(t[1],10);if(r<1||r>65536)throw new Error("Port number is not in range(1, 65536)");const i=wh(r);return Wo([n,i],n.length+i.length)}(t);case 466:return function(e){const t=vh.decode(e),n=Uint8Array.from(cs(t.length));return Wo([n,t],n.length+t.length)}(t);default:return yr(t,"base16")}}const yh=Object.values(cr).map((e=>e.decoder)),vh=function(){let e=yh[0].or(yh[1]);return yh.slice(2).forEach((t=>e=e.or(t))),e}();function mh(e){if(!oh(e))throw new Error("invalid ip address");return lh(e)}function wh(e){const t=new ArrayBuffer(2);return new DataView(t).setUint16(0,e),new Uint8Array(t)}function bh(e){return new DataView(e.buffer).getUint16(e.byteOffset)}function Eh(e){const t=yr(e),n=Uint8Array.from(cs(t.length));return Wo([n,t],n.length+t.length)}function _h(e){const t=us(e);if((e=e.slice(ss(t))).length!==t)throw new Error("inconsistent lengths");return vr(e)}function Sh(e){const t=e.slice(0,e.length-2),n=e.slice(e.length-2),r=vr(t,"base32"),i=bh(n);return"".concat(r,":").concat(i)}function kh(e){const t=[],n=[];let r=null,i=0;for(;i<e.length;){const o=us(e,i),s=ss(o),a=fh(o),l=Th(a,e.slice(i+s));if(0===l){t.push([o]),n.push([o]),i+=s;continue}const c=e.slice(i+s,i+s+l);if(i+=l+s,i>e.length)throw Ch("Invalid address Uint8Array: "+vr(e,"base16"));t.push([o,c]);const u=ph(o,c);if(n.push([o,u]),!0===a.path){r=u;break}}return{bytes:Uint8Array.from(e),string:Ah(n),tuples:t,stringTuples:n,path:r}}function Ah(e){const t=[];return e.map((e=>{const n=fh(e[0]);return t.push(n.name),e.length>1&&null!=e[1]&&t.push(e[1]),null})),Rh(t.join("/"))}function Ih(e){return Wo(e.map((e=>{const t=fh(e[0]);let n=Uint8Array.from(cs(t.code));return e.length>1&&null!=e[1]&&(n=Wo([n,e[1]])),n})))}function Th(e,t){if(e.size>0)return e.size/8;if(0===e.size)return 0;{const e=us(t instanceof Uint8Array?t:Uint8Array.from(t));return e+ss(e)}}function Rh(e){return"/"+e.trim().split("/").filter((e=>e)).join("/")}function Ch(e){return new Error("Error parsing address: "+e)}const xh=Symbol.for("nodejs.util.inspect.custom"),Ph=Symbol.for("@multiformats/js-multiaddr/multiaddr"),Dh=[fh("dns").code,fh("dns4").code,fh("dns6").code,fh("dnsaddr").code];var Nh=new WeakMap,Bh=new WeakMap,Lh=new WeakMap,Oh=new WeakMap;class Mh{constructor(e){let t;if(je(this,"bytes",void 0),gu(this,Nh,void 0),gu(this,Bh,void 0),gu(this,Lh,void 0),gu(this,Oh,void 0),je(this,Ph,!0),null==e&&(e=""),e instanceof Uint8Array)t=kh(e);else if("string"===typeof e){if(e.length>0&&"/"!==e.charAt(0))throw new Error('multiaddr "'.concat(e,'" must start with a "/"'));t=function(e){const t=[],n=[];let r=null;const i=(e=Rh(e)).split("/").slice(1);if(1===i.length&&""===i[0])return{bytes:new Uint8Array,string:"/",tuples:[],stringTuples:[],path:null};for(let o=0;o<i.length;o++){const s=fh(i[o]);if(0===s.size){t.push([s.code]),n.push([s.code]);continue}if(o++,o>=i.length)throw Ch("invalid address: "+e);if(!0===s.path){r=Rh(i.slice(o).join("/")),t.push([s.code,gh(s.code,r)]),n.push([s.code,r]);break}const a=gh(s.code,i[o]);t.push([s.code,a]),n.push([s.code,ph(s.code,a)])}return{string:Ah(n),bytes:Ih(t),tuples:t,stringTuples:n,path:r}}(e)}else{if(!Fh(e))throw new Error("addr must be a string, Buffer, or another Multiaddr");t=kh(e.bytes)}this.bytes=t.bytes,Zu(Nh,this,t.string),Zu(Bh,this,t.tuples),Zu(Lh,this,t.stringTuples),Zu(Oh,this,t.path)}toString(){return yu(Nh,this)}toJSON(){return this.toString()}toOptions(){let e,t,n,r,i="";const o=fh("tcp"),s=fh("udp"),a=fh("ip4"),l=fh("ip6"),c=fh("dns6"),u=fh("ip6zone");for(const[h,d]of this.stringTuples())h===u.code&&(i="%".concat(null!==d&&void 0!==d?d:"")),Dh.includes(h)&&(t=o.name,r=443,n="".concat(null!==d&&void 0!==d?d:"").concat(i),e=h===c.code?6:4),h!==o.code&&h!==s.code||(t=fh(h).name,r=parseInt(null!==d&&void 0!==d?d:"")),h!==a.code&&h!==l.code||(t=fh(h).name,n="".concat(null!==d&&void 0!==d?d:"").concat(i),e=h===l.code?6:4);if(null==e||null==t||null==n||null==r)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:r}}protos(){return yu(Bh,this).map((e=>{let[t]=e;return Object.assign({},fh(t))}))}protoCodes(){return yu(Bh,this).map((e=>{let[t]=e;return t}))}protoNames(){return yu(Bh,this).map((e=>{let[t]=e;return fh(t).name}))}tuples(){return yu(Bh,this)}stringTuples(){return yu(Lh,this)}encapsulate(e){return e=new Mh(e),new Mh(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),r=n.lastIndexOf(t);if(r<0)throw new Error("Address ".concat(this.toString()," does not contain subaddress: ").concat(e.toString()));return new Mh(n.slice(0,r))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new Mh(Ih(t.slice(0,n)));return this}getPeerId(){try{let e=[];this.stringTuples().forEach((t=>{let[n,r]=t;n===hh.p2p.code&&e.push([n,r]),n===hh["p2p-circuit"].code&&(e=[])}));const t=e.pop();if(null!=(null===t||void 0===t?void 0:t[1])){const e=t[1];return"Q"===e[0]||"1"===e[0]?vr(St.decode("z".concat(e)),"base58btc"):vr(Jt.parse(e).multihash.bytes,"base58btc")}return null}catch(e){return null}}getPath(){return yu(Oh,this)}equals(e){return Hr(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find((e=>e.resolvable));if(null==t)return[this];const n=Uh.get(t.name);if(null==n)throw new Mr("no available resolver for ".concat(t.name),"ERR_NO_AVAILABLE_RESOLVER");return(await n(this,e)).map((e=>Vh(e)))}nodeAddress(){const e=this.toOptions();if("tcp"!==e.transport&&"udp"!==e.transport)throw new Error('multiaddr must have a valid format - no protocol with name: "'.concat(e.transport,'". Must have a valid transport protocol: "{tcp, udp}"'));return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(null!==e&&void 0!==e?e:this).protos();return 2===t.length&&((4===t[0].code||41===t[0].code)&&(6===t[1].code||273===t[1].code))}[xh](){return"Multiaddr(".concat(yu(Nh,this),")")}}const Uh=new Map;function Fh(e){return Boolean(null===e||void 0===e?void 0:e[Ph])}function Vh(e){return new Mh(e)}const zh=Uint8Array.from([3,1]);var Kh,jh;!function(e){let t,n;!function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.multiaddr&&e.multiaddr.byteLength>0&&(t.uint32(10),t.bytes(e.multiaddr)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={multiaddr:new Uint8Array(0)},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();if(t>>>3===1)n.multiaddr=e.bytes();else e.skipType(7&t)}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(t=e.AddressInfo||(e.AddressInfo={})),e.codec=()=>(null==n&&(n=Ys((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==r.lengthDelimited&&n.fork(),null!=t.peerId&&t.peerId.byteLength>0&&(n.uint32(10),n.bytes(t.peerId)),null!=t.seq&&0n!==t.seq&&(n.uint32(16),n.uint64(t.seq)),null!=t.addresses)for(const i of t.addresses)n.uint32(26),e.AddressInfo.codec().encode(i,n);!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={peerId:new Uint8Array(0),seq:0n,addresses:[]},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();switch(n>>>3){case 1:r.peerId=t.bytes();break;case 2:r.seq=t.uint64();break;case 3:r.addresses.push(e.AddressInfo.codec().decode(t,t.uint32()));break;default:t.skipType(7&n)}}return r}))),n),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(Kh||(Kh={}));class Hh{constructor(e){je(this,"peerId",void 0),je(this,"multiaddrs",void 0),je(this,"seqNumber",void 0),je(this,"domain",Hh.DOMAIN),je(this,"codec",Hh.CODEC),je(this,"marshaled",void 0);const{peerId:t,multiaddrs:n,seqNumber:r}=e;this.peerId=t,this.multiaddrs=null!==n&&void 0!==n?n:[],this.seqNumber=null!==r&&void 0!==r?r:BigInt(Date.now())}marshal(){return null==this.marshaled&&(this.marshaled=Kh.encode({peerId:this.peerId.toBytes(),seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map((e=>({multiaddr:e.bytes})))})),this.marshaled}equals(e){return e instanceof Hh&&(!!this.peerId.equals(e.peerId)&&(this.seqNumber===e.seqNumber&&!!function(e,t){const n=(e,t)=>e.toString().localeCompare(t.toString());return e.length===t.length&&(t.sort(n),e.sort(n).every(((e,n)=>t[n].equals(e))))}(this.multiaddrs,e.multiaddrs)))}}jh=Hh,je(Hh,"createFromProtobuf",(e=>{var t;const n=Kh.decode(e),r=Uu(n.peerId),i=(null!==(t=n.addresses)&&void 0!==t?t:[]).map((e=>Vh(e.multiaddr))),o=n.seq;return new jh({peerId:r,multiaddrs:i,seqNumber:o})})),je(Hh,"DOMAIN","libp2p-peer-record"),je(Hh,"CODEC",zh);class qh{constructor(e){if(je(this,"map",void 0),this.map=new Map,null!=e)for(const[t,n]of e.entries())this.map.set(t.toString(),n)}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return Vu(this.map.entries(),(e=>[Mu(e[0]),e[1]]))}forEach(e){this.map.forEach(((t,n)=>{e(t,Mu(n),this)}))}get(e){return this.map.get(e.toString())}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),t)}keys(){return Vu(this.map.keys(),(e=>Mu(e)))}values(){return this.map.values()}get size(){return this.map.size}}function Wh(e,t,n){return n(He(e,t))}var Gh=n(7283);class Yh extends Error{constructor(e){super(e),this.name="TimeoutError"}}class Qh extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const Xh=e=>void 0===globalThis.DOMException?new Qh(e):new DOMException(e),Jh=e=>{const t=void 0===e.reason?Xh("This operation was aborted."):e.reason;return t instanceof Error?t:Xh(t)};function $h(e,t){const{milliseconds:n,fallback:r,message:i,customTimers:o={setTimeout:setTimeout,clearTimeout:clearTimeout}}=t;let s;const a=new Promise(((a,l)=>{if("number"!==typeof n||1!==Math.sign(n))throw new TypeError("Expected `milliseconds` to be a positive number, got `".concat(n,"`"));if(t.signal){const{signal:e}=t;e.aborted&&l(Jh(e)),e.addEventListener("abort",(()=>{l(Jh(e))}))}if(n===Number.POSITIVE_INFINITY)return void e.then(a,l);const c=new Yh;s=o.setTimeout.call(void 0,(()=>{if(r)try{a(r())}catch(t){l(t)}else"function"===typeof e.cancel&&e.cancel(),!1===i?a():i instanceof Error?l(i):(c.message=null!==i&&void 0!==i?i:"Promise timed out after ".concat(n," milliseconds"),l(c))}),n),(async()=>{try{a(await e)}catch(t){l(t)}})()})),l=a.finally((()=>{l.clear()}));return l.clear=()=>{o.clearTimeout.call(void 0,s),s=void 0},l}var Zh=new WeakMap;class ed{constructor(){gu(this,Zh,[])}enqueue(e,t){const n={priority:(t={priority:0,...t}).priority,run:e};if(this.size&&yu(Zh,this)[this.size-1].priority>=t.priority)return void yu(Zh,this).push(n);const r=function(e,t,n){let r=0,i=e.length;for(;i>0;){const o=Math.trunc(i/2);let s=r+o;n(e[s],t)<=0?(r=++s,i-=o+1):i=o}return r}(yu(Zh,this),n,((e,t)=>t.priority-e.priority));yu(Zh,this).splice(r,0,n)}dequeue(){const e=yu(Zh,this).shift();return null===e||void 0===e?void 0:e.run}filter(e){return yu(Zh,this).filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return yu(Zh,this).length}}var td=new WeakMap,nd=new WeakMap,rd=new WeakMap,id=new WeakMap,od=new WeakMap,sd=new WeakMap,ad=new WeakMap,ld=new WeakMap,cd=new WeakMap,ud=new WeakMap,hd=new WeakMap,dd=new WeakMap,fd=new WeakMap,pd=new WeakMap,gd=new WeakSet;class yd extends Gh{constructor(e){var t,n,r,i;if(super(),Ve(this,gd),gu(this,td,void 0),gu(this,nd,void 0),gu(this,rd,0),gu(this,id,void 0),gu(this,od,void 0),gu(this,sd,0),gu(this,ad,void 0),gu(this,ld,void 0),gu(this,cd,void 0),gu(this,ud,void 0),gu(this,hd,0),gu(this,dd,void 0),gu(this,fd,void 0),gu(this,pd,void 0),je(this,"timeout",void 0),!("number"===typeof(e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:ed,...e}).intervalCap&&e.intervalCap>=1))throw new TypeError("Expected `intervalCap` to be a number from 1 and up, got `".concat(null!==(t=null===(n=e.intervalCap)||void 0===n?void 0:n.toString())&&void 0!==t?t:"","` (").concat(typeof e.intervalCap,")"));if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError("Expected `interval` to be a finite number >= 0, got `".concat(null!==(r=null===(i=e.interval)||void 0===i?void 0:i.toString())&&void 0!==r?r:"","` (").concat(typeof e.interval,")"));Zu(td,this,e.carryoverConcurrencyCount),Zu(nd,this,e.intervalCap===Number.POSITIVE_INFINITY||0===e.interval),Zu(id,this,e.intervalCap),Zu(od,this,e.interval),Zu(cd,this,new e.queueClass),Zu(ud,this,e.queueClass),this.concurrency=e.concurrency,this.timeout=e.timeout,Zu(pd,this,!0===e.throwOnTimeout),Zu(fd,this,!1===e.autoStart)}get concurrency(){return yu(dd,this)}set concurrency(e){if(!("number"===typeof e&&e>=1))throw new TypeError("Expected `concurrency` to be a number from 1 and up, got `".concat(e,"` (").concat(typeof e,")"));Zu(dd,this,e),He(gd,this,Ad).call(this)}async add(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t={timeout:this.timeout,throwOnTimeout:yu(pd,this),...t},new Promise(((n,r)=>{yu(cd,this).enqueue((async()=>{var i,o;Zu(hd,this,(i=yu(hd,this),i++,i)),Zu(rd,this,(o=yu(rd,this),o++,o));try{var s;null===(s=t.signal)||void 0===s||s.throwIfAborted();let r=e({signal:t.signal});t.timeout&&(r=$h(Promise.resolve(r),{milliseconds:t.timeout})),t.signal&&(r=Promise.race([r,He(gd,this,Id).call(this,t.signal)]));const i=await r;n(i),this.emit("completed",i)}catch(a){if(a instanceof Yh&&!t.throwOnTimeout)return void n();r(a),this.emit("error",a)}finally{He(gd,this,wd).call(this)}}),t),this.emit("add"),He(gd,this,_d).call(this)}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return yu(fd,this)?(Zu(fd,this,!1),He(gd,this,Ad).call(this),this):this}pause(){Zu(fd,this,!0)}clear(){Zu(cd,this,new(yu(ud,this)))}async onEmpty(){0!==yu(cd,this).size&&await He(gd,this,Td).call(this,"empty")}async onSizeLessThan(e){yu(cd,this).size<e||await He(gd,this,Td).call(this,"next",(()=>yu(cd,this).size<e))}async onIdle(){0===yu(hd,this)&&0===yu(cd,this).size||await He(gd,this,Td).call(this,"idle")}get size(){return yu(cd,this).size}sizeBy(e){return yu(cd,this).filter(e).length}get pending(){return yu(hd,this)}get isPaused(){return yu(fd,this)}}function vd(e){return yu(nd,e)||yu(rd,e)<yu(id,e)}function md(e){return yu(hd,e)<yu(dd,e)}function wd(){var e;Zu(hd,this,(e=yu(hd,this),e--,e)),He(gd,this,_d).call(this),this.emit("next")}function bd(){He(gd,this,kd).call(this),He(gd,this,Sd).call(this),Zu(ld,this,void 0)}function Ed(e){const t=Date.now();if(void 0===yu(ad,e)){const n=yu(sd,e)-t;if(!(n<0))return void 0===yu(ld,e)&&Zu(ld,e,setTimeout((()=>{He(gd,e,bd).call(e)}),n)),!0;Zu(rd,e,yu(td,e)?yu(hd,e):0)}return!1}function _d(){if(0===yu(cd,this).size)return yu(ad,this)&&clearInterval(yu(ad,this)),Zu(ad,this,void 0),this.emit("empty"),0===yu(hd,this)&&this.emit("idle"),!1;if(!yu(fd,this)){const e=!Wh(gd,this,Ed);if(Wh(gd,this,vd)&&Wh(gd,this,md)){const t=yu(cd,this).dequeue();return!!t&&(this.emit("active"),t(),e&&He(gd,this,Sd).call(this),!0)}}return!1}function Sd(){yu(nd,this)||void 0!==yu(ad,this)||(Zu(ad,this,setInterval((()=>{He(gd,this,kd).call(this)}),yu(od,this))),Zu(sd,this,Date.now()+yu(od,this)))}function kd(){0===yu(rd,this)&&0===yu(hd,this)&&yu(ad,this)&&(clearInterval(yu(ad,this)),Zu(ad,this,void 0)),Zu(rd,this,yu(td,this)?yu(hd,this):0),He(gd,this,Ad).call(this)}function Ad(){for(;He(gd,this,_d).call(this););}async function Id(e){return new Promise(((t,n)=>{e.addEventListener("abort",(()=>{n(e.reason)}),{once:!0})}))}async function Td(e,t){return new Promise((n=>{const r=()=>{t&&!t()||(this.off(e,r),n())};this.on(e,r)}))}const Rd={},Cd=e=>{e.addEventListener("message",(t=>{Cd.dispatchEvent("message",e,t)})),null!=e.port&&e.port.addEventListener("message",(t=>{Cd.dispatchEvent("message",e,t)}))};Cd.addEventListener=(e,t)=>{null==Rd[e]&&(Rd[e]=[]),Rd[e].push(t)},Cd.removeEventListener=(e,t)=>{null!=Rd[e]&&(Rd[e]=Rd[e].filter((e=>e===t)))},Cd.dispatchEvent=function(e,t,n){null!=Rd[e]&&Rd[e].forEach((e=>e(t,n)))};const xd=Cd,Pd="lock:worker:request-read",Dd="lock:worker:release-read",Nd="lock:master:grant-read",Bd="lock:worker:request-write",Ld="lock:worker:release-write",Od="lock:master:grant-write",Md=(e,t,n,r,i)=>(o,s)=>{if(s.data.type!==n)return;const a={type:s.data.type,name:s.data.name,identifier:s.data.identifier};e.dispatchEvent(new MessageEvent(t,{data:{name:a.name,handler:async()=>{o.postMessage({type:i,name:a.name,identifier:a.identifier}),await new Promise((e=>{const t=n=>{if(null==n||null==n.data)return;const i=n.data.type,s=(n.data.name,n.data.identifier);i===r&&s===a.identifier&&(o.removeEventListener("message",t),e())};o.addEventListener("message",t)}))}}}))},Ud=(e,t,n,r)=>async()=>{const i=Math.random().toString().substring(2);return globalThis.postMessage({type:t,identifier:i,name:e}),new Promise((t=>{const o=s=>{if(null==s||null==s.data)return;const a=s.data.type,l=s.data.identifier;a===n&&l===i&&(globalThis.removeEventListener("message",o),t((()=>{globalThis.postMessage({type:r,identifier:i,name:e})})))};globalThis.addEventListener("message",o)}))},Fd={singleProcess:!1},Vd={};let zd;async function Kd(e,t){let n;const r=new Promise((e=>{n=e}));return e.add((async()=>$h((async()=>{await new Promise((e=>{n((()=>{e()}))}))})(),{milliseconds:t.timeout}))),r}const jd={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function Hd(e){const t=Object.assign({},jd,e);return null==zd&&(zd=(e=>{if(e=Object.assign({},Fd,e),Boolean(globalThis.document)||e.singleProcess){const e=new EventTarget;return xd.addEventListener("message",Md(e,"requestReadLock",Pd,Dd,Nd)),xd.addEventListener("message",Md(e,"requestWriteLock",Bd,Ld,Od)),e}return{isWorker:!0,readLock:e=>Ud(e,Pd,Nd,Dd),writeLock:e=>Ud(e,Bd,Od,Ld)}})(t),!0!==zd.isWorker&&(zd.addEventListener("requestReadLock",(e=>{null!=Vd[e.data.name]&&Vd[e.data.name].readLock().then((async t=>e.data.handler().finally((()=>{t()}))))})),zd.addEventListener("requestWriteLock",(async e=>{null!=Vd[e.data.name]&&Vd[e.data.name].writeLock().then((async t=>e.data.handler().finally((()=>{t()}))))})))),null==Vd[t.name]&&(Vd[t.name]=((e,t)=>{if(!0===zd.isWorker)return{readLock:zd.readLock(e,t),writeLock:zd.writeLock(e,t)};const n=new yd({concurrency:1});let r;return{async readLock(){if(null!=r)return Kd(r,t);r=new yd({concurrency:t.concurrency,autoStart:!1});const e=r,i=Kd(r,t);return n.add((async()=>{e.start(),await e.onIdle().then((()=>{r===e&&(r=null)}))})),i},writeLock:async()=>(r=null,Kd(n,t))}})(t.name,t)),Vd[t.name]}const qd={ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS"};var Wd,Gd,Yd;function Qd(e,t){var n;const r=Wd.decode(t);null!=r.publicKey&&null==e.publicKey&&(e=function(e){if("RSA"===e.type)return new Bu(e);if("Ed25519"===e.type)return new Lu(e);if("secp256k1"===e.type)return new Ou(e);throw new Mr("Not a PeerId","ERR_INVALID_PARAMETERS")}({...e,publicKey:e.publicKey}));const i=new Map,o=BigInt(Date.now());for(const[s,a]of r.tags.entries())null!=a.expiry&&a.expiry<o||i.set(s,a);return{...r,id:e,addresses:r.addresses.map((e=>{let{multiaddr:t,isCertified:n}=e;return{multiaddr:Vh(t),isCertified:null!==n&&void 0!==n&&n}})),metadata:r.metadata,peerRecordEnvelope:null!==(n=r.peerRecordEnvelope)&&void 0!==n?n:void 0,tags:i}}!function(e){let t,n,r;!function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.key&&""!==e.key&&(t.uint32(10),t.string(e.key)),null!=e.value&&e.value.byteLength>0&&(t.uint32(18),t.bytes(e.value)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={key:"",value:new Uint8Array(0)},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.key=e.string();break;case 2:n.value=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(t=e.Peer$metadataEntry||(e.Peer$metadataEntry={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.key&&""!==e.key&&(t.uint32(10),t.string(e.key)),null!=e.value&&(t.uint32(18),Yd.codec().encode(e.value,t)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={key:""},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.key=e.string();break;case 2:n.value=Yd.codec().decode(e,e.uint32());break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(n=e.Peer$tagsEntry||(e.Peer$tagsEntry={})),e.codec=()=>(null==r&&(r=Ys((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==r.lengthDelimited&&n.fork(),null!=t.addresses)for(const e of t.addresses)n.uint32(10),Gd.codec().encode(e,n);if(null!=t.protocols)for(const e of t.protocols)n.uint32(18),n.string(e);if(null!=t.publicKey&&(n.uint32(34),n.bytes(t.publicKey)),null!=t.peerRecordEnvelope&&(n.uint32(42),n.bytes(t.peerRecordEnvelope)),null!=t.metadata&&0!==t.metadata.size)for(const[i,o]of t.metadata.entries())n.uint32(50),e.Peer$metadataEntry.codec().encode({key:i,value:o},n);if(null!=t.tags&&0!==t.tags.size)for(const[i,o]of t.tags.entries())n.uint32(58),e.Peer$tagsEntry.codec().encode({key:i,value:o},n);!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={addresses:[],protocols:[],metadata:new Map,tags:new Map},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();switch(n>>>3){case 1:r.addresses.push(Gd.codec().decode(t,t.uint32()));break;case 2:r.protocols.push(t.string());break;case 4:r.publicKey=t.bytes();break;case 5:r.peerRecordEnvelope=t.bytes();break;case 6:{const n=e.Peer$metadataEntry.codec().decode(t,t.uint32());r.metadata.set(n.key,n.value);break}case 7:{const n=e.Peer$tagsEntry.codec().decode(t,t.uint32());r.tags.set(n.key,n.value);break}default:t.skipType(7&n)}}return r}))),r),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(Wd||(Wd={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.multiaddr&&e.multiaddr.byteLength>0&&(t.uint32(10),t.bytes(e.multiaddr)),null!=e.isCertified&&(t.uint32(16),t.bool(e.isCertified)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={multiaddr:new Uint8Array(0)},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.multiaddr=e.bytes();break;case 2:n.isCertified=e.bool();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(Gd||(Gd={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.value&&0!==e.value&&(t.uint32(8),t.uint32(e.value)),null!=e.expiry&&(t.uint32(16),t.uint64(e.expiry)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={value:0},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.value=e.uint32();break;case 2:n.expiry=e.uint64();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(Yd||(Yd={}));const Xd="/peers/";function Jd(e){if(!Tu(e)||null==e.type)throw new Mr("Invalid PeerId",qd.ERR_INVALID_PARAMETERS);const t=e.toCID().toString();return new Er("".concat(Xd).concat(t))}async function $d(e,t,n){const r=new Map;for(const o of n){var i;if(null==o)continue;if(o.multiaddr instanceof Uint8Array&&(o.multiaddr=Vh(o.multiaddr)),!Fh(o.multiaddr))throw new Mr("Multiaddr was invalid",qd.ERR_INVALID_PARAMETERS);if(!await t(e,o.multiaddr))continue;const n=null!==(i=o.isCertified)&&void 0!==i&&i,s=o.multiaddr.toString(),a=r.get(s);null!=a?o.isCertified=a.isCertified||n:r.set(s,{multiaddr:o.multiaddr,isCertified:n})}return[...r.values()].sort(((e,t)=>e.multiaddr.toString().localeCompare(t.multiaddr.toString()))).map((e=>{let{isCertified:t,multiaddr:n}=e;return{isCertified:t,multiaddr:n.bytes}}))}async function Zd(e,t,n,r){var i,o,s,a,l,c,u;if(null==t)throw new Mr("Invalid PeerData",qd.ERR_INVALID_PARAMETERS);if(null!=t.publicKey&&null!=e.publicKey&&!Hr(t.publicKey,e.publicKey))throw new Mr("publicKey bytes do not match peer id publicKey bytes",qd.ERR_INVALID_PARAMETERS);const h=r.existingPeer;if(null!=h&&!e.equals(h.id))throw new Mr("peer id did not match existing peer id",qd.ERR_INVALID_PARAMETERS);let d=null!==(i=null===h||void 0===h?void 0:h.addresses)&&void 0!==i?i:[],f=new Set(null!==(o=null===h||void 0===h?void 0:h.protocols)&&void 0!==o?o:[]),p=null!==(s=null===h||void 0===h?void 0:h.metadata)&&void 0!==s?s:new Map,g=null!==(a=null===h||void 0===h?void 0:h.tags)&&void 0!==a?a:new Map,y=null===h||void 0===h?void 0:h.peerRecordEnvelope;if("patch"===n){if(null==t.multiaddrs&&null==t.addresses||(d=[],null!=t.multiaddrs&&d.push(...t.multiaddrs.map((e=>({isCertified:!1,multiaddr:e})))),null!=t.addresses&&d.push(...t.addresses)),null!=t.protocols&&(f=new Set(t.protocols)),null!=t.metadata){p=ef(t.metadata instanceof Map?[...t.metadata.entries()]:Object.entries(t.metadata),{validate:tf})}if(null!=t.tags){g=ef(t.tags instanceof Map?[...t.tags.entries()]:Object.entries(t.tags),{validate:nf,map:rf})}null!=t.peerRecordEnvelope&&(y=t.peerRecordEnvelope)}if("merge"===n){if(null!=t.multiaddrs&&d.push(...t.multiaddrs.map((e=>({isCertified:!1,multiaddr:e})))),null!=t.addresses&&d.push(...t.addresses),null!=t.protocols&&(f=new Set([...f,...t.protocols])),null!=t.metadata){const e=t.metadata instanceof Map?[...t.metadata.entries()]:Object.entries(t.metadata);for(const[t,n]of e)null==n?p.delete(t):p.set(t,n);p=ef([...p.entries()],{validate:tf})}if(null!=t.tags){const e=t.tags instanceof Map?[...t.tags.entries()]:Object.entries(t.tags),n=new Map(g);for(const[t,r]of e)null==r?n.delete(t):n.set(t,r);g=ef([...n.entries()],{validate:nf,map:rf})}null!=t.peerRecordEnvelope&&(y=t.peerRecordEnvelope)}const v={addresses:await $d(e,null!==(l=r.addressFilter)&&void 0!==l?l:async()=>!0,d),protocols:[...f.values()].sort(((e,t)=>e.localeCompare(t))),metadata:p,tags:g,publicKey:null!==(c=null!==(u=null===h||void 0===h?void 0:h.id.publicKey)&&void 0!==u?u:t.publicKey)&&void 0!==c?c:e.publicKey,peerRecordEnvelope:y};return"RSA"!==e.type&&delete v.publicKey,v}function ef(e,t){const n=new Map;for(const[o,s]of e)null!=s&&t.validate(o,s);for(const[o,s]of e.sort(((e,t)=>{let[n]=e,[r]=t;return n.localeCompare(r)}))){var r,i;if(null!=s)n.set(o,null!==(r=null===(i=t.map)||void 0===i?void 0:i.call(t,o,s))&&void 0!==r?r:s)}return n}function tf(e,t){if("string"!==typeof e)throw new Mr("Metadata key must be a string",qd.ERR_INVALID_PARAMETERS);if(!(t instanceof Uint8Array))throw new Mr("Metadata value must be a Uint8Array",qd.ERR_INVALID_PARAMETERS)}function nf(e,t){if("string"!==typeof e)throw new Mr("Tag name must be a string",qd.ERR_INVALID_PARAMETERS);if(null!=t.value){if(parseInt("".concat(t.value),10)!==t.value)throw new Mr("Tag value must be an integer",qd.ERR_INVALID_PARAMETERS);if(t.value<0||t.value>100)throw new Mr("Tag value must be between 0-100",qd.ERR_INVALID_PARAMETERS)}if(null!=t.ttl){if(parseInt("".concat(t.ttl),10)!==t.ttl)throw new Mr("Tag ttl must be an integer",qd.ERR_INVALID_PARAMETERS);if(t.ttl<0)throw new Mr("Tag ttl must be between greater than 0",qd.ERR_INVALID_PARAMETERS)}}function rf(e,t){var n;let r;return null!=t.expiry&&(r=t.expiry),null!=t.ttl&&(r=BigInt(Date.now()+Number(t.ttl))),{value:null!==(n=t.value)&&void 0!==n?n:0,expiry:r}}function of(e,t,n){const r=e.toString().split("/")[2],i=Uu(pt.decode(r)),o=n.get(i);if(null!=o)return o;const s=Qd(i,t);return n.set(i,s),s}var sf=new WeakSet;class af{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Ve(this,sf),je(this,"peerId",void 0),je(this,"datastore",void 0),je(this,"lock",void 0),je(this,"addressFilter",void 0),this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=t.addressFilter,this.lock=Hd({name:"peer-store",singleProcess:!0})}async has(e){return this.datastore.has(Jd(e))}async delete(e){if(this.peerId.equals(e))throw new Mr("Cannot delete self peer",qd.ERR_INVALID_PARAMETERS);await this.datastore.delete(Jd(e))}async load(e){return Qd(e,await this.datastore.get(Jd(e)))}async save(e,t){const{existingBuf:n,existingPeer:r}=await He(sf,this,lf).call(this,e),i=await Zd(e,t,"patch",{addressFilter:this.addressFilter});return He(sf,this,cf).call(this,e,i,n,r)}async patch(e,t){const{existingBuf:n,existingPeer:r}=await He(sf,this,lf).call(this,e),i=await Zd(e,t,"patch",{addressFilter:this.addressFilter,existingPeer:r});return He(sf,this,cf).call(this,e,i,n,r)}async merge(e,t){const{existingBuf:n,existingPeer:r}=await He(sf,this,lf).call(this,e),i=await Zd(e,t,"merge",{addressFilter:this.addressFilter,existingPeer:r});return He(sf,this,cf).call(this,e,i,n,r)}async*all(e){const t=new qh;for await(const{key:n,value:r}of this.datastore.query(function(e,t){var n,r;return null==e?{}:{prefix:Xd,filters:(null!==(n=e.filters)&&void 0!==n?n:[]).map((e=>n=>{let{key:r,value:i}=n;return e(of(r,i,t))})),orders:(null!==(r=e.orders)&&void 0!==r?r:[]).map((e=>(n,r)=>e(of(n.key,n.value,t),of(r.key,r.value,t))))}}(null!==e&&void 0!==e?e:{},t))){const e=of(n,r,t);e.id.equals(this.peerId)||(yield e)}}}async function lf(e){try{const t=await this.datastore.get(Jd(e));return{existingBuf:t,existingPeer:Qd(e,t)}}catch(t){if("ERR_NOT_FOUND"!==t.code)throw t}return{}}async function cf(e,t,n,r){const i=Wd.encode(t);return null!=n&&Hr(i,n)?{peer:Qd(e,i),previous:r,updated:!1}:(await this.datastore.put(Jd(e),i),{peer:Qd(e,i),previous:r,updated:!0})}var uf=new WeakSet;class hf{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Ve(this,uf),je(this,"store",void 0),je(this,"events",void 0),je(this,"peerId",void 0),je(this,"log",void 0),this.log=e.logger.forComponent("libp2p:peer-store"),this.events=e.events,this.peerId=e.peerId,this.store=new af(e,t)}async forEach(e,t){this.log.trace("forEach await read lock");const n=await this.store.lock.readLock();this.log.trace("forEach got read lock");try{for await(const n of this.store.all(t))e(n)}finally{this.log.trace("forEach release read lock"),n()}}async all(e){this.log.trace("all await read lock");const t=await this.store.lock.readLock();this.log.trace("all got read lock");try{return await Sr(this.store.all(e))}finally{this.log.trace("all release read lock"),t()}}async delete(e){this.log.trace("delete await write lock");const t=await this.store.lock.writeLock();this.log.trace("delete got write lock");try{await this.store.delete(e)}finally{this.log.trace("delete release write lock"),t()}}async has(e){this.log.trace("has await read lock");const t=await this.store.lock.readLock();this.log.trace("has got read lock");try{return await this.store.has(e)}finally{this.log.trace("has release read lock"),t()}}async get(e){this.log.trace("get await read lock");const t=await this.store.lock.readLock();this.log.trace("get got read lock");try{return await this.store.load(e)}finally{this.log.trace("get release read lock"),t()}}async save(e,t){this.log.trace("save await write lock");const n=await this.store.lock.writeLock();this.log.trace("save got write lock");try{const n=await this.store.save(e,t);return He(uf,this,df).call(this,e,n),n.peer}finally{this.log.trace("save release write lock"),n()}}async patch(e,t){this.log.trace("patch await write lock");const n=await this.store.lock.writeLock();this.log.trace("patch got write lock");try{const n=await this.store.patch(e,t);return He(uf,this,df).call(this,e,n),n.peer}finally{this.log.trace("patch release write lock"),n()}}async merge(e,t){this.log.trace("merge await write lock");const n=await this.store.lock.writeLock();this.log.trace("merge got write lock");try{const n=await this.store.merge(e,t);return He(uf,this,df).call(this,e,n),n.peer}finally{this.log.trace("merge release write lock"),n()}}async consumePeerRecord(e,t){var n;const r=await Ju.openAndCertify(e,Hh.DOMAIN);if(!1===(null===t||void 0===t?void 0:t.equals(r.peerId)))return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",t,r.peerId),!1;const i=Hh.createFromProtobuf(r.payload);let o;try{o=await this.get(r.peerId)}catch(s){if("ERR_NOT_FOUND"!==s.code)throw s}if(null!=(null===(n=o)||void 0===n?void 0:n.peerRecordEnvelope)){const e=await Ju.createFromProtobuf(o.peerRecordEnvelope),t=Hh.createFromProtobuf(e.payload);if(t.seqNumber>=i.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",t.seqNumber,i.seqNumber),!1}return await this.patch(i.peerId,{peerRecordEnvelope:e,addresses:i.multiaddrs.map((e=>({isCertified:!0,multiaddr:e})))}),!0}}function df(e,t){t.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:t}):this.events.safeDispatchEvent("peer:update",{detail:t}))}const ff=e=>e;function pf(e,t){const n=e.getPeerId();if(null!=n){Mu(n).equals(t)&&(e=e.decapsulate(Vh("/p2p/".concat(t.toString()))))}return e}class gf{constructor(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};je(this,"log",void 0),je(this,"components",void 0),je(this,"listen",void 0),je(this,"announce",void 0),je(this,"observed",void 0),je(this,"announceFilter",void 0);const{listen:r=[],announce:i=[]}=n;this.components=e,this.log=e.logger.forComponent("libp2p:address-manager"),this.listen=r.map((e=>e.toString())),this.announce=new Set(i.map((e=>e.toString()))),this.observed=new Map,this.announceFilter=null!==(t=n.announceFilter)&&void 0!==t?t:ff,this._updatePeerStoreAddresses=function(e,t){let n;return function(){clearTimeout(n),n=setTimeout((function(){n=void 0,e()}),t)}}(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",(()=>{this._updatePeerStoreAddresses()})),e.events.addEventListener("transport:close",(()=>{this._updatePeerStoreAddresses()}))}_updatePeerStoreAddresses(){const e=this.getAnnounceAddrs().concat(this.components.transportManager.getAddrs()).concat([...this.observed.entries()].filter((e=>{let[t,n]=e;return n.confident})).map((e=>{let[t]=e;return Vh(t)}))).map((e=>e.getPeerId()===this.components.peerId.toString()?e.decapsulate("/p2p/".concat(this.components.peerId.toString())):e));this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch((e=>{this.log.error("error updating addresses",e)}))}getListenAddrs(){return Array.from(this.listen).map((e=>Vh(e)))}getAnnounceAddrs(){return Array.from(this.announce).map((e=>Vh(e)))}getObservedAddrs(){return Array.from(this.observed).map((e=>{let[t]=e;return Vh(t)}))}addObservedAddr(e){const t=(e=pf(e,this.components.peerId)).toString();this.observed.has(t)||this.observed.set(t,{confident:!1})}confirmObservedAddr(e){var t;const n=(e=pf(e,this.components.peerId)).toString(),r=(null!==(t=this.observed.get(n))&&void 0!==t?t:{confident:!1}).confident;this.observed.set(n,{confident:!0}),r||this._updatePeerStoreAddresses()}removeObservedAddr(e){const t=(e=pf(e,this.components.peerId)).toString();this.observed.delete(t)}getAddresses(){let e=this.getAnnounceAddrs().map((e=>e.toString()));0===e.length&&(e=this.components.transportManager.getAddrs().map((e=>e.toString()))),e=e.concat(Array.from(this.observed).filter((e=>{let[t,n]=e;return n.confident})).map((e=>{let[t]=e;return t})));const t=new Set(e);return this.announceFilter(Array.from(t).map((e=>Vh(e)))).map((e=>{var t;return!0===(null===(t=e.protos().pop())||void 0===t?void 0:t.path)||e.getPeerId()===this.components.peerId.toString()?e:e.encapsulate("/p2p/".concat(this.components.peerId.toString()))}))}}function yf(e){return null!=e&&"function"===typeof e.start&&"function"===typeof e.stop}async function vf(){const e=[];for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n)yf(i)&&e.push(i);await Promise.all(e.map((async e=>{null!=e.beforeStart&&await e.beforeStart()}))),await Promise.all(e.map((async e=>{await e.start()}))),await Promise.all(e.map((async e=>{null!=e.afterStart&&await e.afterStart()})))}async function mf(){const e=[];for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(const i of n)yf(i)&&e.push(i);await Promise.all(e.map((async e=>{null!=e.beforeStop&&await e.beforeStop()}))),await Promise.all(e.map((async e=>{await e.stop()}))),await Promise.all(e.map((async e=>{null!=e.afterStop&&await e.afterStop()})))}class wf{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};je(this,"components",{}),je(this,"_started",!1),this.components={};for(const[t,n]of Object.entries(e))this.components[t]=n;null==this.components.logger&&(this.components.logger=fn())}isStarted(){return this._started}async _invokeStartableMethod(e){await Promise.all(Object.values(this.components).filter((e=>yf(e))).map((async t=>{var n;await(null===(n=t[e])||void 0===n?void 0:n.call(t))})))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}const bf=["metrics","connectionProtector","dns"],Ef=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];var _f=n(7364);const Sf=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"].map((e=>new _f.Netmask(e)));function kf(e){return rh(e)?function(e){for(const t of Sf)if(t.contains(e))return!0;return!1}(e):ih(e)?/^::$/.test(t=e)||/^::1$/.test(t)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(t)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(t)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(t)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(t)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(t)||/^ff([0-9a-fA-F]{2,2}):/i.test(t):void 0;var t}function Af(){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async e=>{const t=e.stringTuples();return(4===t[0][0]||41===t[0][0])&&Boolean(kf("".concat(t[0][1])))},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}}}const If=Symbol.for("@libp2p/transport");var Tf;!function(e){e[e.FATAL_ALL=0]="FATAL_ALL",e[e.NO_FATAL=1]="NO_FATAL"}(Tf||(Tf={}));const Rf=e=>({match:t=>!(t.length<1)&&(!!e(t[0])&&t.slice(1)),pattern:"fn"}),Cf=e=>({match:t=>Rf((t=>t===e)).match(t),pattern:e}),xf=()=>({match:e=>Rf((e=>"string"===typeof e)).match(e),pattern:"{string}"}),Pf=()=>({match:e=>Rf((e=>!isNaN(parseInt(e)))).match(e),pattern:"{number}"}),Df=()=>({match:e=>{if(e.length<2)return!1;if("p2p"!==e[0]&&"ipfs"!==e[0])return!1;if(!e[1].startsWith("Q")&&!e[1].startsWith("1"))return!1;try{St.decode("z".concat(e[1]))}catch(t){return!1}return e.slice(2)},pattern:"/p2p/{peerid}"}),Nf=()=>({match:e=>{if(e.length<2)return!1;if("certhash"!==e[0])return!1;try{hn.decode(e[1])}catch{return!1}return e.slice(2)},pattern:"/certhash/{certhash}"}),Bf=e=>({match:t=>{const n=e.match(t);return!1===n?t:n},pattern:"optional(".concat(e.pattern,")")}),Lf=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{match:e=>{let n;for(const r of t){const t=r.match(e);!1!==t&&((null==n||t.length<n.length)&&(n=t))}return null!=n&&n},pattern:"or(".concat(t.map((e=>e.pattern)).join(", "),")")}},Of=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return{match:e=>{for(const n of t){const t=n.match(e);if(!1===t)return!1;e=t}return e},pattern:"and(".concat(t.map((e=>e.pattern)).join(", "),")")}};function Mf(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];function r(e){let n=(e=>e.toString().split("/").slice(1))(e);for(const r of t){const e=r.match(n);if(!1===e)return!1;n=e}return n}return{matches:function(e){return!1!==r(e)},exactMatch:function(e){const t=r(e);return!1!==t&&0===t.length}}}const Uf=Of(Cf("dns4"),xf()),Ff=Of(Cf("dns6"),xf()),Vf=Of(Cf("dnsaddr"),xf()),zf=Of(Cf("dns"),xf()),Kf=(Mf(Uf),Mf(Ff),Mf(Vf),Mf(Lf(zf,Vf,Uf,Ff))),jf=Of(Cf("ip4"),Rf(rh)),Hf=Of(Cf("ip6"),Rf(ih)),qf=Lf(jf,Hf),Wf=Lf(qf,zf,Uf,Ff,Vf),Gf=Mf(Wf),Yf=(Mf(jf),Mf(Hf),Mf(qf)),Qf=Of(Wf,Cf("tcp"),Pf()),Xf=Of(Wf,Cf("udp"),Pf()),Jf=Lf(Qf,Xf),$f=(Mf(Qf),Mf(Xf),Of(Xf,Cf("quic"))),Zf=Of(Xf,Cf("quic-v1")),ep=Lf($f,Zf),tp=(Mf($f),Mf(Zf),Lf(Wf,Qf,Xf,$f,Zf)),np=Lf(Of(tp,Cf("ws"),Bf(Df()))),rp=(Mf(np),Lf(Of(tp,Cf("wss"),Bf(Df())),Of(tp,Cf("tls"),Cf("ws"),Bf(Df())))),ip=(Mf(rp),Of(Jf,Cf("webrtc-direct"),Nf(),Bf(Nf()),Bf(Df()))),op=Mf(ip),sp=Of(Zf,Cf("webtransport"),Nf(),Nf(),Bf(Df())),ap=Mf(sp),lp=Lf(np,rp,Of(Qf,Bf(Df())),Of(ep,Bf(Df())),Of(Wf,Bf(Df())),ip,sp,Df()),cp=(Mf(lp),Mf(Of(lp,Cf("p2p-circuit"),Df()))),up=Mf(Lf(Of(lp,Cf("p2p-circuit"),Cf("webrtc"),Df()),Of(lp,Cf("webrtc"),Bf(Df())),Cf("webrtc")));Mf(Lf(Of(Wf,Cf("tcp"),Pf(),Cf("http"),Bf(Df())),Of(Wf,Cf("http"),Bf(Df())))),Mf(Lf(Of(Wf,Cf("tcp"),Lf(Of(Cf("443"),Cf("http")),Of(Pf(),Cf("https"))),Bf(Df())),Of(Wf,Cf("tls"),Cf("http"),Bf(Df())),Of(Wf,Cf("https"),Bf(Df()))));function hp(e){try{const{address:t}=e.nodeAddress();return Boolean(kf(t))}catch{return!0}}function dp(e,t){const n=function(e,t){const n=hp(e.multiaddr),r=hp(t.multiaddr);return n&&!r?1:!n&&r?-1:0}(e,t);if(0!==n)return n;const r=function(e,t){const n=cp.exactMatch(e.multiaddr),r=cp.exactMatch(t.multiaddr);return n&&!r?1:!n&&r?-1:0}(e,t);if(0!==r)return r;const i=function(e,t){return e.isCertified&&!t.isCertified?-1:!e.isCertified&&t.isCertified?1:0}(e,t);return i}class fp extends Event{constructor(e,t){super(e),this.detail=t}}function pp(e){const t=[_p.A];return null==e?t:Array.isArray(e)?0===e.length?t:e:[e]}const gp=60;function yp(e){var t,n,r,i,o,s,a,l,c,u,h,d,f,p,g;return{Status:null!==(t=e.Status)&&void 0!==t?t:0,TC:null!==(n=null!==(r=e.TC)&&void 0!==r?r:e.flag_tc)&&void 0!==n&&n,RD:null!==(i=null!==(o=e.RD)&&void 0!==o?o:e.flag_rd)&&void 0!==i&&i,RA:null!==(s=null!==(a=e.RA)&&void 0!==a?a:e.flag_ra)&&void 0!==s&&s,AD:null!==(l=null!==(c=e.AD)&&void 0!==c?c:e.flag_ad)&&void 0!==l&&l,CD:null!==(u=null!==(h=e.CD)&&void 0!==h?h:e.flag_cd)&&void 0!==u&&u,Question:(null!==(d=null!==(f=e.Question)&&void 0!==f?f:e.questions)&&void 0!==d?d:[]).map((e=>({name:e.name,type:_p[e.type]}))),Answer:(null!==(p=null!==(g=e.Answer)&&void 0!==g?g:e.answers)&&void 0!==p?p:[]).map((e=>{var t,n;return{name:e.name,type:_p[e.type],TTL:null!==(t=null!==(n=e.TTL)&&void 0!==n?n:e.ttl)&&void 0!==t?t:gp,data:e.data instanceof Uint8Array?vr(e.data):e.data}}))}}const vp=4;function mp(e){var t;const n=new yd({concurrency:null!==(t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).queryConcurrency)&&void 0!==t?t:vp});return async function(t){var r;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=new URLSearchParams;o.set("name",t),pp(i.types).forEach((e=>{o.append("type",_p[e])})),null===(r=i.onProgress)||void 0===r||r.call(i,new fp("dns:query",{detail:t}));const s=await n.add((async()=>{var t;const n=await fetch("".concat(e,"?").concat(o),{headers:{accept:"application/dns-json"},signal:null===i||void 0===i?void 0:i.signal});if(200!==n.status)throw new Error("Unexpected HTTP status: ".concat(n.status," - ").concat(n.statusText));const r=yp(await n.json());return null===(t=i.onProgress)||void 0===t||t.call(i,new fp("dns:response",{detail:r})),r}),{signal:i.signal});if(null==s)throw new Error("No DNS response received");return s}}var wp=n(101);class bp{constructor(e){je(this,"lru",void 0),this.lru=wp(e)}get(e,t){let n=!0;const r=[];for(const i of t){const t=this.getAnswers(e,i);if(0===t.length){n=!1;break}r.push(...t)}if(n)return yp({answers:r})}getAnswers(e,t){const n="".concat(e.toLowerCase(),"-").concat(t),r=this.lru.get(n);if(null!=r){const e=r.filter((e=>e.expires>Date.now())).map((e=>{let{expires:t,value:n}=e;return{...n,TTL:Math.round((t-Date.now())/1e3),type:_p[n.type]}}));return 0===e.length&&this.lru.remove(n),e}return[]}add(e,t){var n,r;const i="".concat(e.toLowerCase(),"-").concat(t.type),o=null!==(n=this.lru.get(i))&&void 0!==n?n:[];o.push({expires:Date.now()+1e3*(null!==(r=t.TTL)&&void 0!==r?r:gp),value:t}),this.lru.set(i,o)}remove(e,t){const n="".concat(e.toLowerCase(),"-").concat(t);this.lru.remove(n)}clear(){this.lru.clear()}}class Ep{constructor(e){var t,n,r;je(this,"resolvers",void 0),je(this,"cache",void 0),this.resolvers={},this.cache=(r=null!==(t=e.cacheSize)&&void 0!==t?t:1e3,new bp(r)),Object.entries(null!==(n=e.resolvers)&&void 0!==n?n:{}).forEach((e=>{let[t,n]=e;Array.isArray(n)||(n=[n]),t.endsWith(".")||(t="".concat(t,".")),this.resolvers[t]=n})),null==this.resolvers["."]&&(this.resolvers["."]=[mp("https://cloudflare-dns.com/dns-query"),mp("https://dns.google/resolve")])}async query(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=pp(n.types),i=!1!==n.cached?this.cache.get(e,r):void 0;var o;if(null!=i)return null===(o=n.onProgress)||void 0===o||o.call(n,new fp("dns:cache",{detail:i})),i;const s="".concat(e.split(".").pop(),"."),a=(null!==(t=this.resolvers[s])&&void 0!==t?t:this.resolvers["."]).sort((()=>Math.random()>.5?-1:1)),l=[];for(const d of a){var c;if(!0===(null===(c=n.signal)||void 0===c?void 0:c.aborted))break;try{const t=await d(e,{...n,types:r});for(const n of t.Answer)this.cache.add(e,n);return t}catch(h){var u;l.push(h),null===(u=n.onProgress)||void 0===u||u.call(n,new fp("dns:error",{detail:h}))}}if(1===l.length)throw l[0];throw new AggregateError(l,"DNS lookup of ".concat(e," ").concat(r," failed"))}}var _p;!function(e){e[e.A=1]="A",e[e.CNAME=5]="CNAME",e[e.TXT=16]="TXT",e[e.AAAA=28]="AAAA"}(_p||(_p={}));function Sp(){return new Ep(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}const{code:kp}=fh("dnsaddr"),Ap=async function(e){var t,n,r;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const o=null!==(t=i.maxRecursiveDepth)&&void 0!==t?t:32;if(0===o)throw new Mr("Max recursive depth reached","ERR_MAX_RECURSIVE_DEPTH_REACHED");const[,s]=null!==(n=e.stringTuples().find((e=>{let[t]=e;return t===kp})))&&void 0!==n?n:[],a=null!==(r=null===i||void 0===i?void 0:i.dns)&&void 0!==r?r:Sp(),l=await a.query("_dnsaddr.".concat(s),{signal:null===i||void 0===i?void 0:i.signal,types:[_p.TXT]}),c=e.getPeerId(),u=[];for(const h of l.Answer){const e=h.data.split("=")[1];if(null==e)continue;if(null!=c&&!e.includes(c))continue;const t=Vh(e);if(e.startsWith("/dnsaddr")){const e=await t.resolve({...i,maxRecursiveDepth:o-1});u.push(...e.map((e=>e.toString())))}else u.push(t.toString())}return u};const Ip=n(8355);var Tp,Rp;!function(e){e.NOT_STARTED_YET="The libp2p node is not started yet",e.ERR_PROTECTOR_REQUIRED="Private network is enforced, but no protector was provided",e.NOT_FOUND="Not found"}(Tp||(Tp={})),function(e){e.ERR_PROTECTOR_REQUIRED="ERR_PROTECTOR_REQUIRED",e.ERR_PEER_DIAL_INTERCEPTED="ERR_PEER_DIAL_INTERCEPTED",e.ERR_CONNECTION_INTERCEPTED="ERR_CONNECTION_INTERCEPTED",e.ERR_INVALID_PROTOCOLS_FOR_STREAM="ERR_INVALID_PROTOCOLS_FOR_STREAM",e.ERR_CONNECTION_ENDED="ERR_CONNECTION_ENDED",e.ERR_CONNECTION_FAILED="ERR_CONNECTION_FAILED",e.ERR_NODE_NOT_STARTED="ERR_NODE_NOT_STARTED",e.ERR_ALREADY_ABORTED="ERR_ALREADY_ABORTED",e.ERR_TOO_MANY_ADDRESSES="ERR_TOO_MANY_ADDRESSES",e.ERR_NO_VALID_ADDRESSES="ERR_NO_VALID_ADDRESSES",e.ERR_RELAYED_DIAL="ERR_RELAYED_DIAL",e.ERR_DIALED_SELF="ERR_DIALED_SELF",e.ERR_DISCOVERED_SELF="ERR_DISCOVERED_SELF",e.ERR_DUPLICATE_TRANSPORT="ERR_DUPLICATE_TRANSPORT",e.ERR_ENCRYPTION_FAILED="ERR_ENCRYPTION_FAILED",e.ERR_HOP_REQUEST_FAILED="ERR_HOP_REQUEST_FAILED",e.ERR_INVALID_KEY="ERR_INVALID_KEY",e.ERR_INVALID_MESSAGE="ERR_INVALID_MESSAGE",e.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",e.ERR_INVALID_PEER="ERR_INVALID_PEER",e.ERR_MUXER_UNAVAILABLE="ERR_MUXER_UNAVAILABLE",e.ERR_NOT_FOUND="ERR_NOT_FOUND",e.ERR_TRANSPORT_UNAVAILABLE="ERR_TRANSPORT_UNAVAILABLE",e.ERR_TRANSPORT_DIAL_FAILED="ERR_TRANSPORT_DIAL_FAILED",e.ERR_UNSUPPORTED_PROTOCOL="ERR_UNSUPPORTED_PROTOCOL",e.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED="ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED",e.ERR_INVALID_MULTIADDR="ERR_INVALID_MULTIADDR",e.ERR_SIGNATURE_NOT_VALID="ERR_SIGNATURE_NOT_VALID",e.ERR_FIND_SELF="ERR_FIND_SELF",e.ERR_NO_ROUTERS_AVAILABLE="ERR_NO_ROUTERS_AVAILABLE",e.ERR_CONNECTION_NOT_MULTIPLEXED="ERR_CONNECTION_NOT_MULTIPLEXED",e.ERR_NO_DIAL_TOKENS="ERR_NO_DIAL_TOKENS",e.ERR_INVALID_CMS="ERR_INVALID_CMS",e.ERR_MISSING_KEYS="ERR_MISSING_KEYS",e.ERR_NO_KEY="ERR_NO_KEY",e.ERR_INVALID_KEY_NAME="ERR_INVALID_KEY_NAME",e.ERR_INVALID_KEY_TYPE="ERR_INVALID_KEY_TYPE",e.ERR_KEY_ALREADY_EXISTS="ERR_KEY_ALREADY_EXISTS",e.ERR_INVALID_KEY_SIZE="ERR_INVALID_KEY_SIZE",e.ERR_KEY_NOT_FOUND="ERR_KEY_NOT_FOUND",e.ERR_OLD_KEY_NAME_INVALID="ERR_OLD_KEY_NAME_INVALID",e.ERR_NEW_KEY_NAME_INVALID="ERR_NEW_KEY_NAME_INVALID",e.ERR_PASSWORD_REQUIRED="ERR_PASSWORD_REQUIRED",e.ERR_PEM_REQUIRED="ERR_PEM_REQUIRED",e.ERR_CANNOT_READ_KEY="ERR_CANNOT_READ_KEY",e.ERR_MISSING_PRIVATE_KEY="ERR_MISSING_PRIVATE_KEY",e.ERR_MISSING_PUBLIC_KEY="ERR_MISSING_PUBLIC_KEY",e.ERR_INVALID_OLD_PASS_TYPE="ERR_INVALID_OLD_PASS_TYPE",e.ERR_INVALID_NEW_PASS_TYPE="ERR_INVALID_NEW_PASS_TYPE",e.ERR_INVALID_PASS_LENGTH="ERR_INVALID_PASS_LENGTH",e.ERR_NOT_IMPLEMENTED="ERR_NOT_IMPLEMENTED",e.ERR_WRONG_PING_ACK="ERR_WRONG_PING_ACK",e.ERR_INVALID_RECORD="ERR_INVALID_RECORD",e.ERR_ALREADY_SUCCEEDED="ERR_ALREADY_SUCCEEDED",e.ERR_NO_HANDLER_FOR_PROTOCOL="ERR_NO_HANDLER_FOR_PROTOCOL",e.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS",e.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS",e.ERR_CONNECTION_DENIED="ERR_CONNECTION_DENIED",e.ERR_TRANSFER_LIMIT_EXCEEDED="ERR_TRANSFER_LIMIT_EXCEEDED"}(Rp||(Rp={}));const Cp={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:e=>e},connectionManager:{resolvers:{dnsaddr:Ap},addressSorter:dp},transportManager:{faultTolerance:Tf.FATAL_ALL}};const xp=()=>{const e=new Error("Delay aborted");return e.name="AbortError",e},Pp=new WeakMap;const Dp=function(){let{clearTimeout:e,setTimeout:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return function(n){let r,i,o,{value:s,signal:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null!==a&&void 0!==a&&a.aborted)return Promise.reject(xp());const l=null!==e&&void 0!==e?e:clearTimeout,c=()=>{l(r),o(xp())},u=new Promise(((e,l)=>{i=()=>{a&&a.removeEventListener("abort",c),e(s)},o=l,r=(null!==t&&void 0!==t?t:setTimeout)(i,n)}));return a&&a.addEventListener("abort",c,{once:!0}),Pp.set(u,(()=>{l(r),r=null,i()})),u}}(),Np=Dp;class Bp{constructor(){var e,t,n,r,i,o;let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};je(this,"memoryStorage",void 0),je(this,"points",void 0),je(this,"duration",void 0),je(this,"blockDuration",void 0),je(this,"execEvenly",void 0),je(this,"execEvenlyMinDelayMs",void 0),je(this,"keyPrefix",void 0),this.points=null!==(e=s.points)&&void 0!==e?e:4,this.duration=null!==(t=s.duration)&&void 0!==t?t:1,this.blockDuration=null!==(n=s.blockDuration)&&void 0!==n?n:0,this.execEvenly=null!==(r=s.execEvenly)&&void 0!==r&&r,this.execEvenlyMinDelayMs=null!==(i=s.execEvenlyMinDelayMs)&&void 0!==i?i:1e3*this.duration/this.points,this.keyPrefix=null!==(o=s.keyPrefix)&&void 0!==o?o:"rlflx",this.memoryStorage=new Lp}async consume(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=this.getKey(e),i=this._getKeySecDuration(n);let o=this.memoryStorage.incrby(r,t,i);if(o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.consumedPoints>this.points)throw this.blockDuration>0&&o.consumedPoints<=this.points+t&&(o=this.memoryStorage.set(r,o.consumedPoints,this.blockDuration)),new Mr("Rate limit exceeded","ERR_RATE_LIMIT_EXCEEDED",o);if(this.execEvenly&&o.msBeforeNext>0&&!o.isFirstInDuration){let e=Math.ceil(o.msBeforeNext/(o.remainingPoints+2));e<this.execEvenlyMinDelayMs&&(e=o.consumedPoints*this.execEvenlyMinDelayMs),await Np(e)}return o}penalty(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=this.getKey(e),i=this._getKeySecDuration(n),o=this.memoryStorage.incrby(r,t,i);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}reward(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=this.getKey(e),i=this._getKeySecDuration(n),o=this.memoryStorage.incrby(r,-t,i);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}block(e,t){const n=1e3*t,r=this.points+1;return this.memoryStorage.set(this.getKey(e),r,t),{remainingPoints:0,msBeforeNext:0===n?-1:n,consumedPoints:r,isFirstInDuration:!1}}set(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const r=1e3*(n>=0?n:this.duration);return this.memoryStorage.set(this.getKey(e),t,n),{remainingPoints:0,msBeforeNext:0===r?-1:r,consumedPoints:t,isFirstInDuration:!1}}get(e){const t=this.memoryStorage.get(this.getKey(e));return null!=t&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),t}delete(e){this.memoryStorage.delete(this.getKey(e))}_getKeySecDuration(e){return null!=(null===e||void 0===e?void 0:e.customDuration)&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?"".concat(this.keyPrefix,":").concat(e):e}parseKey(e){return e.substring(this.keyPrefix.length)}}class Lp{constructor(){je(this,"storage",void 0),this.storage=new Map}incrby(e,t,n){const r=this.storage.get(e);if(null!=r){const i=null!=r.expiresAt?r.expiresAt.getTime()-(new Date).getTime():-1;return null==r.expiresAt||i>0?(r.value+=t,{remainingPoints:0,msBeforeNext:i,consumedPoints:r.value,isFirstInDuration:!1}):this.set(e,t,n)}return this.set(e,t,n)}set(e,t,n){const r=1e3*n,i=this.storage.get(e);null!=i&&clearTimeout(i.timeoutId);const o={value:t,expiresAt:r>0?new Date(Date.now()+r):void 0};return this.storage.set(e,o),r>0&&(o.timeoutId=setTimeout((()=>{this.storage.delete(e)}),r),null!=o.timeoutId.unref&&o.timeoutId.unref()),{remainingPoints:0,msBeforeNext:0===r?-1:r,consumedPoints:o.value,isFirstInDuration:!0}}get(e){const t=this.storage.get(e);if(null!=t){return{remainingPoints:0,msBeforeNext:null!=t.expiresAt?t.expiresAt.getTime()-(new Date).getTime():-1,consumedPoints:t.value,isFirstInDuration:!1}}}delete(e){const t=this.storage.get(e);return null!=t&&(null!=t.timeoutId&&clearTimeout(t.timeoutId),this.storage.delete(e),!0)}}function Op(e){if(Tu(e))return{peerId:e,multiaddrs:[]};let t;if(Array.isArray(e)||(e=[e]),e.length>0){const n=e[0].getPeerId();t=null==n?void 0:Mu(n),e.forEach((e=>{if(!Fh(e))throw new Mr("Invalid Multiaddr",Rp.ERR_INVALID_MULTIADDR);const n=e.getPeerId();if(null==n){if(null!=t)throw new Mr("Multiaddrs must all have the same peer id or have no peer id",Rp.ERR_INVALID_PARAMETERS)}else{const e=Mu(n);if(null==t||!t.equals(e))throw new Mr("Multiaddrs must all have the same peer id or have no peer id",Rp.ERR_INVALID_PARAMETERS)}}))}return{peerId:t,multiaddrs:e}}class Mp extends Error{constructor(e,t){super(null!==e&&void 0!==e?e:"The operation was aborted"),je(this,"type",void 0),je(this,"code",void 0),this.type="aborted",this.name="AbortError",this.code=null!==t&&void 0!==t?t:"ABORT_ERR"}}async function Up(e,t,n,r){const i=new Mp(null===r||void 0===r?void 0:r.errorMessage,null===r||void 0===r?void 0:r.errorCode);return!0===(null===n||void 0===n?void 0:n.aborted)?Promise.reject(i):new Promise(((o,s)=>{const a=i=>{try{var c;if(!1===(null===r||void 0===r||null===(c=r.filter)||void 0===c?void 0:c.call(r,i)))return}catch(u){return e.removeEventListener(t,a),null===n||void 0===n||n.removeEventListener("abort",l),void s(u)}e.removeEventListener(t,a),null===n||void 0===n||n.removeEventListener("abort",l),o(i)},l=()=>{e.removeEventListener(t,a),null===n||void 0===n||n.removeEventListener("abort",l),s(i)};e.addEventListener(t,a),null===n||void 0===n||n.addEventListener("abort",l)}))}class Fp extends Error{constructor(e,t){super(null!==e&&void 0!==e?e:"The operation was aborted"),je(this,"type",void 0),je(this,"code",void 0),this.type="aborted",this.name="AbortError",this.code=null!==t&&void 0!==t?t:"ABORT_ERR"}}async function Vp(e,t,n){if(null==t)return e;if(t.aborted)return Promise.reject(new Fp(null===n||void 0===n?void 0:n.errorMessage,null===n||void 0===n?void 0:n.errorCode));let r;const i=new Fp(null===n||void 0===n?void 0:n.errorMessage,null===n||void 0===n?void 0:n.errorCode);try{return await Promise.race([e,new Promise(((e,n)=>{r=()=>{n(i)},t.addEventListener("abort",r)}))])}finally{null!=r&&t.removeEventListener("abort",r)}}class zp{constructor(e,t){var n;je(this,"deferred",void 0),je(this,"signal",void 0),je(this,"where",void 0),this.signal=t,this.deferred=mn(),this.where=e,this.onAbort=this.onAbort.bind(this),null===(n=this.signal)||void 0===n||n.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(new Or)}cleanup(){var e;null===(e=this.signal)||void 0===e||e.removeEventListener("abort",this.onAbort)}}class Kp{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;je(this,"id",void 0),je(this,"fn",void 0),je(this,"options",void 0),je(this,"priority",void 0),je(this,"recipients",void 0),je(this,"status",void 0),je(this,"timeline",void 0),je(this,"controller",void 0),this.id="".concat(parseInt(String(1e9*Math.random()),10).toString()).concat(Date.now()),this.status="queued",this.fn=e,this.priority=n,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,vu(1/0,this.controller.signal),this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce(((e,t)=>{var n;return e&&!0===(null===(n=t.signal)||void 0===n?void 0:n.aborted)}),!0)&&this.controller.abort(new Or)}async join(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const n=new zp(new Error("where").stack,t.signal);return this.recipients.push(n),null===(e=t.signal)||void 0===e||e.addEventListener("abort",this.onAbort),n.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{var e;this.controller.signal.throwIfAborted();const t=await Vp(this.fn({...null!==(e=this.options)&&void 0!==e?e:{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach((e=>{e.deferred.resolve(t)})),this.status="complete"}catch(t){this.recipients.forEach((e=>{e.deferred.reject(t)})),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach((e=>{var t;null===(t=e.signal)||void 0===t||t.removeEventListener("abort",this.onAbort)}))}}class jp extends bu{constructor(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var n;(super(),je(this,"concurrency",void 0),je(this,"queue",void 0),je(this,"pending",void 0),this.concurrency=null!==(e=t.concurrency)&&void 0!==e?e:Number.POSITIVE_INFINITY,this.pending=0,null!=t.metricName)&&(null===(n=t.metrics)||void 0===n||n.registerMetricGroup(t.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})}));this.queue=[]}tryToStartAnother(){if(0===this.size)return queueMicrotask((()=>{this.safeDispatchEvent("empty")})),0===this.running&&queueMicrotask((()=>{this.safeDispatchEvent("idle")})),!1;if(this.pending<this.concurrency){let e;for(const t of this.queue)if("queued"===t.status){e=t;break}return null!=e&&(this.safeDispatchEvent("active"),this.pending++,e.run().finally((()=>{for(let t=0;t<this.queue.length;t++)if(this.queue[t]===e){this.queue.splice(t,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")})),!0)}return!1}enqueue(e){var t;if((null===(t=this.queue[this.size-1])||void 0===t?void 0:t.priority)>=e.priority)return void this.queue.push(e);const n=function(e,t,n){let r=0,i=e.length;for(;i>0;){const o=Math.trunc(i/2);let s=r+o;n(e[s],t)<=0?(r=++s,i-=o+1):i=o}return r}(this.queue,e,((e,t)=>t.priority-e.priority));this.queue.splice(n,0,e)}async add(e,t){var n;null===t||void 0===t||null===(n=t.signal)||void 0===n||n.throwIfAborted();const r=new Kp(e,t,null===t||void 0===t?void 0:t.priority),i=r.join(t).then((e=>(this.safeDispatchEvent("completed",{detail:e}),this.safeDispatchEvent("success",{detail:{job:r,result:e}}),e))).catch((e=>{throw this.safeDispatchEvent("error",{detail:e}),this.safeDispatchEvent("failure",{detail:{job:r,error:e}}),e}));return this.enqueue(r),this.safeDispatchEvent("add"),this.tryToStartAnother(),i}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach((e=>{e.abort(new Or)})),this.clear()}async onEmpty(e){0!==this.size&&await Up(this,"empty",null===e||void 0===e?void 0:e.signal)}async onSizeLessThan(e,t){this.size<e||await Up(this,"next",null===t||void 0===t?void 0:t.signal,{filter:()=>this.size<e})}async onIdle(e){0===this.pending&&0===this.size||await Up(this,"idle",null===e||void 0===e?void 0:e.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(e){var t,n;null===e||void 0===e||null===(t=e.signal)||void 0===t||t.throwIfAborted();const r=_n({objectMode:!0}),i=e=>{null!=e?this.abort():this.clear(),r.end(e)},o=e=>{null!=e.detail&&r.push(e.detail)},s=e=>{i(e.detail)},a=()=>{i()},l=()=>{i(new Mr("Queue aborted","ERR_QUEUE_ABORTED"))};this.addEventListener("completed",o),this.addEventListener("error",s),this.addEventListener("idle",a),null===e||void 0===e||null===(n=e.signal)||void 0===n||n.addEventListener("abort",l);try{yield*r}finally{var c;this.removeEventListener("completed",o),this.removeEventListener("error",s),this.removeEventListener("idle",a),null===e||void 0===e||null===(c=e.signal)||void 0===c||c.removeEventListener("abort",l),i()}}}class Hp extends jp{has(e){return null!=this.find(e)}find(e){return this.queue.find((t=>e.equals(t.options.peerId)))}}const qp="last-dial-failure",Wp={minConnections:5,maxQueueLength:100,autoDialConcurrency:25,autoDialPriority:0,autoDialInterval:5e3,autoDialPeerRetryThreshold:42e4,autoDialDiscoveredPeersDebounce:10};class Gp{constructor(e,t){var n,r,i,o,s,a,l;let c;je(this,"connectionManager",void 0),je(this,"peerStore",void 0),je(this,"queue",void 0),je(this,"minConnections",void 0),je(this,"autoDialPriority",void 0),je(this,"autoDialIntervalMs",void 0),je(this,"autoDialMaxQueueLength",void 0),je(this,"autoDialPeerRetryThresholdMs",void 0),je(this,"autoDialDiscoveredPeersDebounce",void 0),je(this,"autoDialInterval",void 0),je(this,"started",void 0),je(this,"running",void 0),je(this,"log",void 0),this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.minConnections=null!==(n=t.minConnections)&&void 0!==n?n:Wp.minConnections,this.autoDialPriority=null!==(r=t.autoDialPriority)&&void 0!==r?r:Wp.autoDialPriority,this.autoDialIntervalMs=null!==(i=t.autoDialInterval)&&void 0!==i?i:Wp.autoDialInterval,this.autoDialMaxQueueLength=null!==(o=t.maxQueueLength)&&void 0!==o?o:Wp.maxQueueLength,this.autoDialPeerRetryThresholdMs=null!==(s=t.autoDialPeerRetryThreshold)&&void 0!==s?s:Wp.autoDialPeerRetryThreshold,this.autoDialDiscoveredPeersDebounce=null!==(a=t.autoDialDiscoveredPeersDebounce)&&void 0!==a?a:Wp.autoDialDiscoveredPeersDebounce,this.log=e.logger.forComponent("libp2p:connection-manager:auto-dial"),this.started=!1,this.running=!1,this.queue=new Hp({concurrency:null!==(l=t.autoDialConcurrency)&&void 0!==l?l:Wp.autoDialConcurrency,metricName:"libp2p_autodial_queue",metrics:e.metrics}),this.queue.addEventListener("error",(e=>{this.log.error("error during auto-dial",e.detail)})),e.events.addEventListener("connection:close",(()=>{this.autoDial().catch((e=>{this.log.error(e)}))})),e.events.addEventListener("peer:discovery",(()=>{clearTimeout(c),c=setTimeout((()=>{this.autoDial().catch((e=>{this.log.error(e)}))}),this.autoDialDiscoveredPeersDebounce)}))}isStarted(){return this.started}start(){this.started=!0}afterStart(){this.autoDial().catch((e=>{this.log.error("error while autodialing",e)}))}stop(){this.queue.clear(),clearTimeout(this.autoDialInterval),this.started=!1,this.running=!1}async autoDial(){if(!this.started||this.running)return;const e=this.connectionManager.getConnectionsMap(),t=e.size;if(t>=this.minConnections)return void(this.minConnections>0&&this.log.trace("have enough connections %d/%d",t,this.minConnections));if(this.queue.size>this.autoDialMaxQueueLength)return this.log("not enough connections %d/%d but auto dial queue is full",t,this.minConnections),void this.sheduleNextAutodial();this.running=!0,this.log("not enough connections %d/%d - will dial peers to increase the number of connections",t,this.minConnections);const n=new zu(this.connectionManager.getDialQueue().map((e=>e.peerId)).filter(Boolean)),r=await this.peerStore.all({filters:[t=>0===t.addresses.length?(this.log.trace("not autodialing %p because they have no addresses",t.id),!1):e.has(t.id)?(this.log.trace("not autodialing %p because they are already connected",t.id),!1):n.has(t.id)?(this.log.trace("not autodialing %p because they are already being dialed",t.id),!1):!this.queue.has(t.id)||(this.log.trace("not autodialing %p because they are already being autodialed",t.id),!1)]}),i=r.sort((()=>Math.random()>.5?1:-1)),o=new qh;for(const a of i)o.has(a.id)||o.set(a.id,[...a.tags.values()].reduce(((e,t)=>e+t.value),0));const s=i.sort(((e,t)=>{var n,r;const i=null!==(n=o.get(e.id))&&void 0!==n?n:0,s=null!==(r=o.get(t.id))&&void 0!==r?r:0;return i>s?-1:i<s?1:0})).filter((e=>{const t=e.metadata.get(qp);if(null==t)return!0;const n=parseInt(vr(t));return!!isNaN(n)||Date.now()-n>this.autoDialPeerRetryThresholdMs}));this.log("selected %d/%d peers to dial",s.length,r.length);for(const a of s)this.queue.add((async()=>{const e=this.connectionManager.getConnectionsMap().size;if(e>=this.minConnections)return this.log("got enough connections now %d/%d",e,this.minConnections),void this.queue.clear();this.log("connecting to a peerStore stored peer %p",a.id),await this.connectionManager.openConnection(a.id,{priority:this.autoDialPriority})}),{peerId:a.id}).catch((e=>{this.log.error("could not connect to peerStore stored peer",e)}));this.running=!1,this.sheduleNextAutodial()}sheduleNextAutodial(){this.started&&(this.autoDialInterval=setTimeout((()=>{this.autoDial().catch((e=>{this.log.error("error while autodialing",e)}))}),this.autoDialIntervalMs))}}const Yp={maxConnections:100,allow:[]};class Qp{constructor(e){var t,n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};je(this,"maxConnections",void 0),je(this,"connectionManager",void 0),je(this,"peerStore",void 0),je(this,"allow",void 0),je(this,"events",void 0),je(this,"log",void 0),this.maxConnections=null!==(t=r.maxConnections)&&void 0!==t?t:Yp.maxConnections,this.allow=null!==(n=r.allow)&&void 0!==n?n:Yp.allow,this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager:connection-pruner"),e.events.addEventListener("connection:open",(()=>{this.maybePruneConnections().catch((e=>{this.log.error(e)}))}))}async maybePruneConnections(){const e=this.connectionManager.getConnections(),t=e.length,n=Math.max(t-this.maxConnections,0);if(this.log("checking max connections limit %d/%d",t,this.maxConnections),t<=this.maxConnections)return;this.log("max connections limit exceeded %d/%d, pruning %d connection(s)",t,this.maxConnections,n);const r=new qh;for(const a of e){const e=a.remotePeer;if(!r.has(e)){r.set(e,0);try{const t=await this.peerStore.get(e);r.set(e,[...t.tags.values()].reduce(((e,t)=>e+t.value),0))}catch(s){"ERR_NOT_FOUND"!==s.code&&this.log.error("error loading peer tags",s)}}}const i=e.sort(((e,t)=>{var n,i;const o=null!==(n=r.get(e.remotePeer))&&void 0!==n?n:0,s=null!==(i=r.get(t.remotePeer))&&void 0!==i?i:0;if(o>s)return 1;if(o<s)return-1;const a=e.timeline.open,l=t.timeline.open;return a<l?1:a>l?-1:0})),o=[];for(const a of i){this.log("too many connections open - closing a connection to %p",a.remotePeer);if(this.allow.some((e=>a.remoteAddr.toString().startsWith(e.toString())))||o.push(a),o.length===n)break}await Promise.all(o.map((async e=>{try{await e.close()}catch(s){this.log.error(s)}}))),this.events.safeDispatchEvent("connection:prune",{detail:o})}}function Xp(e){const t=new globalThis.AbortController;function n(){t.abort();for(const t of e)null!=(null===t||void 0===t?void 0:t.removeEventListener)&&t.removeEventListener("abort",n)}for(const i of e){if(!0===(null===i||void 0===i?void 0:i.aborted)){n();break}null!=(null===i||void 0===i?void 0:i.addEventListener)&&i.addEventListener("abort",n)}const r=t.signal;return r.clear=function(){for(const t of e)null!=(null===t||void 0===t?void 0:t.removeEventListener)&&t.removeEventListener("abort",n)},r}const Jp={addressSorter:dp,maxParallelDials:50,maxDialQueueLength:500,maxPeerAddrsToDial:25,dialTimeout:5e3,resolvers:{dnsaddr:Ap}};class $p{constructor(e){var t,n,r,i,o,s;let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};je(this,"queue",void 0),je(this,"components",void 0),je(this,"addressSorter",void 0),je(this,"maxPeerAddrsToDial",void 0),je(this,"maxDialQueueLength",void 0),je(this,"dialTimeout",void 0),je(this,"shutDownController",void 0),je(this,"connections",void 0),je(this,"log",void 0),this.addressSorter=null!==(t=a.addressSorter)&&void 0!==t?t:Jp.addressSorter,this.maxPeerAddrsToDial=null!==(n=a.maxPeerAddrsToDial)&&void 0!==n?n:Jp.maxPeerAddrsToDial,this.maxDialQueueLength=null!==(r=a.maxDialQueueLength)&&void 0!==r?r:Jp.maxDialQueueLength,this.dialTimeout=null!==(i=a.dialTimeout)&&void 0!==i?i:Jp.dialTimeout,this.connections=null!==(o=a.connections)&&void 0!==o?o:new qh,this.log=e.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=e,this.shutDownController=new AbortController,vu(1/0,this.shutDownController.signal);for(const[c,u]of Object.entries(null!==(l=a.resolvers)&&void 0!==l?l:{})){var l;Uh.set(c,u)}this.queue=new jp({concurrency:null!==(s=a.maxParallelDials)&&void 0!==s?s:Jp.maxParallelDials,metricName:"libp2p_dial_queue",metrics:e.metrics}),this.queue.addEventListener("error",(e=>{this.log.error("error in dial queue",e.detail)}))}start(){this.shutDownController=new AbortController,vu(1/0,this.shutDownController.signal)}stop(){this.shutDownController.abort(),this.queue.abort()}async dial(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{peerId:n,multiaddrs:r}=Op(e),i=Array.from(this.connections.values()).flat().find((e=>!0!==t.force&&(!!e.remotePeer.equals(n)||r.find((t=>t.equals(e.remoteAddr))))));if(null!=i)return this.log("already connected to %a",i.remoteAddr),i;const o=this.queue.queue.find((e=>{if(!0===(null===n||void 0===n?void 0:n.equals(e.options.peerId)))return!0;const t=e.options.multiaddrs;if(null==t)return!1;for(const n of r)if(t.has(n.toString()))return!0;return!1}));if(null!=o){this.log("joining existing dial target for %p",n);for(const e of r)o.options.multiaddrs.add(e.toString());return o.join(t)}if(this.queue.size>=this.maxDialQueueLength)throw new Mr("Dial queue is full","ERR_DIAL_QUEUE_FULL");return this.log("creating dial target for %p",n,r.map((e=>e.toString()))),this.queue.add((async e=>{const t=this.createDialAbortController(null===e||void 0===e?void 0:e.signal);let r;try{r=await this.calculateMultiaddrs(n,null===e||void 0===e?void 0:e.multiaddrs,{...e,signal:t}),r.map((e=>{let{multiaddr:t}=e;return t.toString()})).forEach((t=>{null===e||void 0===e||e.multiaddrs.add(t)}))}catch(i){throw t.clear(),i}try{let o=0;const s=[];for(const a of r){if(o===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",o,n),new Mr("Peer had more than maxPeerAddrsToDial",Rp.ERR_TOO_MANY_ADDRESSES);o++;try{const n=await this.components.transportManager.dial(a.multiaddr,{...e,signal:t});return this.log("dial to %a succeeded",a.multiaddr),n}catch(i){if(this.log.error("dial failed to %a",a.multiaddr,i),null!=n)try{await this.components.peerStore.patch(n,{metadata:{[qp]:yr(Date.now().toString())}})}catch(i){this.log.error("could not update last dial failure key for %p",n,i)}if(t.aborted)throw new Mr(i.message,Kr);s.push(i)}}if(1===s.length)throw s[0];throw new Ur(s,"All multiaddr dials failed",Rp.ERR_TRANSPORT_DIAL_FAILED)}finally{t.clear()}}),{peerId:n,priority:t.priority,multiaddrs:new Set(r.map((e=>e.toString()))),signal:t.signal})}createDialAbortController(e){const t=Xp([AbortSignal.timeout(this.dialTimeout),this.shutDownController.signal,e]);return vu(1/0,t),t}async calculateMultiaddrs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=[...t].map((e=>({multiaddr:Vh(e),isCertified:!1})));if(null!=e){var i,o;if(this.components.peerId.equals(e))throw new Mr("Tried to dial self",Rp.ERR_DIALED_SELF);if(!0===await(null===(i=(o=this.components.connectionGater).denyDialPeer)||void 0===i?void 0:i.call(o,e)))throw new Mr("The dial request is blocked by gater.allowDialPeer",Rp.ERR_PEER_DIAL_INTERCEPTED);if(0===r.length){this.log("loading multiaddrs for %p",e);try{const t=await this.components.peerStore.get(e);r.push(...t.addresses),this.log("loaded multiaddrs for %p",e,r.map((e=>{let{multiaddr:t}=e;return t.toString()})))}catch(d){if(d.code!==Rp.ERR_NOT_FOUND)throw d}}if(0===r.length){this.log("looking up multiaddrs for %p in the peer routing",e);try{const t=await this.components.peerRouting.findPeer(e);this.log("found multiaddrs for %p in the peer routing",e,r.map((e=>{let{multiaddr:t}=e;return t.toString()}))),r.push(...t.multiaddrs.map((e=>({multiaddr:e,isCertified:!1}))))}catch(d){d.code!==Rp.ERR_NO_ROUTERS_AVAILABLE&&this.log.error("looking up multiaddrs for %p in the peer routing failed",e,d)}}}let s=(await Promise.all(r.map((async e=>{const t=await async function(e,t){let n=!1;for(const i of Uh.keys())if(n=e.protoNames().includes(i),n)break;if(!n)return[e];const r=await e.resolve(t);return t.log("resolved %s to",e,r.map((e=>e.toString()))),r}(e.multiaddr,{dns:this.components.dns,...n,log:this.log});return 1===t.length&&t[0].equals(e.multiaddr)?e:t.map((e=>({multiaddr:e,isCertified:!1})))})))).flat();if(null!=e){const t="/p2p/".concat(e.toString());s=s.map((e=>{const n=e.multiaddr.protos().pop();return!0===(null===n||void 0===n?void 0:n.path)?e:null==e.multiaddr.getPeerId()?{multiaddr:e.multiaddr.encapsulate(t),isCertified:e.isCertified}:e}))}const a=s.filter((t=>{if(null==this.components.transportManager.transportForMultiaddr(t.multiaddr))return!1;const n=t.multiaddr.getPeerId();return null==e||null==n||e.equals(n)})),l=new Map;for(const f of a){const e=f.multiaddr.toString(),t=l.get(e);null==t?l.set(e,f):t.isCertified=t.isCertified||f.isCertified||!1}const c=[...l.values()];if(0===c.length)throw new Mr("The dial request has no valid addresses",Rp.ERR_NO_VALID_ADDRESSES);const u=[];for(const f of c)null!=this.components.connectionGater.denyDialMultiaddr&&await this.components.connectionGater.denyDialMultiaddr(f.multiaddr)||u.push(f);const h=u.sort(this.addressSorter);if(0===h.length)throw new Mr("The connection gater denied all addresses in the dial request",Rp.ERR_NO_VALID_ADDRESSES);return this.log.trace("addresses for %p before filtering",null!==e&&void 0!==e?e:"unknown peer",s.map((e=>{let{multiaddr:t}=e;return t.toString()}))),this.log.trace("addresses for %p after filtering",null!==e&&void 0!==e?e:"unknown peer",h.map((e=>{let{multiaddr:t}=e;return t.toString()}))),h}async isDialable(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Array.isArray(e)||(e=[e]);try{const n=await this.calculateMultiaddrs(void 0,new Set(e.map((e=>e.toString()))),t);return!1!==t.runOnTransientConnection||null!=n.find((e=>!cp.matches(e.multiaddr)))}catch(n){this.log.trace("error calculating if multiaddr(s) were dialable",n)}return!1}}const Zp=5,eg=100,tg=5,ng=10,rg=25,ig=0,og=100;class sg{constructor(e){var t,n,r,i,o,s,a,l,c,u,h,d,f,p,g;let y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};je(this,"started",void 0),je(this,"connections",void 0),je(this,"allow",void 0),je(this,"deny",void 0),je(this,"maxIncomingPendingConnections",void 0),je(this,"incomingPendingConnections",void 0),je(this,"maxConnections",void 0),je(this,"dialQueue",void 0),je(this,"autoDial",void 0),je(this,"connectionPruner",void 0),je(this,"inboundConnectionRateLimiter",void 0),je(this,"peerStore",void 0),je(this,"metrics",void 0),je(this,"events",void 0),je(this,"log",void 0),this.maxConnections=null!==(t=y.maxConnections)&&void 0!==t?t:eg;const v=null!==(n=y.minConnections)&&void 0!==n?n:Zp;if(this.maxConnections<v)throw new Mr("Connection Manager maxConnections must be greater than minConnections",Rp.ERR_INVALID_PARAMETERS);this.connections=new qh,this.started=!1,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),this.allow=(null!==(r=y.allow)&&void 0!==r?r:[]).map((e=>Vh(e))),this.deny=(null!==(i=y.deny)&&void 0!==i?i:[]).map((e=>Vh(e))),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=null!==(o=y.maxIncomingPendingConnections)&&void 0!==o?o:ng,this.inboundConnectionRateLimiter=new Bp({points:null!==(s=y.inboundConnectionThreshold)&&void 0!==s?s:tg,duration:1}),this.autoDial=new Gp({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{minConnections:v,autoDialConcurrency:null!==(a=y.autoDialConcurrency)&&void 0!==a?a:rg,autoDialPriority:null!==(l=y.autoDialPriority)&&void 0!==l?l:ig,maxQueueLength:null!==(c=y.autoDialMaxQueueLength)&&void 0!==c?c:og}),this.connectionPruner=new Qp({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{maxConnections:this.maxConnections,allow:this.allow}),this.dialQueue=new $p(e,{addressSorter:null!==(u=y.addressSorter)&&void 0!==u?u:dp,maxParallelDials:null!==(h=y.maxParallelDials)&&void 0!==h?h:50,maxDialQueueLength:null!==(d=y.maxDialQueueLength)&&void 0!==d?d:500,maxPeerAddrsToDial:null!==(f=y.maxPeerAddrsToDial)&&void 0!==f?f:25,dialTimeout:null!==(p=y.dialTimeout)&&void 0!==p?p:5e3,resolvers:null!==(g=y.resolvers)&&void 0!==g?g:{dnsaddr:Ap},connections:this.connections})}isStarted(){return this.started}async start(){var e,t,n;null===(e=this.metrics)||void 0===e||e.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const e={inbound:0,outbound:0};for(const t of this.connections.values())for(const n of t)"inbound"===n.direction?e.inbound++:e.outbound++;return e}}),null===(t=this.metrics)||void 0===t||t.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const e={};for(const r of this.connections.values())for(const i of r)for(const r of i.streams){var t,n;const i="".concat(r.direction," ").concat(null!==(t=r.protocol)&&void 0!==t?t:"unnegotiated");e[i]=(null!==(n=e[i])&&void 0!==n?n:0)+1}return e}}),null===(n=this.metrics)||void 0===n||n.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const e={};for(const o of this.connections.values())for(const i of o){const o={};for(const e of i.streams){var t,n;const r="".concat(e.direction," ").concat(null!==(t=e.protocol)&&void 0!==t?t:"unnegotiated");o[r]=(null!==(n=o[r])&&void 0!==n?n:0)+1}for(const[t,n]of Object.entries(o)){var r;e[t]=null!==(r=e[t])&&void 0!==r?r:[],e[t].push(n)}}const i={};for(let[o,s]of Object.entries(e)){s=s.sort(((e,t)=>e-t));const e=Math.floor(.9*s.length);i[o]=s[e]}return i}}),this.dialQueue.start(),this.autoDial.start(),this.started=!0,this.log("started")}async afterStart(){Promise.resolve().then((async()=>{const e=await this.peerStore.all({filters:[e=>e.tags.has("keep-alive")]});await Promise.all(e.map((async e=>{await this.openConnection(e.id).catch((e=>{this.log.error(e)}))})))})).catch((e=>{this.log.error(e)})),this.autoDial.afterStart()}async stop(){this.dialQueue.stop(),this.autoDial.stop();const e=[];for(const t of this.connections.values())for(const n of t)e.push((async()=>{try{await n.close()}catch(e){this.log.error(e)}})());this.log("closing %d connections",e.length),await Promise.all(e),this.connections.clear(),this.log("stopped")}onConnect(e){this._onConnect(e).catch((e=>{this.log.error(e)}))}async _onConnect(e){const{detail:t}=e;if(!this.started)return void await t.close();const n=t.remotePeer,r=this.connections.get(n);let i=!1;null!=r?r.push(t):(i=!0,this.connections.set(n,[t])),null!=n.publicKey&&"RSA"===n.type&&await this.peerStore.patch(n,{publicKey:n.publicKey}),i&&this.events.safeDispatchEvent("peer:connect",{detail:t.remotePeer})}onDisconnect(e){const{detail:t}=e;if(!this.started)return;const n=t.remotePeer;let r=this.connections.get(n);null!=r&&r.length>1?(r=r.filter((e=>e.id!==t.id)),this.connections.set(n,r)):null!=r&&(this.connections.delete(n),this.events.safeDispatchEvent("peer:disconnect",{detail:t.remotePeer}))}getConnections(e){var t;if(null!=e)return null!==(t=this.connections.get(e))&&void 0!==t?t:[];let n=[];for(const r of this.connections.values())n=n.concat(r);return n}getConnectionsMap(){return this.connections}async openConnection(e){var t,n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isStarted())throw new Mr("Not started",Rp.ERR_NODE_NOT_STARTED);null===(t=r.signal)||void 0===t||t.throwIfAborted();const{peerId:i}=Op(e);if(null!=i&&!0!==r.force){this.log("dial %p",i);const e=this.getConnections(i).find((e=>!e.transient));if(null!=e)return this.log("had an existing non-transient connection to %p",i),e}const o=await this.dialQueue.dial(e,{...r,priority:null!==(n=r.priority)&&void 0!==n?n:50});let s=this.connections.get(o.remotePeer);null==s&&(s=[],this.connections.set(o.remotePeer,s));let a=!1;for(const l of s)l.id===o.id&&(a=!0);return a||s.push(o),o}async closeConnections(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=null!==(t=this.connections.get(e))&&void 0!==t?t:[];await Promise.all(r.map((async e=>{try{await e.close(n)}catch(t){e.abort(t)}})))}async acceptIncomingConnection(e){if(this.deny.some((t=>e.remoteAddr.toString().startsWith(t.toString()))))return this.log("connection from %a refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some((t=>e.remoteAddr.toString().startsWith(t.toString()))))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){const t=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(t,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",e.remoteAddr,t),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){const e={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map((t=>({id:t.id,status:e[t.status],peerId:t.options.peerId,multiaddrs:[...t.options.multiaddrs].map((e=>Vh(e)))})))}async isDialable(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.dialQueue.isDialable(e,t)}}class ag{constructor(e,t){var n;je(this,"routers",void 0),je(this,"started",void 0),je(this,"components",void 0),this.routers=null!==(n=t.routers)&&void 0!==n?n:[],this.started=!1,this.components=e}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}findProviders(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){if(0===t.routers.length)throw new Mr("No content routers available",Rp.ERR_NO_ROUTERS_AVAILABLE);const r=t,i=new zu;for await(const o of kn(...r.routers.map((t=>t.findProviders(e,n)))))null!=o&&(o.multiaddrs.length>0&&await t.components.peerStore.merge(o.id,{multiaddrs:o.multiaddrs}),i.has(o.id)||(i.add(o.id),yield o))}()}catch(n){return Promise.reject(n)}}async provide(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0===this.routers.length)throw new Mr("No content routers available",Rp.ERR_NO_ROUTERS_AVAILABLE);await Promise.all(this.routers.map((async n=>{await n.provide(e,t)})))}async put(e,t,n){if(!this.isStarted())throw new Mr(Tp.NOT_STARTED_YET,Rp.ERR_NODE_NOT_STARTED);await Promise.all(this.routers.map((async r=>{await r.put(e,t,n)})))}async get(e,t){if(!this.isStarted())throw new Mr(Tp.NOT_STARTED_YET,Rp.ERR_NODE_NOT_STARTED);return Promise.any(this.routers.map((async n=>n.get(e,t))))}}var lg;const cg=null!==(lg=globalThis.CustomEvent)&&void 0!==lg?lg:Event;function ug(e){try{let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(n){let r=null!==(n=t.concurrency)&&void 0!==n?n:1/0;r<1&&(r=1/0);const i=null!=t.ordered&&t.ordered,o=new EventTarget,s=[];let a,l=mn(),c=mn(),u=!1,h=!1;function d(){var e;return i?null===(e=s[0])||void 0===e?void 0:e.done:Boolean(s.find((e=>e.done)))}function*f(){for(;s.length>0&&s[0].done;){const e=s[0];if(s.shift(),!e.ok)throw h=!0,l.resolve(),e.err;yield e.value,l.resolve()}}function*p(){for(;d();)for(let e=0;e<s.length;e++)if(s[e].done){const t=s[e];if(s.splice(e,1),e--,!t.ok)throw h=!0,l.resolve(),t.err;yield t.value,l.resolve()}}for(o.addEventListener("task-complete",(()=>{c.resolve()})),Promise.resolve().then((async()=>{try{for await(const t of e){if(s.length===r&&(l=mn(),await l.promise),h)break;const e={done:!1};s.push(e),t().then((t=>{e.done=!0,e.ok=!0,e.value=t,o.dispatchEvent(new cg("task-complete"))}),(t=>{e.done=!0,e.err=t,o.dispatchEvent(new cg("task-complete"))}))}u=!0,o.dispatchEvent(new cg("task-complete"))}catch(t){a=t,o.dispatchEvent(new cg("task-complete"))}}));;){if(d()||(c=mn(),await c.promise),null!=a)throw a;if(i?yield*f():yield*p(),u&&0===s.length)break}}()}catch(t){return Promise.reject(t)}}class hg{constructor(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};je(this,"log",void 0),je(this,"peerId",void 0),je(this,"peerStore",void 0),je(this,"routers",void 0),this.log=e.logger.forComponent("libp2p:peer-routing"),this.peerId=e.peerId,this.peerStore=e.peerStore,this.routers=null!==(t=n.routers)&&void 0!==t?t:[]}async findPeer(e,t){if(0===this.routers.length)throw new Mr("No peer routers available",Rp.ERR_NO_ROUTERS_AVAILABLE);if(e.toString()===this.peerId.toString())throw new Mr("Should not try to find self",Rp.ERR_FIND_SELF);const n=this,r=kn(...this.routers.map((r=>async function*(){try{yield await r.findPeer(e,t)}catch(i){n.log.error(i)}}())));for await(const i of r)if(null!=i)return i.multiaddrs.length>0&&await this.peerStore.merge(i.id,{multiaddrs:i.multiaddrs}),i;throw new Mr(Tp.NOT_FOUND,Rp.ERR_NOT_FOUND)}getClosestPeers(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){if(0===t.routers.length)throw new Mr("No peer routers available",Rp.ERR_NO_ROUTERS_AVAILABLE);const r=t,i=new zu;for await(const o of ug(async function*(){const t=kn(...r.routers.map((t=>t.getClosestPeers(e,n))));for await(let e of t)yield async()=>{if(0===e.multiaddrs.length)try{e=await r.findPeer(e.id,{...n,useCache:!1})}catch(t){return void r.log.error("could not find peer multiaddrs",t)}return e}}()))null!=o&&(o.multiaddrs.length>0&&await t.peerStore.merge(o.id,{multiaddrs:o.multiaddrs}),i.has(o.id)||(i.add(o.id),yield o))}()}catch(n){return Promise.reject(n)}}}class dg{constructor(e){je(this,"log",void 0),je(this,"topologies",void 0),je(this,"handlers",void 0),je(this,"components",void 0),this.log=e.logger.forComponent("libp2p:registrar"),this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){const t=this.handlers.get(e);if(null==t)throw new Mr("No handler registered for protocol ".concat(e),Rp.ERR_NO_HANDLER_FOR_PROTOCOL);return t}getTopologies(e){const t=this.topologies.get(e);return null==t?[]:[...t.values()]}async handle(e,t,n){if(this.handlers.has(e))throw new Mr("Handler already registered for protocol ".concat(e),Rp.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED);const r=Ip.bind({ignoreUndefined:!0})({maxInboundStreams:32,maxOutboundStreams:64},n);this.handlers.set(e,{handler:t,options:r}),await this.components.peerStore.merge(this.components.peerId,{protocols:[e]})}async unhandle(e){(Array.isArray(e)?e:[e]).forEach((e=>{this.handlers.delete(e)})),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()})}async register(e,t){if(null==t)throw new Mr("invalid topology",Rp.ERR_INVALID_PARAMETERS);const n="".concat((1e9*Math.random()).toString(36)).concat(Date.now());let r=this.topologies.get(e);return null==r&&(r=new Map,this.topologies.set(e,r)),r.set(n,t),n}unregister(e){for(const[t,n]of this.topologies.entries())n.has(e)&&(n.delete(e),0===n.size&&this.topologies.delete(t))}_onDisconnect(e){const t=e.detail;this.components.peerStore.get(t).then((e=>{for(const r of e.protocols){const e=this.topologies.get(r);if(null!=e)for(const r of e.values()){var n;null===(n=r.onDisconnect)||void 0===n||n.call(r,t)}}})).catch((e=>{e.code!==Rp.ERR_NOT_FOUND&&this.log.error("could not inform topologies of disconnecting peer %p",t,e)}))}_onPeerUpdate(e){var t;const{peer:n,previous:r}=e.detail,i=(null!==(t=null===r||void 0===r?void 0:r.protocols)&&void 0!==t?t:[]).filter((e=>!n.protocols.includes(e)));for(const s of i){const e=this.topologies.get(s);if(null!=e)for(const t of e.values()){var o;null===(o=t.onDisconnect)||void 0===o||o.call(t,n.id)}}}_onPeerIdentify(e){const t=e.detail.protocols,n=e.detail.connection,r=e.detail.peerId;for(const o of t){const e=this.topologies.get(o);if(null!=e)for(const t of e.values()){var i;n.transient&&!0!==t.notifyOnTransient||(null===(i=t.onConnect)||void 0===i||i.call(t,r,n))}}}}class fg extends Map{constructor(e){super(),je(this,"metric",void 0);const{name:t,metrics:n}=e;this.metric=n.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){const t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function pg(e){const{name:t,metrics:n}=e;let r;return r=null!=n?new fg({name:t,metrics:n}):new Map,r}class gg{constructor(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};je(this,"log",void 0),je(this,"components",void 0),je(this,"transports",void 0),je(this,"listeners",void 0),je(this,"faultTolerance",void 0),je(this,"started",void 0),this.log=e.logger.forComponent("libp2p:transports"),this.components=e,this.started=!1,this.transports=new Map,this.listeners=pg({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=null!==(t=n.faultTolerance)&&void 0!==t?t:Tf.FATAL_ALL}add(e){const t=e[Symbol.toStringTag];if(null==t)throw new Mr("Transport must have a valid tag",Rp.ERR_INVALID_KEY);if(this.transports.has(t))throw new Mr("There is already a transport with the tag ".concat(t),Rp.ERR_DUPLICATE_TRANSPORT);this.log("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){const e=this.components.addressManager.getListenAddrs();await this.listen(e)}async stop(){const e=[];for(const[t,n]of this.listeners)for(this.log("closing listeners for %s",t);n.length>0;){const t=n.pop();null!=t&&e.push(t.close())}await Promise.all(e),this.log("all listeners closed");for(const t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1}async dial(e,t){const n=this.transportForMultiaddr(e);if(null==n)throw new Mr("No transport available for address ".concat(String(e)),Rp.ERR_TRANSPORT_UNAVAILABLE);try{return await n.dial(e,{...t,upgrader:this.components.upgrader})}catch(r){throw null==r.code&&(r.code=Rp.ERR_TRANSPORT_DIAL_FAILED),r}}getAddrs(){let e=[];for(const t of this.listeners.values())for(const n of t)e=[...e,...n.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}transportForMultiaddr(e){for(const t of this.transports.values()){if(t.filter([e]).length>0)return t}}async listen(e){if(!this.isStarted())throw new Mr("Not started",Rp.ERR_NODE_NOT_STARTED);if(null==e||0===e.length)return void this.log("no addresses were provided for listening, this node is dial only");const t=[];for(const[r,i]of this.transports.entries()){const o=i.filter(e),s=[];for(const e of o){var n;this.log("creating listener for %s on %a",r,e);const t=i.createListener({upgrader:this.components.upgrader});let o=null!==(n=this.listeners.get(r))&&void 0!==n?n:[];null==o&&(o=[],this.listeners.set(r,o)),o.push(t),t.addEventListener("listening",(()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:t})})),t.addEventListener("close",(()=>{const e=o.findIndex((e=>e===t));o.splice(e,1),this.components.events.safeDispatchEvent("transport:close",{detail:t})})),s.push(t.listen(e))}if(0===s.length){t.push(r);continue}if(null==(await Promise.allSettled(s)).find((e=>"fulfilled"===e.status))&&this.faultTolerance!==Tf.NO_FATAL)throw new Mr("Transport (".concat(r,") could not listen on any available address"),Rp.ERR_NO_VALID_ADDRESSES)}if(t.length===this.transports.size){const e="no valid addresses were provided for transports [".concat(t.join(", "),"]");if(this.faultTolerance===Tf.FATAL_ALL)throw new Mr(e,Rp.ERR_NO_VALID_ADDRESSES);this.log("libp2p in dial mode only: ".concat(e))}}async remove(e){var t;const n=null!==(t=this.listeners.get(e))&&void 0!==t?t:[];this.log.trace("removing transport %s",e);const r=[];for(this.log.trace("closing listeners for %s",e);n.length>0;){const e=n.pop();null!=e&&r.push(e.close())}await Promise.all(r),this.transports.delete(e),this.listeners.delete(e)}async removeAll(){const e=[];for(const t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}function yg(e){return null!=e[Symbol.asyncIterator]}const vg=e=>{const t=ss(e),n=hr(t);return cs(e,n),vg.bytes=t,n};function mg(e,t){var n,r;const i=null!==(r=(t=null!==(n=t)&&void 0!==n?n:{}).lengthEncoder)&&void 0!==r?r:vg;function*o(e){const t=i(e.byteLength);t instanceof Uint8Array?yield t:yield*t,e instanceof Uint8Array?yield e:yield*e}return yg(e)?async function*(){for await(const t of e)yield*o(t)}():function*(){for(const t of e)yield*o(t)}()}vg.bytes=0,mg.single=(e,t)=>{var n,r;const i=null!==(r=(t=null!==(n=t)&&void 0!==n?n:{}).lengthEncoder)&&void 0!==r?r:vg;return new Gu(i(e.byteLength),e)};var wg;!function(e){e[e.LENGTH=0]="LENGTH",e[e.DATA=1]="DATA"}(wg||(wg={}));const bg=e=>{const t=us(e);return bg.bytes=ss(t),t};function Eg(e,t){var n,r,i;const o=new Gu;let s=wg.LENGTH,a=-1;const l=null!==(n=null===t||void 0===t?void 0:t.lengthDecoder)&&void 0!==n?n:bg,c=null!==(r=null===t||void 0===t?void 0:t.maxLengthLength)&&void 0!==r?r:8,u=null!==(i=null===t||void 0===t?void 0:t.maxDataLength)&&void 0!==i?i:4194304;function*h(){for(;o.byteLength>0;){if(s===wg.LENGTH)try{if(a=l(o),a<0)throw qe(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(a>u)throw qe(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");const e=l.bytes;o.consume(e),null!=(null===t||void 0===t?void 0:t.onLength)&&t.onLength(a),s=wg.DATA}catch(e){if(e instanceof RangeError){if(o.byteLength>c)throw qe(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw e}if(s===wg.DATA){if(o.byteLength<a)break;const e=o.sublist(0,a);o.consume(a),null!=(null===t||void 0===t?void 0:t.onData)&&t.onData(e),yield e,s=wg.LENGTH}}}return yg(e)?async function*(){for await(const t of e)o.append(t),yield*h();if(o.byteLength>0)throw qe(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}():function*(){for(const t of e)o.append(t),yield*h();if(o.byteLength>0)throw qe(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")}()}bg.bytes=0,Eg.fromReader=(e,t)=>{let n=1;return Eg(async function*(){for(;;)try{const{done:t,value:r}=await e.next(n);if(!0===t)return;null!=r&&(yield r)}catch(t){if("ERR_UNDER_READ"===t.code)return{done:!0,value:null};throw t}finally{n=1}}(),{...null!==t&&void 0!==t?t:{},onLength:e=>{n=e}})};class _g{constructor(){je(this,"readNext",void 0),je(this,"haveNext",void 0),je(this,"ended",void 0),je(this,"nextResult",void 0),this.ended=!1,this.readNext=mn(),this.haveNext=mn()}[Symbol.asyncIterator](){return this}async next(){if(null==this.nextResult&&await this.haveNext.promise,null==this.nextResult)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=mn(),e}async throw(e){this.ended=!0,null!=e&&this.haveNext.reject(e);return{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return await this._push(void 0),e}async push(e,t){await this._push(e,t)}async end(e,t){null!=e?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(null!=e&&this.ended)throw new Error("Cannot push value onto an ended pushable");if(null!=this.nextResult&&(await this.readNext.promise,null!=this.nextResult))throw new Error("NeedNext promise resolved but nextResult was not consumed");null!=e?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=mn(),await Vp(this.readNext.promise,null===t||void 0===t?void 0:t.signal,t)}}class Sg extends Error{constructor(e,t){super(e),je(this,"code",void 0),this.code=t}}class kg extends Sg{constructor(e){super(e,"ABORT_ERR"),je(this,"type",void 0),this.type="aborted"}}function Ag(e,t){const n=new _g;e.sink(n).catch((async e=>{await n.end(e)})),e.sink=async e=>{for await(const t of e)await n.push(t);await n.end()};let r=e.source;null!=e.source[Symbol.iterator]?r=e.source[Symbol.iterator]():null!=e.source[Symbol.asyncIterator]&&(r=e.source[Symbol.asyncIterator]());const i=new Gu,o={read:async(e,t)=>{var n;let o;null===t||void 0===t||null===(n=t.signal)||void 0===n||n.throwIfAborted();const s=new Promise(((e,n)=>{var r;o=()=>{n(new kg("Read aborted"))},null===t||void 0===t||null===(r=t.signal)||void 0===r||r.addEventListener("abort",o)}));try{if(null==e){const{done:e,value:t}=await Promise.race([r.next(),s]);return!0===e?new Gu:t}for(;i.byteLength<e;){const{value:e,done:t}=await Promise.race([r.next(),s]);if(!0===t)throw new Sg("unexpected end of input","ERR_UNEXPECTED_EOF");i.append(e)}const t=i.sublist(0,e);return i.consume(e),t}finally{var a;if(null!=o)null===t||void 0===t||null===(a=t.signal)||void 0===a||a.removeEventListener("abort",o)}},write:async(e,t)=>{var r;null===t||void 0===t||null===(r=t.signal)||void 0===r||r.throwIfAborted(),e instanceof Uint8Array?await n.push(e,t):await n.push(e.subarray(),t)},unwrap:()=>{if(i.byteLength>0){const n=e.source;e.source=async function*(){!1===(null===t||void 0===t?void 0:t.yieldBytes)?yield i:yield*i,yield*n}()}return e}};return o}class Ig extends Error{constructor(e,t){super(e),je(this,"code",void 0),this.code=t}}function Tg(e){var t,n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=Ag(e,r);null!=r.maxDataLength&&null==r.maxLengthLength&&(r.maxLengthLength=ss(r.maxDataLength));const o=null!==(t=null===r||void 0===r?void 0:r.lengthDecoder)&&void 0!==t?t:us,s=null!==(n=null===r||void 0===r?void 0:r.lengthEncoder)&&void 0!==n?n:cs,a={read:async e=>{let t=-1;const n=new Gu;for(;;){n.append(await i.read(1,e));try{t=o(n)}catch(s){if(s instanceof RangeError)continue;throw s}if(null!=(null===r||void 0===r?void 0:r.maxLengthLength)&&n.byteLength>r.maxLengthLength)throw new Ig("message length length too long","ERR_MSG_LENGTH_TOO_LONG");if(t>-1)break}if(null!=(null===r||void 0===r?void 0:r.maxDataLength)&&t>r.maxDataLength)throw new Ig("message length too long","ERR_MSG_DATA_TOO_LONG");return i.read(t,e)},write:async(e,t)=>{await i.write(new Gu(s(e.byteLength),e),t)},writeV:async(e,t)=>{const n=new Gu(...e.flatMap((e=>[s(e.byteLength),e])));await i.write(n,t)},unwrap:()=>i.unwrap()};return a}const Rg="/multistream/1.0.0",Cg=1024,xg=yr("\n");async function Pg(e,t,n){await e.write(t,n)}async function Dg(e,t){const n=await async function(e,t){const n=await e.read(t);if(0===n.byteLength||n.get(n.byteLength-1)!==xg[0])throw t.log.error("Invalid mss message - missing newline",n),new Mr("missing newline","ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return n.sublist(0,-1)}(e,t);return vr(n.subarray())}async function Ng(e,t,n){t=Array.isArray(t)?t:[t],n.log.trace("handle: available protocols %s",t);const r=Tg(e,{...n,maxDataLength:Cg,maxLengthLength:2});for(;;){n.log.trace("handle: reading incoming string");const e=await Dg(r,n);if(n.log.trace('handle: read "%s"',e),e!==Rg){if(t.includes(e))return n.log.trace('handle: respond with "%s" for "%s"',e,e),await Pg(r,yr("".concat(e,"\n")),n),n.log.trace('handle: responded with "%s" for "%s"',e,e),{stream:r.unwrap(),protocol:e};if("ls"!==e)n.log('handle: respond with "na" for "%s"',e),await Pg(r,yr("na\n"),n),n.log('handle: responded with "na" for "%s"',e);else{const i=new Gu(...t.map((e=>mg.single(yr("".concat(e,"\n"))))),yr("\n"));n.log.trace('handle: respond with "%s" for %s',t,e),await Pg(r,i,n),n.log.trace('handle: responded with "%s" for %s',t,e)}}else n.log.trace('handle: respond with "%s" for "%s"',Rg,e),await Pg(r,yr("".concat(Rg,"\n")),n),n.log.trace('handle: responded with "%s" for "%s"',Rg,e)}}async function Bg(e,t,n){if(1===(t=Array.isArray(t)?[...t]:[t]).length&&!1===n.negotiateFully)return function(e,t,n){const r=e.sink.bind(e),i=e.source;let o=!1,s=!1;const a=mn();let l=!1,c=!1;const u=mn();let h=!1,d=!1;const f=mn(),p=Tg({sink:r,source:i},{...n,maxDataLength:Cg});async function g(){if(s)return n.log.trace("optimistic: already negotiating %s stream",t),void await a.promise;s=!0;try{l||(n.log.trace("optimistic: doing send protocol for %s stream",t),await y()),h||(n.log.trace("optimistic: doing read protocol for %s stream",t),await v())}finally{s=!1,o=!0,a.resolve()}}async function y(){if(c)await u.promise;else{c=!0;try{n.log.trace('optimistic: write ["%s", "%s", data] in source',Rg,t),await p.writeV([yr("".concat(Rg,"\n")),yr("".concat(t,"\n"))]),n.log.trace('optimistic: wrote ["%s", "%s", data] in source',Rg,t)}finally{l=!0,c=!1,u.resolve()}}}async function v(){if(d)await f.promise;else{d=!0;try{n.log.trace("optimistic: reading multistream select header");let e=await Dg(p,n);if(n.log.trace('optimistic: read multistream select header "%s"',e),e===Rg&&(e=await Dg(p,n)),n.log.trace('optimistic: read protocol "%s", expecting "%s"',e,t),e!==t)throw new Mr("protocol selection failed","ERR_UNSUPPORTED_PROTOCOL")}finally{h=!0,d=!1,f.resolve()}}}if(e.sink=async e=>{const{sink:r}=p.unwrap();await r(async function*(){let r=!1;for await(const i of e){if(c&&await u.promise,l)yield i;else{c=!0,n.log.trace('optimistic: write ["%s", "%s", data(%d)] in sink',Rg,t,i.byteLength);const e="".concat(t,"\n");yield new Gu(Uint8Array.from([19]),yr("".concat(Rg,"\n")),cs(e.length),yr(e),i).subarray(),n.log.trace('optimistic: wrote ["%s", "%s", data(%d)] in sink',Rg,t,i.byteLength),l=!0,c=!1,u.resolve(),g().catch((e=>{n.log.error("could not finish optimistic protocol negotiation of %s",t,e)}))}r=!0}r||await g()}())},e.source=async function*(){await g(),n.log.trace('optimistic: reading data from "%s" stream',t),yield*p.unwrap().source}(),null!=e.closeRead){const t=e.closeRead.bind(e);e.closeRead=async e=>{o||await g().catch((e=>{n.log.error("could not negotiate protocol before close read",e)})),await t(e)}}if(null!=e.closeWrite){const t=e.closeWrite.bind(e);e.closeWrite=async e=>{o||await g().catch((e=>{n.log.error("could not negotiate protocol before close write",e)})),await t(e)}}if(null!=e.close){const t=e.close.bind(e);e.close=async e=>{const n=[];c&&n.push(u.promise),d&&n.push(f.promise),n.length>0?await Vp(Promise.all(n),null===e||void 0===e?void 0:e.signal):(o=!0,s=!1,a.resolve()),await t(e)}}return{stream:e,protocol:t}}(e,t[0],n);const r=Tg(e,{...n,maxDataLength:Cg}),i=t.shift();if(null==i)throw new Error("At least one protocol must be specified");n.log.trace('select: write ["%s", "%s"]',Rg,i);const o=yr("".concat(Rg,"\n")),s=yr("".concat(i,"\n"));await async function(e,t,n){await e.writeV(t,n)}(r,[o,s],n),n.log.trace("select: reading multistream-select header");let a=await Dg(r,n);if(n.log.trace('select: read "%s"',a),a===Rg&&(n.log.trace("select: reading protocol response"),a=await Dg(r,n),n.log.trace('select: read "%s"',a)),a===i)return{stream:r.unwrap(),protocol:i};for(const l of t){n.log.trace('select: write "%s"',l),await Pg(r,yr("".concat(l,"\n")),n),n.log.trace("select: reading protocol response");const e=await Dg(r,n);if(n.log.trace('select: read "%s" for "%s"',e,l),e===l)return{stream:r.unwrap(),protocol:l}}throw new Mr("protocol selection failed","ERR_UNSUPPORTED_PROTOCOL")}const Lg=Symbol.for("@libp2p/connection");class Og{constructor(e){var t;je(this,"id",void 0),je(this,"remoteAddr",void 0),je(this,"remotePeer",void 0),je(this,"direction",void 0),je(this,"timeline",void 0),je(this,"multiplexer",void 0),je(this,"encryption",void 0),je(this,"status",void 0),je(this,"transient",void 0),je(this,"log",void 0),je(this,"tags",void 0),je(this,"_newStream",void 0),je(this,"_close",void 0),je(this,"_abort",void 0),je(this,"_getStreams",void 0),je(this,Symbol.toStringTag,"Connection"),je(this,Lg,!0);const{remoteAddr:n,remotePeer:r,newStream:i,close:o,abort:s,getStreams:a}=e;this.id="".concat(parseInt(String(1e9*Math.random())).toString(36)).concat(Date.now()),this.remoteAddr=n,this.remotePeer=r,this.direction=e.direction,this.status="open",this.timeline=e.timeline,this.multiplexer=e.multiplexer,this.encryption=e.encryption,this.transient=null!==(t=e.transient)&&void 0!==t&&t,this.log=e.logger.forComponent("libp2p:connection:".concat(this.direction,":").concat(this.id)),null==this.remoteAddr.getPeerId()&&(this.remoteAddr=this.remoteAddr.encapsulate("/p2p/".concat(this.remotePeer))),this._newStream=i,this._close=o,this._abort=s,this._getStreams=a,this.tags=[]}get streams(){return this._getStreams()}async newStream(e,t){if("closing"===this.status)throw new Mr("the connection is being closed","ERR_CONNECTION_BEING_CLOSED");if("closed"===this.status)throw new Mr("the connection is closed","ERR_CONNECTION_CLOSED");if(Array.isArray(e)||(e=[e]),this.transient&&!0!==(null===t||void 0===t?void 0:t.runOnTransientConnection))throw new Mr("Cannot open protocol stream on transient connection","ERR_TRANSIENT_CONNECTION");const n=await this._newStream(e,t);return n.direction="outbound",n}async close(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("closed"!==this.status&&"closing"!==this.status){if(this.log("closing connection to %a",this.remoteAddr),this.status="closing",null==e.signal){const t=AbortSignal.timeout(500);vu(1/0,t),e={...e,signal:t}}try{this.log.trace("closing all streams"),await Promise.all(this.streams.map((async t=>t.close(e)))),this.log.trace("closing underlying transport"),await this._close(e),this.log.trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(t){this.log.error("error encountered during graceful close of connection to %a",this.remoteAddr,t),this.abort(t)}}}abort(e){this.log.error("aborting connection to %a due to error",this.remoteAddr,e),this.status="closing",this.streams.forEach((t=>{t.abort(e)})),this.log.error("all streams aborted",this.streams.length),this._abort(e),this.timeline.close=Date.now(),this.status="closed"}}function Mg(e,t,n){let r=0;return n.streams.forEach((n=>{n.direction===t&&n.protocol===e&&r++})),r}class Ug{constructor(e,t){var n;je(this,"components",void 0),je(this,"connectionEncryption",void 0),je(this,"muxers",void 0),je(this,"inboundUpgradeTimeout",void 0),je(this,"events",void 0),this.components=e,this.connectionEncryption=new Map,t.connectionEncryption.forEach((e=>{this.connectionEncryption.set(e.protocol,e)})),this.muxers=new Map,t.muxers.forEach((e=>{this.muxers.set(e.protocol,e)})),this.inboundUpgradeTimeout=null!==(n=t.inboundUpgradeTimeout)&&void 0!==n?n:2e3,this.events=e.events}async shouldBlockConnection(e,t,n){const r=this.components.connectionGater[n];if(void 0!==r&&await r(e,t))throw new Mr("The multiaddr connection is blocked by gater.".concat(n),Rp.ERR_CONNECTION_INTERCEPTED)}async upgradeInbound(e,t){if(!await this.components.connectionManager.acceptIncomingConnection(e))throw new Mr("connection denied",Rp.ERR_CONNECTION_DENIED);let n,r,i,o,s;const a=AbortSignal.timeout(this.inboundUpgradeTimeout),l=()=>{e.abort(new Mr("inbound upgrade timeout",Kr))};a.addEventListener("abort",l,{once:!0}),vu(1/0,a);try{var c,u,h;if(!0===await(null===(c=(u=this.components.connectionGater).denyInboundConnection)||void 0===c?void 0:c.call(u,e)))throw new Mr("The multiaddr connection is blocked by gater.acceptConnection",Rp.ERR_CONNECTION_INTERCEPTED);null===(h=this.components.metrics)||void 0===h||h.trackMultiaddrConnection(e),e.log("starting the inbound connection upgrade");let a=e;if(!0!==(null===t||void 0===t?void 0:t.skipProtection)){const t=this.components.connectionProtector;null!=t&&(e.log("protecting the inbound connection"),a=await t.protect(e))}try{if(n=a,!0!==(null===t||void 0===t?void 0:t.skipEncryption)){({conn:n,remotePeer:r,protocol:s}=await this._encryptInbound(a));const e={...a,...n};await this.shouldBlockConnection(r,e,"denyInboundEncryptedConnection")}else{const t=e.remoteAddr.getPeerId();if(null==t)throw new Mr("inbound connection that skipped encryption must have a peer id",Rp.ERR_INVALID_MULTIADDR);const n=Mu(t);s="native",r=n}if(i=n,null!=(null===t||void 0===t?void 0:t.muxerFactory))o=t.muxerFactory;else if(this.muxers.size>0){const e=await this._multiplexInbound({...a,...n},this.muxers);o=e.muxerFactory,i=e.stream}}catch(d){throw e.log.error("failed to upgrade inbound connection",d),d}return await this.shouldBlockConnection(r,e,"denyInboundUpgradedConnection"),e.log("successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:s,direction:"inbound",maConn:e,upgradedConn:i,muxerFactory:o,remotePeer:r,transient:null===t||void 0===t?void 0:t.transient})}finally{a.removeEventListener("abort",l),this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(e,t){var n;const r=e.remoteAddr.getPeerId();let i,o,s,a,l,c;null!=r&&(i=Mu(r),await this.shouldBlockConnection(i,e,"denyOutboundConnection")),null===(n=this.components.metrics)||void 0===n||n.trackMultiaddrConnection(e),e.log("starting the outbound connection upgrade");let u=e;if(!0!==(null===t||void 0===t?void 0:t.skipProtection)){const t=this.components.connectionProtector;null!=t&&(u=await t.protect(e))}try{if(o=u,!0!==(null===t||void 0===t?void 0:t.skipEncryption)){({conn:o,remotePeer:s,protocol:l}=await this._encryptOutbound(u,i));const e={...u,...o};await this.shouldBlockConnection(s,e,"denyOutboundEncryptedConnection")}else{if(null==i)throw new Mr("Encryption was skipped but no peer id was passed",Rp.ERR_INVALID_PEER);l="native",s=i}if(a=o,null!=(null===t||void 0===t?void 0:t.muxerFactory))c=t.muxerFactory;else if(this.muxers.size>0){const e=await this._multiplexOutbound({...u,...o},this.muxers);c=e.muxerFactory,a=e.stream}}catch(h){throw e.log.error("failed to upgrade outbound connection",h),await e.close(h),h}return await this.shouldBlockConnection(s,e,"denyOutboundUpgradedConnection"),e.log("successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:l,direction:"outbound",maConn:e,upgradedConn:a,muxerFactory:c,remotePeer:s,transient:null===t||void 0===t?void 0:t.transient})}_createConnection(e){var t,n,r=this;const{cryptoProtocol:i,direction:o,maConn:s,upgradedConn:a,remotePeer:l,muxerFactory:c,transient:u}=e;let h,d,f;null!=c&&(h=c.createStreamMuxer({direction:o,onIncomingStream:e=>{null!=f&&Promise.resolve().then((async()=>{var t;const n=this.components.registrar.getProtocols(),{stream:r,protocol:i}=await Ng(e,n,{log:e.log,yieldBytes:!1});if(null==f)return;f.log("incoming stream opened on %s",i);const o=function(e,t){try{const{options:n}=t.getHandler(e);return n.maxInboundStreams}catch(n){if(n.code!==Rp.ERR_NO_HANDLER_FOR_PROTOCOL)throw n}return 32}(i,this.components.registrar);if(Mg(i,"inbound",f)===o){const t=new Mr('Too many inbound protocol streams for protocol "'.concat(i,'" - limit ').concat(o),Rp.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS);throw e.abort(t),t}e.source=r.source,e.sink=r.sink,e.protocol=i,null!=r.closeWrite&&(e.closeWrite=r.closeWrite),null!=r.closeRead&&(e.closeRead=r.closeRead),null!=r.close&&(e.close=r.close),await this.components.peerStore.merge(l,{protocols:[i]}),null===(t=this.components.metrics)||void 0===t||t.trackProtocolStream(e,f),this._onStream({connection:f,stream:e,protocol:i})})).catch((async t=>{f.log.error("error handling incoming stream id %s",e.id,t.message,t.code,t.stack),null==e.timeline.close&&await e.close()}))}}),d=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null==h)throw new Mr("Stream is not multiplexed",Rp.ERR_MUXER_UNAVAILABLE);f.log("starting new stream for protocols %s",e);const n=await h.newStream();f.log.trace("started new stream %s for protocols %s",n.id,e);try{var i;if(null==t.signal){n.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",e);const r=AbortSignal.timeout(3e4);vu(1/0,r),t={...t,signal:r}}n.log.trace("selecting protocol from protocols %s",e);const{stream:o,protocol:s}=await Bg(n,e,{...t,log:n.log,yieldBytes:!0});n.log("selected protocol %s",s);const a=function(e,t){var n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{const{options:n}=t.getHandler(e);if(null!=n.maxOutboundStreams)return n.maxOutboundStreams}catch(i){if(i.code!==Rp.ERR_NO_HANDLER_FOR_PROTOCOL)throw i}return null!==(n=r.maxOutboundStreams)&&void 0!==n?n:64}(s,r.components.registrar,t);if(Mg(s,"outbound",f)>=a){const e=new Mr('Too many outbound protocol streams for protocol "'.concat(s,'" - limit ').concat(a),Rp.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS);throw n.abort(e),e}return await r.components.peerStore.merge(l,{protocols:[s]}),n.source=o.source,n.sink=o.sink,n.protocol=s,null!=o.closeWrite&&(n.closeWrite=o.closeWrite),null!=o.closeRead&&(n.closeRead=o.closeRead),null!=o.close&&(n.close=o.close),null===(i=r.components.metrics)||void 0===i||i.trackProtocolStream(n,f),n}catch(o){if(f.log.error("could not create new stream for protocols %s",e,o),null==n.timeline.close&&n.abort(o),null!=o.code)throw o;throw new Mr(String(o),Rp.ERR_UNSUPPORTED_PROTOCOL)}},Promise.all([h.sink(a.source),a.sink(h.source)]).catch((e=>{f.log.error("error piping data through muxer",e)})));const p=s.timeline;s.timeline=new Proxy(p,{set:function(){return null!=f&&"close"===(arguments.length<=1?void 0:arguments[1])&&null!=(arguments.length<=2?void 0:arguments[2])&&null==p.close&&(async()=>{try{"open"===f.status&&await f.close()}catch(e){f.log.error("error closing connection after timeline close",e)}finally{r.events.safeDispatchEvent("connection:close",{detail:f})}})().catch((e=>{f.log.error("error thrown while dispatching connection:close event",e)})),Reflect.set(...arguments)}}),s.timeline.upgraded=Date.now();var g;return g={remoteAddr:s.remoteAddr,remotePeer:l,status:"open",direction:o,timeline:s.timeline,multiplexer:null===(t=h)||void 0===t?void 0:t.protocol,encryption:i,transient:u,logger:this.components.logger,newStream:null!==(n=d)&&void 0!==n?n:()=>{throw new Mr("connection is not multiplexed",Rp.ERR_CONNECTION_NOT_MULTIPLEXED)},getStreams:()=>null!=h?h.streams:[],close:async e=>{null!=h&&(f.log.trace("close muxer"),await h.close(e)),f.log.trace("close maconn"),await s.close(e),f.log.trace("closed maconn")},abort:e=>{s.abort(e),null!=h&&h.abort(e)}},f=new Og(g),this.events.safeDispatchEvent("connection:open",{detail:f}),f}_onStream(e){const{connection:t,stream:n,protocol:r}=e,{handler:i,options:o}=this.components.registrar.getHandler(r);if(t.transient&&!0!==o.runOnTransientConnection)throw new Mr("Cannot open protocol stream on transient connection","ERR_TRANSIENT_CONNECTION");i({connection:t,stream:n})}async _encryptInbound(e){const t=Array.from(this.connectionEncryption.keys());e.log("handling inbound crypto protocol selection",t);try{const{stream:n,protocol:r}=await Ng(e,t,{log:e.log}),i=this.connectionEncryption.get(r);if(null==i)throw new Error("no crypto module found for ".concat(r));return e.log("encrypting inbound connection using",r),{...await i.secureInbound(this.components.peerId,n),protocol:r}}catch(n){throw e.log.error("encrypting inbound connection to %p failed",n),new Mr(n.message,Rp.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(e,t){const n=Array.from(this.connectionEncryption.keys());e.log("selecting outbound crypto protocol",n);try{e.log.trace("selecting encrypter from %s",n);const{stream:r,protocol:i}=await Bg(e,n,{log:e.log,yieldBytes:!0}),o=this.connectionEncryption.get(i);if(null==o)throw new Error("no crypto module found for ".concat(i));return e.log("encrypting outbound connection to %p using %s",t,o),{...await o.secureOutbound(this.components.peerId,r,t),protocol:i}}catch(r){throw e.log.error("encrypting outbound connection to %p failed",r),new Mr(r.message,Rp.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(e,t){const n=Array.from(t.keys());e.log("outbound selecting muxer %s",n);try{e.log.trace("selecting stream muxer from %s",n);const{stream:r,protocol:i}=await Bg(e,n,{log:e.log,yieldBytes:!0});e.log("selected %s as muxer protocol",i);return{stream:r,muxerFactory:t.get(i)}}catch(r){throw e.log.error("error multiplexing outbound connection",r),new Mr(String(r),Rp.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(e,t){const n=Array.from(t.keys());e.log("inbound handling muxers %s",n);try{const{stream:r,protocol:i}=await Ng(e,n,{log:e.log});return{stream:r,muxerFactory:t.get(i)}}catch(r){throw e.log.error("error multiplexing inbound connection",r),new Mr(String(r),Rp.ERR_MUXER_UNAVAILABLE)}}}const Fg="1.4.0",Vg="libp2p";var zg=new WeakSet;class Kg extends bu{constructor(e){var t,n,r,i,o,s,a,l,c;super(),Ve(this,zg),je(this,"peerId",void 0),je(this,"peerStore",void 0),je(this,"contentRouting",void 0),je(this,"peerRouting",void 0),je(this,"metrics",void 0),je(this,"services",void 0),je(this,"logger",void 0),je(this,"status",void 0),je(this,"components",void 0),je(this,"log",void 0),this.status="stopped";const u=new bu,h=u.dispatchEvent.bind(u);u.dispatchEvent=e=>{const t=h(e),n=this.dispatchEvent(new _u(e.type,{detail:e.detail}));return t||n},vu(1/0,u),this.peerId=e.peerId,this.logger=null!==(t=e.logger)&&void 0!==t?t:fn(),this.log=this.logger.forComponent("libp2p"),this.services={};const d=this.components=function(){const e=new wf(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return new Proxy(e,{get(t,n,r){if("string"===typeof n&&!Ef.includes(n)){const t=e.components[n];if(null==t&&!bf.includes(n))throw new Mr("".concat(n," not set"),"ERR_SERVICE_MISSING");return t}return Reflect.get(t,n,r)},set:(t,n,r)=>("string"===typeof n?e.components[n]=r:Reflect.set(t,n,r),!0)})}({peerId:e.peerId,privateKey:e.privateKey,nodeInfo:null!==(n=e.nodeInfo)&&void 0!==n?n:{name:Vg,version:Fg},logger:this.logger,events:u,datastore:null!==(r=e.datastore)&&void 0!==r?r:new Tr,connectionGater:Af(e.connectionGater),dns:e.dns});this.peerStore=this.configureComponent("peerStore",new hf(d,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...e.peerStore})),null!=e.metrics&&(this.metrics=this.configureComponent("metrics",e.metrics(this.components))),d.events.addEventListener("peer:update",(e=>{if(null==e.detail.previous){const t={id:e.detail.peer.id,multiaddrs:e.detail.peer.addresses.map((e=>e.multiaddr))};d.events.safeDispatchEvent("peer:discovery",{detail:t})}})),null!=e.connectionProtector&&this.configureComponent("connectionProtector",e.connectionProtector(d)),this.components.upgrader=new Ug(this.components,{connectionEncryption:(null!==(i=e.connectionEncryption)&&void 0!==i?i:[]).map(((e,t)=>this.configureComponent("connection-encryption-".concat(t),e(this.components)))),muxers:(null!==(o=e.streamMuxers)&&void 0!==o?o:[]).map(((e,t)=>this.configureComponent("stream-muxers-".concat(t),e(this.components)))),inboundUpgradeTimeout:e.connectionManager.inboundUpgradeTimeout}),this.configureComponent("transportManager",new gg(this.components,e.transportManager)),this.configureComponent("connectionManager",new sg(this.components,e.connectionManager)),this.configureComponent("registrar",new dg(this.components)),this.configureComponent("addressManager",new gf(this.components,e.addresses));const f=(null!==(s=e.peerRouters)&&void 0!==s?s:[]).map(((e,t)=>this.configureComponent("peer-router-".concat(t),e(this.components))));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new hg(this.components,{routers:f}));const p=(null!==(a=e.contentRouters)&&void 0!==a?a:[]).map(((e,t)=>this.configureComponent("content-router-".concat(t),e(this.components))));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new ag(this.components,{routers:p})),(null!==(l=e.peerDiscovery)&&void 0!==l?l:[]).forEach(((e,t)=>{this.configureComponent("peer-discovery-".concat(t),e(this.components)).addEventListener("peer",(e=>{He(zg,this,jg).call(this,e)}))})),null===(c=e.transports)||void 0===c||c.forEach(((e,t)=>{this.components.transportManager.add(this.configureComponent("transport-".concat(t),e(this.components)))})),null!=e.services)for(const v of Object.keys(e.services)){const t=(0,e.services[v])(this.components);var g,y;if(null!=t){if(this.services[v]=t,this.configureComponent(v,t),null!=t[Su]&&(this.log("registering service %s for content routing",v),p.push(t[Su])),null!=t[ku]&&(this.log("registering service %s for peer routing",v),f.push(t[ku])),null!=t[Au])this.log("registering service %s for peer discovery",v),null===(g=(y=t[Au]).addEventListener)||void 0===g||g.call(y,"peer",(e=>{He(zg,this,jg).call(this,e)}))}else this.log.error("service factory %s returned null or undefined instance",v)}}configureComponent(e,t){return null==t&&this.log.error("component %s was null or undefined",e),this.components[e]=t,t}async start(){if("stopped"===this.status){this.status="starting",this.log("libp2p is starting");try{var e,t,n,r;await(null===(e=(t=this.components).beforeStart)||void 0===e?void 0:e.call(t)),await this.components.start(),await(null===(n=(r=this.components).afterStart)||void 0===n?void 0:n.call(r)),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started")}catch(i){throw this.log.error("An error occurred starting libp2p",i),this.status="started",await this.stop(),i}}}async stop(){var e,t,n,r;"started"===this.status&&(this.log("libp2p is stopping"),this.status="stopping",await(null===(e=(t=this.components).beforeStop)||void 0===e?void 0:e.call(t)),await this.components.stop(),await(null===(n=(r=this.components).afterStop)||void 0===n?void 0:n.call(r)),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))}getConnections(e){return this.components.connectionManager.getConnections(e)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){const e=new zu;for(const t of this.components.connectionManager.getConnections())e.add(t.remotePeer);return Array.from(e)}async dial(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.components.connectionManager.openConnection(e,{priority:75,...t})}async dialProtocol(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null==t)throw new Mr("no protocols were provided to open a stream",Rp.ERR_INVALID_PROTOCOLS_FOR_STREAM);if(0===(t=Array.isArray(t)?t:[t]).length)throw new Mr("no protocols were provided to open a stream",Rp.ERR_INVALID_PROTOCOLS_FOR_STREAM);return(await this.dial(e,n)).newStream(t,n)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n;Fh(e)&&(e=Mu(null!==(n=e.getPeerId())&&void 0!==n?n:""));await this.components.connectionManager.closeConnections(e,t)}async getPublicKey(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.log("getPublicKey %p",e),null!=e.publicKey)return e.publicKey;try{const t=await this.peerStore.get(e);if(null!=t.id.publicKey)return t.id.publicKey}catch(i){if(i.code!==Rp.ERR_NOT_FOUND)throw i}const n=Wo([yr("/pk/"),e.multihash.digest]),r=await this.contentRouting.get(n,t);return hu(r),await this.peerStore.patch(e,{publicKey:r}),r}async handle(e,t,n){Array.isArray(e)||(e=[e]),await Promise.all(e.map((async e=>{await this.components.registrar.handle(e,t,n)})))}async unhandle(e){Array.isArray(e)||(e=[e]),await Promise.all(e.map((async e=>{await this.components.registrar.unhandle(e)})))}async register(e,t){return this.components.registrar.register(e,t)}unregister(e){this.components.registrar.unregister(e)}async isDialable(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.components.connectionManager.isDialable(e,t)}}function jg(e){const{detail:t}=e;t.id.toString()!==this.peerId.toString()?this.components.peerStore.merge(t.id,{multiaddrs:t.multiaddrs}).catch((e=>{this.log.error(e)})):this.log.error(new Error(Rp.ERR_DISCOVERED_SELF))}async function Hg(){var e,t;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=null!==(e=n.peerId)&&void 0!==e?e:n.peerId=await Ku();if(null==r.privateKey)throw new Mr("peer id was missing private key","ERR_MISSING_PRIVATE_KEY");return null!==(t=n.privateKey)&&void 0!==t||(n.privateKey=await fu(r.privateKey)),new Kg(await async function(e){var t;const n=Ip(Cp,e);if(null===n.connectionProtector&&null!=(null===(t=globalThis.process)||void 0===t||null===(t=t.env)||void 0===t?void 0:t.LIBP2P_FORCE_PNET))throw new Mr(Tp.ERR_PROTECTOR_REQUIRED,Rp.ERR_PROTECTOR_REQUIRED);if(!(await Fu(n.privateKey.public.bytes,n.privateKey.bytes)).equals(n.peerId))throw new Mr("Private key doesn't match peer id",Rp.ERR_INVALID_KEY);return n}(n))}async function qg(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=await Hg(e);return!1!==e.start&&await t.start(),t}function Wg(e){return null!=(null===e||void 0===e?void 0:e.then)}const Gg=function(e,t){if(null!=e[Symbol.asyncIterator])return async function*(){for await(const n of e){const e=t(n);Wg(e)&&await e,yield n}}();const n=yn(e),{value:r,done:i}=n.next();if(!0===i)return function*(){}();const o=t(r);if("function"===typeof(null===o||void 0===o?void 0:o.then))return async function*(){yield r;for await(const e of n){const n=t(e);Wg(n)&&await n,yield e}}();const s=t;return function*(){yield r;for(const e of n)s(e),yield e}()};var Yg=n(2370);class Qg{constructor(e,t,n){je(this,"_refCounter",void 0),je(this,"cid",void 0),je(this,"priority",void 0),je(this,"wantType",void 0),this._refCounter=1,this.cid=e,this.priority=null!==t&&void 0!==t?t:1,this.wantType=n}inc(){this._refCounter+=1}dec(){this._refCounter=Math.max(0,this._refCounter-1)}hasRefs(){return this._refCounter>0}get[Symbol.toStringTag](){const e=this.cid.toString(St);return"WantlistEntry <key: ".concat(e,", priority: ").concat(this.priority,", refs: ").concat(this._refCounter,">")}equals(e){return this._refCounter===e._refCounter&&this.cid.equals(e.cid)&&this.priority===e.priority&&this.wantType===e.wantType}}class Xg{constructor(e,t,n,r,i){je(this,"entry",void 0),je(this,"cancel",void 0),je(this,"sendDontHave",void 0),this.entry=new Qg(e,t,n),this.cancel=Boolean(r),this.sendDontHave=Boolean(i)}get cid(){return this.entry.cid}set cid(e){this.entry.cid=e}get priority(){return this.entry.priority}set priority(e){this.entry.priority=e}get wantType(){return this.entry.wantType}set wantType(e){this.entry.wantType=e}get[Symbol.toStringTag](){const e=this.cid.toString(St);return"BitswapMessageEntry ".concat(e," <cancel: ").concat(this.cancel,", priority: ").concat(this.priority,">")}equals(e){return this.cancel===e.cancel&&this.sendDontHave===e.sendDontHave&&this.wantType===e.wantType&&this.entry.equals(e.entry)}}const Jg=(e,t)=>{const n=["bitswap"];return null!=t&&n.push(t),null!=e&&n.push("".concat(e.toString().slice(0,8))),pn(n.join(":"))},$g=(e,t)=>{if(e.size!==t.size)return!1;for(const[n,r]of e){const e=t.get(n);if(void 0===e)return!1;if(r instanceof Uint8Array&&e instanceof Uint8Array&&!Hr(r,e))return!1;if(r instanceof Xg&&e instanceof Xg&&!r.equals(e))return!1}return!0};var Zg=n(1870);const ey=function(e){let t=new Uint8Array(e.reduce(((e,t)=>e+Zg.encodingLength(t)),0)),n=0;for(const r of e)t=Zg.encode(r,t,n),n+=Zg.encodingLength(r);return t};var ty,ny;!function(e){let t,n,r,i,o,s;!function(t){let n,r,i,o;!function(e){e.Block="Block",e.Have="Have"}(n=t.WantType||(t.WantType={})),function(e){e[e.Block=0]="Block",e[e.Have=1]="Have"}(r||(r={})),function(e){e.codec=()=>Gs(r)}(n=t.WantType||(t.WantType={})),function(t){let i;t.codec=()=>(null==i&&(i=Ys((function(t,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==i.lengthDelimited&&n.fork(),null!=t.block&&t.block.byteLength>0&&(n.uint32(10),n.bytes(t.block)),null!=t.priority&&0!==t.priority&&(n.uint32(16),n.int32(t.priority)),null!=t.cancel&&!1!==t.cancel&&(n.uint32(24),n.bool(t.cancel)),null!=t.wantType&&0!==r[t.wantType]&&(n.uint32(32),e.Wantlist.WantType.codec().encode(t.wantType,n)),null!=t.sendDontHave&&!1!==t.sendDontHave&&(n.uint32(40),n.bool(t.sendDontHave)),!1!==i.lengthDelimited&&n.ldelim()}),((t,r)=>{const i={block:new Uint8Array(0),priority:0,cancel:!1,wantType:n.Block,sendDontHave:!1},o=null==r?t.len:t.pos+r;for(;t.pos<o;){const n=t.uint32();switch(n>>>3){case 1:i.block=t.bytes();break;case 2:i.priority=t.int32();break;case 3:i.cancel=t.bool();break;case 4:i.wantType=e.Wantlist.WantType.codec().decode(t);break;case 5:i.sendDontHave=t.bool();break;default:t.skipType(7&n)}}return i}))),i),t.encode=e=>Vs(e,t.codec()),t.decode=e=>Is(e,t.codec())}(i=t.Entry||(t.Entry={})),t.codec=()=>(null==o&&(o=Ys((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==r.lengthDelimited&&n.fork(),null!=t.entries)for(const i of t.entries)n.uint32(10),e.Wantlist.Entry.codec().encode(i,n);null!=t.full&&!1!==t.full&&(n.uint32(16),n.bool(t.full)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={entries:[],full:!1},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();switch(n>>>3){case 1:r.entries.push(e.Wantlist.Entry.codec().decode(t,t.uint32()));break;case 2:r.full=t.bool();break;default:t.skipType(7&n)}}return r}))),o),t.encode=e=>Vs(e,t.codec()),t.decode=e=>Is(e,t.codec())}(t=e.Wantlist||(e.Wantlist={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.prefix&&e.prefix.byteLength>0&&(t.uint32(10),t.bytes(e.prefix)),null!=e.data&&e.data.byteLength>0&&(t.uint32(18),t.bytes(e.data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={prefix:new Uint8Array(0),data:new Uint8Array(0)},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.prefix=e.bytes();break;case 2:n.data=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(n=e.Block||(e.Block={})),function(e){e.Have="Have",e.DontHave="DontHave"}(r=e.BlockPresenceType||(e.BlockPresenceType={})),function(e){e[e.Have=0]="Have",e[e.DontHave=1]="DontHave"}(i||(i={})),function(e){e.codec=()=>Gs(i)}(r=e.BlockPresenceType||(e.BlockPresenceType={})),function(t){let n;t.codec=()=>(null==n&&(n=Ys((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==r.lengthDelimited&&n.fork(),null!=t.cid&&t.cid.byteLength>0&&(n.uint32(10),n.bytes(t.cid)),null!=t.type&&0!==i[t.type]&&(n.uint32(16),e.BlockPresenceType.codec().encode(t.type,n)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const i={cid:new Uint8Array(0),type:r.Have},o=null==n?t.len:t.pos+n;for(;t.pos<o;){const n=t.uint32();switch(n>>>3){case 1:i.cid=t.bytes();break;case 2:i.type=e.BlockPresenceType.codec().decode(t);break;default:t.skipType(7&n)}}return i}))),n),t.encode=e=>Vs(e,t.codec()),t.decode=e=>Is(e,t.codec())}(o=e.BlockPresence||(e.BlockPresence={})),e.codec=()=>(null==s&&(s=Ys((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==r.lengthDelimited&&n.fork(),null!=t.wantlist&&(n.uint32(10),e.Wantlist.codec().encode(t.wantlist,n)),null!=t.blocks)for(const e of t.blocks)n.uint32(18),n.bytes(e);if(null!=t.payload)for(const i of t.payload)n.uint32(26),e.Block.codec().encode(i,n);if(null!=t.blockPresences)for(const i of t.blockPresences)n.uint32(34),e.BlockPresence.codec().encode(i,n);null!=t.pendingBytes&&0!==t.pendingBytes&&(n.uint32(40),n.int32(t.pendingBytes)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={blocks:[],payload:[],blockPresences:[],pendingBytes:0},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();switch(n>>>3){case 1:r.wantlist=e.Wantlist.codec().decode(t,t.uint32());break;case 2:r.blocks.push(t.bytes());break;case 3:r.payload.push(e.Block.codec().decode(t,t.uint32()));break;case 4:r.blockPresences.push(e.BlockPresence.codec().decode(t,t.uint32()));break;case 5:r.pendingBytes=t.int32();break;default:t.skipType(7&n)}}return r}))),s),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(ty||(ty={}));class ry{constructor(e){je(this,"full",void 0),je(this,"wantlist",void 0),je(this,"blocks",void 0),je(this,"blockPresences",void 0),je(this,"pendingBytes",void 0),this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}get empty(){return 0===this.blocks.size&&0===this.wantlist.size&&0===this.blockPresences.size}addEntry(e,t,n,r,i){null==n&&(n=ry.WantType.Block);const o=e.toString(St),s=this.wantlist.get(o);null!=s?(s.wantType===n&&(s.priority=t),!0===r&&(s.cancel=Boolean(r)),!0===i&&(s.sendDontHave=Boolean(i)),n===ry.WantType.Block&&s.wantType===ry.WantType.Have&&(s.wantType=n)):this.wantlist.set(o,new Xg(e,t,n,r,i))}addBlock(e,t){const n=e.toString(St);this.blocks.set(n,t)}addHave(e){const t=e.toString(St);this.blockPresences.has(t)||this.blockPresences.set(t,ry.BlockPresenceType.Have)}addDontHave(e){const t=e.toString(St);this.blockPresences.has(t)||this.blockPresences.set(t,ry.BlockPresenceType.DontHave)}cancel(e){const t=e.toString(St);this.wantlist.delete(t),this.addEntry(e,0,ry.WantType.Block,!0,!1)}setPendingBytes(e){this.pendingBytes=e}serializeToBitswap100(){return ty.encode({wantlist:{entries:Array.from(this.wantlist.values()).map((e=>({block:e.cid.bytes,priority:Number(e.priority),cancel:Boolean(e.cancel),wantType:ty.Wantlist.WantType.Block,sendDontHave:!1}))),full:Boolean(this.full)},blocks:Array.from(this.blocks.values())})}serializeToBitswap110(){const e={wantlist:{entries:Array.from(this.wantlist.values()).map((e=>({block:e.cid.bytes,priority:Number(e.priority),wantType:e.wantType,cancel:Boolean(e.cancel),sendDontHave:Boolean(e.sendDontHave)}))),full:Boolean(this.full)},blockPresences:[],payload:[],pendingBytes:this.pendingBytes,blocks:[]};for(const[t,n]of this.blocks.entries()){const r=Jt.parse(t),i=r.version,o=r.code,s=r.multihash.code,a=r.multihash.digest.length,l=ey([i,o,s,a]);e.payload.push({prefix:l,data:n})}for(const[t,n]of this.blockPresences)e.blockPresences.push({cid:Jt.parse(t).bytes,type:n});return this.pendingBytes>0&&(e.pendingBytes=this.pendingBytes),ty.encode(e)}equals(e){return!!(this.full===e.full&&this.pendingBytes===e.pendingBytes&&$g(this.wantlist,e.wantlist)&&$g(this.blocks,e.blocks)&&$g(this.blockPresences,e.blockPresences))}get[Symbol.toStringTag](){const e=Array.from(this.wantlist.keys()),t=Array.from(this.blocks.keys());return"BitswapMessage <full: ".concat(this.full,", list: ").concat(e,", blocks: ").concat(t,">")}}ny=ry,je(ry,"Entry",Xg),je(ry,"WantType",{Block:ty.Wantlist.WantType.Block,Have:ty.Wantlist.WantType.Have}),je(ry,"BlockPresenceType",{Have:ty.BlockPresenceType.Have,DontHave:ty.BlockPresenceType.DontHave}),je(ry,"deserialize",(async(e,t)=>{var n,r;const i=ty.decode(e),o=!0===(null===(n=i.wantlist)||void 0===n?void 0:n.full),s=new ny(o);return null===(r=i.wantlist)||void 0===r||r.entries.forEach((e=>{var t;if(null==e.block)return;const n=Jt.decode(e.block);s.addEntry(n,null!==(t=e.priority)&&void 0!==t?t:0,e.wantType,Boolean(e.cancel),Boolean(e.sendDontHave))})),i.blockPresences.forEach((e=>{if(null==e.cid)return;const t=Jt.decode(e.cid);e.type===ny.BlockPresenceType.Have?s.addHave(t):s.addDontHave(t)})),i.blocks.length>0?(await Promise.all(i.blocks.map((async e=>{const t=await ar.digest(e),n=Jt.createV0(t);s.addBlock(n,e)}))),s):i.payload.length>0?(await Promise.all(i.payload.map((async e=>{if(null==e.prefix||null==e.data)return;const n=Yg(e.prefix),r=n[0],i=n[1],o=n[2],a=o===ar.code?ar:await(null===t||void 0===t?void 0:t.getHasher(o));if(null==a)throw new Mr("Unknown hash algorithm","ERR_UNKNOWN_HASH_ALG");const l=await a.digest(e.data),c=Jt.create(r,i,l);s.addBlock(c,e.data)}))),s.setPendingBytes(i.pendingBytes),s):s})),je(ry,"blockPresenceSize",(e=>e.bytes.length+1));const iy=ty.Wantlist.WantType.Block,oy=ty.Wantlist.WantType.Have;class sy{constructor(e,t){je(this,"set",void 0),je(this,"_stats",void 0),this.set=null!=t?pg({name:"ipfs_bitswap_wantlist",metrics:t.metrics}):new Map,this._stats=e}get length(){return this.set.size}add(e,t,n){const r=e.toString(St),i=this.set.get(r);null!=i?(i.inc(),i.priority=t,i.wantType===oy&&n===iy&&(i.wantType=n)):(this.set.set(r,new Qg(e,t,n)),null!=this._stats&&this._stats.push(void 0,"wantListSize",1))}remove(e){const t=e.toString(St),n=this.set.get(t);null!=n&&(n.dec(),n.hasRefs()||(this.set.delete(t),null!=this._stats&&this._stats.push(void 0,"wantListSize",-1)))}removeForce(e){this.set.has(e)&&this.set.delete(e)}forEach(e){this.set.forEach(e)}entries(){return this.set.entries()}sortedEntries(){return new Map((e=e=>e[1].key,t=Array.from(this.set.entries()),Array.prototype.slice.call(t,0).sort(((t,n)=>{const r=e(t),i=e(n);return r<i?-1:r>i?1:0}))));var e,t}contains(e){const t=e.toString(St);return this.set.has(t)}get(e){const t=e.toString(St);return this.set.get(t)}}je(sy,"Entry",Qg);class ay{constructor(e){je(this,"partner",void 0),je(this,"wantlist",void 0),je(this,"exchangeCount",void 0),je(this,"accounting",void 0),je(this,"lastExchange",void 0),this.partner=e,this.wantlist=new sy,this.exchangeCount=0,this.accounting={bytesSent:0,bytesRecv:0}}sentBytes(e){this.exchangeCount++,this.lastExchange=(new Date).getTime(),this.accounting.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=(new Date).getTime(),this.accounting.bytesRecv+=e}wants(e,t,n){this.wantlist.add(e,t,n)}cancelWant(e){this.wantlist.remove(e)}wantlistContains(e){return this.wantlist.get(e)}debtRatio(){return this.accounting.bytesSent/(this.accounting.bytesRecv+1)}}class ly extends Map{constructor(e,t){super(),je(this,"_cmp",void 0),je(this,"_keys",void 0),this._cmp=null!==t&&void 0!==t?t:this._defaultSort,this._keys=[];for(const[n,r]of null!==e&&void 0!==e?e:[])this.set(n,r)}update(e){if(e<0||e>=this._keys.length)return;const t=this._keys[e];this._keys.splice(e,1);const n=this._find(t);this._keys.splice(n,0,t)}set(e,t){if(this.has(e)){const t=this.indexOf(e);this._keys.splice(t,1)}super.set(e,t);const n=this._find(e);return this._keys.splice(n,0,e),this}clear(){super.clear(),this._keys=[]}delete(e){if(!this.has(e))return!1;const t=this.indexOf(e);return this._keys.splice(t,1),super.delete(e)}indexOf(e){if(!this.has(e))return-1;const t=this._find(e);if(this._keys[t]===e)return t;for(let n=1;n<this._keys.length;n++){if(this._keys[t+n]===e)return t+n;if(this._keys[t-n]===e)return t-n}return-1}_find(e){let t=0,n=this._keys.length;for(;t<n;){const r=t+n>>>1,i=this._kCmp(this._keys[r],e);if(i<0)t=r+1;else{if(!(i>0))return r;n=r}}return t}*keys(){for(const e of this._keys)yield e}*values(){for(const e of this._keys)yield this.get(e)}*entries(){for(const e of this._keys)yield[e,this.get(e)]}*[Symbol.iterator](){yield*this.entries()}forEach(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this;if(null!=e)for(const n of this._keys){const r=this.get(n);if(null==r)throw new Error("Value cannot be undefined");e.apply(t,[[n,r]])}}_defaultSort(e,t){return e[0]<t[0]?-1:t[0]<e[0]?1:0}_kCmp(e,t){return this._cmp([e,this.get(e)],[t,this.get(t)])}}const cy={hasNewInfo:()=>!1,merge(){}};class uy{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:cy;je(this,"_taskMerger",void 0),je(this,"_byPeer",void 0),this._taskMerger=e,this._byPeer=new ly([],hy.compare)}pushTasks(e,t){let n=this._byPeer.get(e.toString());null==n&&(n=new hy(e,this._taskMerger)),n.pushTasks(t),this._byPeer.set(e.toString(),n)}popTasks(e){const t=this._head();if(void 0===t)return{tasks:[],pendingSize:0};const{tasks:n,pendingSize:r}=t.popTasks(e);if(0===n.length)return{tasks:n,pendingSize:r};const i=t.peerId;return t.isIdle()?this._byPeer.delete(i.toString()):this._byPeer.update(0),{peerId:i,tasks:n,pendingSize:r}}_head(){if(0!==this._byPeer.size)for(const[,e]of this._byPeer)return e}remove(e,t){const n=this._byPeer.get(t.toString());null===n||void 0===n||n.remove(e)}tasksDone(e,t){const n=this._byPeer.get(e.toString());if(null==n)return;const r=this._byPeer.indexOf(e.toString());for(const i of t)n.taskDone(i);this._byPeer.update(r)}}class hy{constructor(e,t){je(this,"peerId",void 0),je(this,"_taskMerger",void 0),je(this,"_activeTotalSize",void 0),je(this,"_pending",void 0),je(this,"_active",void 0),this.peerId=e,this._taskMerger=t,this._activeTotalSize=0,this._pending=new dy,this._active=new Set}pushTasks(e){for(const t of e)this._pushTask(t)}_pushTask(e){if(!this._taskHasMoreInfoThanActiveTasks(e))return;const t=this._pending.get(e.topic);if(null!=t)return e.priority>t.priority&&this._pending.updatePriority(e.topic,e.priority),void this._taskMerger.merge(e,t);this._pending.add(e)}_taskHasMoreInfoThanActiveTasks(e){const t=[];for(const n of this._active)n.topic===e.topic&&t.push(n);return 0===t.length||this._taskMerger.hasNewInfo(e,t)}popTasks(e){let t=0;const n=[],r=this._pending.tasks();for(let i=0;i<r.length&&t<e;i++){const e=r[i];n.push(e),t+=e.size,this._pending.delete(e.topic),this._activeTotalSize+=e.size,this._active.add(e)}return{tasks:n,pendingSize:this._pending.totalSize}}taskDone(e){this._active.has(e)&&(this._activeTotalSize-=e.size,this._active.delete(e))}remove(e){this._pending.delete(e)}isIdle(){return 0===this._pending.length&&0===this._active.size}static compare(e,t){return 0===e[1]._pending.length?1:0===t[1]._pending.length?-1:e[1]._activeTotalSize===t[1]._activeTotalSize?t[1]._pending.length-e[1]._pending.length:e[1]._activeTotalSize-t[1]._activeTotalSize}}class dy{constructor(){je(this,"_tasks",void 0),this._tasks=new ly([],this._compare)}get length(){return this._tasks.size}get totalSize(){return[...this._tasks.values()].reduce(((e,t)=>e+t.task.size),0)}get(e){var t;return null===(t=this._tasks)||void 0===t||null===(t=t.get(e))||void 0===t?void 0:t.task}add(e){this._tasks.set(e.topic,{created:Date.now(),task:e})}delete(e){this._tasks.delete(e)}tasks(){return[...this._tasks.values()].map((e=>e.task))}updatePriority(e,t){const n=this._tasks.get(e);if(null==n)return;const r=this._tasks.indexOf(e);n.task.priority=t,this._tasks.update(r)}_compare(e,t){return e[1].task.priority===t[1].task.priority?e[1].created-t[1].created:t[1].task.priority-e[1].task.priority}}const fy={hasNewInfo(e,t){let n=!1,r=!1;for(const i of t)i.data.haveBlock&&(n=!0),i.data.isWantBlock&&(r=!0);return!(r||!e.data.isWantBlock)||!(n||!e.data.haveBlock)},merge(e,t){const n=e.data,r=t.data;!r.haveBlock&&n.haveBlock&&(r.haveBlock=n.haveBlock,r.blockSize=n.blockSize),!r.isWantBlock&&n.isWantBlock&&(r.isWantBlock=!0,r.haveBlock&&!n.haveBlock||(r.haveBlock=n.haveBlock,t.size=e.size)),r.isWantBlock&&r.haveBlock&&(t.size=r.blockSize)}},py=ry.WantType;class gy{constructor(e,t,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};je(this,"_log",void 0),je(this,"blockstore",void 0),je(this,"network",void 0),je(this,"_stats",void 0),je(this,"_opts",void 0),je(this,"ledgerMap",void 0),je(this,"_running",void 0),je(this,"_requestQueue",void 0),this._log=Jg(e,"engine"),this.blockstore=t,this.network=n,this._stats=r,this._opts=this._processOpts(o),this.ledgerMap=pg({name:"ipfs_bitswap_ledger_map",metrics:i.metrics}),this._running=!1,this._requestQueue=new uy(fy)}_processOpts(e){return{maxSizeReplaceHasWithBlock:1024,targetMessageSize:16384,...e}}_scheduleProcessTasks(){setTimeout((()=>{this._processTasks().catch((e=>{this._log.error("error processing stats",e)}))}))}async _processTasks(){if(!this._running)return;const{peerId:e,tasks:t,pendingSize:n}=this._requestQueue.popTasks(this._opts.targetMessageSize);if(0===t.length)return;const r=new ry(!1);r.setPendingBytes(n);const i=[],o=new Map;for(const l of t){const e=Jt.parse(l.topic);l.data.haveBlock?l.data.isWantBlock?(i.push(e),o.set(l.topic,l.data)):r.addHave(e):r.addDontHave(e)}const s=await this._getBlocks(i);for(const[l,c]of o){const e=Jt.parse(l),t=s.get(l);null!=t?r.addBlock(e,t):c.sendDontHave&&r.addDontHave(e)}if(r.empty)return null!=e&&this._requestQueue.tasksDone(e,t),void this._scheduleProcessTasks();try{null!=e&&await this.network.sendMessage(e,r);for(const[t,n]of s.entries())null!=e&&this.messageSent(e,Jt.parse(t),n)}catch(a){this._log.error(a)}null!=e&&this._requestQueue.tasksDone(e,t),this._scheduleProcessTasks()}wantlistForPeer(e){const t=e.toString(),n=this.ledgerMap.get(t);return null!=n?n.wantlist.sortedEntries():new Map}ledgerForPeer(e){const t=e.toString(),n=this.ledgerMap.get(t);if(null!=n)return{peer:n.partner,value:n.debtRatio(),sent:n.accounting.bytesSent,recv:n.accounting.bytesRecv,exchanged:n.exchangeCount}}peers(){return Array.from(this.ledgerMap.values()).map((e=>e.partner))}receivedBlocks(e){if(0!==e.length){for(const t of this.ledgerMap.values())for(const{cid:n,block:r}of e){const e=t.wantlistContains(n);if(null==e)continue;const i=r.length,o=this._sendAsBlock(e.wantType,i);let s=i;o||(s=ry.blockPresenceSize(e.cid)),this._requestQueue.pushTasks(t.partner,[{topic:e.cid.toString(St),priority:e.priority,size:s,data:{blockSize:i,isWantBlock:o,haveBlock:!0,sendDontHave:!1}}])}this._scheduleProcessTasks()}}async messageReceived(e,t){const n=this._findOrCreate(e);if(t.empty)return;if(t.full&&(n.wantlist=new sy),this._updateBlockAccounting(t.blocks,n),0===t.wantlist.size)return void this._scheduleProcessTasks();const r=[],i=[];t.wantlist.forEach((e=>{e.cancel?(n.cancelWant(e.cid),r.push(e.cid)):(n.wants(e.cid,e.priority,e.wantType),i.push(e))})),this._cancelWants(e,r),await this._addWants(e,i),this._scheduleProcessTasks()}_cancelWants(e,t){for(const n of t)this._requestQueue.remove(n.toString(St),e)}async _addWants(e,t){const n=await this._getBlockSizes(t.map((e=>e.cid))),r=[];for(const i of t){const t=i.cid.toString(St),o=n.get(t);if(null==o)i.sendDontHave&&r.push({topic:t,priority:i.priority,size:ry.blockPresenceSize(i.cid),data:{isWantBlock:i.wantType===py.Block,blockSize:0,haveBlock:!1,sendDontHave:i.sendDontHave}});else{const e=this._sendAsBlock(i.wantType,o);let n=o;e||(n=ry.blockPresenceSize(i.cid)),r.push({topic:t,priority:i.priority,size:n,data:{isWantBlock:e,blockSize:o,haveBlock:!0,sendDontHave:i.sendDontHave}})}this._requestQueue.pushTasks(e,r)}}_sendAsBlock(e,t){return e===py.Block||t<=this._opts.maxSizeReplaceHasWithBlock}async _getBlockSizes(e){const t=await this._getBlocks(e);return new Map([...t].map((e=>{let[t,n]=e;return[t,n.length]})))}async _getBlocks(e){const t=new Map;return await Promise.all(e.map((async e=>{try{const n=await this.blockstore.get(e);t.set(e.toString(St),n)}catch(n){"ERR_NOT_FOUND"!==n.code&&this._log.error("failed to query blockstore for %s: %s",e,n)}}))),t}_updateBlockAccounting(e,t){for(const n of e.values())this._log("got block (%s bytes)",n.length),t.receivedBytes(n.length)}messageSent(e,t,n){const r=this._findOrCreate(e);r.sentBytes(n.length),r.wantlist.remove(t)}numBytesSentTo(e){return this._findOrCreate(e).accounting.bytesSent}numBytesReceivedFrom(e){return this._findOrCreate(e).accounting.bytesRecv}peerDisconnected(e){this.ledgerMap.delete(e.toString())}_findOrCreate(e){const t=e.toString(),n=this.ledgerMap.get(t);if(null!=n)return n;const r=new ay(e);return this.ledgerMap.set(t,r),null!=this._stats&&this._stats.push(t,"peerCount",1),r}start(){this._running=!0}stop(){this._running=!1}}var yy=n(2947);const vy=Math.pow(2,31)-1,my="/ipfs/bitswap/1.0.0",wy="/ipfs/bitswap/1.1.0",by="/ipfs/bitswap/1.2.0";class Ey{constructor(e,t,n){var r,i,o,s;let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};je(this,"_log",void 0),je(this,"_libp2p",void 0),je(this,"_bitswap",void 0),je(this,"_protocols",void 0),je(this,"_stats",void 0),je(this,"_running",void 0),je(this,"_hashLoader",void 0),je(this,"_maxInboundStreams",void 0),je(this,"_maxOutboundStreams",void 0),je(this,"_incomingStreamTimeout",void 0),je(this,"_registrarIds",void 0),this._log=Jg(e.peerId,"network"),this._libp2p=e,this._bitswap=t,this._protocols=[my],!0!==a.b100Only&&(this._protocols.unshift(wy),this._protocols.unshift(by)),this._stats=n,this._running=!1,this._onPeerConnect=this._onPeerConnect.bind(this),this._onPeerDisconnect=this._onPeerDisconnect.bind(this),this._onConnection=this._onConnection.bind(this),this._hashLoader=null!==(r=a.hashLoader)&&void 0!==r?r:{async getHasher(){throw new Error("Not implemented")}},this._maxInboundStreams=null!==(i=a.maxInboundStreams)&&void 0!==i?i:1024,this._maxOutboundStreams=null!==(o=a.maxOutboundStreams)&&void 0!==o?o:1024,this._incomingStreamTimeout=null!==(s=a.incomingStreamTimeout)&&void 0!==s?s:3e4}async start(){this._running=!0,await this._libp2p.handle(this._protocols,this._onConnection,{maxInboundStreams:this._maxInboundStreams,maxOutboundStreams:this._maxOutboundStreams});const e={onConnect:this._onPeerConnect,onDisconnect:this._onPeerDisconnect};this._registrarIds=[];for(const t of this._protocols)this._registrarIds.push(await this._libp2p.register(t,e));this._libp2p.getConnections().forEach((e=>{this._onPeerConnect(e.remotePeer)}))}async stop(){if(this._running=!1,await this._libp2p.unhandle(this._protocols),null!=this._registrarIds){for(const e of this._registrarIds)this._libp2p.unregister(e);this._registrarIds=[]}}_onConnection(e){if(!this._running)return;const{stream:t,connection:n}=e,r=new yy.TimeoutController(this._incomingStreamTimeout);Promise.resolve().then((async()=>{this._log("incoming new bitswap %s connection from %p",t.protocol,n.remotePeer);const e=()=>{t.abort(new Mr("Incoming Bitswap stream timed out","ERR_TIMEOUT"))};let r=AbortSignal.timeout(this._incomingStreamTimeout);r.addEventListener("abort",e),await Cr(t,(e=>Eg(e)),(async t=>{for await(const o of t){try{const e=await ry.deserialize(o.subarray(),this._hashLoader);await this._bitswap._receiveMessage(n.remotePeer,e)}catch(i){this._bitswap._receiveError(i);break}r.removeEventListener("abort",e),r=AbortSignal.timeout(this._incomingStreamTimeout),r.addEventListener("abort",e)}})),await t.close({signal:r})})).catch((e=>{this._log(e),t.abort(e)})).finally((()=>{r.clear()}))}_onPeerConnect(e){this._bitswap._onPeerConnected(e)}_onPeerDisconnect(e){this._bitswap._onPeerDisconnected(e)}findProviders(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null===(t=n.onProgress)||void 0===t||t.call(n,new fp("bitswap:network:find-providers",e)),this._libp2p.contentRouting.findProviders(e,n)}async findAndConnect(e,t){await gn(Ar(Rr(this.findProviders(e,t),(async e=>this.connectTo(e.id,t).catch((e=>{this._log.error(e)})))),3)).catch((e=>{this._log.error(e)}))}async provide(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};null===(t=n.onProgress)||void 0===t||t.call(n,new fp("bitswap:network:provide",e)),await this._libp2p.contentRouting.provide(e,n)}async sendMessage(e,t){var n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this._running)throw new Error("network isn't running");const i=e.toString();this._log("sendMessage to %s",i,t),null===(n=r.onProgress)||void 0===n||n.call(r,new fp("bitswap:network:send-wantlist",e)),await this._writeMessage(e,t,r),this._updateSentStats(e,t.blocks)}async connectTo(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this._running)throw new Error("network isn't running");return null===(t=n.onProgress)||void 0===t||t.call(n,new fp("bitswap:network:dial",e)),this._libp2p.dial(e,n)}_updateSentStats(e,t){const n=e.toString();if(null!=this._stats){for(const e of t.values())this._stats.push(n,"dataSent",e.length);this._stats.push(n,"blocksSent",t.size)}}async _writeMessage(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=await this._libp2p.dialProtocol(e,[by,wy,my]);try{let e;switch(r.protocol){case my:e=t.serializeToBitswap100();break;case wy:case by:e=t.serializeToBitswap110();break;default:throw new Error("Unknown protocol: ".concat(r.protocol))}await Cr([e],(e=>mg(e)),r),await r.close()}catch(o){var i;null===(i=n.onProgress)||void 0===i||i.call(n,new fp("bitswap:network:send-wantlist:error",{peer:e,error:o})),this._log(o),r.abort(o)}}}var _y=n(7284);const Sy=e=>"unwant:".concat(vr(e.multihash.bytes,"base64")),ky=e=>"block:".concat(vr(e.multihash.bytes,"base64"));class Ay extends _y.EventEmitter{constructor(e){super(),je(this,"_log",void 0),this.setMaxListeners(1e3),this._log=Jg(e,"notif")}hasBlock(e,t){const n=ky(e);this._log(n),this.emit(n,t)}async wantBlock(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null==e)throw new Error("Not a valid cid");const n=ky(e),r=Sy(e);return this._log("wantBlock:".concat(e)),new Promise(((i,o)=>{var s;const a=()=>{var r;this.removeListener(n,l),null===(r=t.onProgress)||void 0===r||r.call(t,new fp("bitswap:want-block:unwant",e)),o(new Error("Block for ".concat(e," unwanted")))},l=n=>{var o;this.removeListener(r,a),null===(o=t.onProgress)||void 0===o||o.call(t,new fp("bitswap:want-block:block",e)),i(n)};this.once(r,a),this.once(n,l),null===(s=t.signal)||void 0===s||s.addEventListener("abort",(()=>{this.removeListener(n,l),this.removeListener(r,a),o(new Error("Want for ".concat(e," aborted")))}))}))}unwantBlock(e){const t=Sy(e);this._log(t),this.emit(t)}}var Iy=n(8233);class Ty extends _y.EventEmitter{constructor(e,t){super(),je(this,"_options",void 0),je(this,"_queue",void 0),je(this,"_stats",void 0),je(this,"_frequencyLastTime",void 0),je(this,"_frequencyAccumulators",void 0),je(this,"_movingAverages",void 0),je(this,"_enabled",void 0),je(this,"_timeout",void 0),this._options=t,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this),e.forEach((e=>{this._stats[e]=BigInt(0),this._movingAverages[e]={},this._options.movingAverageIntervals.forEach((t=>{(this._movingAverages[e][t]=Iy(t)).push(this._frequencyLastTime,0)}))})),this._enabled=this._options.enabled}enable(){this._enabled=!0}disable(){this._enabled=!1}stop(){null!=this._timeout&&clearTimeout(this._timeout)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}push(e,t){this._enabled&&(this._queue.push([e,t,Date.now()]),this._resetComputeTimeout())}_resetComputeTimeout(){null!=this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._update,this._nextTimeout())}_nextTimeout(){const e=this._queue.length/this._options.computeThrottleMaxQueueSize;return Math.max(this._options.computeThrottleTimeout*(1-e),0)}_update(){if(this._timeout=void 0,this._queue.length>0){let e;for(;this._queue.length>0;){const t=e=this._queue.shift();null!=t&&this._applyOp(t)}null!=e&&this._updateFrequency(e[2]),this.emit("update",this._stats)}}_updateFrequency(e){const t=e-this._frequencyLastTime;t>0&&Object.keys(this._stats).forEach((n=>{this._updateFrequencyFor(n,t,e)})),this._frequencyLastTime=e}_updateFrequencyFor(e,t,n){var r;const i=null!==(r=this._frequencyAccumulators[e])&&void 0!==r?r:0;this._frequencyAccumulators[e]=0;const o=i/t*1e3;let s=this._movingAverages[e];null==s&&(s=this._movingAverages[e]={}),this._options.movingAverageIntervals.forEach((e=>{let t=s[e];null==t&&(t=s[e]=Iy(e)),t.push(n,o)}))}_applyOp(e){const t=e[0],n=e[1];if("number"!==typeof n)throw new Error("invalid increment number: ".concat(n));Object.prototype.hasOwnProperty.call(this._stats,t)||(this._stats[t]=BigInt(0)),this._stats[t]=BigInt(this._stats[t])+BigInt(n),null==this._frequencyAccumulators[t]&&(this._frequencyAccumulators[t]=0),this._frequencyAccumulators[t]+=n}}const Ry={enabled:!1,computeThrottleTimeout:1e3,computeThrottleMaxQueueSize:1e3,movingAverageIntervals:[6e4,3e5,9e5]};class Cy extends _y.EventEmitter{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ry;super(),je(this,"_initialCounters",void 0),je(this,"_options",void 0),je(this,"_enabled",void 0),je(this,"_global",void 0),je(this,"_peers",void 0);const r=Object.assign({},Ry,n);if("number"!==typeof r.computeThrottleTimeout)throw new Error("need computeThrottleTimeout");if("number"!==typeof r.computeThrottleMaxQueueSize)throw new Error("need computeThrottleMaxQueueSize");this._initialCounters=t,this._options=r,this._enabled=this._options.enabled,this._global=new Ty(t,r),this._global.on("update",(e=>this.emit("update",e))),this._peers=pg({name:"ipfs_bitswap_stats_peers",metrics:e.metrics})}enable(){this._enabled=!0,this._options.enabled=!0,this._global.enable()}disable(){this._enabled=!1,this._options.enabled=!1,this._global.disable()}stop(){this._enabled=!1,this._global.stop();for(const e of this._peers)e[1].stop()}get snapshot(){return this._global.snapshot}get movingAverages(){return this._global.movingAverages}forPeer(e){const t=e.toString();return this._peers.get(t)}push(e,t,n){if(this._enabled&&(this._global.push(t,n),null!=e)){let r=this._peers.get(e);null==r&&(r=new Ty(this._initialCounters,this._options),this._peers.set(e,r)),r.push(t,n)}}disconnected(e){const t=e.toString(),n=this._peers.get(t);null!=n&&(n.stop(),this._peers.delete(t))}}var xy=function(e,t,n){var r=null,i=null,o=function(){r&&(clearTimeout(r),i=null,r=null)},s=function(){if(!t)return e.apply(this,arguments);var s=this,a=arguments,l=n&&!r;return o(),i=function(){e.apply(s,a)},r=setTimeout((function(){if(r=null,!l){var e=i;return i=null,e()}}),t),l?i():void 0};return s.cancel=o,s.flush=function(){var e=i;o(),e&&e()},s};class Py{constructor(e,t,n){je(this,"peerId",void 0),je(this,"refcnt",void 0),je(this,"network",void 0),je(this,"_entries",void 0),je(this,"_log",void 0),this.peerId=t,this.network=n,this.refcnt=1,this._entries=[],this._log=Jg(e,"msgqueue"),this.sendEntries=xy(this.sendEntries.bind(this),1)}addMessage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.empty||this.send(e,t)}addEntries(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._entries=this._entries.concat(e),this.sendEntries(t)}sendEntries(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(0===this._entries.length)return;const t=new ry(!1);this._entries.forEach((e=>{!0===e.cancel?t.cancel(e.cid):t.addEntry(e.cid,e.priority)})),this._entries=[],this.addMessage(t,e)}async send(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{await this.network.connectTo(this.peerId,t)}catch(n){return void this._log.error("cant connect to peer %p: %s",this.peerId,n.message)}this._log("sending message to peer %p",this.peerId),this.network.sendMessage(this.peerId,e,t).catch((e=>{this._log.error("send error",e)}))}}class Dy{constructor(e,t,n,r){je(this,"peers",void 0),je(this,"wantlist",void 0),je(this,"network",void 0),je(this,"_peerId",void 0),je(this,"_log",void 0),this.peers=pg({name:"ipfs_bitswap_want_manager_peers",metrics:r.metrics}),this.wantlist=new sy(n,r),this.network=t,this._peerId=e,this._log=Jg(e,"want")}_addEntries(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=e.map(((e,n)=>new ry.Entry(e,vy-n,ry.WantType.Block,t)));i.forEach((e=>{e.cancel?!0===n?this.wantlist.removeForce(e.cid.toString(St)):this.wantlist.remove(e.cid):(this._log("adding to wantlist"),this.wantlist.add(e.cid,e.priority))}));for(const o of this.peers.values())o.addEntries(i,r)}_startPeerHandler(e){let t=this.peers.get(e.toString());if(null!=t)return void t.refcnt++;t=new Py(this._peerId,e,this.network);const n=new ry(!0);for(const r of this.wantlist.entries())n.addEntry(r[1].cid,r[1].priority);return t.addMessage(n),this.peers.set(e.toString(),t),t}_stopPeerHandler(e){const t=this.peers.get(e.toString());null!=t&&(t.refcnt--,t.refcnt>0||this.peers.delete(e.toString()))}wantBlocks(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._addEntries(e,!1,!1,n),null===(t=n.signal)||void 0===t||t.addEventListener("abort",(()=>{this.cancelWants(e)}))}unwantBlocks(e){this._log("unwant blocks: %s",e.length),this._addEntries(e,!0,!0)}cancelWants(e){this._log("cancel wants: %s",e.length),this._addEntries(e,!0)}connectedPeers(){return Array.from(this.peers.keys())}connected(e){this._startPeerHandler(e)}disconnected(e){this._stopPeerHandler(e)}start(){}stop(){this.peers.forEach((e=>{this.disconnected(e.peerId)}))}}const Ny={maxInboundStreams:1024,maxOutboundStreams:1024,incomingStreamTimeout:3e4,hashLoader:{async getHasher(){throw new Error("Not implemented")}},statsEnabled:!1,statsComputeThrottleTimeout:1e3,statsComputeThrottleMaxQueueSize:1e3},By=["blocksReceived","dataReceived","dupBlksReceived","dupDataReceived","blocksSent","dataSent","providesBufferLength","wantListLength","peerCount"];class Ly{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};je(this,"_libp2p",void 0),je(this,"_log",void 0),je(this,"stats",void 0),je(this,"network",void 0),je(this,"blockstore",void 0),je(this,"engine",void 0),je(this,"wm",void 0),je(this,"notifications",void 0),je(this,"started",void 0),this._libp2p=e,this._log=Jg(this.peerId),n=Object.assign({},Ny,n),this.stats=new Cy(e,By,{enabled:n.statsEnabled,computeThrottleTimeout:n.statsComputeThrottleTimeout,computeThrottleMaxQueueSize:n.statsComputeThrottleMaxQueueSize}),this.network=new Ey(e,this,this.stats,{hashLoader:n.hashLoader,maxInboundStreams:n.maxInboundStreams,maxOutboundStreams:n.maxOutboundStreams,incomingStreamTimeout:n.incomingStreamTimeout}),this.blockstore=t,this.engine=new gy(this.peerId,t,this.network,this.stats,e),this.wm=new Dy(this.peerId,this.network,this.stats,e),this.notifications=new Ay(this.peerId),this.started=!1}isStarted(){return this.started}get peerId(){return this._libp2p.peerId}async _receiveMessage(e,t){try{await this.engine.messageReceived(e,t)}catch(r){this._log("failed to receive message",t)}if(0===t.blocks.size)return;const n=[];for(const[i,o]of t.blocks.entries()){const e=Jt.parse(i);n.push({wasWanted:this.wm.wantlist.contains(e),cid:e,data:o})}this.wm.cancelWants(n.filter((e=>{let{wasWanted:t}=e;return t})).map((e=>{let{cid:t}=e;return t}))),await Promise.all(n.map((async t=>{let{cid:n,wasWanted:r,data:i}=t;await this._handleReceivedBlock(e,n,i,r)})))}async _handleReceivedBlock(e,t,n,r){this._log("received block");const i=await this.blockstore.has(t);this._updateReceiveCounters(e.toString(),t,n,i),r&&await this.put(t,n)}_updateReceiveCounters(e,t,n,r){this.stats.push(e,"blocksReceived",1),this.stats.push(e,"dataReceived",n.length),r&&(this.stats.push(e,"dupBlksReceived",1),this.stats.push(e,"dupDataReceived",n.length))}_receiveError(e){this._log.error("ReceiveError",e)}_onPeerConnected(e){this.wm.connected(e)}_onPeerDisconnected(e){this.wm.disconnected(e),this.engine.peerDisconnected(e),this.stats.disconnected(e)}enableStats(){this.stats.enable()}disableStats(){this.stats.disable()}wantlistForPeer(e,t){return this.engine.wantlistForPeer(e)}ledgerForPeer(e){return this.engine.ledgerForPeer(e)}async want(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=async(e,t)=>(this.wm.wantBlocks([e],t),this.notifications.wantBlock(e,t));let r=!1;const i=async(e,t)=>{try{return await this.blockstore.get(e,t)}catch(i){if("ERR_NOT_FOUND"!==i.code)throw i;return r||(r=!0,this.network.findAndConnect(e,t).catch((e=>{this._log.error(e)}))),await n(e,t)}},o=new AbortController,s=Xp([o.signal,t.signal]);try{return await Promise.race([this.notifications.wantBlock(e,{...t,signal:s}),i(e,{...t,signal:s})])}finally{o.abort(),s.clear()}}unwant(e){const t=Array.isArray(e)?e:[e];this.wm.unwantBlocks(t),t.forEach((e=>{this.notifications.unwantBlock(e)}))}cancelWants(e){this.wm.cancelWants(Array.isArray(e)?e:[e])}async put(e,t,n){await this.blockstore.put(e,t),this.notify(e,t)}async*putMany(e,t){yield*this.blockstore.putMany(Gg(e,(e=>{let{cid:t,block:n}=e;this.notify(t,n)})),t)}notify(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.notifications.hasBlock(e,t),this.engine.receivedBlocks([{cid:e,block:t}]),this.network.provide(e,n).catch((e=>{this._log.error("Failed to provide: %s",e.message)}))}getWantlist(){return this.wm.wantlist.entries()}get peers(){return this.engine.peers()}async start(){this.wm.start(),await this.network.start(),this.engine.start(),this.started=!0}async stop(){this.stats.stop(),this.wm.stop(),await this.network.stop(),this.engine.stop(),this.started=!1}}class Oy{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};je(this,"bitswap",void 0),je(this,"started",void 0);const{libp2p:n,blockstore:r,hashers:i}=e;this.bitswap=function(e,t){return new Ly(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}(n,r,{hashLoader:{getHasher:async e=>{let t;if(t="string"===typeof e?Object.values(i).find((t=>t.name===e)):i[e],null!=t)return t;throw new Error('Could not load hasher for code/name "'.concat(e,'"'))}},...t}),this.started=!1}isStarted(){return this.started}async start(){await this.bitswap.start(),this.started=!0}async stop(){await this.bitswap.stop(),this.started=!1}announce(e,t,n){this.bitswap.notify(e,t,n)}async retrieve(e){let{validateFn:t,...n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.bitswap.want(e,n)}}function My(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>new Oy(t,e)}var Uy=new WeakMap,Fy=new WeakMap,Vy=new WeakMap,zy=new WeakMap;class Ky{constructor(e){je(this,"url",void 0),gu(this,Uy,0),gu(this,Fy,0),gu(this,Vy,0),gu(this,zy,0),this.url=e instanceof URL?e:new URL(e)}async getRawBlock(e,t){const n=this.url;if(n.pathname="/ipfs/".concat(e.toString()),n.search="?format=raw",!0===(null===t||void 0===t?void 0:t.aborted))throw new Error("Signal to fetch raw block for CID ".concat(e," from gateway ").concat(this.url," was aborted prior to fetch"));try{var r,i;Zu(Uy,this,(r=yu(Uy,this),r++,r));const s=await fetch(n.toString(),{signal:t,headers:{Accept:"application/vnd.ipld.raw"},cache:"force-cache"});var o;if(!s.ok)throw Zu(Fy,this,(o=yu(Fy,this),o++,o)),new Error("unable to fetch raw block for CID ".concat(e," from gateway ").concat(this.url));return Zu(zy,this,(i=yu(zy,this),i++,i)),new Uint8Array(await s.arrayBuffer())}catch(a){var s;if(!0===(null===t||void 0===t?void 0:t.aborted))throw new Error("fetching raw block for CID ".concat(e," from gateway ").concat(this.url," was aborted"));throw Zu(Fy,this,(s=yu(Fy,this),s++,s)),new Error("unable to fetch raw block for CID ".concat(e))}}reliability(){return 0===yu(Uy,this)?1:yu(Vy,this)>0?-1/0:yu(zy,this)/(yu(Uy,this)+3*yu(Fy,this))}incrementInvalidBlocks(){var e;Zu(Vy,this,(e=yu(Vy,this),e++,e))}}class jy{constructor(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};je(this,"gateways",void 0),je(this,"log",void 0),this.log=e.logger.forComponent("helia:trustless-gateway-block-broker"),this.gateways=(null!==(t=n.gateways)&&void 0!==t?t:Hy).map((e=>new Ky(e)))}async retrieve(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=this.gateways.sort(((e,t)=>t.reliability()-e.reliability())),r=[];for(const a of n){this.log("getting block for %c from %s",e,a.url);try{const n=await a.getRawBlock(e,t.signal);this.log.trace("got block for %c from %s",e,a.url);try{var i;await(null===(i=t.validateFn)||void 0===i?void 0:i.call(t,n))}catch(s){throw this.log.error("failed to validate block for %c from %s",e,a.url,s),a.incrementInvalidBlocks(),new Error("unable to validate block for CID ".concat(e," from gateway ").concat(a.url))}return n}catch(s){var o;if(this.log.error("failed to get block for %c from %s",e,a.url,s),s instanceof Error?r.push(s):r.push(new Error("unable to fetch raw block for CID ".concat(e," from gateway ").concat(a.url))),!0===(null===(o=t.signal)||void 0===o?void 0:o.aborted)){this.log.trace("request aborted while fetching raw block for CID %c from gateway %s",e,a.url);break}}}throw new AggregateError(r,"unable to fetch raw block for CID ".concat(e," from any gateway"))}}const Hy=["https://trustless-gateway.link","https://cloudflare-ipfs.com","https://4everland.io"];function qy(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>new jy(t,e)}class Wy{constructor(e){je(this,"libp2p",void 0),this.libp2p=e}async provide(e,t){await this.libp2p.contentRouting.provide(e,t)}async*findProviders(e,t){yield*this.libp2p.contentRouting.findProviders(e,t)}async put(e,t,n){await this.libp2p.contentRouting.put(e,t,n)}async get(e,t){return this.libp2p.contentRouting.get(e,t)}async findPeer(e,t){return this.libp2p.peerRouting.findPeer(e,t)}async*getClosestPeers(e,t){yield*this.libp2p.peerRouting.getClosestPeers(e,t)}}function Gy(e){return new Wy(e)}const Yy=["string","number","bigint","symbol"],Qy=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function Xy(e){if(null===e)return"null";if(void 0===e)return"undefined";if(!0===e||!1===e)return"boolean";const t=typeof e;if(Yy.includes(t))return t;if("function"===t)return"Function";if(Array.isArray(e))return"Array";if(function(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}(e))return"Buffer";const n=function(e){const t=Object.prototype.toString.call(e).slice(8,-1);if(Qy.includes(t))return t;return}(e);return n||"Object"}class Jy{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return"Type[".concat(this.major,"].").concat(this.name)}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}Jy.uint=new Jy(0,"uint",!0),Jy.negint=new Jy(1,"negint",!0),Jy.bytes=new Jy(2,"bytes",!0),Jy.string=new Jy(3,"string",!0),Jy.array=new Jy(4,"array",!1),Jy.map=new Jy(5,"map",!1),Jy.tag=new Jy(6,"tag",!1),Jy.float=new Jy(7,"float",!0),Jy.false=new Jy(7,"false",!0),Jy.true=new Jy(7,"true",!0),Jy.null=new Jy(7,"null",!0),Jy.undefined=new Jy(7,"undefined",!0),Jy.break=new Jy(7,"break",!0);class $y{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return"Token[".concat(this.type,"].").concat(this.value)}}const Zy=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"===typeof globalThis.Buffer.isBuffer,ev=new TextDecoder,tv=new TextEncoder;function nv(e){return Zy&&globalThis.Buffer.isBuffer(e)}function rv(e){return e instanceof Uint8Array?nv(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}const iv=Zy?(e,t,n)=>n-t>64?globalThis.Buffer.from(e.subarray(t,n)).toString("utf8"):hv(e,t,n):(e,t,n)=>n-t>64?ev.decode(e.subarray(t,n)):hv(e,t,n),ov=Zy?e=>e.length>64?globalThis.Buffer.from(e):uv(e):e=>e.length>64?tv.encode(e):uv(e),sv=e=>Uint8Array.from(e),av=Zy?(e,t,n)=>nv(e)?new Uint8Array(e.subarray(t,n)):e.slice(t,n):(e,t,n)=>e.slice(t,n),lv=Zy?(e,t)=>(e=e.map((e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e))),rv(globalThis.Buffer.concat(e,t))):(e,t)=>{const n=new Uint8Array(t);let r=0;for(let i of e)r+i.length>n.length&&(i=i.subarray(0,n.length-r)),n.set(i,r),r+=i.length;return n},cv=Zy?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function uv(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t}function hv(e,t,n){const r=[];for(;t<n;){const i=e[t];let o=null,s=i>239?4:i>223?3:i>191?2:1;if(t+s<=n){let n,r,a,l;switch(s){case 1:i<128&&(o=i);break;case 2:n=e[t+1],128===(192&n)&&(l=(31&i)<<6|63&n,l>127&&(o=l));break;case 3:n=e[t+1],r=e[t+2],128===(192&n)&&128===(192&r)&&(l=(15&i)<<12|(63&n)<<6|63&r,l>2047&&(l<55296||l>57343)&&(o=l));break;case 4:n=e[t+1],r=e[t+2],a=e[t+3],128===(192&n)&&128===(192&r)&&128===(192&a)&&(l=(15&i)<<18|(63&n)<<12|(63&r)<<6|63&a,l>65535&&l<1114112&&(o=l))}}null===o?(o=65533,s=1):o>65535&&(o-=65536,r.push(o>>>10&1023|55296),o=56320|1023&o),r.push(o),t+=s}return fv(r)}const dv=4096;function fv(e){const t=e.length;if(t<=dv)return String.fromCharCode.apply(String,e);let n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=dv));return n}class pv{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:256;this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const n=t.length-(this.maxCursor-this.cursor)-1;t.set(e,n)}else{if(t){const e=t.length-(this.maxCursor-this.cursor)-1;e<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=cv(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,null===this._initReuseChunk&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(){let e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(1===this.chunks.length){const n=this.chunks[0];t&&this.cursor>n.length/2?(e=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):e=av(n,0,this.cursor)}else e=lv(this.chunks,this.cursor);return t&&this.reset(),e}}const gv="CBOR decode error:",yv="CBOR encode error:",vv=[];function mv(e,t,n){if(e.length-t<n)throw new Error("".concat(gv," not enough data for type"))}vv[23]=1,vv[24]=2,vv[25]=3,vv[26]=5,vv[27]=9;const wv=[24,256,65536,4294967296,BigInt("18446744073709551616")];function bv(e,t,n){mv(e,t,1);const r=e[t];if(!0===n.strict&&r<wv[0])throw new Error("".concat(gv," integer encoded in more bytes than necessary (strict decode)"));return r}function Ev(e,t,n){mv(e,t,2);const r=e[t]<<8|e[t+1];if(!0===n.strict&&r<wv[1])throw new Error("".concat(gv," integer encoded in more bytes than necessary (strict decode)"));return r}function _v(e,t,n){mv(e,t,4);const r=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(!0===n.strict&&r<wv[2])throw new Error("".concat(gv," integer encoded in more bytes than necessary (strict decode)"));return r}function Sv(e,t,n){mv(e,t,8);const r=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],i=16777216*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],o=(BigInt(r)<<BigInt(32))+BigInt(i);if(!0===n.strict&&o<wv[3])throw new Error("".concat(gv," integer encoded in more bytes than necessary (strict decode)"));if(o<=Number.MAX_SAFE_INTEGER)return Number(o);if(!0===n.allowBigInt)return o;throw new Error("".concat(gv," integers outside of the safe integer range are not supported"))}function kv(e,t){return Av(e,0,t.value)}function Av(e,t,n){if(n<wv[0]){const r=Number(n);e.push([t|r])}else if(n<wv[1]){const r=Number(n);e.push([24|t,r])}else if(n<wv[2]){const r=Number(n);e.push([25|t,r>>>8,255&r])}else if(n<wv[3]){const r=Number(n);e.push([26|t,r>>>24&255,r>>>16&255,r>>>8&255,255&r])}else{const r=BigInt(n);if(!(r<wv[4]))throw new Error("".concat(gv," encountered BigInt larger than allowable range"));{const n=[27|t,0,0,0,0,0,0,0];let i=Number(r&BigInt(4294967295)),o=Number(r>>BigInt(32)&BigInt(4294967295));n[8]=255&i,i>>=8,n[7]=255&i,i>>=8,n[6]=255&i,i>>=8,n[5]=255&i,n[4]=255&o,o>>=8,n[3]=255&o,o>>=8,n[2]=255&o,o>>=8,n[1]=255&o,e.push(n)}}}kv.encodedSize=function(e){return Av.encodedSize(e.value)},Av.encodedSize=function(e){return e<wv[0]?1:e<wv[1]?2:e<wv[2]?3:e<wv[3]?5:9},kv.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};const Iv=BigInt(-1),Tv=BigInt(1);function Rv(e,t){const n=t.value,r="bigint"===typeof n?n*Iv-Tv:-1*n-1;Av(e,t.type.majorEncoded,r)}function Cv(e,t,n,r){mv(e,t,n+r);const i=av(e,t+n,t+n+r);return new $y(Jy.bytes,i,n+r)}function xv(e,t,n,r){return Cv(e,t,1,n)}function Pv(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===Jy.string?ov(e.value):e.value),e.encodedBytes}function Dv(e,t){const n=Pv(t);Av(e,t.type.majorEncoded,n.length),e.push(n)}function Nv(e,t,n,r,i){const o=n+r;mv(e,t,o);const s=new $y(Jy.string,iv(e,t+n,t+o),o);return!0===i.retainStringBytes&&(s.byteValue=av(e,t+n,t+o)),s}function Bv(e,t,n,r){return Nv(e,t,1,n,r)}Rv.encodedSize=function(e){const t=e.value,n="bigint"===typeof t?t*Iv-Tv:-1*t-1;return n<wv[0]?1:n<wv[1]?2:n<wv[2]?3:n<wv[3]?5:9},Rv.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0},Dv.encodedSize=function(e){const t=Pv(e);return Av.encodedSize(t.length)+t.length},Dv.compareTokens=function(e,t){return n=Pv(e),r=Pv(t),n.length<r.length?-1:n.length>r.length?1:function(e,t){if(nv(e)&&nv(t))return e.compare(t);for(let n=0;n<e.length;n++)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return 0}(n,r);var n,r};const Lv=Dv;function Ov(e,t,n,r){return new $y(Jy.array,r,n)}function Mv(e,t,n,r){return Ov(0,0,1,n)}function Uv(e,t){Av(e,Jy.array.majorEncoded,t.value)}function Fv(e,t,n,r){return new $y(Jy.map,r,n)}function Vv(e,t,n,r){return Fv(0,0,1,n)}function zv(e,t){Av(e,Jy.map.majorEncoded,t.value)}function Kv(e,t,n,r){return new $y(Jy.tag,n,1)}function jv(e,t){Av(e,Jy.tag.majorEncoded,t.value)}Uv.compareTokens=kv.compareTokens,Uv.encodedSize=function(e){return Av.encodedSize(e.value)},zv.compareTokens=kv.compareTokens,zv.encodedSize=function(e){return Av.encodedSize(e.value)},jv.compareTokens=kv.compareTokens,jv.encodedSize=function(e){return Av.encodedSize(e.value)};const Hv=20,qv=21,Wv=22,Gv=23;function Yv(e,t,n){if(n){if(!1===n.allowNaN&&Number.isNaN(e))throw new Error("".concat(gv," NaN values are not supported"));if(!1===n.allowInfinity&&(e===1/0||e===-1/0))throw new Error("".concat(gv," Infinity values are not supported"))}return new $y(Jy.float,e,t)}function Qv(e,t,n){const r=t.value;if(!1===r)e.push([Jy.float.majorEncoded|Hv]);else if(!0===r)e.push([Jy.float.majorEncoded|qv]);else if(null===r)e.push([Jy.float.majorEncoded|Wv]);else if(void 0===r)e.push([Jy.float.majorEncoded|Gv]);else{let t,o=!1;n&&!0===n.float64||(Zv(r),t=em($v,1),r===t||Number.isNaN(r)?($v[0]=249,e.push($v.slice(0,3)),o=!0):(tm(r),t=nm($v,1),r===t&&($v[0]=250,e.push($v.slice(0,5)),o=!0))),o||(i=r,Jv.setFloat64(0,i,!1),t=rm($v,1),$v[0]=251,e.push($v.slice(0,9)))}var i}Qv.encodedSize=function(e,t){const n=e.value;if(!1===n||!0===n||null===n||void 0===n)return 1;if(!t||!0!==t.float64){Zv(n);let e=em($v,1);if(n===e||Number.isNaN(n))return 3;if(tm(n),e=nm($v,1),n===e)return 5}return 9};const Xv=new ArrayBuffer(9),Jv=new DataView(Xv,1),$v=new Uint8Array(Xv,0);function Zv(e){if(e===1/0)Jv.setUint16(0,31744,!1);else if(e===-1/0)Jv.setUint16(0,64512,!1);else if(Number.isNaN(e))Jv.setUint16(0,32256,!1);else{Jv.setFloat32(0,e);const t=Jv.getUint32(0),n=(2139095040&t)>>23,r=8388607&t;if(255===n)Jv.setUint16(0,31744,!1);else if(0===n)Jv.setUint16(0,(2147483648&e)>>16|r>>13,!1);else{const e=n-127;e<-24?Jv.setUint16(0,0):e<-14?Jv.setUint16(0,(2147483648&t)>>16|1<<24+e,!1):Jv.setUint16(0,(2147483648&t)>>16|e+15<<10|r>>13,!1)}}}function em(e,t){if(e.length-t<2)throw new Error("".concat(gv," not enough data for float16"));const n=(e[t]<<8)+e[t+1];if(31744===n)return 1/0;if(64512===n)return-1/0;if(32256===n)return NaN;const r=n>>10&31,i=1023&n;let o;return o=0===r?i*2**-24:31!==r?(i+1024)*2**(r-25):0===i?1/0:NaN,32768&n?-o:o}function tm(e){Jv.setFloat32(0,e,!1)}function nm(e,t){if(e.length-t<4)throw new Error("".concat(gv," not enough data for float32"));const n=(e.byteOffset||0)+t;return new DataView(e.buffer,n,4).getFloat32(0,!1)}function rm(e,t){if(e.length-t<8)throw new Error("".concat(gv," not enough data for float64"));const n=(e.byteOffset||0)+t;return new DataView(e.buffer,n,8).getFloat64(0,!1)}function im(e,t,n){throw new Error("".concat(gv," encountered invalid minor (").concat(n,") for major ").concat(e[t]>>>5))}function om(e){return()=>{throw new Error("".concat(gv," ").concat(e))}}Qv.compareTokens=kv.compareTokens;const sm=[];for(let n=0;n<=23;n++)sm[n]=im;sm[24]=function(e,t,n,r){return new $y(Jy.uint,bv(e,t+1,r),2)},sm[25]=function(e,t,n,r){return new $y(Jy.uint,Ev(e,t+1,r),3)},sm[26]=function(e,t,n,r){return new $y(Jy.uint,_v(e,t+1,r),5)},sm[27]=function(e,t,n,r){return new $y(Jy.uint,Sv(e,t+1,r),9)},sm[28]=im,sm[29]=im,sm[30]=im,sm[31]=im;for(let n=32;n<=55;n++)sm[n]=im;sm[56]=function(e,t,n,r){return new $y(Jy.negint,-1-bv(e,t+1,r),2)},sm[57]=function(e,t,n,r){return new $y(Jy.negint,-1-Ev(e,t+1,r),3)},sm[58]=function(e,t,n,r){return new $y(Jy.negint,-1-_v(e,t+1,r),5)},sm[59]=function(e,t,n,r){const i=Sv(e,t+1,r);if("bigint"!==typeof i){const e=-1-i;if(e>=Number.MIN_SAFE_INTEGER)return new $y(Jy.negint,e,9)}if(!0!==r.allowBigInt)throw new Error("".concat(gv," integers outside of the safe integer range are not supported"));return new $y(Jy.negint,Iv-BigInt(i),9)},sm[60]=im,sm[61]=im,sm[62]=im,sm[63]=im;for(let n=64;n<=87;n++)sm[n]=xv;sm[88]=function(e,t,n,r){return Cv(e,t,2,bv(e,t+1,r))},sm[89]=function(e,t,n,r){return Cv(e,t,3,Ev(e,t+1,r))},sm[90]=function(e,t,n,r){return Cv(e,t,5,_v(e,t+1,r))},sm[91]=function(e,t,n,r){const i=Sv(e,t+1,r);if("bigint"===typeof i)throw new Error("".concat(gv," 64-bit integer bytes lengths not supported"));return Cv(e,t,9,i)},sm[92]=im,sm[93]=im,sm[94]=im,sm[95]=om("indefinite length bytes/strings are not supported");for(let n=96;n<=119;n++)sm[n]=Bv;sm[120]=function(e,t,n,r){return Nv(e,t,2,bv(e,t+1,r),r)},sm[121]=function(e,t,n,r){return Nv(e,t,3,Ev(e,t+1,r),r)},sm[122]=function(e,t,n,r){return Nv(e,t,5,_v(e,t+1,r),r)},sm[123]=function(e,t,n,r){const i=Sv(e,t+1,r);if("bigint"===typeof i)throw new Error("".concat(gv," 64-bit integer string lengths not supported"));return Nv(e,t,9,i,r)},sm[124]=im,sm[125]=im,sm[126]=im,sm[127]=om("indefinite length bytes/strings are not supported");for(let n=128;n<=151;n++)sm[n]=Mv;sm[152]=function(e,t,n,r){return Ov(0,0,2,bv(e,t+1,r))},sm[153]=function(e,t,n,r){return Ov(0,0,3,Ev(e,t+1,r))},sm[154]=function(e,t,n,r){return Ov(0,0,5,_v(e,t+1,r))},sm[155]=function(e,t,n,r){const i=Sv(e,t+1,r);if("bigint"===typeof i)throw new Error("".concat(gv," 64-bit integer array lengths not supported"));return Ov(0,0,9,i)},sm[156]=im,sm[157]=im,sm[158]=im,sm[159]=function(e,t,n,r){if(!1===r.allowIndefinite)throw new Error("".concat(gv," indefinite length items not allowed"));return Ov(0,0,1,1/0)};for(let n=160;n<=183;n++)sm[n]=Vv;sm[184]=function(e,t,n,r){return Fv(0,0,2,bv(e,t+1,r))},sm[185]=function(e,t,n,r){return Fv(0,0,3,Ev(e,t+1,r))},sm[186]=function(e,t,n,r){return Fv(0,0,5,_v(e,t+1,r))},sm[187]=function(e,t,n,r){const i=Sv(e,t+1,r);if("bigint"===typeof i)throw new Error("".concat(gv," 64-bit integer map lengths not supported"));return Fv(0,0,9,i)},sm[188]=im,sm[189]=im,sm[190]=im,sm[191]=function(e,t,n,r){if(!1===r.allowIndefinite)throw new Error("".concat(gv," indefinite length items not allowed"));return Fv(0,0,1,1/0)};for(let n=192;n<=215;n++)sm[n]=Kv;sm[216]=function(e,t,n,r){return new $y(Jy.tag,bv(e,t+1,r),2)},sm[217]=function(e,t,n,r){return new $y(Jy.tag,Ev(e,t+1,r),3)},sm[218]=function(e,t,n,r){return new $y(Jy.tag,_v(e,t+1,r),5)},sm[219]=function(e,t,n,r){return new $y(Jy.tag,Sv(e,t+1,r),9)},sm[220]=im,sm[221]=im,sm[222]=im,sm[223]=im;for(let n=224;n<=243;n++)sm[n]=om("simple values are not supported");sm[244]=im,sm[245]=im,sm[246]=im,sm[247]=function(e,t,n,r){if(!1===r.allowUndefined)throw new Error("".concat(gv," undefined values are not supported"));return!0===r.coerceUndefinedToNull?new $y(Jy.null,null,1):new $y(Jy.undefined,void 0,1)},sm[248]=om("simple values are not supported"),sm[249]=function(e,t,n,r){return Yv(em(e,t+1),3,r)},sm[250]=function(e,t,n,r){return Yv(nm(e,t+1),5,r)},sm[251]=function(e,t,n,r){return Yv(rm(e,t+1),9,r)},sm[252]=im,sm[253]=im,sm[254]=im,sm[255]=function(e,t,n,r){if(!1===r.allowIndefinite)throw new Error("".concat(gv," indefinite length items not allowed"));return new $y(Jy.break,void 0,1)};const am=[];for(let n=0;n<24;n++)am[n]=new $y(Jy.uint,n,1);for(let n=-1;n>=-24;n--)am[31-n]=new $y(Jy.negint,n,1);am[64]=new $y(Jy.bytes,new Uint8Array(0),1),am[96]=new $y(Jy.string,"",1),am[128]=new $y(Jy.array,0,1),am[160]=new $y(Jy.map,0,1),am[244]=new $y(Jy.false,!1,1),am[245]=new $y(Jy.true,!0,1),am[246]=new $y(Jy.null,null,1);const lm={float64:!1,mapSorter:function(e,t){const n=Array.isArray(e[0])?e[0][0]:e[0],r=Array.isArray(t[0])?t[0][0]:t[0];if(n.type!==r.type)return n.type.compare(r.type);const i=n.type.major,o=cm[i].compareTokens(n,r);0===o&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone");return o},quickEncodeToken:function(e){switch(e.type){case Jy.false:return sv([244]);case Jy.true:return sv([245]);case Jy.null:return sv([246]);case Jy.bytes:return e.value.length?void 0:sv([64]);case Jy.string:return""===e.value?sv([96]):void 0;case Jy.array:return 0===e.value?sv([128]):void 0;case Jy.map:return 0===e.value?sv([160]):void 0;case Jy.uint:return e.value<24?sv([Number(e.value)]):void 0;case Jy.negint:if(e.value>=-24)return sv([31-Number(e.value)])}}};const cm=function(){const e=[];return e[Jy.uint.major]=kv,e[Jy.negint.major]=Rv,e[Jy.bytes.major]=Dv,e[Jy.string.major]=Lv,e[Jy.array.major]=Uv,e[Jy.map.major]=zv,e[Jy.tag.major]=jv,e[Jy.float.major]=Qv,e}(),um=new pv;class hm{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do{if(t.obj===e)return!0}while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error("".concat(yv," object contains circular references"));return new hm(t,e)}}const dm={null:new $y(Jy.null,null),undefined:new $y(Jy.undefined,void 0),true:new $y(Jy.true,!0),false:new $y(Jy.false,!1),emptyArray:new $y(Jy.array,0),emptyMap:new $y(Jy.map,0)},fm={number:(e,t,n,r)=>Number.isInteger(e)&&Number.isSafeInteger(e)?new $y(e>=0?Jy.uint:Jy.negint,e):new $y(Jy.float,e),bigint:(e,t,n,r)=>e>=BigInt(0)?new $y(Jy.uint,e):new $y(Jy.negint,e),Uint8Array:(e,t,n,r)=>new $y(Jy.bytes,e),string:(e,t,n,r)=>new $y(Jy.string,e),boolean:(e,t,n,r)=>e?dm.true:dm.false,null:(e,t,n,r)=>dm.null,undefined:(e,t,n,r)=>dm.undefined,ArrayBuffer:(e,t,n,r)=>new $y(Jy.bytes,new Uint8Array(e)),DataView:(e,t,n,r)=>new $y(Jy.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),Array(e,t,n,r){if(!e.length)return!0===n.addBreakTokens?[dm.emptyArray,new $y(Jy.break)]:dm.emptyArray;r=hm.createCheck(r,e);const i=[];let o=0;for(const s of e)i[o++]=pm(s,n,r);return n.addBreakTokens?[new $y(Jy.array,e.length),i,new $y(Jy.break)]:[new $y(Jy.array,e.length),i]},Object(e,t,n,r){const i="Object"!==t,o=i?e.keys():Object.keys(e),s=i?e.size:o.length;if(!s)return!0===n.addBreakTokens?[dm.emptyMap,new $y(Jy.break)]:dm.emptyMap;r=hm.createCheck(r,e);const a=[];let l=0;for(const c of o)a[l++]=[pm(c,n,r),pm(i?e.get(c):e[c],n,r)];return function(e,t){t.mapSorter&&e.sort(t.mapSorter)}(a,n),n.addBreakTokens?[new $y(Jy.map,s),a,new $y(Jy.break)]:[new $y(Jy.map,s),a]}};fm.Map=fm.Object,fm.Buffer=fm.Uint8Array;for(const n of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))fm["".concat(n,"Array")]=fm.DataView;function pm(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0;const r=Xy(e),i=t&&t.typeEncoders&&t.typeEncoders[r]||fm[r];if("function"===typeof i){const o=i(e,r,t,n);if(null!=o)return o}const o=fm[r];if(!o)throw new Error("".concat(yv," unsupported type: ").concat(r));return o(e,r,t,n)}function gm(e,t,n,r){if(Array.isArray(t))for(const i of t)gm(e,i,n,r);else n[t.type.major](e,t,r)}function ym(e,t,n){const r=pm(e,n);if(!Array.isArray(r)&&n.quickEncodeToken){const e=n.quickEncodeToken(r);if(e)return e;const i=t[r.type.major];if(i.encodedSize){const e=i.encodedSize(r,n),t=new pv(e);if(i(t,r,n),1!==t.chunks.length)throw new Error("Unexpected error: pre-calculated length for ".concat(r," was wrong"));return rv(t.chunks[0])}}return um.reset(),gm(um,r,t,n),um.toBytes(!0)}function vm(e,t){return t=Object.assign({},lm,t),ym(e,cm,t)}const mm={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class wm{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const e=this.data[this._pos];let t=am[e];if(void 0===t){const n=sm[e];if(!n)throw new Error("".concat(gv," no decoder for major type ").concat(e>>>5," (byte 0x").concat(e.toString(16).padStart(2,"0"),")"));const r=31&e;t=n(this.data,this._pos,r,this.options)}return this._pos+=t.encodedLength,t}}const bm=Symbol.for("DONE"),Em=Symbol.for("BREAK");function _m(e,t){if(e.done())return bm;const n=e.next();if(n.type===Jy.break)return Em;if(n.type.terminal)return n.value;if(n.type===Jy.array)return function(e,t,n){const r=[];for(let i=0;i<e.value;i++){const o=_m(t,n);if(o===Em){if(e.value===1/0)break;throw new Error("".concat(gv," got unexpected break to lengthed array"))}if(o===bm)throw new Error("".concat(gv," found array but not enough entries (got ").concat(i,", expected ").concat(e.value,")"));r[i]=o}return r}(n,e,t);if(n.type===Jy.map)return function(e,t,n){const r=!0===n.useMaps,i=r?void 0:{},o=r?new Map:void 0;for(let s=0;s<e.value;s++){const a=_m(t,n);if(a===Em){if(e.value===1/0)break;throw new Error("".concat(gv," got unexpected break to lengthed map"))}if(a===bm)throw new Error("".concat(gv," found map but not enough entries (got ").concat(s," [no key], expected ").concat(e.value,")"));if(!0!==r&&"string"!==typeof a)throw new Error("".concat(gv," non-string keys not supported (got ").concat(typeof a,")"));if(!0===n.rejectDuplicateMapKeys&&(r&&o.has(a)||!r&&a in i))throw new Error("".concat(gv,' found repeat map key "').concat(a,'"'));const l=_m(t,n);if(l===bm)throw new Error("".concat(gv," found map but not enough entries (got ").concat(s," [no value], expected ").concat(e.value,")"));r?o.set(a,l):i[a]=l}return r?o:i}(n,e,t);if(n.type===Jy.tag){if(t.tags&&"function"===typeof t.tags[n.value]){const r=_m(e,t);return t.tags[n.value](r)}throw new Error("".concat(gv," tag not supported (").concat(n.value,")"))}throw new Error("unsupported")}function Sm(e,t){const[n,r]=function(e,t){if(!(e instanceof Uint8Array))throw new Error("".concat(gv," data to decode must be a Uint8Array"));const n=(t=Object.assign({},mm,t)).tokenizer||new wm(e,t),r=_m(n,t);if(r===bm)throw new Error("".concat(gv," did not find any content to decode"));if(r===Em)throw new Error("".concat(gv," got unexpected break"));return[r,e.subarray(n.pos())]}(e,t);if(r.length>0)throw new Error("".concat(gv," too many terminals, data makes no sense"));return n}const km="/pin/",Am="/pinned-block/",Im=Wn;function Tm(e){return 0===e.version&&(e=e.toV1()),new Er("".concat(km).concat(e.toString(Im)))}var Rm=new WeakSet;class Cm{constructor(e,t,n){Ve(this,Rm),je(this,"datastore",void 0),je(this,"blockstore",void 0),je(this,"dagWalkers",void 0),this.datastore=e,this.blockstore=t,this.dagWalkers=n}add(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(r,i){const o=Tm(e);if(await t.datastore.has(o))throw new Error("Already pinned");const s=Math.round(null!==(r=n.depth)&&void 0!==r?r:1/0);if(s<0)throw new Error("Depth must be greater than or equal to 0");const a=new jp({concurrency:1});for await(const c of He(Rm,t,xm).call(t,e,a,{...n,depth:s}))await He(Rm,t,Pm).call(t,c,(t=>null==t.pinnedBy.find((t=>Hr(t,e.bytes)))&&(t.pinCount++,t.pinnedBy.push(e.bytes),!0)),n),yield c;const l={depth:s,metadata:null!==(i=n.metadata)&&void 0!==i?i:{}};await t.datastore.put(o,vm(l),n)}()}catch(n){return Promise.reject(n)}}rm(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){const r=Tm(e),i=Sm(await t.datastore.get(r,n));await t.datastore.delete(r,n);const o=new jp({concurrency:1});for await(const s of He(Rm,t,xm).call(t,e,o,{...n,depth:i.depth}))await He(Rm,t,Pm).call(t,s,(t=>(t.pinCount--,t.pinnedBy=t.pinnedBy.filter((t=>Hr(t,e.bytes))),!0)),{...n,depth:i.depth}),yield s}()}catch(n){return Promise.reject(n)}}ls(){try{var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async function*(){for await(const{key:n,value:r}of e.datastore.query({prefix:km+(null!=t.cid?"".concat(t.cid.toString(Wn)):"")},t)){const e=Jt.parse(n.toString().substring(5),Wn),t=Sm(r);yield{cid:e,...t}}}()}catch(t){return Promise.reject(t)}}async isPinned(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=new Er("".concat(Am).concat(Im.encode(e.multihash.bytes)));return this.datastore.has(n,t)}}async function*xm(e,t,n){if(-1===n.depth)return;const r=this.dagWalkers[e.code];if(null==r)throw new Error("No dag walker found for cid codec ".concat(e.code));const i=await this.blockstore.get(e,n);yield e;for await(const o of r.walk(i))yield*await t.add((async()=>He(Rm,this,xm).call(this,o,t,{...n,depth:n.depth-1})))}async function Pm(e,t,n){var r;const i=new Er("".concat(Am).concat(Im.encode(e.multihash.bytes)));let o={pinCount:0,pinnedBy:[]};try{o=Sm(await this.datastore.get(i,n))}catch(s){if("ERR_NOT_FOUND"!==s.code)throw s}t(o)&&(0===o.pinCount&&await this.datastore.has(i)?await this.datastore.delete(i):(await this.datastore.put(i,vm(o),n),null===(r=n.onProgress)||void 0===r||r.call(n,new fp("helia:pin:add",e))))}class Dm{constructor(e,t){var n;je(this,"log",void 0),je(this,"routers",void 0),this.log=e.logger.forComponent("helia:routing"),this.routers=null!==(n=t.routers)&&void 0!==n?n:[]}async start(){await vf(...this.routers)}async stop(){await mf(...this.routers)}findProviders(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){if(0===t.routers.length)throw new Mr("No content routers available","ERR_NO_ROUTERS_AVAILABLE");const r=new zu;for await(const i of kn(...Nm(t.routers,"findProviders").map((t=>t.findProviders(e,n)))))null!=i&&(r.has(i.id)||(r.add(i.id),yield i))}()}catch(n){return Promise.reject(n)}}async provide(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(0===this.routers.length)throw new Mr("No content routers available","ERR_NO_ROUTERS_AVAILABLE");await Promise.all(Nm(this.routers,"provide").map((async n=>{await n.provide(e,t)})))}async put(e,t,n){await Promise.all(Nm(this.routers,"put").map((async r=>{await r.put(e,t,n)})))}async get(e,t){return Promise.any(Nm(this.routers,"get").map((async n=>n.get(e,t))))}async findPeer(e,t){if(0===this.routers.length)throw new Mr("No peer routers available","ERR_NO_ROUTERS_AVAILABLE");const n=this,r=kn(...Nm(this.routers,"findPeer").map((r=>async function*(){try{yield await r.findPeer(e,t)}catch(i){n.log.error(i)}}())));for await(const i of r)if(null!=i)return i;throw new Mr("Could not find peer in routing","ERR_NOT_FOUND")}getClosestPeers(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){if(0===t.routers.length)throw new Mr("No peer routers available","ERR_NO_ROUTERS_AVAILABLE");const r=new zu;for await(const i of kn(...Nm(t.routers,"getClosestPeers").map((t=>t.getClosestPeers(e,n)))))null!=i&&(r.has(i.id)||(r.add(i.id),yield i))}()}catch(n){return Promise.reject(n)}}}function Nm(e,t){return e.filter((e=>null!=e[t]))}class Bm{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};je(this,"lock",void 0),je(this,"child",void 0),je(this,"pins",void 0),je(this,"started",void 0),this.child=e,this.pins=t,this.lock=Hd({singleProcess:n.holdGcLock}),this.started=!1}isStarted(){return this.started}async start(){await vf(this.child),this.started=!0}async stop(){await mf(this.child),this.started=!1}unwrap(){return this.child}async put(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=await this.lock.readLock();try{return await this.child.put(e,t,n)}finally{r()}}putMany(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){const r=await t.lock.readLock();try{yield*t.child.putMany(e,n)}finally{r()}}()}catch(n){return Promise.reject(n)}}async get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=await this.lock.readLock();try{return await this.child.get(e,t)}finally{n()}}getMany(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){const r=await t.lock.readLock();try{yield*t.child.getMany(e,n)}finally{r()}}()}catch(n){return Promise.reject(n)}}async delete(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=await this.lock.writeLock();try{if(await this.pins.isPinned(e))throw new Error("CID was pinned");await this.child.delete(e,t)}finally{n()}}deleteMany(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){const r=await t.lock.writeLock();try{const r=t;yield*t.child.deleteMany(async function*(){for await(const t of e){if(await r.pins.isPinned(t))throw new Error("CID was pinned");yield t}}(),n)}finally{r()}}()}catch(n){return Promise.reject(n)}}async has(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=await this.lock.readLock();try{return await this.child.has(e,t)}finally{n()}}getAll(){try{var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async function*(){const n=await e.lock.readLock();try{yield*e.child.getAll(t)}finally{n()}}()}catch(t){return Promise.reject(t)}}}function Lm(e){return e instanceof ArrayBuffer?new Uint8Array(e,0,e.byteLength):e}const Om={float64:!0,typeEncoders:{Object:function(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;const t=Jt.asCID(e);if(!t)return null;const n=new Uint8Array(t.bytes.byteLength+1);return n.set(t.bytes,1),[new $y(Jy.tag,42),new $y(Jy.bytes,n)]},undefined:function(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")},number:function(e){if(Number.isNaN(e))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}}},Mm={...Om,typeEncoders:{...Om.typeEncoders}};const Um={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};Um.tags[42]=function(e){if(0!==e[0])throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return Jt.decode(e.subarray(1))};const Fm={...Um,tags:Um.tags.slice()},Vm="dag-cbor",zm=113,Km=e=>vm(e,Om),jm=e=>Sm(Lm(e),Um);Jy.uint.major,Jy.negint.major,Jy.bytes.major,Jy.string.major,Jy.array.major,Jy.map.major,Jy.tag.major,Jy.float.major;class Hm{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;32===e||9===e||13===e||10===e;)e=this.data[++this._pos]}expect(e){if(this.data.length-this._pos<e.length)throw new Error("".concat(gv," unexpected end of input at position ").concat(this._pos));for(let t=0;t<e.length;t++)if(this.data[this._pos++]!==e[t])throw new Error("".concat(gv," unexpected token at position ").concat(this._pos,", expected to find '").concat(String.fromCharCode(...e),"'"))}parseNumber(){const e=this._pos;let t=!1,n=!1;const r=e=>{for(;!this.done();){const t=this.ch();if(!e.includes(t))break;this._pos++}};if(45===this.ch()&&(t=!0,this._pos++),48===this.ch()){if(this._pos++,46!==this.ch())return new $y(Jy.uint,0,this._pos-e);this._pos++,n=!0}if(r([48,49,50,51,52,53,54,55,56,57]),t&&this._pos===e+1)throw new Error("".concat(gv," unexpected token at position ").concat(this._pos));if(!this.done()&&46===this.ch()){if(n)throw new Error("".concat(gv," unexpected token at position ").concat(this._pos));n=!0,this._pos++,r([48,49,50,51,52,53,54,55,56,57])}this.done()||101!==this.ch()&&69!==this.ch()||(n=!0,this._pos++,this.done()||43!==this.ch()&&45!==this.ch()||this._pos++,r([48,49,50,51,52,53,54,55,56,57]));const i=String.fromCharCode.apply(null,this.data.subarray(e,this._pos)),o=parseFloat(i);return n?new $y(Jy.float,o,this._pos-e):!0!==this.options.allowBigInt||Number.isSafeInteger(o)?new $y(o>=0?Jy.uint:Jy.negint,o,this._pos-e):new $y(o>=0?Jy.uint:Jy.negint,BigInt(i),this._pos-e)}parseString(){if(34!==this.ch())throw new Error("".concat(gv," unexpected character at position ").concat(this._pos,"; this shouldn't happen"));this._pos++;for(let i=this._pos,o=0;i<this.data.length&&o<65536;i++,o++){const e=this.data[i];if(92===e||e<32||e>=128)break;if(34===e){const e=String.fromCharCode.apply(null,this.data.subarray(this._pos,i));return this._pos=i+1,new $y(Jy.string,e,o)}}const e=this._pos,t=[],n=()=>{if(this._pos+4>=this.data.length)throw new Error("".concat(gv," unexpected end of unicode escape sequence at position ").concat(this._pos));let e=0;for(let t=0;t<4;t++){let t=this.ch();if(t>=48&&t<=57)t-=48;else if(t>=97&&t<=102)t=t-97+10;else{if(!(t>=65&&t<=70))throw new Error("".concat(gv," unexpected unicode escape character at position ").concat(this._pos));t=t-65+10}e=16*e+t,this._pos++}return e},r=()=>{const e=this.ch();let n,r,i,o,s=null,a=e>239?4:e>223?3:e>191?2:1;if(this._pos+a>this.data.length)throw new Error("".concat(gv," unexpected unicode sequence at position ").concat(this._pos));switch(a){case 1:e<128&&(s=e);break;case 2:n=this.data[this._pos+1],128===(192&n)&&(o=(31&e)<<6|63&n,o>127&&(s=o));break;case 3:n=this.data[this._pos+1],r=this.data[this._pos+2],128===(192&n)&&128===(192&r)&&(o=(15&e)<<12|(63&n)<<6|63&r,o>2047&&(o<55296||o>57343)&&(s=o));break;case 4:n=this.data[this._pos+1],r=this.data[this._pos+2],i=this.data[this._pos+3],128===(192&n)&&128===(192&r)&&128===(192&i)&&(o=(15&e)<<18|(63&n)<<12|(63&r)<<6|63&i,o>65535&&o<1114112&&(s=o))}null===s?(s=65533,a=1):s>65535&&(s-=65536,t.push(s>>>10&1023|55296),s=56320|1023&s),t.push(s),this._pos+=a};for(;!this.done();){const i=this.ch();let o;switch(i){case 92:if(this._pos++,this.done())throw new Error("".concat(gv," unexpected string termination at position ").concat(this._pos));switch(o=this.ch(),this._pos++,o){case 34:case 39:case 92:case 47:t.push(o);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(n());break;default:throw new Error("".concat(gv," unexpected string escape character at position ").concat(this._pos))}break;case 34:return this._pos++,new $y(Jy.string,fv(t),this._pos-e);default:if(i<32)throw new Error("".concat(gv," invalid control character at position ").concat(this._pos));i<128?(t.push(i),this._pos++):r()}}throw new Error("".concat(gv," unexpected end of string at position ").concat(this._pos))}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new $y(Jy.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new $y(Jy.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new $y(Jy.null,null,4);case 102:return this.expect([102,97,108,115,101]),new $y(Jy.false,!1,5);case 116:return this.expect([116,114,117,101]),new $y(Jy.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error("".concat(gv," unexpected character at position ").concat(this._pos))}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":if(this.modeStack.pop(),93===this.ch())return this._pos++,this.skipWhitespace(),new $y(Jy.break,void 0,1);if(44!==this.ch())throw new Error("".concat(gv," unexpected character at position ").concat(this._pos,", was expecting array delimiter but found '").concat(String.fromCharCode(this.ch()),"'"));return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue();case"array-start":return this.modeStack.pop(),93===this.ch()?(this._pos++,this.skipWhitespace(),new $y(Jy.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(125===this.ch())return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new $y(Jy.break,void 0,1);if(44!==this.ch())throw new Error("".concat(gv," unexpected character at position ").concat(this._pos,", was expecting object delimiter but found '").concat(String.fromCharCode(this.ch()),"'"));this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),125===this.ch())return this._pos++,this.skipWhitespace(),new $y(Jy.break,void 0,1);const e=this.parseString();if(this.skipWhitespace(),58!==this.ch())throw new Error("".concat(gv," unexpected character at position ").concat(this._pos,", was expecting key/value delimiter ':' but found '").concat(String.fromCharCode(this.ch()),"'"));return this._pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error("".concat(gv," unexpected parse state at position ").concat(this._pos,"; this shouldn't happen"))}}}function qm(e,t){return Sm(e,t=Object.assign({tokenizer:new Hm(e,t)},t))}class Wm extends Hm{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return 0===this.tokenBuffer.length&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){const e=this._next();if(e.type===Jy.map){const e=this._next();if(e.type===Jy.string&&"/"===e.value){const e=this._next();if(e.type===Jy.string){if(this._next().type!==Jy.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(e),new $y(Jy.tag,42,0)}if(e.type===Jy.map){const e=this._next();if(e.type===Jy.string&&"bytes"===e.value){const e=this._next();if(e.type===Jy.string){for(let e=0;e<2;e++){if(this._next().type!==Jy.break)throw new Error("Invalid encoded Bytes form")}const t=cn.decode("m".concat(e.value));return new $y(Jy.bytes,t,e.value.length)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}return e}}const Gm={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};Gm.tags[42]=Jt.parse;const Ym=297,Qm=e=>{const t=function(e){return e instanceof ArrayBuffer?new Uint8Array(e,0,e.byteLength):e}(e);return qm(t,Object.assign(Gm,{tokenizer:new Wm(t,Gm)}))},Xm=(new TextDecoder,new TextEncoder,new TextDecoder);function Jm(e,t){let n=0;for(let r=0;;r+=7){if(r>=64)throw new Error("protobuf: varint overflow");if(t>=e.length)throw new Error("protobuf: unexpected end of data");const i=e[t++];if(n+=r<28?(127&i)<<r:(127&i)*2**r,i<128)break}return[n,t]}function $m(e,t){let n;[n,t]=Jm(e,t);const r=t+n;if(n<0||r<0)throw new Error("protobuf: invalid length");if(r>e.length)throw new Error("protobuf: unexpected end of data");return[e.subarray(t,r),r]}function Zm(e,t){let n;return[n,t]=Jm(e,t),[7&n,n>>3,t]}function ew(e){const t={},n=e.length;let r=0;for(;r<n;){let n,i;if([n,i,r]=Zm(e,r),1===i){if(t.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(2!==n)throw new Error("protobuf: (PBLink) wrong wireType (".concat(n,") for Hash"));if(void 0!==t.Name)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[t.Hash,r]=$m(e,r)}else if(2===i){if(void 0!==t.Name)throw new Error("protobuf: (PBLink) duplicate Name section");if(2!==n)throw new Error("protobuf: (PBLink) wrong wireType (".concat(n,") for Name"));if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let i;[i,r]=$m(e,r),t.Name=Xm.decode(i)}else{if(3!==i)throw new Error("protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ".concat(i));if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(0!==n)throw new Error("protobuf: (PBLink) wrong wireType (".concat(n,") for Tsize"));[t.Tsize,r]=Jm(e,r)}}if(r>n)throw new Error("protobuf: (PBLink) unexpected end of data");return t}const tw=new TextEncoder,nw=2**32,rw=2**31;function iw(e,t){let n=t.length;if("number"===typeof e.Tsize){if(e.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(e.Tsize))throw new Error("Tsize too large for encoding");n=aw(t,n,e.Tsize)-1,t[n]=24}if("string"===typeof e.Name){const r=tw.encode(e.Name);n-=r.length,t.set(r,n),n=aw(t,n,r.length)-1,t[n]=18}return e.Hash&&(n-=e.Hash.length,t.set(e.Hash,n),n=aw(t,n,e.Hash.length)-1,t[n]=10),t.length-n}function ow(e){const t=function(e){let t=0;if(e.Data){const n=e.Data.length;t+=1+n+lw(n)}if(e.Links)for(const n of e.Links){const e=sw(n);t+=1+e+lw(e)}return t}(e),n=new Uint8Array(t);let r=t;if(e.Data&&(r-=e.Data.length,n.set(e.Data,r),r=aw(n,r,e.Data.length)-1,n[r]=10),e.Links)for(let i=e.Links.length-1;i>=0;i--){const t=iw(e.Links[i],n.subarray(0,r));r-=t,r=aw(n,r,t)-1,n[r]=18}return n}function sw(e){let t=0;if(e.Hash){const n=e.Hash.length;t+=1+n+lw(n)}if("string"===typeof e.Name){const n=tw.encode(e.Name).length;t+=1+n+lw(n)}return"number"===typeof e.Tsize&&(t+=1+lw(e.Tsize)),t}function aw(e,t,n){const r=t-=lw(n);for(;n>=rw;)e[t++]=127&n|128,n/=128;for(;n>=128;)e[t++]=127&n|128,n>>>=7;return e[t]=n,r}function lw(e){return e%2===0&&e++,Math.floor((function(e){let t=0;e>=nw&&(e=Math.floor(e/nw),t=32);e>=65536&&(e>>>=16,t+=16);e>=256&&(e>>>=8,t+=8);return t+cw[e]}(e)+6)/7)}const cw=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],uw=["Data","Links"],hw=["Hash","Name","Tsize"],dw=new TextEncoder;function fw(e,t){if(e===t)return 0;const n=e.Name?dw.encode(e.Name):[],r=t.Name?dw.encode(t.Name):[];let i=n.length,o=r.length;for(let s=0,a=Math.min(i,o);s<a;++s)if(n[s]!==r[s]){i=n[s],o=r[s];break}return i<o?-1:o<i?1:0}function pw(e,t){return!Object.keys(e).some((e=>!t.includes(e)))}function gw(e){if("object"===typeof e.asCID){const t=Jt.asCID(e);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if("object"!==typeof e||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");const t={};if(e.Hash){let r=Jt.asCID(e.Hash);try{r||("string"===typeof e.Hash?r=Jt.parse(e.Hash):e.Hash instanceof Uint8Array&&(r=Jt.decode(e.Hash)))}catch(n){throw new TypeError("Invalid DAG-PB form: ".concat(n.message))}r&&(t.Hash=r)}if(!t.Hash)throw new TypeError("Invalid DAG-PB form");return"string"===typeof e.Name&&(t.Name=e.Name),"number"===typeof e.Tsize&&(t.Tsize=e.Tsize),t}function yw(e){if((e instanceof Uint8Array||"string"===typeof e)&&(e={Data:e}),"object"!==typeof e||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");const t={};if(void 0!==e.Data)if("string"===typeof e.Data)t.Data=dw.encode(e.Data);else{if(!(e.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form");t.Data=e.Data}if(void 0!==e.Links){if(!Array.isArray(e.Links))throw new TypeError("Invalid DAG-PB form");t.Links=e.Links.map(gw),t.Links.sort(fw)}else t.Links=[];return t}function vw(e){if(!e||"object"!==typeof e||Array.isArray(e)||e instanceof Uint8Array||e["/"]&&e["/"]===e.bytes)throw new TypeError("Invalid DAG-PB form");if(!pw(e,uw))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(void 0!==e.Data&&!(e.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(e.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let t=0;t<e.Links.length;t++){const n=e.Links[t];if(!n||"object"!==typeof n||Array.isArray(n)||n instanceof Uint8Array||n["/"]&&n["/"]===n.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!pw(n,hw))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(void 0===n.Hash)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(null==n.Hash||!n.Hash["/"]||n.Hash["/"]!==n.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(void 0!==n.Name&&"string"!==typeof n.Name)throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(void 0!==n.Tsize){if("number"!==typeof n.Tsize||n.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(n.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(t>0&&-1===fw(n,e.Links[t-1]))throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function mw(e){return yw({Data:e,Links:arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]})}function ww(e,t,n){return gw({Hash:n,Name:e,Tsize:t})}const bw="dag-pb",Ew=112;function _w(e){vw(e);const t={};return e.Links&&(t.Links=e.Links.map((e=>{const t={};return e.Hash&&(t.Hash=e.Hash.bytes),void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t}))),e.Data&&(t.Data=e.Data),ow(t)}function Sw(e){const t=function(e){const t=e.length;let n,r,i=0,o=!1;for(;i<t;){let t,s;if([t,s,i]=Zm(e,i),2!==t)throw new Error("protobuf: (PBNode) invalid wireType, expected 2, got ".concat(t));if(1===s){if(r)throw new Error("protobuf: (PBNode) duplicate Data section");[r,i]=$m(e,i),n&&(o=!0)}else{if(2!==s)throw new Error("protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ".concat(s));{if(o)throw new Error("protobuf: (PBNode) duplicate Links section");let t;n||(n=[]),[t,i]=$m(e,i),n.push(ew(t))}}}if(i>t)throw new Error("protobuf: (PBNode) unexpected end of data");const s={};return r&&(s.Data=r),s.Links=n||[],s}(function(e){return e instanceof ArrayBuffer?new Uint8Array(e,0,e.byteLength):e}(e)),n={};return t.Data&&(n.Data=t.Data),t.Links&&(n.Links=t.Links.map((e=>{const t={};try{t.Hash=Jt.decode(e.Hash)}catch(n){}if(!t.Hash)throw new Error("Invalid Hash field found in link, expected CID");return void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t}))),n}const kw={codec:Ew,*walk(e){const t=Sw(e);yield*t.Links.map((e=>e.Hash))}},Aw={codec:rn,*walk(){}},Iw={codec:zm,*walk(e){const t=[],n=[];n[42]=e=>{if(0!==e[0])throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");const n=Jt.decode(e.subarray(1));return t.push(n),n},Sm(e,{tags:n}),yield*t}};class Tw extends Hm{constructor(e,t){super(e,t),je(this,"tokenBuffer",void 0),this.tokenBuffer=[]}done(){return 0===this.tokenBuffer.length&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){const e=this._next();if(e.type===Jy.map){const e=this._next();if(e.type===Jy.string&&"/"===e.value){const e=this._next();if(e.type===Jy.string){if(this._next().type!==Jy.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(e),new $y(Jy.tag,42,0)}if(e.type===Jy.map){const e=this._next();if(e.type===Jy.string&&"bytes"===e.value){const e=this._next();if(e.type===Jy.string){for(let e=0;e<2;e++){if(this._next().type!==Jy.break)throw new Error("Invalid encoded Bytes form")}const t=cn.decode("m".concat(e.value));return new $y(Jy.bytes,t,e.value.length)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}return e}}const Rw={codec:297,*walk(e){const t=[],n=[];n[42]=e=>{const n=Jt.parse(e);return t.push(n),n},qm(e,{tags:n,tokenizer:new Tw(e,{tags:n,allowIndefinite:!0,allowUndefined:!0,allowNaN:!0,allowInfinity:!0,allowBigInt:!0,strict:!1,rejectDuplicateMapKeys:!1})}),yield*t}},Cw={codec:Zn,*walk(){}};const xw=new Er("/version");class Pw extends et{constructor(e){super(),je(this,"child",void 0),this.child=e}put(e,t){return 0===e.multihash.code||null==this.child?e:this.child.put(e,t)}get(e){if(0===e.multihash.code)return e.multihash.digest;if(null==this.child)throw Tn.notFoundError();return this.child.get(e)}has(e){return 0===e.multihash.code||null!=this.child&&this.child.has(e)}delete(e){if(0!==e.code)return null!=this.child?this.child.delete(e):void 0}getAll(e){return null!=this.child?this.child.getAll(e):[]}}function Dw(e){return"function"===typeof e.retrieve}function Nw(e){return"function"===typeof e.announce}class Bw{constructor(e){var t,n,r;je(this,"child",void 0),je(this,"blockRetrievers",void 0),je(this,"blockAnnouncers",void 0),je(this,"hashers",void 0),je(this,"started",void 0),je(this,"log",void 0),this.log=e.logger.forComponent("helia:networked-storage"),this.child=new In([new Pw,e.blockstore]),this.blockRetrievers=(null!==(t=e.blockBrokers)&&void 0!==t?t:[]).filter(Dw),this.blockAnnouncers=(null!==(n=e.blockBrokers)&&void 0!==n?n:[]).filter(Nw),this.hashers=null!==(r=e.hashers)&&void 0!==r?r:{},this.started=!1}isStarted(){return this.started}async start(){await vf(this.child,...new Set([...this.blockRetrievers,...this.blockAnnouncers])),this.started=!0}async stop(){await mf(this.child,...new Set([...this.blockRetrievers,...this.blockAnnouncers])),this.started=!1}unwrap(){return this.child}async put(e,t){var n,r;let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};var o;return await this.child.has(e)?(null===(o=i.onProgress)||void 0===o||o.call(i,new fp("blocks:put:duplicate",e)),e):(null===(n=i.onProgress)||void 0===n||n.call(i,new fp("blocks:put:providers:notify",e)),this.blockAnnouncers.forEach((n=>{n.announce(e,t,i)})),null===(r=i.onProgress)||void 0===r||r.call(i,new fp("blocks:put:blockstore:put",e)),this.child.put(e,t,i))}putMany(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(r){const i=vn(e,(async e=>{let{cid:r}=e;const i=await t.child.has(r);var o;i&&(null===(o=n.onProgress)||void 0===o||o.call(n,new fp("blocks:put-many:duplicate",r)));return!i})),o=Gg(i,(e=>{var r;let{cid:i,block:o}=e;null===(r=n.onProgress)||void 0===r||r.call(n,new fp("blocks:put-many:providers:notify",i)),t.blockAnnouncers.forEach((e=>{e.announce(i,o,n)}))}));null===(r=n.onProgress)||void 0===r||r.call(n,new fp("blocks:put-many:blockstore:put-many")),yield*t.child.putMany(o,n)}()}catch(n){return Promise.reject(n)}}async get(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!0!==n.offline&&!await this.child.has(e)){var r,i,o;null===(r=n.onProgress)||void 0===r||r.call(n,new fp("blocks:get:providers:get",e));const t=await Ow(e,this.blockRetrievers,this.hashers[e.multihash.code],{...n,log:this.log});return null===(i=n.onProgress)||void 0===i||i.call(n,new fp("blocks:get:blockstore:put",e)),await this.child.put(e,t,n),null===(o=n.onProgress)||void 0===o||o.call(n,new fp("blocks:get:providers:notify",e)),this.blockAnnouncers.forEach((r=>{r.announce(e,t,n)})),t}return null===(t=n.onProgress)||void 0===t||t.call(n,new fp("blocks:get:blockstore:get",e)),this.child.get(e,n)}getMany(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(r){null===(r=n.onProgress)||void 0===r||r.call(n,new fp("blocks:get-many:blockstore:get-many")),yield*t.child.getMany(Gg(e,(async e=>{if(!0!==n.offline&&!await t.child.has(e)){var r,i,o;null===(r=n.onProgress)||void 0===r||r.call(n,new fp("blocks:get-many:providers:get",e));const s=await Ow(e,t.blockRetrievers,t.hashers[e.multihash.code],{...n,log:t.log});null===(i=n.onProgress)||void 0===i||i.call(n,new fp("blocks:get-many:blockstore:put",e)),await t.child.put(e,s,n),null===(o=n.onProgress)||void 0===o||o.call(n,new fp("blocks:get-many:providers:notify",e)),t.blockAnnouncers.forEach((t=>{t.announce(e,s,n)}))}})))}()}catch(n){return Promise.reject(n)}}async delete(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};null===(t=n.onProgress)||void 0===t||t.call(n,new fp("blocks:delete:blockstore:delete",e)),await this.child.delete(e,n)}deleteMany(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(r){null===(r=n.onProgress)||void 0===r||r.call(n,new fp("blocks:delete-many:blockstore:delete-many")),yield*t.child.deleteMany(async function*(){for await(const t of e)yield t}(),n)}()}catch(n){return Promise.reject(n)}}async has(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.child.has(e,t)}getAll(){try{var e=this;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async function*(n){null===(n=t.onProgress)||void 0===n||n.call(t,new fp("blocks:get-all:blockstore:get-many")),yield*e.child.getAll(t)}()}catch(t){return Promise.reject(t)}}}const Lw=(e,t)=>{if(null==t)throw new Mr("No hasher configured for multihash code 0x".concat(e.multihash.code.toString(16),", please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv"),"ERR_UNKNOWN_HASH_ALG");return async n=>{if(!Hr((await t.digest(n)).digest,e.multihash.digest))throw new Mr("Hash of downloaded block did not match multihash from passed CID","ERR_HASH_MISMATCH")}};async function Ow(e,t,n,r){const i=Lw(e,n),o=Xp([(new AbortController).signal,r.signal]);try{return await Promise.any(t.map((async t=>{try{let n=!1;const s=await t.retrieve(e,{...r,signal:o,validateFn:async e=>{await i(e),n=!0}});return n||await i(s),s}catch(n){throw r.log.error("could not retrieve verified block for %c",e,n),n}})))}finally{o.clear()}}class Mw{constructor(e){var t,n,r,i,o;je(this,"blockstore",void 0),je(this,"datastore",void 0),je(this,"pins",void 0),je(this,"logger",void 0),je(this,"routing",void 0),je(this,"dagWalkers",void 0),je(this,"hashers",void 0),je(this,"dns",void 0),je(this,"log",void 0),this.logger=null!==(t=e.logger)&&void 0!==t?t:fn(),this.log=this.logger.forComponent("helia"),this.hashers=function(){const e={};return[ar,lr,rr,...arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]].forEach((t=>{e[t.code]=t})),e}(e.hashers),this.dagWalkers=function(){const e={};return[kw,Aw,Iw,Rw,Cw,...arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]].forEach((t=>{e[t.codec]=t})),e}(e.dagWalkers),this.dns=null!==(n=e.dns)&&void 0!==n?n:Sp();const s={blockstore:e.blockstore,datastore:e.datastore,hashers:this.hashers,dagWalkers:this.dagWalkers,logger:this.logger,blockBrokers:[],dns:this.dns,...null!==(r=e.components)&&void 0!==r?r:{}};s.blockBrokers=e.blockBrokers.map((e=>e(s)));const a=new Bw(s);this.pins=new Cm(e.datastore,a,this.dagWalkers),this.blockstore=new Bm(a,this.pins,{holdGcLock:null===(i=e.holdGcLock)||void 0===i||i}),this.datastore=e.datastore,this.routing=new Dm(s,{routers:(null!==(o=e.routers)&&void 0!==o?o:[]).flatMap((e=>{const t=[e];return null!=e[Su]&&t.push(e[Su]),null!=e[ku]&&t.push(e[ku]),t}))})}async start(){await async function(e){if(!await e.has(xw))return void await e.put(xw,yr("".concat(1)));const t=vr(await e.get(xw));if(1!==parseInt(t,10))throw new Error("Unknown datastore version, a datastore migration may be required")}(this.datastore),await vf(this.blockstore,this.datastore,this.routing)}async stop(){await mf(this.blockstore,this.datastore,this.routing)}async gc(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=await this.blockstore.lock.writeLock();try{const t=this,n=this.blockstore.unwrap();this.log("gc start"),await gn(n.deleteMany(async function*(){for await(const{cid:s}of n.getAll())try{var r;if(await t.pins.isPinned(s,e))continue;yield s,null===(r=e.onProgress)||void 0===r||r.call(e,new fp("helia:gc:deleted",s))}catch(o){var i;t.log.error("Error during gc",o),null===(i=e.onProgress)||void 0===i||i.call(e,new fp("helia:gc:error",o))}}()))}finally{t()}this.log("gc finished")}}class Uw extends Mw{constructor(e){super({...e,components:{libp2p:e.libp2p}}),je(this,"libp2p",void 0),this.libp2p=e.libp2p}async start(){await super.start(),await this.libp2p.start()}async stop(){await super.stop(),await this.libp2p.stop()}}function Fw(){const e=mn();let t=!1;return{sink:async n=>{if(t)throw new Error("already piped");t=!0,e.resolve(n)},source:async function*(){const t=await e.promise;yield*t}()}}var Vw;const zw=65535,Kw=Boolean(null===(Vw=globalThis.process)||void 0===Vw||null===(Vw=Vw.env)||void 0===Vw?void 0:Vw.DUMP_SESSION_KEYS),jw=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4));function Hw(e){return e instanceof Uint8Array||null!=e&&"object"===typeof e&&"Uint8Array"===e.constructor.name}const qw=e=>new DataView(e.buffer,e.byteOffset,e.byteLength);if(!(68===new Uint8Array(new Uint32Array([287454020]).buffer)[0]))throw new Error("Non little-endian hardware is not supported");function Ww(e){if("string"!==typeof e)throw new Error("utf8ToBytes expected string, got ".concat(typeof e));return new Uint8Array((new TextEncoder).encode(e))}function Gw(e){if("string"===typeof e)e=Ww(e);else{if(!Hw(e))throw new Error("expected Uint8Array, got ".concat(typeof e));e=e.slice()}return e}const Yw=e=>"[object Object]"===Object.prototype.toString.call(e)&&e.constructor===Object;function Qw(e,t){if(!Hw(e))throw new Error("Uint8Array expected");if("number"===typeof t&&e.length!==t)throw new Error("Uint8Array length ".concat(t," expected"))}const Xw=(e,t)=>(Object.assign(t,e),t);function Jw(e,t,n,r){if("function"===typeof e.setBigUint64)return e.setBigUint64(t,n,r);const i=BigInt(32),o=BigInt(4294967295),s=Number(n>>i&o),a=Number(n&o),l=r?4:0,c=r?0:4;e.setUint32(t+l,s,r),e.setUint32(t+c,a,r)}function $w(e){if(!Number.isSafeInteger(e)||e<0)throw new Error("wrong positive integer: ".concat(e))}function Zw(e){if("boolean"!==typeof e)throw new Error("boolean expected, not ".concat(e))}function eb(e){if(null==(t=e)||"object"!==typeof t||!(t instanceof Uint8Array||"Uint8Array"===t.constructor.name))throw new Error("Uint8Array expected");for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];if(r.length>0&&!r.includes(e.length))throw new Error("Uint8Array expected of length ".concat(r,", not of length=").concat(e.length))}function tb(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function nb(e,t){eb(e);const n=t.outputLen;if(e.length<n)throw new Error("digestInto() expects output buffer of length at least ".concat(n))}const rb=(e,t)=>255&e[t++]|(255&e[t++])<<8;class ib{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,Qw(e=Gw(e),32);const t=rb(e,0),n=rb(e,2),r=rb(e,4),i=rb(e,6),o=rb(e,8),s=rb(e,10),a=rb(e,12),l=rb(e,14);this.r[0]=8191&t,this.r[1]=8191&(t>>>13|n<<3),this.r[2]=7939&(n>>>10|r<<6),this.r[3]=8191&(r>>>7|i<<9),this.r[4]=255&(i>>>4|o<<12),this.r[5]=o>>>1&8190,this.r[6]=8191&(o>>>14|s<<2),this.r[7]=8065&(s>>>11|a<<5),this.r[8]=8191&(a>>>8|l<<8),this.r[9]=l>>>5&127;for(let c=0;c<8;c++)this.pad[c]=rb(e,16+2*c)}process(e,t){const n=arguments.length>2&&void 0!==arguments[2]&&arguments[2]?0:2048,{h:r,r:i}=this,o=i[0],s=i[1],a=i[2],l=i[3],c=i[4],u=i[5],h=i[6],d=i[7],f=i[8],p=i[9],g=rb(e,t+0),y=rb(e,t+2),v=rb(e,t+4),m=rb(e,t+6),w=rb(e,t+8),b=rb(e,t+10),E=rb(e,t+12),_=rb(e,t+14);let S=r[0]+(8191&g),k=r[1]+(8191&(g>>>13|y<<3)),A=r[2]+(8191&(y>>>10|v<<6)),I=r[3]+(8191&(v>>>7|m<<9)),T=r[4]+(8191&(m>>>4|w<<12)),R=r[5]+(w>>>1&8191),C=r[6]+(8191&(w>>>14|b<<2)),x=r[7]+(8191&(b>>>11|E<<5)),P=r[8]+(8191&(E>>>8|_<<8)),D=r[9]+(_>>>5|n),N=0,B=N+S*o+k*(5*p)+A*(5*f)+I*(5*d)+T*(5*h);N=B>>>13,B&=8191,B+=R*(5*u)+C*(5*c)+x*(5*l)+P*(5*a)+D*(5*s),N+=B>>>13,B&=8191;let L=N+S*s+k*o+A*(5*p)+I*(5*f)+T*(5*d);N=L>>>13,L&=8191,L+=R*(5*h)+C*(5*u)+x*(5*c)+P*(5*l)+D*(5*a),N+=L>>>13,L&=8191;let O=N+S*a+k*s+A*o+I*(5*p)+T*(5*f);N=O>>>13,O&=8191,O+=R*(5*d)+C*(5*h)+x*(5*u)+P*(5*c)+D*(5*l),N+=O>>>13,O&=8191;let M=N+S*l+k*a+A*s+I*o+T*(5*p);N=M>>>13,M&=8191,M+=R*(5*f)+C*(5*d)+x*(5*h)+P*(5*u)+D*(5*c),N+=M>>>13,M&=8191;let U=N+S*c+k*l+A*a+I*s+T*o;N=U>>>13,U&=8191,U+=R*(5*p)+C*(5*f)+x*(5*d)+P*(5*h)+D*(5*u),N+=U>>>13,U&=8191;let F=N+S*u+k*c+A*l+I*a+T*s;N=F>>>13,F&=8191,F+=R*o+C*(5*p)+x*(5*f)+P*(5*d)+D*(5*h),N+=F>>>13,F&=8191;let V=N+S*h+k*u+A*c+I*l+T*a;N=V>>>13,V&=8191,V+=R*s+C*o+x*(5*p)+P*(5*f)+D*(5*d),N+=V>>>13,V&=8191;let z=N+S*d+k*h+A*u+I*c+T*l;N=z>>>13,z&=8191,z+=R*a+C*s+x*o+P*(5*p)+D*(5*f),N+=z>>>13,z&=8191;let K=N+S*f+k*d+A*h+I*u+T*c;N=K>>>13,K&=8191,K+=R*l+C*a+x*s+P*o+D*(5*p),N+=K>>>13,K&=8191;let j=N+S*p+k*f+A*d+I*h+T*u;N=j>>>13,j&=8191,j+=R*c+C*l+x*a+P*s+D*o,N+=j>>>13,j&=8191,N=(N<<2)+N|0,N=N+B|0,B=8191&N,N>>>=13,L+=N,r[0]=B,r[1]=L,r[2]=O,r[3]=M,r[4]=U,r[5]=F,r[6]=V,r[7]=z,r[8]=K,r[9]=j}finalize(){const{h:e,pad:t}=this,n=new Uint16Array(10);let r=e[1]>>>13;e[1]&=8191;for(let s=2;s<10;s++)e[s]+=r,r=e[s]>>>13,e[s]&=8191;e[0]+=5*r,r=e[0]>>>13,e[0]&=8191,e[1]+=r,r=e[1]>>>13,e[1]&=8191,e[2]+=r,n[0]=e[0]+5,r=n[0]>>>13,n[0]&=8191;for(let s=1;s<10;s++)n[s]=e[s]+r,r=n[s]>>>13,n[s]&=8191;n[9]-=8192;let i=(1^r)-1;for(let s=0;s<10;s++)n[s]&=i;i=~i;for(let s=0;s<10;s++)e[s]=e[s]&i|n[s];e[0]=65535&(e[0]|e[1]<<13),e[1]=65535&(e[1]>>>3|e[2]<<10),e[2]=65535&(e[2]>>>6|e[3]<<7),e[3]=65535&(e[3]>>>9|e[4]<<4),e[4]=65535&(e[4]>>>12|e[5]<<1|e[6]<<14),e[5]=65535&(e[6]>>>2|e[7]<<11),e[6]=65535&(e[7]>>>5|e[8]<<8),e[7]=65535&(e[8]>>>8|e[9]<<5);let o=e[0]+t[0];e[0]=65535&o;for(let s=1;s<8;s++)o=(e[s]+t[s]|0)+(o>>>16)|0,e[s]=65535&o}update(e){tb(this);const{buffer:t,blockLen:n}=this,r=(e=Gw(e)).length;for(let i=0;i<r;){const o=Math.min(n-this.pos,r-i);if(o!==n)t.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===n&&(this.process(t,0,!1),this.pos=0);else for(;n<=r-i;i+=n)this.process(e,i)}return this}destroy(){this.h.fill(0),this.r.fill(0),this.buffer.fill(0),this.pad.fill(0)}digestInto(e){tb(this),nb(e,this),this.finished=!0;const{buffer:t,h:n}=this;let{pos:r}=this;if(r){for(t[r++]=1;r<16;r++)t[r]=0;this.process(t,0,!0)}this.finalize();let i=0;for(let o=0;o<8;o++)e[i++]=n[o]>>>0,e[i++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}}const ob=function(e){const t=(t,n)=>e(n).update(Gw(t)).digest(),n=e(new Uint8Array(32));return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=t=>e(t),t}((e=>new ib(e))),sb=Ww("expand 16-byte k"),ab=Ww("expand 32-byte k"),lb=jw(sb),cb=jw(ab);function ub(e,t){return e<<t|e>>>32-t}function hb(e){return e.byteOffset%4===0}const db=64,fb=16,pb=2**32-1,gb=new Uint32Array;function yb(e,t){const{allowShortKeys:n,extendNonceFn:r,counterLength:i,counterRight:o,rounds:s}=function(e,t){if(void 0!==t&&("object"!==typeof t||!Yw(t)))throw new Error("options must be object or undefined");return Object.assign(e,t)}({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if("function"!==typeof e)throw new Error("core must be a function");return $w(i),$w(s),Zw(o),Zw(n),function(t,a,l,c){let u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;eb(t),eb(a),eb(l);const h=l.length;if(c||(c=new Uint8Array(h)),eb(c),$w(u),u<0||u>=pb)throw new Error("arx: counter overflow");if(c.length<h)throw new Error("arx: output (".concat(c.length,") is shorter than data (").concat(h,")"));const d=[];let f,p,g=t.length;if(32===g)f=t.slice(),d.push(f),p=cb;else{if(16!==g||!n)throw new Error("arx: invalid 32-byte key, got length=".concat(g));f=new Uint8Array(32),f.set(t),f.set(t,16),p=lb,d.push(f)}hb(a)||(a=a.slice(),d.push(a));const y=jw(f);if(r){if(24!==a.length)throw new Error("arx: extended nonce must be 24 bytes");r(p,y,jw(a.subarray(0,16)),y),a=a.subarray(16)}const v=16-i;if(v!==a.length)throw new Error("arx: nonce must be ".concat(v," or 16 bytes"));if(12!==v){const e=new Uint8Array(12);e.set(a,o?0:12-a.length),a=e,d.push(a)}const m=jw(a);for(!function(e,t,n,r,i,o,s,a){const l=i.length,c=new Uint8Array(db),u=jw(c),h=hb(i)&&hb(o),d=h?jw(i):gb,f=h?jw(o):gb;for(let p=0;p<l;s++){if(e(t,n,r,u,s,a),s>=pb)throw new Error("arx: counter overflow");const g=Math.min(db,l-p);if(h&&g===db){const e=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let t,n=0;n<fb;n++)t=e+n,f[t]=d[t]^u[n];p+=db}else{for(let e,t=0;t<g;t++)e=p+t,o[e]=i[e]^c[t];p+=g}}}(e,p,y,m,l,c,u,s);d.length>0;)d.pop().fill(0);return c}}function vb(e,t,n,r,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:20,s=e[0],a=e[1],l=e[2],c=e[3],u=t[0],h=t[1],d=t[2],f=t[3],p=t[4],g=t[5],y=t[6],v=t[7],m=i,w=n[0],b=n[1],E=n[2],_=s,S=a,k=l,A=c,I=u,T=h,R=d,C=f,x=p,P=g,D=y,N=v,B=m,L=w,O=b,M=E;for(let F=0;F<o;F+=2)_=_+I|0,B=ub(B^_,16),x=x+B|0,I=ub(I^x,12),_=_+I|0,B=ub(B^_,8),x=x+B|0,I=ub(I^x,7),S=S+T|0,L=ub(L^S,16),P=P+L|0,T=ub(T^P,12),S=S+T|0,L=ub(L^S,8),P=P+L|0,T=ub(T^P,7),k=k+R|0,O=ub(O^k,16),D=D+O|0,R=ub(R^D,12),k=k+R|0,O=ub(O^k,8),D=D+O|0,R=ub(R^D,7),A=A+C|0,M=ub(M^A,16),N=N+M|0,C=ub(C^N,12),A=A+C|0,M=ub(M^A,8),N=N+M|0,C=ub(C^N,7),_=_+T|0,M=ub(M^_,16),D=D+M|0,T=ub(T^D,12),_=_+T|0,M=ub(M^_,8),D=D+M|0,T=ub(T^D,7),S=S+R|0,B=ub(B^S,16),N=N+B|0,R=ub(R^N,12),S=S+R|0,B=ub(B^S,8),N=N+B|0,R=ub(R^N,7),k=k+C|0,L=ub(L^k,16),x=x+L|0,C=ub(C^x,12),k=k+C|0,L=ub(L^k,8),x=x+L|0,C=ub(C^x,7),A=A+I|0,O=ub(O^A,16),P=P+O|0,I=ub(I^P,12),A=A+I|0,O=ub(O^A,8),P=P+O|0,I=ub(I^P,7);let U=0;r[U++]=s+_|0,r[U++]=a+S|0,r[U++]=l+k|0,r[U++]=c+A|0,r[U++]=u+I|0,r[U++]=h+T|0,r[U++]=d+R|0,r[U++]=f+C|0,r[U++]=p+x|0,r[U++]=g+P|0,r[U++]=y+D|0,r[U++]=v+N|0,r[U++]=m+B|0,r[U++]=w+L|0,r[U++]=b+O|0,r[U++]=E+M|0}const mb=yb(vb,{counterRight:!1,counterLength:4,allowShortKeys:!1}),wb=yb(vb,{counterRight:!1,counterLength:8,extendNonceFn:function(e,t,n,r){let i=e[0],o=e[1],s=e[2],a=e[3],l=t[0],c=t[1],u=t[2],h=t[3],d=t[4],f=t[5],p=t[6],g=t[7],y=n[0],v=n[1],m=n[2],w=n[3];for(let E=0;E<20;E+=2)i=i+l|0,y=ub(y^i,16),d=d+y|0,l=ub(l^d,12),i=i+l|0,y=ub(y^i,8),d=d+y|0,l=ub(l^d,7),o=o+c|0,v=ub(v^o,16),f=f+v|0,c=ub(c^f,12),o=o+c|0,v=ub(v^o,8),f=f+v|0,c=ub(c^f,7),s=s+u|0,m=ub(m^s,16),p=p+m|0,u=ub(u^p,12),s=s+u|0,m=ub(m^s,8),p=p+m|0,u=ub(u^p,7),a=a+h|0,w=ub(w^a,16),g=g+w|0,h=ub(h^g,12),a=a+h|0,w=ub(w^a,8),g=g+w|0,h=ub(h^g,7),i=i+c|0,w=ub(w^i,16),p=p+w|0,c=ub(c^p,12),i=i+c|0,w=ub(w^i,8),p=p+w|0,c=ub(c^p,7),o=o+u|0,y=ub(y^o,16),g=g+y|0,u=ub(u^g,12),o=o+u|0,y=ub(y^o,8),g=g+y|0,u=ub(u^g,7),s=s+h|0,v=ub(v^s,16),d=d+v|0,h=ub(h^d,12),s=s+h|0,v=ub(v^s,8),d=d+v|0,h=ub(h^d,7),a=a+l|0,m=ub(m^a,16),f=f+m|0,l=ub(l^f,12),a=a+l|0,m=ub(m^a,8),f=f+m|0,l=ub(l^f,7);let b=0;r[b++]=i,r[b++]=o,r[b++]=s,r[b++]=a,r[b++]=y,r[b++]=v,r[b++]=m,r[b++]=w},allowShortKeys:!1}),bb=new Uint8Array(16),Eb=(e,t)=>{e.update(t);const n=t.length%16;n&&e.update(bb.subarray(n))},_b=new Uint8Array(32);function Sb(e,t,n,r,i){const o=e(t,n,_b),s=ob.create(o);i&&Eb(s,i),Eb(s,r);const a=new Uint8Array(16),l=qw(a);Jw(l,0,BigInt(i?i.length:0),!0),Jw(l,8,BigInt(r.length),!0),s.update(a);const c=s.digest();return o.fill(0),c}const kb=e=>(t,n,r)=>{const i=16;return Qw(t,32),Qw(n),{encrypt:(o,s)=>{const a=o.length,l=a+i;s?Qw(s,l):s=new Uint8Array(l),e(t,n,o,s,1);const c=Sb(e,t,n,s.subarray(0,-16),r);return s.set(c,a),s},decrypt:(o,s)=>{const a=o.length,l=a-i;if(a<i)throw new Error("encrypted data must be at least ".concat(i," bytes"));s?Qw(s,l):s=new Uint8Array(l);const c=o.subarray(0,-16);if(!function(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return 0===n}(o.subarray(-16),Sb(e,t,n,c,r)))throw new Error("invalid tag");return e(t,n,c,s,1),s}}},Ab=Xw({blockSize:64,nonceLength:12,tagLength:16},kb(mb));kb(wb);function Ib(e,t,n){return Yr(e),void 0===n&&(n=new Uint8Array(e.outputLen)),la(e,ii(n),ii(t))}const Tb=new Uint8Array([0]),Rb=new Uint8Array;function Cb(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:32;if(Yr(e),Wr(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(r/e.outputLen);void 0===n&&(n=Rb);const o=new Uint8Array(i*e.outputLen),s=la.create(e,t),a=s._cloneInto(),l=new Uint8Array(s.outputLen);for(let c=0;c<i;c++)Tb[0]=c+1,a.update(0===c?Rb:l).update(n).update(Tb).digestInto(l),o.set(l,e.outputLen*c),s._cloneInto(a);return s.destroy(),a.destroy(),l.fill(0),Tb.fill(0),o.slice(0,r)}const xb={hashSHA256:e=>Mc(e.subarray()),getHKDF(e,t){const n=Ib(Mc,t,e),r=Cb(Mc,n,void 0,96);return[r.subarray(0,32),r.subarray(32,64),r.subarray(64,96)]},generateX25519KeyPair(){const e=Vo.utils.randomPrivateKey();return{publicKey:Vo.getPublicKey(e),privateKey:e}},generateX25519KeyPairFromSeed:e=>({publicKey:Vo.getPublicKey(e),privateKey:e}),generateX25519SharedKey:(e,t)=>Vo.getSharedSecret(e.subarray(),t.subarray()),chaCha20Poly1305Encrypt:(e,t,n,r)=>Ab(r,t,n).encrypt(e.subarray()),chaCha20Poly1305Decrypt:(e,t,n,r,i)=>Ab(r,t,n).decrypt(e.subarray(),i)};const Pb=e=>{const t=hr(2);return t[0]=e>>8,t[1]=e,t};Pb.bytes=2;const Db=e=>{if(e.length<2)throw RangeError("Could not decode int16BE");if(e instanceof Uint8Array){let t=0;return t+=e[0]<<8,t+=e[1],t}return e.getUint16(0)};function Nb(e,t){t.enabled&&Kw&&(e?(t("LOCAL_STATIC_PUBLIC_KEY ".concat(vr(e.publicKey,"hex"))),t("LOCAL_STATIC_PRIVATE_KEY ".concat(vr(e.privateKey,"hex")))):t("Missing local static keys."))}function Bb(e,t){t.enabled&&Kw&&(e?(t("LOCAL_PUBLIC_EPHEMERAL_KEY ".concat(vr(e.publicKey,"hex"))),t("LOCAL_PRIVATE_EPHEMERAL_KEY ".concat(vr(e.privateKey,"hex")))):t("Missing local ephemeral keys."))}function Lb(e,t){t.enabled&&Kw&&t(e?"REMOTE_EPHEMERAL_PUBLIC_KEY ".concat(vr(e.subarray(),"hex")):"Missing remote ephemeral keys.")}function Ob(e,t,n){n.enabled&&Kw&&(n("CIPHER_STATE_1 ".concat(e.n.getUint64()," ").concat(e.k&&vr(e.k,"hex"))),n("CIPHER_STATE_2 ".concat(t.n.getUint64()," ").concat(t.k&&vr(t.k,"hex"))))}Db.bytes=2;class Mb extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected Peer"),je(this,"code",void 0),this.code=Mb.code}}je(Mb,"code","ERR_UNEXPECTED_PEER");class Ub extends Error{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Invalid crypto exchange"),je(this,"code",void 0),this.code=Ub.code}}je(Ub,"code","ERR_INVALID_CRYPTO_EXCHANGE");class Fb{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;je(this,"n",void 0),je(this,"bytes",void 0),je(this,"view",void 0),this.n=e,this.bytes=ur(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>4294967295)throw new Error("Cipherstate has reached maximum n, a new handshake must be performed")}}const Vb=ur(0);class zb{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;je(this,"k",void 0),je(this,"n",void 0),je(this,"crypto",void 0),this.crypto=e,this.k=t,this.n=new Fb(n)}hasKey(){return Boolean(this.k)}encryptWithAd(e,t){if(!this.hasKey())return t;this.n.assertValue();const n=this.crypto.encrypt(t,this.n.getBytes(),e,this.k);return this.n.increment(),n}decryptWithAd(e,t,n){if(!this.hasKey())return t;this.n.assertValue();const r=this.crypto.decrypt(t,this.n.getBytes(),e,this.k,n);return this.n.increment(),r}}class Kb{constructor(e,t){je(this,"cs",void 0),je(this,"ck",void 0),je(this,"h",void 0),je(this,"crypto",void 0),this.crypto=e;const n=yr(t,"utf-8");this.h=function(e,t){if(t.length<=32){const e=ur(32);return e.set(t),e}return e.hash(t)}(e,n),this.ck=this.h,this.cs=new zb(e)}mixKey(e){const[t,n]=this.crypto.hkdf(this.ck,e);this.ck=t,this.cs=new zb(this.crypto,n)}mixHash(e){this.h=this.crypto.hash(new Gu(this.h,e))}encryptAndHash(e){const t=this.cs.encryptWithAd(this.h,e);return this.mixHash(t),t}decryptAndHash(e){const t=this.cs.decryptWithAd(this.h,e);return this.mixHash(e),t}split(){const[e,t]=this.crypto.hkdf(this.ck,Vb);return[new zb(this.crypto,e),new zb(this.crypto,t)]}}class jb{constructor(e){je(this,"ss",void 0),je(this,"s",void 0),je(this,"e",void 0),je(this,"rs",void 0),je(this,"re",void 0),je(this,"initiator",void 0),je(this,"crypto",void 0);const{crypto:t,protocolName:n,prologue:r,initiator:i,s:o,e:s,rs:a,re:l}=e;this.crypto=t,this.ss=new Kb(t,n),this.ss.mixHash(r),this.initiator=i,this.s=o,this.e=s,this.rs=a,this.re=l}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");const e=this.crypto.generateKeypair();return this.ss.mixHash(e.publicKey),this.e=e,e.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.re)throw new Error("remote ephemeral public key is already set");if(e.byteLength<t+32)throw new Error("message is not long enough");this.re=e.sublist(t,t+32),this.ss.mixHash(this.re)}readS(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.rs)throw new Error("remote static public key is already set");const n=32+(this.ss.cs.hasKey()?16:0);if(e.byteLength<t+n)throw new Error("message is not long enough");const r=e.sublist(t,t+n);return this.rs=this.ss.decryptAndHash(r),n}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}}class Hb extends jb{writeMessageA(e){return new Gu(this.writeE(),this.ss.encryptAndHash(e))}writeMessageB(e){const t=this.writeE();this.writeEE();const n=this.writeS();return this.writeES(),new Gu(t,n,this.ss.encryptAndHash(e))}writeMessageC(e){const t=this.writeS();return this.writeSE(),new Gu(t,this.ss.encryptAndHash(e))}readMessageA(e){try{return this.readE(e),this.ss.decryptAndHash(e.sublist(32))}catch(t){throw new Ub("handshake stage 0 validation fail: ".concat(t.message))}}readMessageB(e){try{this.readE(e),this.readEE();const t=this.readS(e,32);return this.readES(),this.ss.decryptAndHash(e.sublist(32+t))}catch(t){throw new Ub("handshake stage 1 validation fail: ".concat(t.message))}}readMessageC(e){try{const t=this.readS(e);return this.readSE(),this.ss.decryptAndHash(e.sublist(t))}catch(t){throw new Ub("handshake stage 2 validation fail: ".concat(t.message))}}}var qb,Wb;async function Gb(e,t,n){const r=await e.sign(Qb(t));return Wb.encode({identityKey:e.public.bytes,identitySig:r,extensions:n})}async function Yb(e,t,n){try{const r=Wb.decode(e);if(n){const e=n.subarray();if(!Hr(e,r.identityKey))throw new Error("Payload identity key ".concat(vr(r.identityKey,"hex")," does not match expected remote identity key ").concat(vr(e,"hex")))}if(!t)throw new Error("Remote static does not exist");const i=Qb(t),o=hu(r.identityKey);if(!await o.verify(i,r.identitySig))throw new Error("Invalid payload signature");return r}catch(r){throw new Mb(r.message)}}function Qb(e){const t=yr("noise-libp2p-static-key:");return e instanceof Uint8Array?Wo([t,e],t.length+e.length):(e.prepend(t),e)}async function Xb(e){const{log:t,connection:n,crypto:r,privateKey:i,prologue:o,s:s,remoteIdentityKey:a,extensions:l}=e,c=await Gb(i,s.publicKey,l),u=new Hb({crypto:r,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:o,s:s});Nb(u.s,t),t.trace("Stage 0 - Initiator starting to send first message."),await n.write(u.writeMessageA(Vb)),t.trace("Stage 0 - Initiator finished sending first message."),Bb(u.e,t),t.trace("Stage 1 - Initiator waiting to receive first message from responder...");const h=u.readMessageB(await n.read());var d,f;t.trace("Stage 1 - Initiator received the message."),Lb(u.re,t),d=u.rs,(f=t).enabled&&Kw&&f(d?"REMOTE_STATIC_PUBLIC_KEY ".concat(vr(d.subarray(),"hex")):"Missing remote static public key."),t.trace("Initiator going to check remote's signature...");const p=await Yb(h,u.rs,a);t.trace("All good with the signature!"),t.trace("Stage 2 - Initiator sending third handshake message."),await n.write(u.writeMessageC(c)),t.trace("Stage 2 - Initiator sent message with signed payload.");const[g,y]=u.ss.split();return Ob(g,y,t),{payload:p,encrypt:e=>g.encryptWithAd(Vb,e),decrypt:(e,t)=>y.decryptWithAd(Vb,e,t)}}!function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==n.lengthDelimited&&t.fork(),null!=e.webtransportCerthashes)for(const r of e.webtransportCerthashes)t.uint32(10),t.bytes(r);!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={webtransportCerthashes:[]},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();if(t>>>3===1)n.webtransportCerthashes.push(e.bytes());else e.skipType(7&t)}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(qb||(qb={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.identityKey&&e.identityKey.byteLength>0&&(t.uint32(10),t.bytes(e.identityKey)),null!=e.identitySig&&e.identitySig.byteLength>0&&(t.uint32(18),t.bytes(e.identitySig)),null!=e.extensions&&(t.uint32(34),qb.codec().encode(e.extensions,t)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={identityKey:ur(0),identitySig:ur(0)},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.identityKey=e.bytes();break;case 2:n.identitySig=e.bytes();break;case 4:n.extensions=qb.codec().decode(e,e.uint32());break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(Wb||(Wb={}));class Jb{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};je(this,"protocol","/noise"),je(this,"crypto",void 0),je(this,"prologue",void 0),je(this,"staticKey",void 0),je(this,"extensions",void 0),je(this,"metrics",void 0),je(this,"components",void 0);const{staticNoiseKey:n,extensions:r,crypto:i,prologueBytes:o}=t,{metrics:s}=e;this.components=e;const a=null!==i&&void 0!==i?i:xb;this.crypto=function(e){return{generateKeypair:e.generateX25519KeyPair,dh:(t,n)=>e.generateX25519SharedKey(t.privateKey,n).subarray(0,32),encrypt:e.chaCha20Poly1305Encrypt,decrypt:e.chaCha20Poly1305Decrypt,hash:e.hashSHA256,hkdf:e.getHKDF}}(a),this.extensions=r,this.metrics=s?function(e){return{xxHandshakeSuccesses:e.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:e.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:e.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:e.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:e.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}(s):void 0,this.staticKey=n?a.generateX25519KeyPairFromSeed(n):a.generateX25519KeyPair(),this.prologue=null!==o&&void 0!==o?o:ur(0)}async secureOutbound(e,t,n){const r=Tg(t,{lengthEncoder:Pb,lengthDecoder:Db,maxDataLength:zw});if(!e.privateKey)throw new Mr("local peerId does not contain private key","ERR_NO_PRIVATE_KEY");const i=await fu(e.privateKey),o=null===n||void 0===n?void 0:n.publicKey,s=await this.performHandshakeInitiator(r,i,o),a=await this.createSecureConnection(r,s);return t.source=a.source,t.sink=a.sink,{conn:t,remoteExtensions:s.payload.extensions,remotePeer:await Fu(s.payload.identityKey)}}async secureInbound(e,t,n){const r=Tg(t,{lengthEncoder:Pb,lengthDecoder:Db,maxDataLength:zw});if(!e.privateKey)throw new Mr("local peerId does not contain private key","ERR_NO_PRIVATE_KEY");const i=await fu(e.privateKey),o=null===n||void 0===n?void 0:n.publicKey,s=await this.performHandshakeResponder(r,i,o),a=await this.createSecureConnection(r,s);return t.source=a.source,t.sink=a.sink,{conn:t,remoteExtensions:s.payload.extensions,remotePeer:await Fu(s.payload.identityKey)}}async performHandshakeInitiator(e,t,n){let r;try{var i;r=await Xb({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:this.extensions}),null===(i=this.metrics)||void 0===i||i.xxHandshakeSuccesses.increment()}catch(s){var o;throw null===(o=this.metrics)||void 0===o||o.xxHandshakeErrors.increment(),s}return r}async performHandshakeResponder(e,t,n){let r;try{var i;r=await async function(e){const{log:t,connection:n,crypto:r,privateKey:i,prologue:o,s:s,remoteIdentityKey:a,extensions:l}=e,c=await Gb(i,s.publicKey,l),u=new Hb({crypto:r,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:o,s:s});Nb(u.s,t),t.trace("Stage 0 - Responder waiting to receive first message."),u.readMessageA(await n.read()),t.trace("Stage 0 - Responder received first message."),Lb(u.re,t),t.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await n.write(u.writeMessageB(c)),t.trace("Stage 1 - Responder sent the second handshake message with signed payload."),Bb(u.e,t),t.trace("Stage 2 - Responder waiting for third handshake message...");const h=u.readMessageC(await n.read());t.trace("Stage 2 - Responder received the message, finished handshake.");const d=await Yb(h,u.rs,a),[f,p]=u.ss.split();return Ob(f,p,t),{payload:d,encrypt:e=>p.encryptWithAd(Vb,e),decrypt:(e,t)=>f.decryptWithAd(Vb,e,t)}}({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:this.extensions}),null===(i=this.metrics)||void 0===i||i.xxHandshakeSuccesses.increment()}catch(s){var o;throw null===(o=this.metrics)||void 0===o||o.xxHandshakeErrors.increment(),s}return r}async createSecureConnection(e,t){const[n,r]=function(){const e=Fw(),t=Fw();return[{source:e.source,sink:t.sink},{source:t.source,sink:e.sink}]}(),i=e.unwrap();return await Cr(n,function(e,t){return async function*(n){for await(const r of n)for(let n=0;n<r.length;n+=65519){let i,o=n+65519;o>r.length&&(o=r.length),i=r instanceof Uint8Array?e.encrypt(r.subarray(n,o)):e.encrypt(r.sublist(n,o)),null===t||void 0===t||t.encryptedPackets.increment(),yield new Gu(Pb(i.byteLength),i)}}}(t,this.metrics),i,(e=>Eg(e,{lengthDecoder:Db})),function(e,t){return async function*(n){for await(const i of n)for(let n=0;n<i.length;n+=zw){let o=n+zw;if(o>i.length&&(o=i.length),o-16<n)throw new Error("Invalid chunk");const s=i.sublist(n,o),a=i.subarray(n,o-16);try{const n=e.decrypt(s,a);null===t||void 0===t||t.decryptedPackets.increment(),yield n}catch(r){throw null===t||void 0===t||t.decryptErrors.increment(),r}}}}(t,this.metrics),n),r}}function $b(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>new Jb(t,e)}function Zb(e){if(null!=e){if("function"===typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"===typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"===typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}const eE="ERR_INVALID_FRAME",tE="ERR_UNREQUESTED_PING",nE="ERR_NOT_MATCHING_PING",rE="ERR_STREAM_ALREADY_EXISTS",iE="ERR_DECODE_INVALID_VERSION",oE="ERR_BOTH_CLIENTS",sE="ERR_RECV_WINDOW_EXCEEDED",aE=new Set([eE,tE,nE,rE,iE,oE,sE]),lE="ERR_INVALID_CONFIG",cE="ERR_MUXER_LOCAL_CLOSED",uE="ERR_MUXER_REMOTE_CLOSED",hE=262144,dE={enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:hE,maxStreamWindowSize:16777216,maxMessageSize:65536};var fE,pE;!function(e){e[e.Data=0]="Data",e[e.WindowUpdate=1]="WindowUpdate",e[e.Ping=2]="Ping",e[e.GoAway=3]="GoAway"}(fE||(fE={})),function(e){e[e.SYN=1]="SYN",e[e.ACK=2]="ACK",e[e.FIN=4]="FIN",e[e.RST=8]="RST"}(pE||(pE={}));Object.values(pE).filter((e=>"string"!==typeof e));var gE;!function(e){e[e.NormalTermination=0]="NormalTermination",e[e.ProtocolError=1]="ProtocolError",e[e.InternalError=2]="InternalError"}(gE||(gE={}));const yE=2**24;class vE{constructor(e){je(this,"source",void 0),je(this,"buffer",void 0),je(this,"frameInProgress",void 0),this.source=function(e){if(void 0!==e[Symbol.iterator]){const t=e[Symbol.iterator]();return t.return=void 0,{[Symbol.iterator]:()=>t}}if(void 0!==e[Symbol.asyncIterator]){const t=e[Symbol.asyncIterator]();return t.return=void 0,{[Symbol.asyncIterator]:()=>t}}throw new Error("a source must be either an iterable or an async iterable")}(e),this.buffer=new Gu,this.frameInProgress=!1}async*emitFrames(){for await(const e of this.source)for(this.buffer.append(e);;){const e=this.readHeader();if(void 0===e)break;const{type:t,length:n}=e;t===fE.Data?(this.frameInProgress=!0,yield{header:e,readData:this.readBytes.bind(this,n)}):yield{header:e}}}readHeader(){if(this.frameInProgress)throw new Mr("decoding frame already in progress","ERR_DECODE_IN_PROGRESS");if(this.buffer.length<12)return;const e=function(e){if(0!==e[0])throw new Mr("Invalid frame version",iE);return{type:e[1],flag:(e[2]<<8)+e[3],streamID:e[4]*yE+(e[5]<<16)+(e[6]<<8)+e[7],length:e[8]*yE+(e[9]<<16)+(e[10]<<8)+e[11]}}(this.buffer.subarray(0,12));return this.buffer.consume(12),e}async readBytes(e){if(this.buffer.length<e)for await(const n of this.source)if(this.buffer.append(n),this.buffer.length>=e)break;const t=this.buffer.sublist(0,e);return this.buffer.consume(e),this.frameInProgress=!1,t}}function mE(e){const t=new Uint8Array(12);return t[1]=e.type,t[2]=e.flag>>>8,t[3]=e.flag,t[4]=e.streamID>>>24,t[5]=e.streamID>>>16,t[6]=e.streamID>>>8,t[7]=e.streamID,t[8]=e.length>>>24,t[9]=e.length>>>16,t[10]=e.length>>>8,t[11]=e.length,t}function wE(e,t){var n,r;const i=null===(n=(r=Zb(e)).return)||void 0===n?void 0:n.call(r);var o;null!=(o=i)&&"function"===typeof o.then&&"function"===typeof o.catch&&"function"===typeof o.finally&&i.catch((e=>{t.error("could not cause iterator to return",e)}))}function bE(e){return null!=e&&("function"===typeof e.then&&"function"===typeof e.catch&&"function"===typeof e.finally)}class EE{constructor(e){var t,n;je(this,"id",void 0),je(this,"direction",void 0),je(this,"timeline",void 0),je(this,"protocol",void 0),je(this,"metadata",void 0),je(this,"source",void 0),je(this,"status",void 0),je(this,"readStatus",void 0),je(this,"writeStatus",void 0),je(this,"log",void 0),je(this,"sinkController",void 0),je(this,"sinkEnd",void 0),je(this,"closed",void 0),je(this,"endErr",void 0),je(this,"streamSource",void 0),je(this,"onEnd",void 0),je(this,"onCloseRead",void 0),je(this,"onCloseWrite",void 0),je(this,"onReset",void 0),je(this,"onAbort",void 0),je(this,"sendCloseWriteTimeout",void 0),je(this,"sendingData",void 0),this.sinkController=new AbortController,this.sinkEnd=mn(),this.closed=mn(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=null!==(t=e.metadata)&&void 0!==t?t:{},this.direction=e.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=null!==(n=e.sendCloseWriteTimeout)&&void 0!==n?n:5e3,this.onEnd=e.onEnd,this.onCloseRead=null===e||void 0===e?void 0:e.onCloseRead,this.onCloseWrite=null===e||void 0===e?void 0:e.onCloseWrite,this.onReset=null===e||void 0===e?void 0:e.onReset,this.onAbort=null===e||void 0===e?void 0:e.onAbort,this.source=this.streamSource=_n({onEnd:e=>{null!=e?this.log.trace("source ended with error",e):this.log.trace("source ended"),this.onSourceEnd(e)}}),this.sink=this.sink.bind(this)}async sink(e){if("ready"!==this.writeStatus)throw new Mr('writable end state is "'.concat(this.writeStatus,'" not "ready"'),"ERR_SINK_INVALID_STATE");try{this.writeStatus="writing";const t={signal:this.sinkController.signal};if("outbound"===this.direction){const e=this.sendNewStream(t);bE(e)&&await e}const n=()=>{wE(e,this.log)};try{this.sinkController.signal.addEventListener("abort",n),this.log.trace("sink reading from source");for await(let n of e){n=n instanceof Uint8Array?new Gu(n):n;const e=this.sendData(n,t);bE(e)&&(this.sendingData=mn(),await e,this.sendingData.resolve(),this.sendingData=void 0)}}finally{this.sinkController.signal.removeEventListener("abort",n)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),"writing"===this.writeStatus&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(t){throw this.log.trace("sink ended with error, calling abort with error",t),this.abort(t),t}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(e){var t;null==this.timeline.closeRead&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",null!=e&&null==this.endErr&&(this.endErr=e),null===(t=this.onCloseRead)||void 0===t||t.call(this),null!=this.timeline.closeWrite?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),"aborted"!==this.status&&"reset"!==this.status&&(this.status="closed"),null!=this.onEnd&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){var t;null==this.timeline.closeWrite&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",null!=e&&null==this.endErr&&(this.endErr=e),null===(t=this.onCloseWrite)||void 0===t||t.call(this),null!=this.timeline.closeRead?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),"aborted"!==this.status&&"reset"!==this.status&&(this.status="closed"),null!=this.onEnd&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(e){this.log.trace("closing gracefully"),this.status="closing",await Vp(Promise.all([this.closeWrite(e),this.closeRead(e),this.closed.promise]),null===e||void 0===e?void 0:e.signal),this.status="closed",this.log.trace("closed gracefully")}async closeRead(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("closing"===this.readStatus||"closed"===this.readStatus)return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);const t=this.readStatus;this.readStatus="closing","reset"!==this.status&&"aborted"!==this.status&&null==this.timeline.closeRead&&(this.log.trace("send close read to remote"),await this.sendCloseRead(e)),"ready"===t&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"closing"!==this.writeStatus&&"closed"!==this.writeStatus&&(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),"ready"===this.writeStatus&&(this.log.trace("sink was never sunk, sink an empty array"),await Vp(this.sink([]),e.signal)),"writing"===this.writeStatus&&(null!=this.sendingData&&await Vp(this.sendingData.promise,e.signal),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),await Vp(this.sinkEnd.promise,e.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(e){var t;if("closed"===this.status||"aborted"===this.status||"reset"===this.status)return;this.log("abort with error",e),this.log("try to send reset to remote");const n=this.sendReset();bE(n)&&n.catch((e=>{this.log.error("error sending reset message",e)})),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),null===(t=this.onAbort)||void 0===t||t.call(this,e)}reset(){var e;if("closed"===this.status||"aborted"===this.status||"reset"===this.status)return;const t=new Mr("stream reset","ERR_STREAM_RESET");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(t),null===(e=this.onReset)||void 0===e||e.call(this)}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){"writing"===this.writeStatus&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){"closing"!==this.readStatus&&"closed"!==this.readStatus&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){"closing"!==this.readStatus&&"closed"!==this.readStatus?(this.log.trace("remote close write"),this._closeSource()):this.log("received remote close write but local source is already closed")}remoteCloseRead(){"closing"!==this.writeStatus&&"closed"!==this.writeStatus?(this.log.trace("remote close read"),this._closeSink()):this.log("received remote close read but local sink is already closed")}destroy(){"closed"!==this.status&&"aborted"!==this.status&&"reset"!==this.status?(this.log.trace("stream destroyed"),this._closeSinkAndSource()):this.log("received destroy but we are already closed")}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}}var _E;!function(e){e[e.Init=0]="Init",e[e.SYNSent=1]="SYNSent",e[e.SYNReceived=2]="SYNReceived",e[e.Established=3]="Established",e[e.Finished=4]="Finished"}(_E||(_E={}));class SE extends EE{constructor(e){super({...e,onEnd:t=>{var n;this.state=_E.Finished,null===(n=e.onEnd)||void 0===n||n.call(e,t)}}),je(this,"name",void 0),je(this,"state",void 0),je(this,"config",void 0),je(this,"_id",void 0),je(this,"sendWindowCapacity",void 0),je(this,"sendWindowCapacityUpdate",void 0),je(this,"recvWindow",void 0),je(this,"recvWindowCapacity",void 0),je(this,"epochStart",void 0),je(this,"getRTT",void 0),je(this,"sendFrame",void 0),this.config=e.config,this._id=parseInt(e.id,10),this.name=e.name,this.state=e.state,this.sendWindowCapacity=hE,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=e.getRTT,this.sendFrame=e.sendFrame,this.source=Gg(this.source,(()=>{this.sendWindowUpdate()}))}async sendNewStream(){}async sendData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(e=e.sublist();0!==e.byteLength;){var n,r;if(0===this.sendWindowCapacity)if(null===(n=this.log)||void 0===n||n.trace("wait for send window capacity, status %s",this.status),await this.waitForSendWindowCapacity(t),"closed"===this.status||"aborted"===this.status||"reset"===this.status)return void(null===(r=this.log)||void 0===r||r.trace("%s while waiting for send window capacity",this.status));const i=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-12,e.length),o=this.getSendFlags();this.sendFrame({type:fE.Data,flag:o,streamID:this._id,length:i},e.sublist(0,i)),this.sendWindowCapacity-=i,e.consume(i)}}async sendReset(){this.sendFrame({type:fE.WindowUpdate,flag:pE.RST,streamID:this._id,length:0})}async sendCloseWrite(){const e=this.getSendFlags()|pE.FIN;this.sendFrame({type:fE.WindowUpdate,flag:e,streamID:this._id,length:0})}async sendCloseRead(){}async waitForSendWindowCapacity(){var e;let t,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.sendWindowCapacity>0)return;const i=()=>{"open"===this.status||"closing"===this.status?n(new Mr("stream aborted","ERR_STREAM_ABORT")):t()};null===(e=r.signal)||void 0===e||e.addEventListener("abort",i);try{await new Promise(((e,r)=>{this.sendWindowCapacityUpdate=()=>{e()},n=r,t=e}))}finally{var o;null===(o=r.signal)||void 0===o||o.removeEventListener("abort",i)}}handleWindowUpdate(e){var t;null===(t=this.log)||void 0===t||t.trace("stream received window update id=%s",this._id),this.processFlags(e.flag);const n=this.sendWindowCapacity;var r;(this.sendWindowCapacity+=e.length,0===n&&e.length>0)&&(null===(r=this.sendWindowCapacityUpdate)||void 0===r||r.call(this))}async handleData(e,t){var n;if(null===(n=this.log)||void 0===n||n.trace("stream received data id=%s",this._id),this.processFlags(e.flag),this.recvWindowCapacity<e.length)throw new Mr("receive window exceeded",sE,{available:this.recvWindowCapacity,recv:e.length});const r=await t();this.recvWindowCapacity-=e.length,this.sourcePush(r)}processFlags(e){(e&pE.ACK)===pE.ACK&&this.state===_E.SYNSent&&(this.state=_E.Established),(e&pE.FIN)===pE.FIN&&this.remoteCloseWrite(),(e&pE.RST)===pE.RST&&this.reset()}getSendFlags(){switch(this.state){case _E.Init:return this.state=_E.SYNSent,pE.SYN;case _E.SYNReceived:return this.state=_E.Established,pE.ACK;default:return 0}}sendWindowUpdate(){const e=this.getSendFlags(),t=Date.now(),n=this.getRTT();if(0===e&&n>-1&&t-this.epochStart<4*n&&(this.recvWindow=Math.min(2*this.recvWindow,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&0===e)return;const r=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=t,this.sendFrame({type:fE.WindowUpdate,flag:e,streamID:this._id,length:r})}}const kE="/yamux/1.0.0";class AE{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};je(this,"protocol",kE),je(this,"_components",void 0),je(this,"_init",void 0),this._components=e,this._init=t}createStreamMuxer(e){return new IE(this._components,{...this._init,...e})}}class IE{constructor(e,t){var n;je(this,"protocol",kE),je(this,"source",void 0),je(this,"sink",void 0),je(this,"config",void 0),je(this,"log",void 0),je(this,"logger",void 0),je(this,"closeController",void 0),je(this,"nextStreamID",void 0),je(this,"_streams",void 0),je(this,"nextPingID",void 0),je(this,"activePing",void 0),je(this,"rtt",void 0),je(this,"client",void 0),je(this,"localGoAway",void 0),je(this,"remoteGoAway",void 0),je(this,"numInboundStreams",void 0),je(this,"numOutboundStreams",void 0),je(this,"onIncomingStream",void 0),je(this,"onStreamEnd",void 0),this.client="outbound"===t.direction,this.config={...dE,...t},this.logger=e.logger,this.log=this.logger.forComponent("libp2p:yamux"),function(e){if(e.keepAliveInterval<=0)throw new Mr("keep-alive interval must be positive",lE);if(e.maxInboundStreams<0)throw new Mr("max inbound streams must be larger or equal 0",lE);if(e.maxOutboundStreams<0)throw new Mr("max outbound streams must be larger or equal 0",lE);if(e.initialStreamWindowSize<hE)throw new Mr("InitialStreamWindowSize must be larger or equal 256 kB",lE);if(e.maxStreamWindowSize<e.initialStreamWindowSize)throw new Mr("MaxStreamWindowSize must be larger than the InitialStreamWindowSize",lE);if(e.maxStreamWindowSize>2**32-1)throw new Mr("MaxStreamWindowSize must be less than equal MAX_UINT32",lE);if(e.maxMessageSize<1024)throw new Mr("MaxMessageSize must be greater than a kilobyte",lE)}(this.config),this.closeController=new AbortController,vu(1/0,this.closeController.signal),this.onIncomingStream=t.onIncomingStream,this.onStreamEnd=t.onStreamEnd,this._streams=new Map,this.source=_n({onEnd:()=>{var e;null===(e=this.log)||void 0===e||e.trace("muxer source ended"),this._streams.forEach((e=>{e.destroy()}))}}),this.sink=async e=>{var t;const n=()=>{const t=Zb(e);if(null!=t.return){const e=t.return();null!=(n=e)&&"function"===typeof n.then&&e.catch((e=>{var t;null===(t=this.log)||void 0===t||t.call(this,"could not cause sink source to return",e)}))}var n};let r,i;try{const t=new vE(e);try{this.closeController.signal.addEventListener("abort",n);for await(const e of t.emitFrames())await this.handleFrame(e.header,e.readData)}finally{this.closeController.signal.removeEventListener("abort",n)}r=gE.NormalTermination}catch(a){const e=a.code;var o,s;if(aE.has(e))null===(o=this.log)||void 0===o||o.error("protocol error in sink",a),r=gE.ProtocolError;else null===(s=this.log)||void 0===s||s.error("internal error in sink",a),r=gE.InternalError;i=a}null===(t=this.log)||void 0===t||t.trace("muxer sink ended"),null!=i?this.abort(i,r):await this.close({reason:r})},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=-1,null===(n=this.log)||void 0===n||n.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch((e=>{var t;return null===(t=this.log)||void 0===t?void 0:t.error("keepalive error: %s",e)})),this.ping().catch((e=>{var t;return null===(t=this.log)||void 0===t?void 0:t.error("ping error: %s",e)}))}get streams(){return Array.from(this._streams.values())}newStream(e){var t;if(void 0!==this.remoteGoAway)throw new Mr("muxer closed remotely",uE);if(void 0!==this.localGoAway)throw new Mr("muxer closed locally",cE);const n=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new Mr("max outbound streams exceeded","ERROR_MAX_OUTBOUND_STREAMS_EXCEEDED");null===(t=this.log)||void 0===t||t.trace("new outgoing stream id=%s",n);const r=this._newStream(n,e,_E.Init,"outbound");return this._streams.set(n,r),this.numOutboundStreams++,r.sendWindowUpdate(),r}async ping(){if(void 0!==this.remoteGoAway)throw new Mr("muxer closed remotely",uE);if(void 0!==this.localGoAway)throw new Mr("muxer closed locally",cE);if(void 0===this.activePing){let e=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise(((t,n)=>{const r=()=>{n(new Mr("muxer closed locally",cE))};this.closeController.signal.addEventListener("abort",r,{once:!0}),e=()=>{this.closeController.signal.removeEventListener("abort",r),t()}})),resolve:e};const t=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}const n=Date.now();this.rtt=n-t}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}async close(){var e,t,n;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.closeController.signal.aborted)return;const i=null!==(e=null===(t=r)||void 0===t?void 0:t.reason)&&void 0!==e?e:gE.NormalTermination;if(null===(n=this.log)||void 0===n||n.trace("muxer close reason=%s",i),null==r.signal){const e=AbortSignal.timeout(500);vu(1/0,e),r={...r,signal:e}}try{await Promise.all([...this._streams.values()].map((async e=>e.close(r)))),this.sendGoAway(i),this._closeMuxer()}catch(o){this.abort(o)}}abort(e,t){var n,r;if(!this.closeController.signal.aborted){t=null!==(n=t)&&void 0!==n?n:gE.InternalError,null===(r=this.log)||void 0===r||r.error("muxer abort reason=%s error=%s",t,e);for(const t of this._streams.values())t.abort(e);this.sendGoAway(t),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(e,t,n,r){if(null!=this._streams.get(e))throw new Mr("Stream already exists",rE,{id:e});const i=new SE({id:e.toString(),name:t,state:n,direction:r,sendFrame:this.sendFrame.bind(this),onEnd:()=>{var t;this.closeStream(e),null===(t=this.onStreamEnd)||void 0===t||t.call(this,i)},log:this.logger.forComponent("libp2p:yamux:".concat(r,":").concat(e)),config:this.config,getRTT:this.getRTT.bind(this)});return i}closeStream(e){this.client===(e%2===0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(e)}async keepAliveLoop(){var e;const t=new Promise(((e,t)=>{this.closeController.signal.addEventListener("abort",t,{once:!0})}));for(null===(e=this.log)||void 0===e||e.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let e;try{await Promise.race([t,new Promise((t=>{e=setTimeout(t,this.config.keepAliveInterval)}))]),this.ping().catch((e=>{var t;return null===(t=this.log)||void 0===t?void 0:t.error("ping error: %s",e)}))}catch(n){return void clearInterval(e)}}}async handleFrame(e,t){var n;const{streamID:r,type:i,length:o}=e;if(null===(n=this.log)||void 0===n||n.trace("received frame %o",e),0===r)switch(i){case fE.Ping:return void this.handlePing(e);case fE.GoAway:return void this.handleGoAway(o);default:throw new Mr("Invalid frame type",eE,{header:e})}else switch(e.type){case fE.Data:case fE.WindowUpdate:return void await this.handleStreamMessage(e,t);default:throw new Mr("Invalid frame type",eE,{header:e})}}handlePing(e){if(e.flag===pE.SYN){var t;null===(t=this.log)||void 0===t||t.trace("received ping request pingId=%s",e.length),this.sendPing(e.length,pE.ACK)}else{if(e.flag!==pE.ACK)throw new Mr("Invalid frame flag",eE,{header:e});var n;null===(n=this.log)||void 0===n||n.trace("received ping response pingId=%s",e.length),this.handlePingResponse(e.length)}}handlePingResponse(e){if(void 0===this.activePing)throw new Mr("ping not requested",tE);if(this.activePing.id!==e)throw new Mr("ping doesn't match our id",nE);this.activePing.resolve()}handleGoAway(e){var t,n;null===(t=this.log)||void 0===t||t.trace("received GoAway reason=%s",null!==(n=gE[e])&&void 0!==n?n:"unknown"),this.remoteGoAway=e;for(const r of this._streams.values())r.reset();this._closeMuxer()}async handleStreamMessage(e,t){const{streamID:n,flag:r,type:i}=e;(r&pE.SYN)===pE.SYN&&this.incomingStream(n);const o=this._streams.get(n);if(void 0!==o)switch(i){case fE.WindowUpdate:return void o.handleWindowUpdate(e);case fE.Data:if(void 0===t)throw new Error("unreachable");return void await o.handleData(e,t);default:throw new Error("unreachable")}else if(i===fE.Data){var s;if(null===(s=this.log)||void 0===s||s.call(this,"discarding data for stream id=%s",n),void 0===t)throw new Error("unreachable");await t()}else{var a;null===(a=this.log)||void 0===a||a.call(this,"frame for missing stream id=%s",n)}}incomingStream(e){var t,n,r;if(this.client!==(e%2===0))throw new Mr("both endpoints are clients",oE);if(this._streams.has(e))return;if(null===(t=this.log)||void 0===t||t.trace("new incoming stream id=%s",e),void 0!==this.localGoAway)return void this.sendFrame({type:fE.WindowUpdate,flag:pE.RST,streamID:e,length:0});if(this.numInboundStreams>=this.config.maxInboundStreams)return null===(r=this.log)||void 0===r||r.call(this,"maxIncomingStreams exceeded, forcing stream reset"),void this.sendFrame({type:fE.WindowUpdate,flag:pE.RST,streamID:e,length:0});const i=this._newStream(e,void 0,_E.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(e,i),null===(n=this.onIncomingStream)||void 0===n||n.call(this,i)}sendFrame(e,t){var n;if(null===(n=this.log)||void 0===n||n.trace("sending frame %o",e),e.type===fE.Data){if(void 0===t)throw new Mr("invalid frame",eE);this.source.push(new Gu(mE(e),t))}else this.source.push(mE(e))}sendPing(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pE.SYN;var n,r;t===pE.SYN?null===(n=this.log)||void 0===n||n.trace("sending ping request pingId=%s",e):null===(r=this.log)||void 0===r||r.trace("sending ping response pingId=%s",e);this.sendFrame({type:fE.Ping,flag:t,streamID:0,length:e})}sendGoAway(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:gE.NormalTermination;null===(e=this.log)||void 0===e||e.call(this,"sending GoAway reason=%s",gE[t]),this.localGoAway=t,this.sendFrame({type:fE.GoAway,flag:0,streamID:0,length:t})}}function TE(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>new AE(t,e)}function RE(e){try{let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){const n=e.getReader();try{for(;;){const e=await n.read();if(e.done)return;yield e.value}}finally{!0!==t.preventCancel&&await n.cancel(),n.releaseLock()}}()}catch(t){return Promise.reject(t)}}const CE="ERR_UNRECOGNIZED_VALIDITY",xE="ERR_SIGNATURE_VERIFICATION",PE="ERR_UNDEFINED_PARAMETER",DE="ERR_RECORD_TOO_LARGE";var NE;!function(e){let t,n,r;!function(e){e.EOL="EOL"}(t=e.ValidityType||(e.ValidityType={})),function(e){e[e.EOL=0]="EOL"}(n||(n={})),function(e){e.codec=()=>Gs(n)}(t=e.ValidityType||(e.ValidityType={})),e.codec=()=>(null==r&&(r=Ys((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==r.lengthDelimited&&n.fork(),null!=t.value&&(n.uint32(10),n.bytes(t.value)),null!=t.signatureV1&&(n.uint32(18),n.bytes(t.signatureV1)),null!=t.validityType&&(n.uint32(24),e.ValidityType.codec().encode(t.validityType,n)),null!=t.validity&&(n.uint32(34),n.bytes(t.validity)),null!=t.sequence&&(n.uint32(40),n.uint64(t.sequence)),null!=t.ttl&&(n.uint32(48),n.uint64(t.ttl)),null!=t.pubKey&&(n.uint32(58),n.bytes(t.pubKey)),null!=t.signatureV2&&(n.uint32(66),n.bytes(t.signatureV2)),null!=t.data&&(n.uint32(74),n.bytes(t.data)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();switch(n>>>3){case 1:r.value=t.bytes();break;case 2:r.signatureV1=t.bytes();break;case 3:r.validityType=e.ValidityType.codec().decode(t);break;case 4:r.validity=t.bytes();break;case 5:r.sequence=t.uint64();break;case 6:r.ttl=t.uint64();break;case 7:r.pubKey=t.bytes();break;case 8:r.signatureV2=t.bytes();break;case 9:r.data=t.bytes();break;default:t.skipType(7&n)}}return r}))),r),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(NE||(NE={}));const BE=pn("ipns:utils"),LE=yr("/ipns/"),OE=async(e,t)=>{if(null==t||null==e){const e=new Error("one or more of the provided parameters are not defined");throw BE.error(e),qe(e,PE)}let n;if(null!=t.pubKey){try{n=hu(t.pubKey)}catch(r){throw BE.error(r),r}if(!(await Fu(t.pubKey)).equals(e))throw qe(new Error("Embedded public key did not match PeerID"),"ERR_INVALID_EMBEDDED_KEY")}else null!=e.publicKey&&(n=hu(e.publicKey));if(null!=n)return n;throw qe(new Error("no public key is available"),PE)},ME=e=>"signatureV1"in e?NE.encode({value:yr(e.value),signatureV1:e.signatureV1,validityType:e.validityType,validity:yr(e.validity),sequence:e.sequence,ttl:e.ttl,pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data}):NE.encode({pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data});function UE(e){const t=NE.decode(e);if(null!=t.sequence&&(t.sequence=BigInt(t.sequence)),null!=t.ttl&&(t.ttl=BigInt(t.ttl)),null==t.signatureV2||null==t.data)throw qe(new Error("missing data or signatureV2"),xE);const n=VE(t.data),r=zE(n.Value),i=vr(n.Validity);if(null!=t.value&&null!=t.signatureV1)return KE(t),{value:r,validityType:NE.ValidityType.EOL,validity:i,sequence:n.Sequence,ttl:n.TTL,pubKey:t.pubKey,signatureV1:t.signatureV1,signatureV2:t.signatureV2,data:t.data};if(null!=t.signatureV2)return{value:r,validityType:NE.ValidityType.EOL,validity:i,sequence:n.Sequence,ttl:n.TTL,pubKey:t.pubKey,signatureV2:t.signatureV2,data:t.data};throw new Error("invalid record: does not include signatureV1 or signatureV2")}const FE=e=>Uu(e.slice(LE.length)),VE=e=>{const t=Sm(e);if(0!==t.ValidityType)throw qe(new Error("Unknown validity type"),CE);return t.ValidityType=NE.ValidityType.EOL,Number.isInteger(t.Sequence)&&(t.Sequence=BigInt(t.Sequence)),Number.isInteger(t.TTL)&&(t.TTL=BigInt(t.TTL)),t},zE=e=>{if(null!=e){if(Tu(e))return"/ipns/".concat(e.toCID().toString(Wn));if(e instanceof Uint8Array){const t=vr(e);t.startsWith("/")&&(e=t)}const t=e.toString().trim();if(t.startsWith("/")&&t.length>1)return t;const n=Jt.asCID(e);if(null!=n)return 114===n.code?"/ipns/".concat(n.toString(Wn)):"/ipfs/".concat(n.toV1().toString());try{return e instanceof Uint8Array?"/ipfs/".concat(Jt.decode(e).toV1().toString()):"/ipfs/".concat(Jt.parse(t).toV1().toString())}catch{}}throw qe(new Error("Value must be a valid content path starting with /"),"ERR_INVALID_VALUE")},KE=e=>{var t,n;if(null==e.data)throw qe(new Error("Record data is missing"),"ERR_INVALID_RECORD_DATA");const r=VE(e.data);if(!Hr(r.Value,null!==(t=e.value)&&void 0!==t?t:new Uint8Array(0)))throw qe(new Error('Field "value" did not match between protobuf and CBOR'),xE);if(!Hr(r.Validity,null!==(n=e.validity)&&void 0!==n?n:new Uint8Array(0)))throw qe(new Error('Field "validity" did not match between protobuf and CBOR'),xE);if(r.ValidityType!==e.validityType)throw qe(new Error('Field "validityType" did not match between protobuf and CBOR'),xE);if(r.Sequence!==e.sequence)throw qe(new Error('Field "sequence" did not match between protobuf and CBOR'),xE);if(r.TTL!==e.ttl)throw qe(new Error('Field "ttl" did not match between protobuf and CBOR'),xE)};var jE=n(7353);const HE=pn("ipns:validator"),qE=10240,WE=async(e,t)=>{const n=UE(t);let r;try{const t=(i=n.data,Wo([yr("ipns-signature:"),i]));r=await e.verify(t,n.signatureV2)}catch(o){r=!1}var i;if(!r)throw HE.error("record signature verification failed"),qe(new Error("record signature verification failed"),xE);if(n.validityType===NE.ValidityType.EOL){if(jE.fromString(n.validity).toDate().getTime()<Date.now())throw HE.error("record has expired"),qe(new Error("record has expired"),"ERR_IPNS_EXPIRED_RECORD")}else if(null!=n.validityType)throw HE.error("unrecognized validity type"),qe(new Error("unrecognized validity type"),CE);HE("ipns record for %s is valid",n.value)};async function GE(e,t){if(t.byteLength>qE)throw qe(new Error("record too large"),DE);const n=FE(e),r=UE(t),i=await OE(n,r);await WE(i,t)}async function*YE(e){const t=/\r?\n/,n=new TextDecoder("utf8");let r="";for await(let o of e){var i;"string"===typeof o&&(o=(new TextEncoder).encode(o)),r+=n.decode(o,{stream:!0});const e=r.split(t);r=null!==(i=e.pop())&&void 0!==i?i:"";for(let t=0;t<e.length;t++)yield JSON.parse(e[t])}r+=n.decode(),""!==r&&(yield JSON.parse(r))}const QE=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{for await(const t of e)return t})();for(const t of e)return t},XE=yr("/ipns/");function JE(e){return Hr(e.subarray(0,XE.byteLength),XE)}const $E=e=>Uu(e.slice(XE.length));class ZE{constructor(e){je(this,"client",void 0),this.client=e}findProviders(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){yield*Rr(t.client.getProviders(e,n),(e=>{var t;return{id:e.ID,multiaddrs:null!==(t=e.Addrs)&&void 0!==t?t:[]}}))}()}catch(n){return Promise.reject(n)}}async provide(){}async put(e,t,n){if(!JE(e))return;const r=$E(e),i=UE(t);await this.client.putIPNS(r,i,n)}async get(e,t){if(!JE(e))throw new Mr("Not found","ERR_NOT_FOUND");const n=$E(e);try{const e=await this.client.getIPNS(n,t);return ME(e)}catch(r){if("ERR_BAD_RESPONSE"===r.code)throw new Mr("Not found","ERR_NOT_FOUND");throw r}}}class e_{constructor(e){je(this,"client",void 0),this.client=e}async findPeer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=await QE(this.client.getPeers(e,t));var r;if(null!=n)return{id:n.ID,multiaddrs:null!==(r=n.Addrs)&&void 0!==r?r:[]};throw new Mr("Not found","ERR_NOT_FOUND")}getClosestPeers(e){try{return async function*(){}()}catch(t){return Promise.reject(t)}}}const t_=pn("delegated-routing-v1-http-api-client"),n_=4,r_=3e4;var i_=new WeakSet;class o_{constructor(e){var t,n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Ve(this,i_),je(this,"started",void 0),je(this,"httpQueue",void 0),je(this,"shutDownController",void 0),je(this,"clientUrl",void 0),je(this,"timeout",void 0),je(this,"contentRouting",void 0),je(this,"peerRouting",void 0),this.started=!1,this.shutDownController=new AbortController,vu(1/0,this.shutDownController.signal),this.httpQueue=new yd({concurrency:null!==(t=r.concurrentRequests)&&void 0!==t?t:n_}),this.clientUrl=e instanceof URL?e:new URL(e),this.timeout=null!==(n=r.timeout)&&void 0!==n?n:r_,this.contentRouting=new ZE(this),this.peerRouting=new e_(this)}get[Su](){return this.contentRouting}get[ku](){return this.peerRouting}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.shutDownController.abort(),this.started=!1}getProviders(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){t_("getProviders starts: %c",e);const r=AbortSignal.timeout(t.timeout),i=Xp([t.shutDownController.signal,r,n.signal]);vu(1/0,r,i);const o=mn(),s=mn();t.httpQueue.add((async()=>(o.resolve(),s.promise)));try{await o.promise;const n="".concat(t.clientUrl,"routing/v1/providers/").concat(e.toString()),r={headers:{Accept:"application/x-ndjson"},signal:i},s=await fetch(n,r);if(404===s.status)throw new Mr("No matching records found.","ERR_NOT_FOUND");if(422===s.status)throw new Mr("Request does not conform to schema or semantic constraints.","ERR_INVALID_REQUEST");if(null==s.body)throw new Mr("Routing response had no body","ERR_BAD_RESPONSE");if("application/json"===s.headers.get("Content-Type")){const e=await s.json();for(const n of e.Providers){const e=He(i_,t,s_).call(t,n);null!=e&&(yield e)}}else for await(const e of YE(RE(s.body))){const n=He(i_,t,s_).call(t,e);null!=n&&(yield n)}}catch(a){t_.error("getProviders errored:",a)}finally{i.clear(),s.resolve(),t_("getProviders finished: %c",e)}}()}catch(n){return Promise.reject(n)}}getPeers(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){t_("getPeers starts: %c",e);const r=AbortSignal.timeout(t.timeout),i=Xp([t.shutDownController.signal,r,n.signal]);vu(1/0,r,i);const o=mn(),s=mn();t.httpQueue.add((async()=>(o.resolve(),s.promise)));try{await o.promise;const n="".concat(t.clientUrl,"routing/v1/peers/").concat(e.toCID().toString()),r={headers:{Accept:"application/x-ndjson"},signal:i},s=await fetch(n,r);if(404===s.status)throw new Mr("No matching records found.","ERR_NOT_FOUND");if(422===s.status)throw new Mr("Request does not conform to schema or semantic constraints.","ERR_INVALID_REQUEST");if(null==s.body)throw new Mr("Routing response had no body","ERR_BAD_RESPONSE");if("application/json"===s.headers.get("Content-Type")){const e=await s.json();for(const n of e.Peers){const e=He(i_,t,s_).call(t,n);null!=e&&(yield e)}}else for await(const e of YE(RE(s.body))){const n=He(i_,t,s_).call(t,e);null!=n&&(yield n)}}catch(a){t_.error("getPeers errored:",a)}finally{i.clear(),s.resolve(),t_("getPeers finished: %c",e)}}()}catch(n){return Promise.reject(n)}}async getIPNS(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t_("getIPNS starts: %c",e);const n=AbortSignal.timeout(this.timeout),r=Xp([this.shutDownController.signal,n,t.signal]);vu(1/0,n,r);const i=mn(),o=mn();this.httpQueue.add((async()=>(i.resolve(),o.promise)));const s="".concat(this.clientUrl,"routing/v1/ipns/").concat(e.toCID().toString());try{await i.promise;const n={headers:{Accept:"application/vnd.ipfs.ipns-record"},signal:r},o=await fetch(s,n);if(t_("getIPNS GET %s %d",s,o.status),404===o.status)throw new Mr("No matching records found.","ERR_NOT_FOUND");if(422===o.status)throw new Mr("Request does not conform to schema or semantic constraints.","ERR_INVALID_REQUEST");if(null==o.body)throw new Mr("GET ipns response had no body","ERR_BAD_RESPONSE");const a=await o.arrayBuffer(),l=new Uint8Array(a,0,a.byteLength);return!1!==t.validate&&await GE((e=>Wo([LE,e.toBytes()]))(e),l),UE(l)}catch(a){throw t_.error("getIPNS GET %s error:",s,a),a}finally{r.clear(),o.resolve(),t_("getIPNS finished: %c",e)}}async putIPNS(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};t_("putIPNS starts: %c",e);const r=AbortSignal.timeout(this.timeout),i=Xp([this.shutDownController.signal,r,n.signal]);vu(1/0,r,i);const o=mn(),s=mn();this.httpQueue.add((async()=>(o.resolve(),s.promise)));const a="".concat(this.clientUrl,"routing/v1/ipns/").concat(e.toCID().toString());try{await o.promise;const e={method:"PUT",headers:{"Content-Type":"application/vnd.ipfs.ipns-record"},body:ME(t),signal:i},n=await fetch(a,e);if(t_("putIPNS PUT %s %d",a,n.status),200!==n.status)throw new Mr("PUT ipns response had status other than 200","ERR_BAD_RESPONSE")}catch(l){throw t_.error("putIPNS PUT %s error:",a,l.stack),l}finally{i.clear(),s.resolve(),t_("putIPNS finished: %c",e)}}}function s_(e){var t,n;const r=[],i=null!==(t=null===(n=e.Addrs)||void 0===n?void 0:n.map(Vh))&&void 0!==t?t:[];return null!=e.Protocols&&r.push(...e.Protocols),null!=e.Protocol&&(r.push(e.Protocol),delete e.Protocol),{...e,Schema:"peer",ID:Mu(e.ID),Addrs:i,Protocols:r}}var a_;!function(e){let t,n,r,i,o,s,a,l;!function(e){e.DIAL="DIAL",e.DIAL_RESPONSE="DIAL_RESPONSE"}(t=e.MessageType||(e.MessageType={})),function(e){e[e.DIAL=0]="DIAL",e[e.DIAL_RESPONSE=1]="DIAL_RESPONSE"}(n||(n={})),function(e){e.codec=()=>Gs(n)}(t=e.MessageType||(e.MessageType={})),function(e){e.OK="OK",e.E_DIAL_ERROR="E_DIAL_ERROR",e.E_DIAL_REFUSED="E_DIAL_REFUSED",e.E_BAD_REQUEST="E_BAD_REQUEST",e.E_INTERNAL_ERROR="E_INTERNAL_ERROR"}(r=e.ResponseStatus||(e.ResponseStatus={})),function(e){e[e.OK=0]="OK",e[e.E_DIAL_ERROR=100]="E_DIAL_ERROR",e[e.E_DIAL_REFUSED=101]="E_DIAL_REFUSED",e[e.E_BAD_REQUEST=200]="E_BAD_REQUEST",e[e.E_INTERNAL_ERROR=300]="E_INTERNAL_ERROR"}(i||(i={})),function(e){e.codec=()=>Gs(i)}(r=e.ResponseStatus||(e.ResponseStatus={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==n.lengthDelimited&&t.fork(),null!=e.id&&(t.uint32(10),t.bytes(e.id)),null!=e.addrs)for(const r of e.addrs)t.uint32(18),t.bytes(r);!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={addrs:[]},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.id=e.bytes();break;case 2:n.addrs.push(e.bytes());break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(o=e.PeerInfo||(e.PeerInfo={})),function(t){let n;t.codec=()=>(null==n&&(n=Ys((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==r.lengthDelimited&&n.fork(),null!=t.peer&&(n.uint32(10),e.PeerInfo.codec().encode(t.peer,n)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();if(n>>>3===1)r.peer=e.PeerInfo.codec().decode(t,t.uint32());else t.skipType(7&n)}return r}))),n),t.encode=e=>Vs(e,t.codec()),t.decode=e=>Is(e,t.codec())}(s=e.Dial||(e.Dial={})),function(t){let n;t.codec=()=>(null==n&&(n=Ys((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==r.lengthDelimited&&n.fork(),null!=t.status&&(n.uint32(8),e.ResponseStatus.codec().encode(t.status,n)),null!=t.statusText&&(n.uint32(18),n.string(t.statusText)),null!=t.addr&&(n.uint32(26),n.bytes(t.addr)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();switch(n>>>3){case 1:r.status=e.ResponseStatus.codec().decode(t);break;case 2:r.statusText=t.string();break;case 3:r.addr=t.bytes();break;default:t.skipType(7&n)}}return r}))),n),t.encode=e=>Vs(e,t.codec()),t.decode=e=>Is(e,t.codec())}(a=e.DialResponse||(e.DialResponse={})),e.codec=()=>(null==l&&(l=Ys((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==r.lengthDelimited&&n.fork(),null!=t.type&&(n.uint32(8),e.MessageType.codec().encode(t.type,n)),null!=t.dial&&(n.uint32(18),e.Dial.codec().encode(t.dial,n)),null!=t.dialResponse&&(n.uint32(26),e.DialResponse.codec().encode(t.dialResponse,n)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();switch(n>>>3){case 1:r.type=e.MessageType.codec().decode(t);break;case 2:r.dial=e.Dial.codec().decode(t,t.uint32());break;case 3:r.dialResponse=e.DialResponse.codec().decode(t,t.uint32());break;default:t.skipType(7&n)}}return r}))),l),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(a_||(a_={}));class l_{constructor(e,t){var n,r,i,o,s,a;je(this,"components",void 0),je(this,"startupDelay",void 0),je(this,"refreshInterval",void 0),je(this,"protocol",void 0),je(this,"timeout",void 0),je(this,"maxInboundStreams",void 0),je(this,"maxOutboundStreams",void 0),je(this,"verifyAddressTimeout",void 0),je(this,"started",void 0),je(this,"log",void 0),this.components=e,this.log=e.logger.forComponent("libp2p:autonat"),this.started=!1,this.protocol="/".concat(null!==(n=t.protocolPrefix)&&void 0!==n?n:"libp2p","/").concat("autonat","/").concat("1.0.0"),this.timeout=null!==(r=t.timeout)&&void 0!==r?r:3e4,this.maxInboundStreams=null!==(i=t.maxInboundStreams)&&void 0!==i?i:1,this.maxOutboundStreams=null!==(o=t.maxOutboundStreams)&&void 0!==o?o:1,this.startupDelay=null!==(s=t.startupDelay)&&void 0!==s?s:5e3,this.refreshInterval=null!==(a=t.refreshInterval)&&void 0!==a?a:6e4,this._verifyExternalAddresses=this._verifyExternalAddresses.bind(this)}isStarted(){return this.started}async start(){this.started||(await this.components.registrar.handle(this.protocol,(e=>{this.handleIncomingAutonatStream(e).catch((e=>{this.log.error("error handling incoming autonat stream",e)}))}),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),this.verifyAddressTimeout=setTimeout(this._verifyExternalAddresses,this.startupDelay),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.protocol),clearTimeout(this.verifyAddressTimeout),this.started=!1}async handleIncomingAutonatStream(e){const t=AbortSignal.timeout(this.timeout),n=()=>{e.stream.abort(new Mr("handleIncomingAutonatStream timeout",Kr))};t.addEventListener("abort",n,{once:!0}),vu(1/0,t);const r=this.components.addressManager.getAddresses().map((e=>e.toOptions().host));try{const n=this;await Cr(e.stream,(e=>Eg(e)),(async function*(i){const o=await QE(i);if(null==o)return n.log("no message received"),void(yield a_.encode({type:a_.MessageType.DIAL_RESPONSE,dialResponse:{status:a_.ResponseStatus.E_BAD_REQUEST,statusText:"No message was sent"}}));let s;try{s=a_.decode(o)}catch(f){return n.log.error("could not decode message",f),void(yield a_.encode({type:a_.MessageType.DIAL_RESPONSE,dialResponse:{status:a_.ResponseStatus.E_BAD_REQUEST,statusText:"Could not decode message"}}))}const a=s.dial;if(null==a)return n.log.error("dial was missing from message"),void(yield a_.encode({type:a_.MessageType.DIAL_RESPONSE,dialResponse:{status:a_.ResponseStatus.E_BAD_REQUEST,statusText:"No Dial message found in message"}}));let l;const c=a.peer;if(null==c||null==c.id)return n.log.error("PeerId missing from message"),void(yield a_.encode({type:a_.MessageType.DIAL_RESPONSE,dialResponse:{status:a_.ResponseStatus.E_BAD_REQUEST,statusText:"missing peer info"}}));try{l=Uu(c.id)}catch(f){return n.log.error("invalid PeerId",f),void(yield a_.encode({type:a_.MessageType.DIAL_RESPONSE,dialResponse:{status:a_.ResponseStatus.E_BAD_REQUEST,statusText:"bad peer id"}}))}if(n.log("incoming request from %p",l),!e.connection.remotePeer.equals(l))return n.log("target peer %p did not equal sending peer %p",l,e.connection.remotePeer),void(yield a_.encode({type:a_.MessageType.DIAL_RESPONSE,dialResponse:{status:a_.ResponseStatus.E_BAD_REQUEST,statusText:"peer id mismatch"}}));const u=c.addrs.map((e=>Vh(e))).filter((t=>{const r=t.toOptions().host===e.connection.remoteAddr.toOptions().host;return n.log.trace("request to dial %a was sent from %a is same host %s",t,e.connection.remoteAddr,r),r})).filter((e=>{var t;const r=e.toOptions().host,i=!(null!==(t=kf(r))&&void 0!==t&&t);return n.log.trace("host %s was public %s",r,i),i})).filter((e=>{const t=e.toOptions().host,i=!r.includes(t);return n.log.trace("host %s was not our host %s",t,i),i})).filter((e=>{const t=Boolean(n.components.transportManager.transportForMultiaddr(e));return n.log.trace("transport for %a is supported %s",e,t),t})).map((e=>(null==e.getPeerId()&&(e=e.encapsulate("/p2p/".concat(l.toString()))),e)));if(0===u.length)return n.log("no valid multiaddrs for %p in message",l),void(yield a_.encode({type:a_.MessageType.DIAL_RESPONSE,dialResponse:{status:a_.ResponseStatus.E_DIAL_REFUSED,statusText:"no dialable addresses"}}));n.log("dial multiaddrs %s for peer %p",u.map((e=>e.toString())).join(", "),l);let h="",d=u[0];for await(const e of u){let r;d=e;try{if(r=await n.components.connectionManager.openConnection(e,{signal:t}),!r.remoteAddr.equals(e))throw n.log.error("tried to dial %a but dialed %a",e,r.remoteAddr),new Error("Unexpected remote address");return n.log("Success %p",l),void(yield a_.encode({type:a_.MessageType.DIAL_RESPONSE,dialResponse:{status:a_.ResponseStatus.OK,addr:r.remoteAddr.decapsulateCode(fh("p2p").code).bytes}}))}catch(f){n.log("could not dial %p",l,f),h=f.message}finally{null!=r&&await r.close()}}yield a_.encode({type:a_.MessageType.DIAL_RESPONSE,dialResponse:{status:a_.ResponseStatus.E_DIAL_ERROR,statusText:h,addr:d.bytes}})}),(e=>mg(e)),e.stream)}catch(i){this.log.error("error handling incoming autonat stream",i)}finally{t.removeEventListener("abort",n)}}_verifyExternalAddresses(){this.verifyExternalAddresses().catch((e=>{this.log.error("error verifying external address",e)}))}async verifyExternalAddresses(){if(clearTimeout(this.verifyAddressTimeout),!this.isStarted())return;const e=this.components.addressManager,t=e.getObservedAddrs().filter((e=>{var t;return!(null!==(t=kf(e.toOptions().host))&&void 0!==t&&t)}));if(0===t.length)return this.log("no public addresses found, not requesting verification"),void(this.verifyAddressTimeout=setTimeout(this._verifyExternalAddresses,this.refreshInterval));const n=AbortSignal.timeout(this.timeout);vu(1/0,n);const r=this;try{this.log("verify multiaddrs %s",t.map((e=>e.toString())).join(", "));const o=a_.encode({type:a_.MessageType.DIAL,dial:{peer:{id:this.components.peerId.toBytes(),addrs:t.map((e=>e.bytes))}}}),s=(await Ku()).toBytes(),a={},l=[],c=async e=>{let t=()=>{};try{this.log("asking %p to verify multiaddr",e.id);const i=await r.components.connectionManager.openConnection(e.id,{signal:n}),s=await i.newStream(this.protocol,{signal:n});t=()=>{s.abort(new Mr("verifyAddress timeout",Kr))},n.addEventListener("abort",t,{once:!0});const a=await Cr([o],(e=>mg(e)),s,(e=>Eg(e)),(async e=>QE(e)));if(null==a)return void this.log("no response received from %p",i.remotePeer);const c=a_.decode(a);if(c.type!==a_.MessageType.DIAL_RESPONSE||null==c.dialResponse)return void this.log("invalid autonat response from %p",i.remotePeer);if(c.dialResponse.status===a_.ResponseStatus.OK){const e=i.remoteAddr.toOptions();let t;if(4===e.family){t=e.host.split(".")[0]}else{if(6!==e.family)return void this.log('remote address "%s" was not IP4 or IP6?',e.host);t=e.host.split(":")[0]}if(l.includes(t))return void this.log("already have response from network segment %d - %s",t,e.host);l.push(t)}return c.dialResponse}catch(i){this.log.error("error asking remote to verify multiaddr",i)}finally{n.removeEventListener("abort",t)}};for await(const r of ug(Rr(this.components.peerRouting.getClosestPeers(s,{signal:n}),(e=>async()=>c(e))),{concurrency:4}))try{if(null==r)continue;const n=null==r.addr?t[0]:Vh(r.addr);if(this.log("autonat response for %a is %s",n,r.status),r.status===a_.ResponseStatus.E_BAD_REQUEST)continue;if(r.status===a_.ResponseStatus.E_DIAL_REFUSED)continue;if(null==r.addr&&t.length>1)continue;if(!t.some((e=>e.equals(n)))){this.log("peer reported %a as %s but it was not in our observed address list",n,r.status);continue}const i=n.toString();if(null==a[i]&&(a[i]={success:0,failure:0}),r.status===a_.ResponseStatus.OK?a[i].success++:r.status===a_.ResponseStatus.E_DIAL_ERROR&&a[i].failure++,4===a[i].success)return this.log("%a is externally dialable",n),void e.confirmObservedAddr(n);if(4===a[i].failure)return this.log("%a is not externally dialable",n),void e.removeObservedAddr(n)}catch(i){this.log.error("could not verify external address",i)}}finally{this.verifyAddressTimeout=setTimeout(this._verifyExternalAddresses,this.refreshInterval)}}}function c_(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>new l_(t,e)}const u_=z_("dns4"),h_=z_("dns6"),d_=z_("dnsaddr"),f_=V_(z_("dns"),d_,u_,h_),p_=V_(z_("ip4"),z_("ip6")),g_=V_(F_(p_,z_("tcp")),F_(f_,z_("tcp"))),y_=F_(p_,z_("udp")),v_=F_(y_,z_("utp")),m_=F_(y_,z_("quic")),w_=F_(y_,z_("quic-v1")),b_=V_(F_(g_,z_("ws")),F_(f_,z_("ws"))),E_=V_(F_(b_,z_("p2p")),b_),__=V_(F_(g_,z_("wss")),F_(f_,z_("wss")),F_(g_,z_("tls"),z_("ws")),F_(f_,z_("tls"),z_("ws"))),S_=V_(F_(__,z_("p2p")),__),k_=V_(F_(g_,z_("http")),F_(p_,z_("http")),F_(f_,z_("http"))),A_=V_(F_(g_,z_("https")),F_(p_,z_("https")),F_(f_,z_("https"))),I_=F_(y_,z_("webrtc-direct"),z_("certhash")),T_=V_(F_(I_,z_("p2p")),I_),R_=F_(w_,z_("webtransport"),z_("certhash"),z_("certhash")),C_=V_(F_(R_,z_("p2p")),R_),x_=V_(F_(E_,z_("p2p-webrtc-star"),z_("p2p")),F_(S_,z_("p2p-webrtc-star"),z_("p2p")),F_(E_,z_("p2p-webrtc-star")),F_(S_,z_("p2p-webrtc-star"))),P_=(V_(F_(E_,z_("p2p-websocket-star"),z_("p2p")),F_(S_,z_("p2p-websocket-star"),z_("p2p")),F_(E_,z_("p2p-websocket-star")),F_(S_,z_("p2p-websocket-star"))),V_(F_(k_,z_("p2p-webrtc-direct"),z_("p2p")),F_(A_,z_("p2p-webrtc-direct"),z_("p2p")),F_(k_,z_("p2p-webrtc-direct")),F_(A_,z_("p2p-webrtc-direct")))),D_=V_(b_,__,k_,A_,x_,P_,g_,v_,m_,f_,T_,C_),N_=(V_(F_(D_,z_("p2p-stardust"),z_("p2p")),F_(D_,z_("p2p-stardust"))),V_(F_(D_,z_("p2p")),x_,P_,T_,C_,z_("p2p"))),B_=V_(F_(N_,z_("p2p-circuit"),N_),F_(N_,z_("p2p-circuit")),F_(z_("p2p-circuit"),N_),F_(D_,z_("p2p-circuit")),F_(z_("p2p-circuit"),D_),z_("p2p-circuit")),L_=()=>V_(F_(B_,L_),B_),O_=L_(),M_=V_(F_(O_,N_,O_),F_(N_,O_),F_(O_,N_),O_,N_);V_(F_(O_,z_("webrtc"),z_("p2p")),F_(O_,z_("webrtc")),F_(D_,z_("webrtc"),z_("p2p")),F_(D_,z_("webrtc")),z_("webrtc"));function U_(e){return function(t){let n;try{n=Vh(t)}catch(i){return!1}const r=e(n.protoNames());return null!==r&&(!0===r||!1===r?r:0===r.length)}}function F_(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];function r(e){if(e.length<t.length)return null;let n=e;return t.some((t=>(n="function"===typeof t?t().partialMatch(e):t.partialMatch(e),Array.isArray(n)&&(e=n),null===n))),n}return{toString:function(){return"{ "+t.join(" ")+" }"},input:t,matches:U_(r),partialMatch:r}}function V_(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];function r(e){let n=null;return t.some((t=>{const r="function"===typeof t?t().partialMatch(e):t.partialMatch(e);return null!=r&&(n=r,!0)})),n}return{toString:function(){return"{ "+t.join(" ")+" }"},input:t,matches:U_(r),partialMatch:r}}function z_(e){const t=e;return{toString:function(){return t},matches:function(e){let n;try{n=Vh(e)}catch(i){return!1}const r=n.protoNames();return 1===r.length&&r[0]===t},partialMatch:function(e){return 0===e.length?null:e[0]===t?e.slice(1):null}}}class K_ extends bu{constructor(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{list:[]};if(null==n.list||0===n.list.length)throw new Error("Bootstrap requires a list of peer addresses");super(),je(this,"log",void 0),je(this,"timer",void 0),je(this,"list",void 0),je(this,"timeout",void 0),je(this,"components",void 0),je(this,"_init",void 0),je(this,Au,this),je(this,Symbol.toStringTag,"@libp2p/bootstrap"),this.components=e,this.log=e.logger.forComponent("libp2p:bootstrap"),this.timeout=null!==(t=n.timeout)&&void 0!==t?t:1e3,this.list=[];for(const r of n.list){if(!M_.matches(r)){this.log.error("Invalid multiaddr");continue}const e=Vh(r),t=e.getPeerId();if(null==t){this.log.error("Invalid bootstrap multiaddr without peer id");continue}const n={id:Mu(t),multiaddrs:[e]};this.list.push(n)}this._init=n}isStarted(){return Boolean(this.timer)}start(){this.isStarted()||(this.log("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout((()=>{this._discoverBootstrapPeers().catch((e=>{this.log.error(e)}))}),this.timeout))}async _discoverBootstrapPeers(){if(null!=this.timer)for(const r of this.list){var e,t,n;if(await this.components.peerStore.merge(r.id,{tags:{[null!==(e=this._init.tagName)&&void 0!==e?e:"bootstrap"]:{value:null!==(t=this._init.tagValue)&&void 0!==t?t:50,ttl:null!==(n=this._init.tagTTL)&&void 0!==n?n:12e4}}}),null==this.timer)return;this.safeDispatchEvent("peer",{detail:r})}}stop(){null!=this.timer&&clearTimeout(this.timer),this.timer=void 0}}function j_(e){return t=>new K_(t,e)}function H_(e){const{stream:t,remoteAddr:n,logger:r}=e,i=r.forComponent("libp2p:stream:converter");let o=!1,s=!1;const a=t.close.bind(t);t.close=async e=>{await a(e),h(!0)};const l=t.abort.bind(t);t.abort=e=>{l(e),h(!0)};const c=t.sink.bind(t);t.sink=async e=>{try{await c(e)}catch(t){"aborted"!==t.type&&i.error("%s error in sink",n,t)}finally{s=!0,h()}};const u={log:i,sink:t.sink,source:async function*(){try{for await(const e of t.source)e instanceof Uint8Array?yield e:yield*e}finally{o=!0,h()}}(),remoteAddr:n,timeline:{open:Date.now(),close:void 0},close:t.close,abort:t.abort};function h(e){!0===e&&(o=!0,s=!0),o&&s&&null==u.timeline.close&&(u.timeline.close=Date.now())}return u}function q_(e,t){const n=Tg(e,t),r={read:async(e,t)=>{const r=await n.read(t);return e.decode(r)},write:async(e,t,r)=>{await n.write(t.encode(e),r)},writeV:async(e,t,r)=>{await n.writeV(e.map((e=>t.encode(e))),r)},pb:e=>({read:async t=>r.read(e,t),write:async(t,n)=>r.write(t,e,n),writeV:async(t,n)=>r.writeV(t,e,n),unwrap:()=>r}),unwrap:()=>n.unwrap()};return r}je(K_,"tag","bootstrap");const W_="circuit-relay-relay",G_=(BigInt(1<<17),"/libp2p/circuit/relay/0.2.0/hop"),Y_="/libp2p/circuit/relay/0.2.0/stop",Q_="ERR_RELAYED_DIAL";var X_,J_,$_,Z_,eS,tS,nS,rS;function iS(e){const t=e*BigInt(1e3),n=(new Date).getTime();return Number(t-BigInt(n))}!function(e){let t,n,r;!function(e){e.RESERVE="RESERVE",e.CONNECT="CONNECT",e.STATUS="STATUS"}(t=e.Type||(e.Type={})),function(e){e[e.RESERVE=0]="RESERVE",e[e.CONNECT=1]="CONNECT",e[e.STATUS=2]="STATUS"}(n||(n={})),function(e){e.codec=()=>Gs(n)}(t=e.Type||(e.Type={})),e.codec=()=>(null==r&&(r=Ys((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==r.lengthDelimited&&n.fork(),null!=t.type&&(n.uint32(8),e.Type.codec().encode(t.type,n)),null!=t.peer&&(n.uint32(18),$_.codec().encode(t.peer,n)),null!=t.reservation&&(n.uint32(26),Z_.codec().encode(t.reservation,n)),null!=t.limit&&(n.uint32(34),eS.codec().encode(t.limit,n)),null!=t.status&&(n.uint32(40),tS.codec().encode(t.status,n)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();switch(n>>>3){case 1:r.type=e.Type.codec().decode(t);break;case 2:r.peer=$_.codec().decode(t,t.uint32());break;case 3:r.reservation=Z_.codec().decode(t,t.uint32());break;case 4:r.limit=eS.codec().decode(t,t.uint32());break;case 5:r.status=tS.codec().decode(t);break;default:t.skipType(7&n)}}return r}))),r),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(X_||(X_={})),function(e){let t,n,r;!function(e){e.CONNECT="CONNECT",e.STATUS="STATUS"}(t=e.Type||(e.Type={})),function(e){e[e.CONNECT=0]="CONNECT",e[e.STATUS=1]="STATUS"}(n||(n={})),function(e){e.codec=()=>Gs(n)}(t=e.Type||(e.Type={})),e.codec=()=>(null==r&&(r=Ys((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==r.lengthDelimited&&n.fork(),null!=t.type&&(n.uint32(8),e.Type.codec().encode(t.type,n)),null!=t.peer&&(n.uint32(18),$_.codec().encode(t.peer,n)),null!=t.limit&&(n.uint32(26),eS.codec().encode(t.limit,n)),null!=t.status&&(n.uint32(32),tS.codec().encode(t.status,n)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();switch(n>>>3){case 1:r.type=e.Type.codec().decode(t);break;case 2:r.peer=$_.codec().decode(t,t.uint32());break;case 3:r.limit=eS.codec().decode(t,t.uint32());break;case 4:r.status=tS.codec().decode(t);break;default:t.skipType(7&n)}}return r}))),r),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(J_||(J_={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==n.lengthDelimited&&t.fork(),null!=e.id&&e.id.byteLength>0&&(t.uint32(10),t.bytes(e.id)),null!=e.addrs)for(const r of e.addrs)t.uint32(18),t.bytes(r);!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={id:new Uint8Array(0),addrs:[]},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.id=e.bytes();break;case 2:n.addrs.push(e.bytes());break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}($_||($_={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==n.lengthDelimited&&t.fork(),null!=e.expire&&0n!==e.expire&&(t.uint32(8),t.uint64(e.expire)),null!=e.addrs)for(const r of e.addrs)t.uint32(18),t.bytes(r);null!=e.voucher&&(t.uint32(26),t.bytes(e.voucher)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={expire:0n,addrs:[]},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.expire=e.uint64();break;case 2:n.addrs.push(e.bytes());break;case 3:n.voucher=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(Z_||(Z_={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.duration&&(t.uint32(8),t.uint32(e.duration)),null!=e.data&&(t.uint32(16),t.uint64(e.data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.duration=e.uint32();break;case 2:n.data=e.uint64();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(eS||(eS={})),function(e){e.UNUSED="UNUSED",e.OK="OK",e.RESERVATION_REFUSED="RESERVATION_REFUSED",e.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONNECTION_FAILED="CONNECTION_FAILED",e.NO_RESERVATION="NO_RESERVATION",e.MALFORMED_MESSAGE="MALFORMED_MESSAGE",e.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE"}(tS||(tS={})),function(e){e[e.UNUSED=0]="UNUSED",e[e.OK=100]="OK",e[e.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",e[e.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",e[e.PERMISSION_DENIED=202]="PERMISSION_DENIED",e[e.CONNECTION_FAILED=203]="CONNECTION_FAILED",e[e.NO_RESERVATION=204]="NO_RESERVATION",e[e.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",e[e.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE"}(nS||(nS={})),function(e){e.codec=()=>Gs(nS)}(tS||(tS={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.relay&&e.relay.byteLength>0&&(t.uint32(10),t.bytes(e.relay)),null!=e.peer&&e.peer.byteLength>0&&(t.uint32(18),t.bytes(e.peer)),null!=e.expiration&&0n!==e.expiration&&(t.uint32(24),t.uint64(e.expiration)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={relay:new Uint8Array(0),peer:new Uint8Array(0),expiration:0n},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.relay=e.bytes();break;case 2:n.peer=e.bytes();break;case 3:n.expiration=e.uint64();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(rS||(rS={}));class oS extends bu{constructor(e){super(),je(this,"peerId",void 0),je(this,"peerStore",void 0),je(this,"contentRouting",void 0),je(this,"registrar",void 0),je(this,"started",void 0),je(this,"topologyId",void 0),je(this,"log",void 0),this.log=e.logger.forComponent("libp2p:circuit-relay:discover-relays"),this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.contentRouting=e.contentRouting,this.registrar=e.registrar}isStarted(){return this.started}async start(){this.topologyId=await this.registrar.register(G_,{notifyOnTransient:!0,onConnect:e=>{this.safeDispatchEvent("relay:discover",{detail:e})}}),this.started=!0}afterStart(){this.discover().catch((e=>{this.log.error("error discovering relays",e)}))}stop(){null!=this.topologyId&&this.registrar.unregister(this.topologyId),this.started=!1}async discover(){this.log("searching peer store for relays");const e=await this.peerStore.all({filters:[e=>e.protocols.includes(G_)],orders:[()=>Math.random()<.5?1:-1]});for(const n of e)this.log("found relay peer %p in content peer store",n.id),this.safeDispatchEvent("relay:discover",{detail:n.id});this.log("found %d relay peers in peer store",e.length);try{this.log("searching content routing for relays");const e=await async function(e){const t=(new TextEncoder).encode(e),n=await ar.digest(t);return Jt.createV0(n)}("/libp2p/relay");let t=0;for await(const n of this.contentRouting.findProviders(e))if(n.multiaddrs.length>0&&!n.id.equals(this.peerId)){const e=n.id;t++,await this.peerStore.merge(e,{multiaddrs:n.multiaddrs}),this.log("found relay peer %p in content routing",e),this.safeDispatchEvent("relay:discover",{detail:e})}this.log("found %d relay peers in content routing",t)}catch(t){this.log.error("failed when finding relays on the network",t)}}}var sS=new WeakSet;class aS extends bu{constructor(e){super(),Ve(this,sS),je(this,"connectionManager",void 0),je(this,"relayStore",void 0),je(this,"listeningAddrs",void 0),je(this,"log",void 0),je(this,"_onRemoveRelayPeer",(e=>{He(sS,this,lS).call(this,e.detail)})),this.log=e.logger.forComponent("libp2p:circuit-relay:transport:listener"),this.connectionManager=e.connectionManager,this.relayStore=e.relayStore,this.listeningAddrs=new qh,this.relayStore.addEventListener("relay:removed",this._onRemoveRelayPeer)}async listen(e){this.log("listen on %a",e);const t=e.decapsulate("/p2p-circuit"),n=await this.connectionManager.openConnection(t);if(!this.relayStore.hasReservation(n.remotePeer))return this.log("making reservation on peer %p",n.remotePeer),void await this.relayStore.addRelay(n.remotePeer,"configured");const r=this.relayStore.getReservation(n.remotePeer);if(null==r)throw new Mr("Did not have reservation after making reservation","ERR_NO_RESERVATION");this.listeningAddrs.has(n.remotePeer)?this.log("already listening on relay %p",n.remotePeer):(this.listeningAddrs.set(n.remotePeer,r.addrs.map((e=>Vh(e).encapsulate("/p2p-circuit")))),this.safeDispatchEvent("listening",{}))}getAddrs(){return[...this.listeningAddrs.values()].flat()}async close(){}}function lS(e){const t=this.listeningAddrs.has(e);this.log("relay peer removed %p - had reservation",e,t),this.listeningAddrs.delete(e),t&&(this.log.trace("removing relay event listener for peer %p",e),this.relayStore.removeEventListener("relay:removed",this._onRemoveRelayPeer),this.safeDispatchEvent("close",{}))}var cS=new WeakSet;class uS extends bu{constructor(e,t){var n,r,i,o;super(),Ve(this,cS),je(this,"peerId",void 0),je(this,"connectionManager",void 0),je(this,"transportManager",void 0),je(this,"peerStore",void 0),je(this,"events",void 0),je(this,"reserveQueue",void 0),je(this,"reservations",void 0),je(this,"maxDiscoveredRelays",void 0),je(this,"maxReservationQueueLength",void 0),je(this,"reservationCompletionTimeout",void 0),je(this,"started",void 0),je(this,"log",void 0),this.log=e.logger.forComponent("libp2p:circuit-relay:transport:reservation-store"),this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.peerStore=e.peerStore,this.events=e.events,this.reservations=new qh,this.maxDiscoveredRelays=null!==(n=null===t||void 0===t?void 0:t.discoverRelays)&&void 0!==n?n:0,this.maxReservationQueueLength=null!==(r=null===t||void 0===t?void 0:t.maxReservationQueueLength)&&void 0!==r?r:100,this.reservationCompletionTimeout=null!==(i=null===t||void 0===t?void 0:t.reservationCompletionTimeout)&&void 0!==i?i:1e4,this.started=!1,this.reserveQueue=new Hp({concurrency:null!==(o=null===t||void 0===t?void 0:t.reservationConcurrency)&&void 0!==o?o:1,metricName:"libp2p_relay_reservation_queue",metrics:e.metrics}),this.events.addEventListener("peer:disconnect",(e=>{He(cS,this,dS).call(this,e.detail)}))}isStarted(){return this.started}start(){this.started=!0}stop(){this.reserveQueue.clear(),this.reservations.forEach((e=>{let{timeout:t}=e;clearTimeout(t)})),this.reservations.clear(),this.started=!1}async addRelay(e,t){this.peerId.equals(e)?this.log("not trying to use self as relay"):this.reserveQueue.size>this.maxReservationQueueLength?this.log("not adding relay as the queue is full"):this.reserveQueue.has(e)?this.log("relay peer is already in the reservation queue"):(this.log("add relay %p",e),await this.reserveQueue.add((async()=>{try{const n=this.reservations.get(e);if(null!=n){if(iS(n.reservation.expire)>6e5)return void this.log("already have reservation on relay peer %p and it expires in more than 10 minutes",e);clearTimeout(n.timeout),this.reservations.delete(e)}if("discovered"===t&&[...this.reservations.values()].reduce(((e,t)=>("discovered"===t.type&&e++,e)),0)>=this.maxDiscoveredRelays)return void this.log("already have enough discovered relays");const r=AbortSignal.timeout(this.reservationCompletionTimeout),i=await this.connectionManager.openConnection(e,{signal:r});if(i.remoteAddr.protoNames().includes("p2p-circuit"))return void this.log("not creating reservation over relayed connection");const o=await He(cS,this,hS).call(this,i,{signal:r});this.log("created reservation on relay peer %p",e);const s=iS(o.expire),a=Math.min(Math.max(s-3e5,3e4),Math.pow(2,31)-1),l=setTimeout((()=>{this.addRelay(e,t).catch((t=>{this.log.error("could not refresh reservation to relay %p",e,t)}))}),a);this.reservations.set(e,{timeout:l,reservation:o,type:t}),await this.peerStore.merge(e,{tags:{[W_]:{value:1,ttl:s}}}),await this.transportManager.listen([Vh("/p2p/".concat(e.toString(),"/p2p-circuit"))])}catch(n){this.log.error("could not reserve slot on %p",e,n);const t=this.reservations.get(e);null!=t&&clearTimeout(t.timeout),this.reservations.delete(e)}}),{peerId:e}))}hasReservation(e){return this.reservations.has(e)}getReservation(e){var t;return null===(t=this.reservations.get(e))||void 0===t?void 0:t.reservation}}async function hS(e,t){var n,r;null===(n=t.signal)||void 0===n||n.throwIfAborted(),this.log("requesting reservation from %p",e.remotePeer);const i=await e.newStream(G_,t),o=q_(i).pb(X_);let s;await o.write({type:X_.Type.RESERVE},t);try{s=await o.read(t)}catch(l){throw this.log.error("error parsing reserve message response from %p because",e.remotePeer,l),i.abort(l),l}finally{await i.close()}if(s.status===tS.OK&&null!=s.reservation){let t=!1;const n=e.remoteAddr.bytes;for(const e of s.reservation.addrs)if(Hr(n,e)){t=!0;break}return t||s.reservation.addrs.push(n),s.reservation}const a="reservation failed with status ".concat(null!==(r=s.status)&&void 0!==r?r:"undefined");throw this.log.error(a),new Error(a)}function dS(e){const t=this.reservations.get(e);null!=t&&(this.log("connection to relay %p closed, removing reservation from local store",e),clearTimeout(t.timeout),this.reservations.delete(e),this.safeDispatchEvent("relay:removed",{detail:e}),this.reservations.size<this.maxDiscoveredRelays&&(this.log("not enough relays %d/%d",this.reservations.size,this.maxDiscoveredRelays),this.safeDispatchEvent("relay:not-enough-relays",{})))}const fS=300,pS=300,gS=3e4;class yS{constructor(e,t){var n,r,i;je(this,"discovery",void 0),je(this,"registrar",void 0),je(this,"peerStore",void 0),je(this,"connectionManager",void 0),je(this,"transportManager",void 0),je(this,"peerId",void 0),je(this,"upgrader",void 0),je(this,"addressManager",void 0),je(this,"connectionGater",void 0),je(this,"reservationStore",void 0),je(this,"logger",void 0),je(this,"maxInboundStopStreams",void 0),je(this,"maxOutboundStopStreams",void 0),je(this,"stopTimeout",void 0),je(this,"started",void 0),je(this,"log",void 0),je(this,If,!0),je(this,Symbol.toStringTag,"libp2p/circuit-relay-v2"),this.log=e.logger.forComponent("libp2p:circuit-relay:transport"),this.registrar=e.registrar,this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.logger=e.logger,this.peerId=e.peerId,this.upgrader=e.upgrader,this.addressManager=e.addressManager,this.connectionGater=e.connectionGater,this.maxInboundStopStreams=null!==(n=t.maxInboundStopStreams)&&void 0!==n?n:fS,this.maxOutboundStopStreams=null!==(r=t.maxOutboundStopStreams)&&void 0!==r?r:pS,this.stopTimeout=null!==(i=t.stopTimeout)&&void 0!==i?i:gS,null!=t.discoverRelays&&t.discoverRelays>0&&(this.discovery=new oS(e),this.discovery.addEventListener("relay:discover",(e=>{this.reservationStore.addRelay(e.detail,"discovered").catch((t=>{this.log.error("could not add discovered relay %p",e.detail,t)}))}))),this.reservationStore=new uS(e,t),this.reservationStore.addEventListener("relay:not-enough-relays",(()=>{var e;null===(e=this.discovery)||void 0===e||e.discover().catch((e=>{this.log.error("could not discover relays",e)}))})),this.started=!1}isStarted(){return this.started}async start(){var e;this.reservationStore.start(),await this.registrar.handle(Y_,(e=>{this.onStop(e).catch((t=>{this.log.error("error while handling STOP protocol",t),e.stream.abort(t)}))}),{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams,runOnTransientConnection:!0}),await(null===(e=this.discovery)||void 0===e?void 0:e.start()),this.started=!0}afterStart(){var e;null===(e=this.discovery)||void 0===e||e.afterStart()}async stop(){var e;null===(e=this.discovery)||void 0===e||e.stop(),this.reservationStore.stop(),await this.registrar.unhandle(Y_),this.started=!1}async dial(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(1!==e.protoCodes().filter((e=>290===e)).length){const t="Invalid circuit relay address";throw this.log.error(t,e),new Mr(t,Q_)}const n=e.toString().split("/p2p-circuit"),r=Vh(n[0]),i=Vh(n[n.length-1]),o=r.getPeerId(),s=i.getPeerId();if(null==o||null==s){const t="Circuit relay dial to ".concat(e.toString()," failed as address did not have peer ids");throw this.log.error(t),new Mr(t,Q_)}const a=Mu(o),l=Mu(s);let c=!1;let u,h=this.connectionManager.getConnections(a)[0];null==h&&(await this.peerStore.merge(a,{multiaddrs:[r]}),h=await this.connectionManager.openConnection(a,t),c=!0);try{return u=await h.newStream(G_),await this.connectV2({stream:u,connection:h,destinationPeer:l,destinationAddr:i,relayAddr:r,ma:e,disconnectOnFailure:c})}catch(d){throw this.log.error("circuit relay dial to destination %p via relay %p failed",l,a,d),null!=u&&u.abort(d),c&&await h.close(),d}}async connectV2(e){let{stream:t,connection:n,destinationPeer:r,destinationAddr:i,relayAddr:o,ma:s,disconnectOnFailure:a}=e;try{const e=q_(t),n=e.pb(X_);await n.write({type:X_.Type.CONNECT,peer:{id:r.toBytes(),addrs:[Vh(i).bytes]}});const a=await n.read();var l,c;if(a.status!==tS.OK)throw new Mr("failed to connect via relay with status ".concat(null!==(l=null===a||void 0===a||null===(c=a.status)||void 0===c?void 0:c.toString())&&void 0!==l?l:"undefined"),"ERR_HOP_REQUEST_FAILED");const u=H_({stream:e.unwrap(),remoteAddr:s,localAddr:o.encapsulate("/p2p-circuit/p2p/".concat(this.peerId.toString())),logger:this.logger});return this.log("new outbound transient connection %a",u.remoteAddr),await this.upgrader.upgradeOutbound(u,{transient:!0})}catch(u){throw this.log.error("Circuit relay dial to destination ".concat(r.toString()," via relay ").concat(n.remotePeer.toString()," failed"),u),a&&await n.close(),u}}createListener(e){return function(e){return new aS(e)}({connectionManager:this.connectionManager,relayStore:this.reservationStore,logger:this.logger})}filter(e){return(e=Array.isArray(e)?e:[e]).filter((e=>O_.matches(e)))}async onStop(e){var t,n;let{connection:r,stream:i}=e;if(!this.reservationStore.hasReservation(r.remotePeer))try{this.log("dialed via relay we did not have a reservation on, start listening on that relay address"),await this.transportManager.listen([r.remoteAddr.encapsulate("/p2p-circuit")])}catch(d){this.log.error("failed to listen on a relay peer we were dialed via but did not have a reservation on",d)}const o=AbortSignal.timeout(this.stopTimeout),s=q_(i).pb(J_),a=await s.read({signal:o});if(this.log("new circuit relay v2 stop stream from %p with type %s",r.remotePeer,a.type),void 0===(null===a||void 0===a?void 0:a.type))return this.log.error("type was missing from circuit v2 stop protocol request from %s",r.remotePeer),await s.write({type:J_.Type.STATUS,status:tS.MALFORMED_MESSAGE},{signal:o}),void await i.close();if(a.type!==J_.Type.CONNECT)return this.log.error("invalid stop connect request via peer %p",r.remotePeer),await s.write({type:J_.Type.STATUS,status:tS.UNEXPECTED_MESSAGE},{signal:o}),void await i.close();if(!(e=>{if(null==e.peer)return!1;try{e.peer.addrs.forEach(Vh)}catch{return!1}return!0})(a))return this.log.error("invalid stop connect request via peer %p",r.remotePeer),await s.write({type:J_.Type.STATUS,status:tS.MALFORMED_MESSAGE},{signal:o}),void await i.close();const l=Uu(a.peer.id);if(!0===await(null===(t=(n=this.connectionGater).denyInboundRelayedConnection)||void 0===t?void 0:t.call(n,r.remotePeer,l)))return this.log.error("connection gater denied inbound relayed connection from %p",r.remotePeer),await s.write({type:J_.Type.STATUS,status:tS.PERMISSION_DENIED},{signal:o}),void await i.close();this.log.trace("sending success response to %p",r.remotePeer),await s.write({type:J_.Type.STATUS,status:tS.OK},{signal:o});const c=r.remoteAddr.encapsulate("/p2p-circuit/p2p/".concat(l.toString())),u=this.addressManager.getAddresses()[0],h=H_({stream:s.unwrap().unwrap(),remoteAddr:c,localAddr:u,logger:this.logger});this.log("new inbound transient connection %a",h.remoteAddr),await this.upgrader.upgradeInbound(h,{transient:!0}),this.log("%s connection %a upgraded","inbound",h.remoteAddr)}}function vS(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>new yS(t,e)}var mS;function wS(e,t){if(cp.matches(e))return!1;return null!=t.transportForMultiaddr(e)&&(!!Kf.matches(e)||!!Yf.matches(e)&&!1===kf(e.toOptions().host))}!function(e){let t,n,r;!function(e){e.UNUSED="UNUSED",e.CONNECT="CONNECT",e.SYNC="SYNC"}(t=e.Type||(e.Type={})),function(e){e[e.UNUSED=0]="UNUSED",e[e.CONNECT=100]="CONNECT",e[e.SYNC=300]="SYNC"}(n||(n={})),function(e){e.codec=()=>Gs(n)}(t=e.Type||(e.Type={})),e.codec=()=>(null==r&&(r=Ys((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==r.lengthDelimited&&n.fork(),null!=t.type&&(n.uint32(8),e.Type.codec().encode(t.type,n)),null!=t.observedAddresses)for(const e of t.observedAddresses)n.uint32(18),n.bytes(e);!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={observedAddresses:[]},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();switch(n>>>3){case 1:r.type=e.Type.codec().decode(t);break;case 2:r.observedAddresses.push(t.bytes());break;default:t.skipType(7&n)}}return r}))),r),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(mS||(mS={}));const bS=5e3,ES=3,_S=1,SS=1;class kS{constructor(e,t){var n,r,i,o;je(this,"started",void 0),je(this,"timeout",void 0),je(this,"retries",void 0),je(this,"maxInboundStreams",void 0),je(this,"maxOutboundStreams",void 0),je(this,"peerStore",void 0),je(this,"registrar",void 0),je(this,"connectionManager",void 0),je(this,"addressManager",void 0),je(this,"transportManager",void 0),je(this,"topologyId",void 0),je(this,"log",void 0),this.log=e.logger.forComponent("libp2p:dcutr"),this.started=!1,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.timeout=null!==(n=t.timeout)&&void 0!==n?n:bS,this.retries=null!==(r=t.retries)&&void 0!==r?r:ES,this.maxInboundStreams=null!==(i=t.maxInboundStreams)&&void 0!==i?i:_S,this.maxOutboundStreams=null!==(o=t.maxOutboundStreams)&&void 0!==o?o:SS}isStarted(){return this.started}async start(){this.started||(this.topologyId=await this.registrar.register(AS,{notifyOnTransient:!0,onConnect:(e,t)=>{t.transient&&"inbound"===t.direction&&this.upgradeInbound(t).catch((e=>{this.log.error("error during outgoing DCUtR attempt",e)}))}}),await this.registrar.handle(AS,(e=>{this.handleIncomingUpgrade(e.stream,e.connection).catch((t=>{this.log.error("error during incoming DCUtR attempt",t),e.stream.abort(t)}))}),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnTransientConnection:!0}),this.started=!0)}async stop(){await this.registrar.unhandle(AS),null!=this.topologyId&&this.registrar.unregister(this.topologyId),this.started=!1}async upgradeInbound(e){if(await this.attemptUnilateralConnectionUpgrade(e))return;let t;for(let i=0;i<this.retries;i++){const o={signal:AbortSignal.timeout(this.timeout)};try{t=await e.newStream([AS],{signal:o.signal,runOnTransientConnection:!0});const n=q_(t,{maxDataLength:4096}).pb(mS);this.log("B sending connect to %p",e.remotePeer);const r=Date.now();await n.write({type:mS.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map((e=>e.bytes))},o),this.log("B receiving connect from %p",e.remotePeer);const i=await n.read(o);if(i.type!==mS.Type.CONNECT)throw this.log("A sent wrong message type"),new Mr("DCUtR message type was incorrect",jr);const s=this.getDialableMultiaddrs(i.observedAddresses);if(0===s.length)throw this.log("A did not have any dialable multiaddrs"),new Mr("DCUtR connect message had no multiaddrs",jr);const a=Date.now()-r;this.log("A sending sync, rtt %dms",a),await n.write({type:mS.Type.SYNC,observedAddresses:[]},o),this.log("A waiting for half RTT"),await Np(a/2),this.log("B dialing",s);const l=await this.connectionManager.openConnection(s,{signal:o.signal,priority:100});this.log("DCUtR to %p succeeded to address %a, closing relayed connection",e.remotePeer,l.remoteAddr),await e.close(o);break}catch(r){var n;if(this.log.error("error while attempting DCUtR on attempt %d of %d",i+1,this.retries,r),null===(n=t)||void 0===n||n.abort(r),i===this.retries)throw r}finally{null!=t&&await t.close(o)}}}async attemptUnilateralConnectionUpgrade(e){const t=(await this.peerStore.get(e.remotePeer)).addresses.map((t=>{const n=t.multiaddr;return null==n.getPeerId()?n.encapsulate("/p2p/".concat(e.remotePeer)):n})).filter((e=>wS(e,this.transportManager)));if(t.length>0){const r=AbortSignal.timeout(this.timeout);try{this.log("attempting unilateral connection upgrade to %a",t);const n=await this.connectionManager.openConnection(t,{signal:r,force:!0});if(n.transient)throw new Error("Could not open a new, non-transient, connection");return this.log("unilateral connection upgrade to %p succeeded via %a, closing relayed connection",e.remotePeer,n.remoteAddr),await e.close({signal:r}),!0}catch(n){this.log.error("unilateral connection upgrade to %p on addresses %a failed",e.remotePeer,t,n)}}else this.log("peer %p has no public addresses, not attempting unilateral connection upgrade",e.remotePeer);return!1}async handleIncomingUpgrade(e,t){const n={signal:AbortSignal.timeout(this.timeout)};try{const r=q_(e,{maxDataLength:4096}).pb(mS);this.log("A receiving connect");const i=await r.read(n);if(i.type!==mS.Type.CONNECT)throw this.log("B sent wrong message type"),new Mr("DCUtR message type was incorrect",jr);if(0===i.observedAddresses.length)throw this.log("B sent no multiaddrs"),new Mr("DCUtR connect message had no multiaddrs",jr);const o=this.getDialableMultiaddrs(i.observedAddresses);if(0===o.length)throw this.log("B had no dialable multiaddrs"),new Mr("DCUtR connect message had no dialable multiaddrs",jr);this.log("A sending connect"),await r.write({type:mS.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map((e=>e.bytes))}),this.log("A receiving sync");if((await r.read(n)).type!==mS.Type.SYNC)throw new Mr("DCUtR message type was incorrect",jr);this.log("A dialing",o);const s=await this.connectionManager.openConnection(o,{signal:n.signal,priority:100,force:!0});this.log("DCUtR to %p succeeded via %a, closing relayed connection",t.remotePeer,s.remoteAddr),await t.close(n)}catch(r){this.log.error("incoming DCUtR from %p failed",t.remotePeer,r),e.abort(r)}finally{await e.close(n)}}getDialableMultiaddrs(e){const t=[];for(const n of e)if(null!=n&&0!==n.length)try{const e=Vh(n);if(!wS(e,this.transportManager))continue;t.push(e)}catch{}return t}}const AS="/libp2p/dcutr";function IS(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>new kS(t,e)}var TS=n(4053);const RS="object"===typeof window&&"object"===typeof document&&9===document.nodeType,CS=TS(),xS=RS&&!CS,PS=CS&&!RS,DS=CS&&RS,NS="undefined"!==typeof globalThis.process&&"undefined"!==typeof globalThis.process.release&&"node"===globalThis.process.release.name&&!CS,BS="function"===typeof importScripts&&"undefined"!==typeof self&&"undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,LS=("undefined"!==typeof globalThis.process&&"undefined"!==typeof globalThis.process.env&&globalThis.process.env.NODE_ENV,"undefined"!==typeof navigator&&"ReactNative"===navigator.product);var OS;!function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==n.lengthDelimited&&t.fork(),null!=e.protocolVersion&&(t.uint32(42),t.string(e.protocolVersion)),null!=e.agentVersion&&(t.uint32(50),t.string(e.agentVersion)),null!=e.publicKey&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.listenAddrs)for(const r of e.listenAddrs)t.uint32(18),t.bytes(r);if(null!=e.observedAddr&&(t.uint32(34),t.bytes(e.observedAddr)),null!=e.protocols)for(const r of e.protocols)t.uint32(26),t.string(r);null!=e.signedPeerRecord&&(t.uint32(66),t.bytes(e.signedPeerRecord)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={listenAddrs:[],protocols:[]},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 5:n.protocolVersion=e.string();break;case 6:n.agentVersion=e.string();break;case 1:n.publicKey=e.bytes();break;case 2:n.listenAddrs.push(e.bytes());break;case 4:n.observedAddr=e.bytes();break;case 3:n.protocols.push(e.string());break;case 8:n.signedPeerRecord=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(OS||(OS={}));const MS=8192,US="ipfs",FS=6e4,VS=1,zS=1,KS=1,jS=1,HS=10,qS=8192,WS=!0,GS=!0;var YS=new WeakSet;class QS{constructor(e){var t,n,r,i,o,s,a,l,c,u,h,d,f;let p=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Ve(this,YS),je(this,"identifyProtocolStr",void 0),je(this,"identifyPushProtocolStr",void 0),je(this,"host",void 0),je(this,"started",void 0),je(this,"timeout",void 0),je(this,"peerId",void 0),je(this,"peerStore",void 0),je(this,"registrar",void 0),je(this,"connectionManager",void 0),je(this,"addressManager",void 0),je(this,"maxInboundStreams",void 0),je(this,"maxOutboundStreams",void 0),je(this,"maxPushIncomingStreams",void 0),je(this,"maxPushOutgoingStreams",void 0),je(this,"maxIdentifyMessageSize",void 0),je(this,"maxObservedAddresses",void 0),je(this,"events",void 0),je(this,"runOnTransientConnection",void 0),je(this,"log",void 0),this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.connectionManager=e.connectionManager,this.events=e.events,this.log=e.logger.forComponent("libp2p:identify"),this.identifyProtocolStr="/".concat(null!==(t=p.protocolPrefix)&&void 0!==t?t:US,"/").concat("id","/").concat("1.0.0"),this.identifyPushProtocolStr="/".concat(null!==(n=p.protocolPrefix)&&void 0!==n?n:US,"/").concat("id/push","/").concat("1.0.0"),this.timeout=null!==(r=p.timeout)&&void 0!==r?r:FS,this.maxInboundStreams=null!==(i=p.maxInboundStreams)&&void 0!==i?i:VS,this.maxOutboundStreams=null!==(o=p.maxOutboundStreams)&&void 0!==o?o:zS,this.maxPushIncomingStreams=null!==(s=p.maxPushIncomingStreams)&&void 0!==s?s:KS,this.maxPushOutgoingStreams=null!==(a=p.maxPushOutgoingStreams)&&void 0!==a?a:jS,this.maxIdentifyMessageSize=null!==(l=p.maxIdentifyMessageSize)&&void 0!==l?l:qS,this.maxObservedAddresses=null!==(c=p.maxObservedAddresses)&&void 0!==c?c:HS,this.runOnTransientConnection=null!==(u=p.runOnTransientConnection)&&void 0!==u?u:GS,this.host={protocolVersion:"".concat(null!==(h=p.protocolPrefix)&&void 0!==h?h:US,"/").concat("0.1.0"),agentVersion:null!==(d=p.agentVersion)&&void 0!==d?d:"".concat(e.nodeInfo.name,"/").concat(e.nodeInfo.version)},(null!==(f=p.runOnConnectionOpen)&&void 0!==f?f:WS)&&e.events.addEventListener("connection:open",(e=>{const t=e.detail;this.identify(t).catch((e=>{this.log.error("error during identify trigged by connection:open",e)}))})),e.events.addEventListener("self:peer:update",(e=>{this.push().catch((e=>{this.log.error(e)}))})),this.host.agentVersion==="".concat(e.nodeInfo.name,"/").concat(e.nodeInfo.version)&&(NS||PS?this.host.agentVersion+=" UserAgent=".concat(globalThis.process.version):(xS||BS||DS||LS)&&(this.host.agentVersion+=" UserAgent=".concat(globalThis.navigator.userAgent)))}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:yr(this.host.agentVersion),ProtocolVersion:yr(this.host.protocolVersion)}}),await this.registrar.handle(this.identifyProtocolStr,(e=>{this._handleIdentify(e).catch((e=>{this.log.error(e)}))}),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnTransientConnection:this.runOnTransientConnection}),await this.registrar.handle(this.identifyPushProtocolStr,(e=>{this._handlePush(e).catch((e=>{this.log.error(e)}))}),{maxInboundStreams:this.maxPushIncomingStreams,maxOutboundStreams:this.maxPushOutgoingStreams,runOnTransientConnection:this.runOnTransientConnection}),this.started=!0)}async stop(){await this.registrar.unhandle(this.identifyProtocolStr),await this.registrar.unhandle(this.identifyPushProtocolStr),this.started=!1}async pushToConnections(e){var t,n;const r=this.addressManager.getAddresses().map((e=>e.decapsulateCode(fh("p2p").code))),i=new Hh({peerId:this.peerId,multiaddrs:r}),o=await Ju.seal(i,this.peerId),s=this.registrar.getProtocols(),a=await this.peerStore.get(this.peerId),l=vr(null!==(t=a.metadata.get("AgentVersion"))&&void 0!==t?t:yr(this.host.agentVersion)),c=vr(null!==(n=a.metadata.get("ProtocolVersion"))&&void 0!==n?n:yr(this.host.protocolVersion)),u=e.map((async e=>{let t;const n=AbortSignal.timeout(this.timeout);vu(1/0,n);try{var i;t=await e.newStream(this.identifyPushProtocolStr,{signal:n,runOnTransientConnection:this.runOnTransientConnection});const a=q_(t,{maxDataLength:null!==(i=this.maxIdentifyMessageSize)&&void 0!==i?i:MS}).pb(OS);await a.write({listenAddrs:r.map((e=>e.bytes)),signedPeerRecord:o.marshal(),protocols:s,agentVersion:l,protocolVersion:c},{signal:n}),await t.close({signal:n})}catch(u){var a;this.log.error("could not push identify update to peer",u),null===(a=t)||void 0===a||a.abort(u)}}));await Promise.all(u)}async push(){if(!this.isStarted())return;const e=[];await Promise.all(this.connectionManager.getConnections().map((async t=>{try{if(!(await this.peerStore.get(t.remotePeer)).protocols.includes(this.identifyPushProtocolStr))return;e.push(t)}catch(n){if("ERR_NOT_FOUND"!==n.code)throw n}}))),await this.pushToConnections(e)}async _identify(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null==n.signal){const e=AbortSignal.timeout(this.timeout);vu(1/0,e),n={...n,signal:e}}try{var r;t=await e.newStream(this.identifyProtocolStr,{...n,runOnTransientConnection:this.runOnTransientConnection});const i=q_(t,{maxDataLength:null!==(r=this.maxIdentifyMessageSize)&&void 0!==r?r:MS}).pb(OS),o=await i.read(n);return await t.close(n),o}catch(o){var i;throw this.log.error("error while reading identify message",o),null===(i=t)||void 0===i||i.abort(o),o}}async identify(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r=await this._identify(e,n),{publicKey:i,protocols:o,observedAddr:s}=r;if(null==i)throw new Mr("public key was missing from identify message","ERR_MISSING_PUBLIC_KEY");const a=await Fu(i);if(!e.remotePeer.equals(a))throw new Mr("identified peer does not match the expected peer","ERR_INVALID_PEER");if(this.peerId.equals(a))throw new Mr("identified peer is our own peer id?","ERR_INVALID_PEER");const l=function(e){if(null!=e&&e.length>0)try{return Vh(e)}catch{}}(s);return this.log("identify completed for peer %p and protocols %o",a,o),this.log("our observed address is %a",l),null!=l&&this.addressManager.getObservedAddrs().length<(null!==(t=this.maxObservedAddresses)&&void 0!==t?t:1/0)&&(this.log("storing our observed address %a",l),this.addressManager.addObservedAddr(l)),He(YS,this,XS).call(this,e,r)}async _handleIdentify(e){const{connection:t,stream:n}=e,r=AbortSignal.timeout(this.timeout);vu(1/0,r);try{var i;const e=null!==(i=this.peerId.publicKey)&&void 0!==i?i:new Uint8Array(0),o=await this.peerStore.get(this.peerId),s=this.addressManager.getAddresses().map((e=>e.decapsulateCode(fh("p2p").code)));let a=o.peerRecordEnvelope;if(s.length>0&&null==a){const e=new Hh({peerId:this.peerId,multiaddrs:s});a=(await Ju.seal(e,this.peerId)).marshal().subarray()}let l=t.remoteAddr.bytes;Gf.matches(t.remoteAddr)||(l=void 0);const c=q_(n).pb(OS);await c.write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:e,listenAddrs:s.map((e=>e.bytes)),signedPeerRecord:a,observedAddr:l,protocols:o.protocols},{signal:r}),await n.close({signal:r})}catch(o){this.log.error("could not respond to identify request",o),n.abort(o)}}async _handlePush(e){const{connection:t,stream:n}=e;try{var r;if(this.peerId.equals(t.remotePeer))throw new Error("received push from ourselves?");const e={signal:AbortSignal.timeout(this.timeout)},i=q_(n,{maxDataLength:null!==(r=this.maxIdentifyMessageSize)&&void 0!==r?r:MS}).pb(OS),o=await i.read(e);await n.close(e),await He(YS,this,XS).call(this,t,o)}catch(i){return this.log.error("received invalid message",i),void n.abort(i)}this.log("handled push from %p",t.remotePeer)}}async function XS(e,t){if(this.log("received identify from %p",e.remotePeer),null==t)throw new Mr("message was null or undefined","ERR_INVALID_MESSAGE");const n={};if(t.listenAddrs.length>0&&(n.addresses=t.listenAddrs.map((e=>({isCertified:!1,multiaddr:Vh(e)})))),t.protocols.length>0&&(n.protocols=t.protocols),null!=t.publicKey){n.publicKey=t.publicKey;if(!(await Fu(t.publicKey)).equals(e.remotePeer))throw new Mr("public key did not match remote PeerId","ERR_INVALID_PUBLIC_KEY")}let r;if(null!=t.signedPeerRecord){this.log("received signedPeerRecord from %p",e.remotePeer);let i=t.signedPeerRecord;const s=await Ju.openAndCertify(i,Hh.DOMAIN);let a,l=Hh.createFromProtobuf(s.payload);if(!l.peerId.equals(s.peerId))throw new Mr("signing key does not match PeerId in the PeerRecord","ERR_INVALID_SIGNING_KEY");if(!e.remotePeer.equals(l.peerId))throw new Mr("signing key does not match remote PeerId","ERR_INVALID_PEER_RECORD_KEY");try{a=await this.peerStore.get(l.peerId)}catch(o){if("ERR_NOT_FOUND"!==o.code)throw o}if(null!=a&&(n.metadata=a.metadata,null!=a.peerRecordEnvelope)){const e=await Ju.createFromProtobuf(a.peerRecordEnvelope),t=Hh.createFromProtobuf(e.payload);t.seqNumber>=l.seqNumber&&(this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",t.seqNumber,l.seqNumber),l=t,i=a.peerRecordEnvelope)}n.peerRecordEnvelope=i,n.addresses=l.multiaddrs.map((e=>({isCertified:!0,multiaddr:e}))),r={seq:l.seqNumber,addresses:l.multiaddrs}}else this.log("%p did not send a signed peer record",e.remotePeer);if(this.log("patching %p with",e.remotePeer,n),await this.peerStore.patch(e.remotePeer,n),null!=t.agentVersion||null!=t.protocolVersion){const n={};null!=t.agentVersion&&(n.AgentVersion=yr(t.agentVersion)),null!=t.protocolVersion&&(n.ProtocolVersion=yr(t.protocolVersion)),this.log("merging %p metadata",e.remotePeer,n),await this.peerStore.merge(e.remotePeer,{metadata:n})}const i={peerId:e.remotePeer,protocolVersion:t.protocolVersion,agentVersion:t.agentVersion,publicKey:t.publicKey,listenAddrs:t.listenAddrs.map((e=>Vh(e))),observedAddr:null==t.observedAddr?void 0:Vh(t.observedAddr),protocols:t.protocols,signedPeerRecord:r,connection:e};return this.events.safeDispatchEvent("peer:identify",{detail:i}),i}function JS(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>new QS(t,e)}const $S=36e5,ZS=36*$S,ek="/dht/provider",tk=$S,nk=20,rk=3;var ik,ok,sk,ak,lk,ck,uk,hk;function dk(e){const t=e.getUTCFullYear(),n=String(e.getUTCMonth()+1).padStart(2,"0"),r=String(e.getUTCDate()).padStart(2,"0"),i=String(e.getUTCHours()).padStart(2,"0"),o=String(e.getUTCMinutes()).padStart(2,"0"),s=String(e.getUTCSeconds()).padStart(2,"0"),a=e.getUTCMilliseconds(),l=String(1e3*a*1e3).padStart(9,"0");return"".concat(t,"-").concat(n,"-").concat(r,"T").concat(i,":").concat(o,":").concat(s,".").concat(l,"Z")}!function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.key&&e.key.byteLength>0&&(t.uint32(10),t.bytes(e.key)),null!=e.value&&e.value.byteLength>0&&(t.uint32(18),t.bytes(e.value)),null!=e.timeReceived&&""!==e.timeReceived&&(t.uint32(42),t.string(e.timeReceived)),!1!==n.lengthDelimited&&t.ldelim()}),(function(e,t){const n={key:ur(0),value:ur(0),timeReceived:""},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.key=e.bytes();break;case 2:n.value=e.bytes();break;case 5:n.timeReceived=e.string();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=(t,n)=>Is(t,e.codec(),n)}(ik||(ik={}));class fk{constructor(e,t,n){if(je(this,"key",void 0),je(this,"value",void 0),je(this,"timeReceived",void 0),!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=n}serialize(){return ik.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:dk(this.timeReceived)}}static deserialize(e){const t=ik.decode(e);return new fk(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){const t=function(e){const t=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),n=String(e).trim().match(t);if(null==n)throw new Error("Invalid format");const r=parseInt(n[1],10),i=parseInt(n[2],10)-1,o=parseInt(n[3],10),s=parseInt(n[4],10),a=parseInt(n[5],10),l=parseInt(n[6],10),c=parseInt(n[7].slice(0,-6),10);return new Date(Date.UTC(r,i,o,s,a,l,c))}(e.timeReceived);if(null==e.key)throw new Error("key missing from deserialized object");if(null==e.value)throw new Error("value missing from deserialized object");return new fk(e.key,e.value,t)}}function pk(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r={...e,name:"SEND_QUERY",type:0,messageName:e.type,messageType:e.type};return null===(t=n.onProgress)||void 0===t||t.call(n,new _u("kad-dht:query:send-query",{detail:r})),r}function gk(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r={...e,name:"PEER_RESPONSE",type:1,messageName:e.messageType,closer:null!=e.closer?e.closer:[],providers:null!=e.providers?e.providers:[]};return null===(t=n.onProgress)||void 0===t||t.call(n,new _u("kad-dht:query:peer-response",{detail:r})),r}function yk(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r={...e,name:"FINAL_PEER",type:2};return null===(t=n.onProgress)||void 0===t||t.call(n,new _u("kad-dht:query:final-peer",{detail:r})),r}function vk(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r={...e,name:"QUERY_ERROR",type:3};return null===(t=n.onProgress)||void 0===t||t.call(n,new _u("kad-dht:query:query-error",{detail:r})),r}function mk(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r={...e,name:"PROVIDER",type:4};return null===(t=n.onProgress)||void 0===t||t.call(n,new _u("kad-dht:query:provider",{detail:r})),r}function wk(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r={...e,name:"VALUE",type:5};return null===(t=n.onProgress)||void 0===t||t.call(n,new _u("kad-dht:query:value",{detail:r})),r}function bk(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r={...e,name:"DIAL_PEER",type:7};return null===(t=n.onProgress)||void 0===t||t.call(n,new _u("kad-dht:query:dial-peer",{detail:r})),r}!function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.key&&(t.uint32(10),t.bytes(e.key)),null!=e.value&&(t.uint32(18),t.bytes(e.value)),null!=e.author&&(t.uint32(26),t.bytes(e.author)),null!=e.signature&&(t.uint32(34),t.bytes(e.signature)),null!=e.timeReceived&&(t.uint32(42),t.string(e.timeReceived)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.key=e.bytes();break;case 2:n.value=e.bytes();break;case 3:n.author=e.bytes();break;case 4:n.signature=e.bytes();break;case 5:n.timeReceived=e.string();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(ok||(ok={})),function(e){e.PUT_VALUE="PUT_VALUE",e.GET_VALUE="GET_VALUE",e.ADD_PROVIDER="ADD_PROVIDER",e.GET_PROVIDERS="GET_PROVIDERS",e.FIND_NODE="FIND_NODE",e.PING="PING"}(sk||(sk={})),function(e){e[e.PUT_VALUE=0]="PUT_VALUE",e[e.GET_VALUE=1]="GET_VALUE",e[e.ADD_PROVIDER=2]="ADD_PROVIDER",e[e.GET_PROVIDERS=3]="GET_PROVIDERS",e[e.FIND_NODE=4]="FIND_NODE",e[e.PING=5]="PING"}(ak||(ak={})),function(e){e.codec=()=>Gs(ak)}(sk||(sk={})),function(e){e.NOT_CONNECTED="NOT_CONNECTED",e.CONNECTED="CONNECTED",e.CAN_CONNECT="CAN_CONNECT",e.CANNOT_CONNECT="CANNOT_CONNECT"}(lk||(lk={})),function(e){e[e.NOT_CONNECTED=0]="NOT_CONNECTED",e[e.CONNECTED=1]="CONNECTED",e[e.CAN_CONNECT=2]="CAN_CONNECT",e[e.CANNOT_CONNECT=3]="CANNOT_CONNECT"}(ck||(ck={})),function(e){e.codec=()=>Gs(ck)}(lk||(lk={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==n.lengthDelimited&&t.fork(),null!=e.id&&e.id.byteLength>0&&(t.uint32(10),t.bytes(e.id)),null!=e.multiaddrs)for(const r of e.multiaddrs)t.uint32(18),t.bytes(r);null!=e.connection&&(t.uint32(24),lk.codec().encode(e.connection,t)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={id:ur(0),multiaddrs:[]},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.id=e.bytes();break;case 2:n.multiaddrs.push(e.bytes());break;case 3:n.connection=lk.codec().decode(e);break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(uk||(uk={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==n.lengthDelimited&&t.fork(),null!=e.type&&0!==ak[e.type]&&(t.uint32(8),sk.codec().encode(e.type,t)),null!=e.clusterLevel&&(t.uint32(80),t.int32(e.clusterLevel)),null!=e.key&&(t.uint32(18),t.bytes(e.key)),null!=e.record&&(t.uint32(26),t.bytes(e.record)),null!=e.closer)for(const r of e.closer)t.uint32(66),uk.codec().encode(r,t);if(null!=e.providers)for(const r of e.providers)t.uint32(74),uk.codec().encode(r,t);!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={type:sk.PUT_VALUE,closer:[],providers:[]},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.type=sk.codec().decode(e);break;case 10:n.clusterLevel=e.int32();break;case 2:n.key=e.bytes();break;case 3:n.record=e.bytes();break;case 8:n.closer.push(uk.codec().decode(e,e.uint32()));break;case 9:n.providers.push(uk.codec().decode(e,e.uint32()));break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(hk||(hk={}));const Ek={pk:function(e,t){return 0}};async function _k(e,t){const n=t.key,r=vr(n).split("/");if(r.length<3)return;const i=e[r[1].toString()];if(null==i){const e='No validator available for key type "'.concat(r[1],'"');throw new Mr(e,"ERR_INVALID_RECORD_KEY_TYPE")}await i(n,t.value)}const Sk={pk:async(e,t)=>{if(!(e instanceof Uint8Array))throw new Mr('"key" must be a Uint8Array',"ERR_INVALID_RECORD_KEY_NOT_BUFFER");if(e.byteLength<5)throw new Mr("invalid public key record","ERR_INVALID_RECORD_KEY_TOO_SHORT");if("/pk/"!==vr(e.subarray(0,4)))throw new Mr("key was not prefixed with /pk/","ERR_INVALID_RECORD_KEY_BAD_PREFIX");if(!Hr(e.slice(4),(await ar.digest(t)).bytes))throw new Mr("public key does not match passed in key","ERR_INVALID_RECORD_HASH_MISMATCH")}},kk=yr("/pk/");function Ak(e){return{...e,multiaddrs:e.multiaddrs.filter((e=>{const[[t,n]]=e.stringTuples();if(53===t||54===t||55===t)return"localhost"!==n;if(4!==t&&6!==t)return!1;if(null==n)return!1;const r=kf(n);return null==r||!r}))}}async function Ik(e){return(await ar.digest(e)).digest}async function Tk(e){return Ik(e.toBytes())}function Rk(e){return new Er("".concat("/dht/record","/").concat(vr(e,"base32")),!1)}function Ck(e,t){const n=new Date;return new fk(e,t,n).serialize()}class xk{constructor(e,t){je(this,"log",void 0),je(this,"components",void 0),je(this,"validators",void 0),je(this,"selectors",void 0),je(this,"peerRouting",void 0),je(this,"queryManager",void 0),je(this,"network",void 0);const{validators:n,selectors:r,peerRouting:i,queryManager:o,network:s,logPrefix:a}=t;this.components=e,this.log=e.logger.forComponent("".concat(a,":content-fetching")),this.validators=n,this.selectors=r,this.peerRouting=i,this.queryManager=o,this.network=s}async getLocal(e){this.log("getLocal %b",e);const t=Rk(e);this.log("fetching record for key %k",t);const n=await this.components.datastore.get(t);this.log("found %k in local datastore",t);const r=fk.deserialize(n);return await _k(this.validators,r),r}sendCorrectionRecord(e,t,n){try{var r=this;let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return async function*(){r.log("sendCorrection for %b",e);const o=Ck(e,n);for(const{value:a,from:l}of t){if(Hr(a,n)){r.log("record was ok");continue}if(r.components.peerId.equals(l)){try{const t=Rk(e);r.log("Storing corrected record for key ".concat(t.toString())),await r.components.datastore.put(t,o.subarray())}catch(s){r.log.error("Failed error correcting self",s)}continue}let t=!1;const c={type:sk.PUT_VALUE,key:e,record:o};for await(const e of r.network.sendRequest(l,c,i))"PEER_RESPONSE"===e.name&&null!=e.record&&Hr(e.record.value,fk.deserialize(o).value)&&(t=!0),yield e;t||(yield vk({from:l,error:new Mr("value not put correctly","ERR_PUT_VALUE_INVALID")},i)),r.log.error("Failed error correcting entry")}}()}catch(i){return Promise.reject(i)}}put(e,t){try{var n=this;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return async function*(){n.log("put key %b value %b",e,t);const i=Ck(e,t),o=Rk(e);n.log("storing record for key ".concat(o.toString())),await n.components.datastore.put(o,i.subarray()),yield*Cr(n.peerRouting.getClosestPeers(e,{signal:r.signal}),(t=>Rr(t,(t=>async()=>{if("FINAL_PEER"!==t.name)return[t];const o=[],s={type:sk.PUT_VALUE,key:e,record:i};n.log("send put to %p",t.peer.id);for await(const e of n.network.sendRequest(t.peer.id,s,r))o.push(e),"PEER_RESPONSE"===e.name&&(null!=e.record&&Hr(e.record.value,fk.deserialize(i).value)||o.push(vk({from:t.peer.id,error:new Mr("value not put correctly","ERR_PUT_VALUE_INVALID")},r)));return o}))),(e=>ug(e,{ordered:!1,concurrency:rk})),(async function*(e){for await(const t of e)yield*t}))}()}catch(r){return Promise.reject(r)}}get(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){t.log("get %b",e);const r=[];for await(const l of t.getMany(e,n))"VALUE"===l.name&&r.push(l),yield l;if(0===r.length)return;const i=r.map((e=>e.value));let o=0;try{o=function(e,t,n){if(0===n.length)throw new Mr("No records given","ERR_NO_RECORDS_RECEIVED");const r=vr(t).split("/");if(r.length<3)throw new Mr("Record key does not have a selector function","ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY");const i=e[r[1].toString()];if(null==i){const e='No selector function configured for key type "'.concat(r[1],'"');throw new Mr(e,"ERR_UNRECOGNIZED_KEY_PREFIX")}return 1===n.length?0:i(t,n)}(t.selectors,e,i)}catch(a){if("ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY"!==a.code)throw a}const s=i[o];if(t.log("GetValue %b %b",e,s),null==s)throw new Mr("best value was not found","ERR_NOT_FOUND");yield*t.sendCorrectionRecord(e,r,s,n),yield r[o]}()}catch(n){return Promise.reject(n)}}getMany(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){t.log("getMany values for %b",e);try{const r=await t.getLocal(e);yield wk({value:r.value,from:t.components.peerId},n)}catch(i){t.log("error getting local value for %b",e,i)}const r=t;yield*t.queryManager.run(e,(function(t){try{let{peer:i,signal:o}=t;return async function*(){for await(const t of r.peerRouting.getValueOrPeers(i,e,{signal:o}))yield t,"PEER_RESPONSE"===t.name&&null!=t.record&&(yield wk({from:i,value:t.record.value},n))}()}catch(i){return Promise.reject(i)}}),n)}()}catch(n){return Promise.reject(n)}}}function Pk(e,t){var n;return{id:e.id.toBytes(),multiaddrs:(null!==(n=e.multiaddrs)&&void 0!==n?n:[]).map((e=>e.bytes)),connection:t}}function Dk(e){var t;if(null==e.id)throw new Error("Invalid peer in message");return{id:Uu(e.id),multiaddrs:(null!==(t=e.multiaddrs)&&void 0!==t?t:[]).map((e=>Vh(e)))}}class Nk{constructor(e,t){je(this,"log",void 0),je(this,"components",void 0),je(this,"network",void 0),je(this,"peerRouting",void 0),je(this,"queryManager",void 0),je(this,"routingTable",void 0),je(this,"providers",void 0);const{network:n,peerRouting:r,queryManager:i,routingTable:o,providers:s,logPrefix:a}=t;this.components=e,this.log=e.logger.forComponent("".concat(a,":content-routing")),this.network=n,this.peerRouting=r,this.queryManager=i,this.routingTable=o,this.providers=s}provide(e,t){try{var n=this;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return async function*(){n.log("provide %s",e),await n.providers.addProvider(e,n.components.peerId);const i={type:sk.ADD_PROVIDER,key:e.multihash.bytes,providers:[Pk({id:n.components.peerId,multiaddrs:t})]};let o=0;yield*Cr(n.peerRouting.getClosestPeers(e.multihash.bytes,r),(t=>Rr(t,(t=>(t=>async()=>{if("FINAL_PEER"!==t.name)return[t];const s=[];n.log("putProvider %s to %p",e,t.peer.id);try{n.log("sending provider record for %s to %p",e,t.peer.id);for await(const a of n.network.sendMessage(t.peer.id,i,r))"PEER_RESPONSE"===a.name&&(n.log("sent provider record for %s to %p",e,t.peer.id),o++),s.push(a)}catch(a){n.log.error("error sending provide record to peer %p",t.peer.id,a),s.push(vk({from:t.peer.id,error:a},r))}return s})(t)))),(e=>ug(e,{ordered:!1,concurrency:rk})),(async function*(e){for await(const t of e)yield*t})),n.log("sent provider records to %d peers",o)}()}catch(r){return Promise.reject(r)}}async*findProviders(e,t){const n=this.routingTable.kBucketSize;let r=0;const i=e.multihash.bytes,o=this;this.log("findProviders %c",e);const s=await this.providers.getProviders(e);if(s.length>0){const e=[];for(const t of s.slice(0,n))try{const n=await this.components.peerStore.get(t);e.push({id:t,multiaddrs:n.addresses.map((e=>{let{multiaddr:t}=e;return t}))})}catch(c){if("ERR_NOT_FOUND"!==c.code)throw c;this.log("no peer store entry for %p",t)}if(yield gk({from:this.components.peerId,messageType:sk.GET_PROVIDERS,providers:e},t),yield mk({from:this.components.peerId,providers:e},t),r+=e.length,r>=n)return}const a=function(e){try{let{peer:n,signal:r}=e;return async function*(){const e={type:sk.GET_PROVIDERS,key:i};yield*o.network.sendRequest(n,e,{...t,signal:r})}()}catch(n){return Promise.reject(n)}},l=new zu(s);for await(const u of this.queryManager.run(i,a,t))if(yield u,"PEER_RESPONSE"===u.name){this.log("Found %d provider entries for %c and %d closer peers",u.providers.length,e,u.closer.length);const i=[];for(const e of u.providers)l.has(e.id)||(l.add(e.id),i.push(e));if(i.length>0&&(yield mk({from:u.from,providers:i},t),r+=i.length,r>=n))return}}}class Bk extends bu{constructor(e,t){super(),je(this,"log",void 0),je(this,"protocol",void 0),je(this,"running",void 0),je(this,"components",void 0);const{protocol:n}=t;this.components=e,this.log=e.logger.forComponent("".concat(t.logPrefix,":network")),this.running=!1,this.protocol=n}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}sendRequest(e,t){try{var n=this;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return async function*(){if(!n.running)return;const i=t.type;if(null==i)throw new Qs("Message type was missing","ERR_INVALID_PARAMETERS");n.log("sending %s to %p",t.type,e),yield bk({peer:e},r),yield pk({to:e,type:i},r);try{const i=await n.components.connectionManager.openConnection(e,r),o=await i.newStream(n.protocol,r),s=await n._writeReadMessage(o,t,r);yield gk({from:e,messageType:s.type,closer:s.closer.map(Dk),providers:s.providers.map(Dk),record:null==s.record?void 0:fk.deserialize(s.record)},r)}catch(o){n.log.error("could not send %s to %p",t.type,e,o),yield vk({from:e,error:o},r)}finally{0}}()}catch(r){return Promise.reject(r)}}sendMessage(e,t){try{var n=this;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return async function*(){if(!n.running)return;const i=t.type;if(null==i)throw new Qs("Message type was missing","ERR_INVALID_PARAMETERS");n.log("sending %s to %p",t.type,e),yield bk({peer:e},r),yield pk({to:e,type:i},r);try{const o=await n.components.connectionManager.openConnection(e,r),s=await o.newStream(n.protocol,r);await n._writeMessage(s,t,r),yield gk({from:e,messageType:i},r)}catch(o){yield vk({from:e,error:o},r)}finally{0}}()}catch(r){return Promise.reject(r)}}async _writeMessage(e,t,n){const r=q_(e);await r.write(t,hk,n),await r.unwrap().close(n)}async _writeReadMessage(e,t,n){const r=q_(e);await r.write(t,hk,n);const i=await r.read(hk,n);return await r.unwrap().close(n),i.closer.forEach((e=>{this.safeDispatchEvent("peer",{detail:Dk(e)})})),i.providers.forEach((e=>{this.safeDispatchEvent("peer",{detail:Dk(e)})})),i}}function Lk(e,t){for(let n=0;n<e.byteLength;n++){if(e[n]<t[n])return-1;if(e[n]>t[n])return 1}return e.byteLength>t.byteLength?1:e.byteLength<t.byteLength?-1:0}function Ok(e,t){if(e.length!==t.length)throw new Error("Inputs should have the same length");const n=hr(e.length);for(let r=0;r<e.length;r++)n[r]=e[r]^t[r];return n}class Mk{constructor(e,t){je(this,"originDhtKey",void 0),je(this,"capacity",void 0),je(this,"peerDistances",void 0),this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map((e=>e.peerId))}async add(e){if(null!=this.peerDistances.find((t=>t.peerId.equals(e))))return;const t=await Tk(e),n={peerId:e,distance:Ok(this.originDhtKey,t)};this.peerDistances.push(n),this.peerDistances.sort(((e,t)=>Lk(e.distance,t.distance))),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async anyCloser(e){if(0===e.length)return!1;if(0===this.length)return!0;const t=await Promise.all(e.map(Tk)),n=this.peerDistances[this.peerDistances.length-1].distance;for(const r of t){if(Lk(Ok(this.originDhtKey,r),n)<0)return!0}return!1}}class Uk{constructor(e,t){je(this,"log",void 0),je(this,"routingTable",void 0),je(this,"network",void 0),je(this,"validators",void 0),je(this,"queryManager",void 0),je(this,"peerStore",void 0),je(this,"peerId",void 0);const{routingTable:n,network:r,validators:i,queryManager:o,logPrefix:s}=t;this.routingTable=n,this.network=r,this.validators=i,this.queryManager=o,this.peerStore=e.peerStore,this.peerId=e.peerId,this.log=e.logger.forComponent("".concat(s,":peer-routing"))}async findPeerLocal(e){let t;const n=await this.routingTable.find(e);if(null!=n){this.log("findPeerLocal found %p in routing table",e);try{t=await this.peerStore.get(n)}catch(r){if("ERR_NOT_FOUND"!==r.code)throw r}}if(null==t)try{t=await this.peerStore.get(e)}catch(r){if("ERR_NOT_FOUND"!==r.code)throw r}if(null!=t)return this.log("findPeerLocal found %p in peer store",e),{id:t.id,multiaddrs:t.addresses.map((e=>e.multiaddr))}}_getValueSingle(e,t){try{var n=this;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return async function*(){const i={type:sk.GET_VALUE,key:t};yield*n.network.sendRequest(e,i,r)}()}catch(r){return Promise.reject(r)}}getPublicKeyFromNode(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){const r=function(e){return Wo([kk,e.toBytes()])}(e);for await(const i of t._getValueSingle(e,r,n))if(yield i,"PEER_RESPONSE"===i.name&&null!=i.record){const t=await Fu(du({bytes:i.record.value}));if(!t.equals(e))throw new Mr("public key does not match id","ERR_PUBLIC_KEY_DOES_NOT_MATCH_ID");if(null==t.publicKey)throw new Mr("public key missing","ERR_PUBLIC_KEY_MISSING");yield wk({from:e,value:t.publicKey},n)}throw new Mr("Node not responding with its public key: ".concat(e.toString()),"ERR_INVALID_RECORD")}()}catch(n){return Promise.reject(n)}}findPeer(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){if(t.log("findPeer %p",e),!1!==n.useCache){const r=await t.findPeerLocal(e);if(null!=r)return t.log("found local"),void(yield yk({from:t.peerId,peer:r},n))}let r=!1;if(!1!==n.useNetwork){const i=t,o=function(t){try{let{peer:r,signal:o}=t;return async function*(){const t={type:sk.FIND_NODE,key:e.toBytes()};for await(const s of i.network.sendRequest(r,t,{...n,signal:o}))if(yield s,"PEER_RESPONSE"===s.name){const t=s.closer.find((t=>t.id.equals(e)));null!=t&&(yield yk({from:s.from,peer:t},n))}}()}catch(r){return Promise.reject(r)}};for await(const s of t.queryManager.run(e.toBytes(),o,n))"FINAL_PEER"===s.name&&(r=!0),yield s}r||(yield vk({from:t.peerId,error:new Mr("Not found","ERR_NOT_FOUND")},n))}()}catch(n){return Promise.reject(n)}}getClosestPeers(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){t.log("getClosestPeers to %b",e);const r=await Ik(e),i=t.routingTable.closestPeers(r),o=t,s=new Mk(r,t.routingTable.kBucketSize);await Promise.all(i.map((async e=>{await s.add(e)})));const a=function(t){try{let{peer:r,signal:i}=t;return async function*(){o.log("closerPeersSingle %s from %p",vr(e,"base32"),r);const t={type:sk.FIND_NODE,key:e};yield*o.network.sendRequest(r,t,{...n,signal:i})}()}catch(r){return Promise.reject(r)}};for await(const c of t.queryManager.run(e,a,n))yield c,"PEER_RESPONSE"===c.name&&await Promise.all(c.closer.map((async e=>{await s.add(e.id)})));t.log("found %d peers close to %b",s.length,e);for(const e of s.peers)try{const r=await t.peerStore.get(e);yield yk({from:t.peerId,peer:{id:e,multiaddrs:r.addresses.map((e=>{let{multiaddr:t}=e;return t}))}},n)}catch(l){if("ERR_NOT_FOUND"!==l.code)throw l}}()}catch(n){return Promise.reject(n)}}getValueOrPeers(e,t){try{var n=this;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return async function*(){for await(const o of n._getValueSingle(e,t,r)){if("PEER_RESPONSE"===o.name&&null!=o.record)try{await n._verifyRecordOnline(o.record)}catch(i){const e="invalid record received, discarded";n.log(e),yield vk({from:o.from,error:new Mr(e,"ERR_INVALID_RECORD")},r);continue}yield o}}()}catch(r){return Promise.reject(r)}}async _verifyRecordOnline(e){if(null==e.timeReceived)throw new Mr("invalid record received","ERR_INVALID_RECORD");await _k(this.validators,new fk(e.key,e.value,e.timeReceived))}async getCloserPeersOffline(e,t){const n=await Ik(e),r=this.routingTable.closestPeers(n),i=[];for(const s of r)if(!s.equals(t))try{const e=await this.peerStore.get(s);i.push({id:s,multiaddrs:e.addresses.map((e=>{let{multiaddr:t}=e;return t}))})}catch(o){if("ERR_NOT_FOUND"!==o.code)throw o}return i.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",i.length,e,t):this.log("getCloserPeersOffline could not find peer closer to %b than %p",e,t),i}}class Fk{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};je(this,"log",void 0),je(this,"datastore",void 0),je(this,"cache",void 0),je(this,"cleanupInterval",void 0),je(this,"provideValidity",void 0),je(this,"syncQueue",void 0),je(this,"started",void 0),je(this,"cleaner",void 0);const{cacheSize:n,cleanupInterval:r,provideValidity:i}=t;this.log=e.logger.forComponent("libp2p:kad-dht:providers"),this.datastore=e.datastore,this.cleanupInterval=null!==r&&void 0!==r?r:tk,this.provideValidity=null!==i&&void 0!==i?i:864e5,this.cache=wp(null!==n&&void 0!==n?n:256),this.syncQueue=new yd({concurrency:1}),this.started=!1}isStarted(){return this.started}async start(){this.started||(this.started=!0,this.cleaner=setInterval((()=>{this._cleanup().catch((e=>{this.log.error(e)}))}),this.cleanupInterval))}async stop(){this.started=!1,null!=this.cleaner&&(clearInterval(this.cleaner),this.cleaner=void 0)}async _cleanup(){await this.syncQueue.add((async()=>{const e=Date.now();let t=0,n=0;const r=new Map,i=this.datastore.batch(),o=this.datastore.query({prefix:ek});for await(const l of o)try{const{cid:e,peerId:o}=zk(l.key),a=Kk(l.value).getTime(),c=Date.now(),u=c-a,h=u>this.provideValidity;if(this.log("comparing: %d - %d = %d > %d %s",c,a,u,this.provideValidity,h?"(expired)":""),h){var s;n++,i.delete(l.key);const t=null!==(s=r.get(e))&&void 0!==s?s:new Set;t.add(o),r.set(e,t)}t++}catch(a){this.log.error(a.message)}r.size>0?(this.log("deleting %d / %d entries",n,t),await i.commit()):this.log("nothing to delete");for(const[l,c]of r){const e=Vk(l),t=this.cache.get(e);if(null!=t){for(const e of c)t.delete(e);0===t.size?this.cache.remove(e):this.cache.set(e,t)}}this.log("Cleanup successful (%dms)",Date.now()-e)}))}async _getProvidersMap(e){const t=Vk(e);let n=this.cache.get(t);return null==n&&(n=await async function(e,t){const n=new Map,r=e.query({prefix:Vk(t)});for await(const i of r){const{peerId:e}=zk(i.key);n.set(e,Kk(i.value))}return n}(this.datastore,e),this.cache.set(t,n)),n}async addProvider(e,t){await this.syncQueue.add((async()=>{this.log("%p provides %s",t,e);const n=await this._getProvidersMap(e);this.log("loaded %s provs",n.size);const r=new Date;n.set(t.toString(),r);const i=Vk(e);this.cache.set(i,n),await async function(e,t,n,r){const i=[Vk(t),"/",n.toString()].join(""),o=new Er(i),s=cs(r.getTime());await e.put(o,s)}(this.datastore,e,t,r)}))}async getProviders(e){return this.syncQueue.add((async()=>{this.log("get providers for %s",e);return[...(await this._getProvidersMap(e)).keys()].map((e=>Mu(e)))}),{throwOnTimeout:!0})}}function Vk(e){const t="string"===typeof e?e:vr(e.multihash.bytes,"base32");return"".concat(ek,"/").concat(t)}function zk(e){const t=e.toString().split("/");if(5!==t.length)throw new Error("incorrectly formatted provider entry key in datastore: ".concat(e.toString()));return{cid:t[3],peerId:t[4]}}function Kk(e){return new Date(us(e))}const jk=BigInt("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");async function*Hk(e){const{key:t,startingPeer:n,ourPeerId:r,signal:i,query:o,alpha:s,pathIndex:a,numPaths:l,cleanUp:c,queryFuncTimeout:u,log:h,peersSeen:d}=e,f=new yd({concurrency:s}),p=await Ik(t);!function n(s,c){if(null==s)return;d.add(s);const g=BigInt("0x"+vr(Ok(c,p),"base16"));f.add((async()=>{const c=[i];null!=u&&c.push(AbortSignal.timeout(u));const y=Xp(c);vu(1/0,y);try{for await(const e of o({key:t,peer:s,signal:y,pathIndex:a,numPaths:l})){if(y.aborted)return;if("PEER_RESPONSE"===e.name)for(const i of e.closer){if(d.has(i.id)){h("already seen %p in query",i.id);continue}if(r.equals(i.id)){h("not querying ourselves");continue}const e=await Tk(i.id);BigInt("0x"+vr(Ok(e,p),"base16"))>g?h("skipping %p as they are not closer to %b than %p",i.id,t,s):(h("querying closer peer %p",i.id),n(i.id,e))}f.emit("completed",e)}}catch(v){if(!i.aborted)return vk({from:s,error:v},e)}finally{y.clear()}}),{priority:jk-g}).catch((e=>{h.error(e)}))}(n,await Tk(n)),yield*async function*(e,t,n,r){const i=_n({objectMode:!0}),o=t=>{r("clean up queue, results %d, queue size %d, pending tasks %d",i.readableLength,e.size,e.pending),e.clear(),i.end(t)},s=e=>{null!=e&&i.push(e)},a=e=>{r("queue error",e),o(e)},l=()=>{r("queue idle"),o()},c=()=>{r("abort queue"),o(new Mr("Query aborted","ERR_QUERY_ABORTED"))},u=()=>{o()};e.on("completed",s),e.on("error",a),e.on("idle",l),t.addEventListener("abort",c),n.addEventListener("cleanup",u);try{yield*i}finally{e.removeListener("completed",s),e.removeListener("error",a),e.removeListener("idle",l),t.removeEventListener("abort",c),n.removeEventListener("cleanup",u)}}(f,i,c,h)}class qk{constructor(e,t){je(this,"disjointPaths",void 0),je(this,"alpha",void 0),je(this,"shutDownController",void 0),je(this,"running",void 0),je(this,"queries",void 0),je(this,"logger",void 0),je(this,"peerId",void 0),je(this,"routingTable",void 0),je(this,"initialQuerySelfHasRun",void 0),je(this,"logPrefix",void 0),je(this,"metrics",void 0);const{disjointPaths:n=nk,alpha:r=rk,logPrefix:i}=t;this.logPrefix=i,this.disjointPaths=null!==n&&void 0!==n?n:nk,this.running=!1,this.alpha=null!==r&&void 0!==r?r:rk,this.queries=0,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.routingTable=t.routingTable,this.logger=e.logger,this.peerId=e.peerId,null!=e.metrics&&(this.metrics={runningQueries:e.metrics.registerMetric("".concat(i.replaceAll(":","_"),"_running_queries")),queryTime:e.metrics.registerMetric("".concat(i.replaceAll(":","_"),"_query_time_seconds"))}),this.shutDownController=new AbortController,vu(1/0,this.shutDownController.signal)}isStarted(){return this.running}async start(){this.running=!0,this.shutDownController=new AbortController,vu(1/0,this.shutDownController.signal)}async stop(){this.running=!1,this.shutDownController.abort()}run(e,t){try{var n=this;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return async function*(i){if(!n.running)throw new Error("QueryManager not started");const o=null===(i=n.metrics)||void 0===i?void 0:i.queryTime.timer();if(null==r.signal){const e=AbortSignal.timeout(3e4);vu(1/0,e),r={...r,signal:e}}const s=new AbortController,a=Xp([n.shutDownController.signal,s.signal,r.signal]);vu(1/0,a,s.signal);const l=n.logger.forComponent("".concat(n.logPrefix,":query:")+vr(e,"base58btc")),c=Date.now(),u=new bu;let h=!1;try{var d;!0!==r.isSelfQuery&&null!=n.initialQuerySelfHasRun&&(l("waiting for initial query-self query before continuing"),await Vp(n.initialQuerySelfHasRun.promise,a),n.initialQuerySelfHasRun=void 0),l("query:start"),n.queries++,null===(d=n.metrics)||void 0===d||d.runningQueries.update(n.queries);const i=await Ik(e),o=n.routingTable.closestPeers(i),s=o.slice(0,Math.min(n.disjointPaths,o.length));if(0===o.length)return void l.error("Running query with no peers");const c=new zu,f=s.map(((i,o)=>Hk({key:e,startingPeer:i,ourPeerId:n.peerId,signal:a,query:t,pathIndex:o,numPaths:s.length,alpha:n.alpha,cleanUp:u,queryFuncTimeout:r.queryFuncTimeout,log:l,peersSeen:c,onProgress:r.onProgress})));for await(const e of kn(...f))"QUERY_ERROR"===e.name&&l.error("query error",e.error),yield e;h=!0}catch(p){if(n.running||"ERR_QUERY_ABORTED"!==p.code)throw p}finally{var f;h||(l("query exited early"),s.abort()),a.clear(),n.queries--,null===(f=n.metrics)||void 0===f||f.runningQueries.update(n.queries),null!=o&&o(),u.dispatchEvent(new _u("cleanup")),l("query:done in %dms",Date.now()-c)}}()}catch(r){return Promise.reject(r)}}}const Wk=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{let t=0;for await(const n of e)t++;return t})();{let t=0;for(const n of e)t++;return t}},Gk=e=>{const t=e.addEventListener||e.on||e.addListener,n=e.removeEventListener||e.off||e.removeListener;if(!t||!n)throw new TypeError("Emitter is not compatible");return{addListener:t.bind(e),removeListener:n.bind(e)}};function Yk(e,t,n){"function"===typeof n&&(n={filter:n});const r=function(e,t,n){let r;const i=new Promise(((i,o)=>{var s;if(!((n={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...n}).count>=0)||n.count!==Number.POSITIVE_INFINITY&&!Number.isInteger(n.count))throw new TypeError("The `count` option should be at least 0 or more");null===(s=n.signal)||void 0===s||s.throwIfAborted();const a=[t].flat(),l=[],{addListener:c,removeListener:u}=Gk(e),h=function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];const s=n.multiArgs?t:t[0];n.filter&&!n.filter(s)||(l.push(s),n.count===l.length&&(r(),i(l)))},d=e=>{r(),o(e)};r=()=>{for(const e of a)u(e,h);for(const e of n.rejectionEvents)u(e,d)};for(const e of a)c(e,h);for(const e of n.rejectionEvents)c(e,d);n.signal&&n.signal.addEventListener("abort",(()=>{d(n.signal.reason)}),{once:!0}),n.resolveImmediately&&i(l)}));if(i.cancel=r,"number"===typeof n.timeout){const e=$h(i,{milliseconds:n.timeout});return e.cancel=r,e}return i}(e,t,n={...n,count:1,resolveImmediately:!1}),i=r.then((e=>e[0]));return i.cancel=r.cancel,i}class Qk{constructor(e,t){var n;je(this,"log",void 0),je(this,"peerId",void 0),je(this,"peerRouting",void 0),je(this,"routingTable",void 0),je(this,"count",void 0),je(this,"interval",void 0),je(this,"initialInterval",void 0),je(this,"queryTimeout",void 0),je(this,"started",void 0),je(this,"timeoutId",void 0),je(this,"controller",void 0),je(this,"initialQuerySelfHasRun",void 0),je(this,"querySelfPromise",void 0);const{peerRouting:r,logPrefix:i,count:o,interval:s,queryTimeout:a,routingTable:l}=t;this.peerId=e.peerId,this.log=e.logger.forComponent("".concat(i,":query-self")),this.started=!1,this.peerRouting=r,this.routingTable=l,this.count=null!==o&&void 0!==o?o:nk,this.interval=null!==s&&void 0!==s?s:3e5,this.initialInterval=null!==(n=t.initialInterval)&&void 0!==n?n:1e3,this.queryTimeout=null!==a&&void 0!==a?a:5e3,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun}isStarted(){return this.started}start(){this.started||(this.started=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout((()=>{this.querySelf().catch((e=>{this.log.error("error running self-query",e)}))}),this.initialInterval))}stop(){this.started=!1,null!=this.timeoutId&&clearTimeout(this.timeoutId),null!=this.controller&&this.controller.abort()}async querySelf(){if(this.started){if(null!=this.querySelfPromise)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=mn(),this.started){this.controller=new AbortController;const t=AbortSignal.timeout(this.queryTimeout),n=Xp([this.controller.signal,t]);vu(1/0,n,this.controller.signal,t);try{0===this.routingTable.size&&(this.log("routing table was empty, waiting for some peers before running query"),await Yk(this.routingTable,"peer:add",{signal:n})),this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);const e=Date.now(),t=await Cr(this.peerRouting.getClosestPeers(this.peerId.toBytes(),{signal:n,isSelfQuery:!0}),(e=>Ar(e,this.count)),(async e=>Wk(e)));this.log("self-query found %d peers in %dms",t,Date.now()-e)}catch(e){this.log.error("self-query error",e)}finally{n.clear(),null!=this.initialQuerySelfHasRun&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.started&&(this.timeoutId=setTimeout((()=>{this.querySelf().catch((e=>{this.log.error("error running self-query",e)}))}),this.interval))}else this.log("skip self-query because we are not started")}}function Xk(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;++n)if(e[n]!==t[n])return!1;return!0}function Jk(e,t){if(!(t instanceof Uint8Array))throw new TypeError(e+" is not a Uint8Array")}class $k extends bu{constructor(e){var t,n,r,i;super(),je(this,"localNodeId",void 0),je(this,"root",void 0),je(this,"numberOfNodesPerKBucket",void 0),je(this,"numberOfNodesToPing",void 0),je(this,"distance",void 0),je(this,"arbiter",void 0),this.localNodeId=e.localNodeId,this.numberOfNodesPerKBucket=null!==(t=e.numberOfNodesPerKBucket)&&void 0!==t?t:20,this.numberOfNodesToPing=null!==(n=e.numberOfNodesToPing)&&void 0!==n?n:3,this.distance=null!==(r=e.distance)&&void 0!==r?r:$k.distance,this.arbiter=null!==(i=e.arbiter)&&void 0!==i?i:$k.arbiter,Jk("option.localNodeId as parameter 1",this.localNodeId),this.root={contacts:[],dontSplit:!1,left:null,right:null}}static arbiter(e,t){var n,r;return(null!==(n=e.vectorClock)&&void 0!==n?n:0)>(null!==(r=t.vectorClock)&&void 0!==r?r:0)?e:t}static distance(e,t){let n=0,r=0;const i=Math.min(e.length,t.length),o=Math.max(e.length,t.length);for(;r<i;++r)n=256*n+(e[r]^t[r]);for(;r<o;++r)n=256*n+255;return n}add(e){Jk("contact.id",null===e||void 0===e?void 0:e.id);let t=0,n=this.root;for(;null===n.contacts;)n=this._determineNode(n,e.id,t++);const r=this._indexOf(n,e.id);return r>=0?(this._update(n,r,e),this):n.contacts.length<this.numberOfNodesPerKBucket?(n.contacts.push(e),this.safeDispatchEvent("added",{detail:e}),this):n.dontSplit?(this.safeDispatchEvent("ping",{detail:{oldContacts:n.contacts.slice(0,this.numberOfNodesToPing),newContact:e}}),this):(this._split(n,t),this.add(e))}closest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;if(Jk("id",e),!Number.isInteger(t)&&t!==1/0||t<=0)throw new TypeError("n is not positive number");let n=[];for(let r=[this.root],i=0;r.length>0&&n.length<t;){const t=r.pop();if(null!=t)if(null===t.contacts){const n=this._determineNode(t,e,i++);r.push(t.left===n?t.right:t.left),r.push(n)}else n=n.concat(t.contacts)}return n.map((t=>({distance:this.distance(t.id,e),contact:t}))).sort(((e,t)=>e.distance-t.distance)).slice(0,t).map((e=>e.contact))}count(){let e=0;for(const t=[this.root];t.length>0;){const n=t.pop();null!=n&&(null===n.contacts?t.push(n.right,n.left):e+=n.contacts.length)}return e}_determineNode(e,t,n){const r=n>>3,i=n%8;if(t.length<=r&&0!==i)return e.left;return 0!==(t[r]&1<<7-i)?e.right:e.left}get(e){Jk("id",e);let t=0,n=this.root;for(;null===n.contacts;)n=this._determineNode(n,e,t++);const r=this._indexOf(n,e);return r>=0?n.contacts[r]:void 0}_indexOf(e,t){for(let n=0;n<e.contacts.length;++n)if(Xk(e.contacts[n].id,t))return n;return-1}remove(e){Jk("the id as parameter 1",e);let t=0,n=this.root;for(;null===n.contacts;)n=this._determineNode(n,e,t++);const r=this._indexOf(n,e);if(r>=0){const e=n.contacts.splice(r,1)[0];this.safeDispatchEvent("removed",{detail:e})}return this}_split(e,t){e.left={contacts:[],dontSplit:!1,left:null,right:null},e.right={contacts:[],dontSplit:!1,left:null,right:null};for(const r of e.contacts)this._determineNode(e,r.id,t).contacts.push(r);e.contacts=null;const n=this._determineNode(e,this.localNodeId,t);(e.left===n?e.right:e.left).dontSplit=!0}toArray(){let e=[];for(const t=[this.root];t.length>0;){const n=t.pop();null!=n&&(null===n.contacts?t.push(n.right,n.left):e=e.concat(n.contacts))}return e}*toIterable(){for(const e=[this.root];e.length>0;){const t=e.pop();null!=t&&(null===t.contacts?e.push(t.right,t.left):yield*t.contacts)}}_update(e,t,n){if(!Xk(e.contacts[t].id,n.id))throw new Error("wrong index for _update");const r=e.contacts[t],i=this.arbiter(r,n);i===r&&r!==n||(e.contacts.splice(t,1),e.contacts.push(i),this.safeDispatchEvent("updated",{detail:{incumbent:r,selection:i}}))}}class Zk extends bu{constructor(e,t){super(),je(this,"kBucketSize",void 0),je(this,"kb",void 0),je(this,"pingQueue",void 0),je(this,"log",void 0),je(this,"components",void 0),je(this,"pingTimeout",void 0),je(this,"pingConcurrency",void 0),je(this,"running",void 0),je(this,"protocol",void 0),je(this,"tagName",void 0),je(this,"tagValue",void 0),je(this,"metrics",void 0);const{kBucketSize:n,pingTimeout:r,logPrefix:i,pingConcurrency:o,protocol:s,tagName:a,tagValue:l}=t;this.components=e,this.log=e.logger.forComponent("".concat(i,":routing-table")),this.kBucketSize=null!==n&&void 0!==n?n:20,this.pingTimeout=null!==r&&void 0!==r?r:1e4,this.pingConcurrency=null!==o&&void 0!==o?o:10,this.running=!1,this.protocol=s,this.tagName=null!==a&&void 0!==a?a:"kad-close",this.tagValue=null!==l&&void 0!==l?l:50,this.pingQueue=new Hp({concurrency:this.pingConcurrency,metricName:"".concat(i.replaceAll(":","_"),"_ping_queue"),metrics:this.components.metrics}),this.pingQueue.addEventListener("error",(e=>{this.log.error("error pinging peer",e.detail)})),null!=this.components.metrics&&(this.metrics={routingTableSize:this.components.metrics.registerMetric("".concat(i.replaceAll(":","_"),"_routing_table_size"))})}isStarted(){return this.running}async start(){this.running=!0;const e=new $k({localNodeId:await Tk(this.components.peerId),numberOfNodesPerKBucket:this.kBucketSize,numberOfNodesToPing:1});this.kb=e,e.addEventListener("ping",(e=>{this._onPing(e).catch((e=>{this.log.error("could not process k-bucket ping event",e)}))})),this._tagPeers(e)}async stop(){this.running=!1,this.pingQueue.clear(),this.kb=void 0}_tagPeers(e){let t=new zu;const n=function(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return()=>{clearTimeout(t),t=setTimeout((()=>{e()}),n)}}((()=>{const n=new zu(e.closest(e.localNodeId,20).map((e=>e.peer))),r=n.difference(t),i=t.difference(n);Promise.resolve().then((async()=>{for(const e of r)await this.components.peerStore.merge(e,{tags:{[this.tagName]:{value:this.tagValue}}});for(const e of i)await this.components.peerStore.merge(e,{tags:{[this.tagName]:void 0}})})).catch((e=>{this.log.error("Could not update peer tags",e)})),t=n}));e.addEventListener("added",(e=>{n(),this.safeDispatchEvent("peer:add",{detail:e.detail.peer})})),e.addEventListener("removed",(e=>{n(),this.safeDispatchEvent("peer:remove",{detail:e.detail.peer})}))}async _onPing(e){if(!this.running)return;const{oldContacts:t,newContact:n}=e.detail,r=(await Promise.all(t.map((async e=>{const t=this.pingQueue.find(e.peer);return null!=t?t.join():this.pingQueue.add((async()=>{let t;try{const n={signal:AbortSignal.timeout(this.pingTimeout)};this.log("pinging old contact %p",e.peer);const r=await this.components.connectionManager.openConnection(e.peer,n);t=await r.newStream(this.protocol,n);const i=q_(t);await i.write({type:sk.PING},hk,n);const o=await i.read(hk,n);if(await i.unwrap().close(),o.type!==sk.PING)throw new Mr("Incorrect message type received, expected PING got ".concat(o.type),"ERR_BAD_PING_RESPONSE");return!0}catch(i){var n;return this.running&&null!=this.kb&&(this.log.error("could not ping peer %p",e.peer,i),this.log("evicting old contact after ping failed %p",e.peer),this.kb.remove(e.id)),null===(n=t)||void 0===n||n.abort(i),!1}finally{var r;null===(r=this.metrics)||void 0===r||r.routingTableSize.update(this.size)}}),{peerId:e.peer})})))).filter((e=>e)).length;this.running&&r<t.length&&null!=this.kb&&(this.log("adding new contact %p",n.peer),this.kb.add(n))}get size(){return null==this.kb?0:this.kb.count()}async find(e){const t=await Tk(e),n=this.closestPeer(t);if(null!=n&&e.equals(n))return n}closestPeer(e){const t=this.closestPeers(e,1);if(t.length>0)return t[0]}closestPeers(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.kBucketSize;if(null==this.kb)return[];return this.kb.closest(e,t).map((e=>e.peer))}async add(e){var t;if(null==this.kb)throw new Error("RoutingTable is not started");const n=await Tk(e);this.kb.add({id:n,peer:e}),this.log("added %p with kad id %b",e,n),null===(t=this.metrics)||void 0===t||t.routingTableSize.update(this.size)}async remove(e){var t;if(null==this.kb)throw new Error("RoutingTable is not started");const n=await Tk(e);this.kb.remove(n),null===(t=this.metrics)||void 0===t||t.routingTableSize.update(this.size)}}const eA=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782];class tA{constructor(e,t){je(this,"log",void 0),je(this,"peerRouting",void 0),je(this,"routingTable",void 0),je(this,"refreshInterval",void 0),je(this,"refreshQueryTimeout",void 0),je(this,"commonPrefixLengthRefreshedAt",void 0),je(this,"refreshTimeoutId",void 0);const{peerRouting:n,routingTable:r,refreshInterval:i,refreshQueryTimeout:o,logPrefix:s}=t;this.log=e.logger.forComponent("".concat(s,":routing-table:refresh")),this.peerRouting=n,this.routingTable=r,this.refreshInterval=null!==i&&void 0!==i?i:3e5,this.refreshQueryTimeout=null!==o&&void 0!==o?o:3e4,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async start(){this.log("refreshing routing table every ".concat(this.refreshInterval,"ms")),this.refreshTable(!0)}async stop(){null!=this.refreshTimeoutId&&clearTimeout(this.refreshTimeoutId)}refreshTable(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.log("refreshing routing table");const t=this._maxCommonPrefix(),n=this._getTrackedCommonPrefixLengthsForRefresh(t);this.log("max common prefix length ".concat(t)),this.log("tracked CPLs [ ".concat(n.map((e=>e.toISOString())).join(", ")," ]")),Promise.all(n.map((async(r,i)=>{try{if(await this._refreshCommonPrefixLength(i,r,e),0===this._numPeersForCpl(t)){const t=Math.min(2*(i+1),n.length-1);for(let n=i+1;n<t+1;n++)try{await this._refreshCommonPrefixLength(n,r,e)}catch(o){this.log.error(o)}}}catch(o){this.log.error(o)}}))).catch((e=>{this.log.error(e)})).then((()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),null!=this.refreshTimeoutId.unref&&this.refreshTimeoutId.unref()})).catch((e=>{this.log.error(e)}))}async _refreshCommonPrefixLength(e,t,n){if(!n&&t.getTime()>Date.now()-this.refreshInterval)return void this.log("not running refresh for cpl %s as time since last refresh not above interval",e);const r=await this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,r,this.routingTable.size);const i=await Wk(this.peerRouting.getClosestPeers(r.toBytes(),{signal:AbortSignal.timeout(this.refreshQueryTimeout)}));this.log("found ".concat(i," peers that were close to imaginary peer %p"),r),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,r,this.routingTable.size)}_getTrackedCommonPrefixLengthsForRefresh(e){e>15&&(e=15);const t=[];for(let r=0;r<=e;r++){var n;t[r]=null!==(n=this.commonPrefixLengthRefreshedAt[r])&&void 0!==n?n:new Date}return t}async _generateRandomPeerId(e){if(null==this.routingTable.kb)throw new Error("Routing table not started");const t=mc(2),n=(t[1]<<8)+t[0];return Uu(await this._makePeerId(this.routingTable.kb.localNodeId,n,e))}async _makePeerId(e,t,n){if(n>15)throw new Error("Cannot generate peer ID for common prefix length greater than ".concat(15));const r=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1),i=65535<<16-(n+1),o=eA[(r^32768>>n)&i|t&~i],s=new ArrayBuffer(34),a=new DataView(s,0,s.byteLength);return a.setUint8(0,ar.code),a.setUint8(1,32),a.setUint32(2,o,!1),new Uint8Array(a.buffer,a.byteOffset,a.byteLength)}_maxCommonPrefix(){let e=0;for(const t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(const n of this._prefixLengths())n===e&&t++;return t}*_prefixLengths(){if(null!=this.routingTable.kb)for(const{id:e}of this.routingTable.kb.toIterable()){const t=Ok(this.routingTable.kb.localNodeId,e);let n=0;for(const e of t){if(0!==e)break;n++}yield n}}}class nA{constructor(e,t){je(this,"providers",void 0),je(this,"log",void 0),this.log=e.logger.forComponent("".concat(t.logPrefix,":rpc:handlers:add-provider")),this.providers=t.providers}async handle(e,t){if(this.log("start"),null==t.key||0===t.key.length)throw new Mr("Missing key","ERR_MISSING_KEY");let n;try{n=Jt.decode(t.key)}catch(r){throw new Mr("Invalid CID","ERR_INVALID_CID")}null!=t.providers&&0!==t.providers.length||this.log.error("no providers found in message"),await Promise.all(t.providers.map((async t=>{e.equals(t.id)?t.multiaddrs.length<1?this.log("no valid addresses for provider %p. Ignore",e):(this.log("received provider %p for %s (addrs %s)",e,n,t.multiaddrs.map((e=>Vh(e).toString()))),await this.providers.addProvider(n,Uu(t.id))):this.log("invalid provider peer %p from %p",t.id,e)})))}}class rA{constructor(e,t){je(this,"peerRouting",void 0),je(this,"peerInfoMapper",void 0),je(this,"peerId",void 0),je(this,"addressManager",void 0),je(this,"log",void 0);const{peerRouting:n,logPrefix:r}=t;this.log=e.logger.forComponent("".concat(r,":rpc:handlers:find-node")),this.peerId=e.peerId,this.addressManager=e.addressManager,this.peerRouting=n,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){this.log("incoming request from %p for peers closer to %b",e,t.key);let n=[];if(null==t.key)throw new Mr("Invalid FIND_NODE message received - key was missing","ERR_INVALID_MESSAGE");n=Hr(this.peerId.toBytes(),t.key)?[{id:this.peerId,multiaddrs:this.addressManager.getAddresses().map((e=>e.decapsulateCode(fh("p2p").code)))}]:await this.peerRouting.getCloserPeersOffline(t.key,e);const r={type:sk.FIND_NODE,clusterLevel:t.clusterLevel,closer:n.map(this.peerInfoMapper).filter((e=>{let{multiaddrs:t}=e;return t.length})).map((e=>({id:e.id.toBytes(),multiaddrs:e.multiaddrs.map((e=>e.bytes))}))),providers:[]};return 0===r.closer.length&&this.log("could not find any peers closer to %b than %p",t.key,e),r}}class iA{constructor(e,t){je(this,"peerRouting",void 0),je(this,"providers",void 0),je(this,"peerStore",void 0),je(this,"peerInfoMapper",void 0),je(this,"log",void 0);const{peerRouting:n,providers:r,logPrefix:i}=t;this.log=e.logger.forComponent("".concat(i,":rpc:handlers:get-providers")),this.peerStore=e.peerStore,this.peerRouting=n,this.providers=r,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(null==t.key)throw new Mr("Invalid FIND_NODE message received - key was missing","ERR_INVALID_MESSAGE");let n;try{n=Jt.decode(t.key)}catch(l){throw new Mr("Invalid CID","ERR_INVALID_CID")}this.log("%p asking for providers for %s",e,n);const[r,i]=await Promise.all([this.providers.getProviders(n),this.peerRouting.getCloserPeersOffline(t.key,e)]),o=await this._getPeers(r),s=await this._getPeers(i.map((e=>{let{id:t}=e;return t}))),a={type:sk.GET_PROVIDERS,key:t.key,clusterLevel:t.clusterLevel,closer:s.map(this.peerInfoMapper).filter((e=>{let{multiaddrs:t}=e;return t.length})).map((e=>({id:e.id.toBytes(),multiaddrs:e.multiaddrs.map((e=>e.bytes))}))),providers:o.map(this.peerInfoMapper).filter((e=>{let{multiaddrs:t}=e;return t.length})).map((e=>({id:e.id.toBytes(),multiaddrs:e.multiaddrs.map((e=>e.bytes))})))};return this.log("got %s providers %s closerPeers",a.providers.length,a.closer.length),a}async _getAddresses(e){return[]}async _getPeers(e){const t=[];for(const r of e)try{const e=await this.peerStore.get(r),n=this.peerInfoMapper({id:r,multiaddrs:e.addresses.map((e=>{let{multiaddr:t}=e;return t}))});n.multiaddrs.length>0&&t.push(n)}catch(n){if("ERR_NOT_FOUND"!==n.code)throw n}return t}}class oA{constructor(e,t){je(this,"peerStore",void 0),je(this,"datastore",void 0),je(this,"peerRouting",void 0),je(this,"log",void 0),this.log=e.logger.forComponent("".concat(t.logPrefix,":rpc:handlers:get-value")),this.peerStore=e.peerStore,this.datastore=e.datastore,this.peerRouting=t.peerRouting}async handle(e,t){const n=t.key;if(this.log("%p asked for key %b",e,n),null==n||0===n.length)throw new Mr("Invalid key","ERR_INVALID_KEY");const r={type:sk.GET_VALUE,key:n,clusterLevel:t.clusterLevel,closer:[],providers:[]};if(function(e){return"/pk/"===vr(e.subarray(0,4))}(n)){this.log("is public key");const e=function(e){return Uu(e.subarray(4))}(n);let t;try{const n=await this.peerStore.get(e);if(null==n.id.publicKey)throw new Mr("No public key found in key book","ERR_NOT_FOUND");t=n.id.publicKey}catch(s){if("ERR_NOT_FOUND"!==s.code)throw s}if(null!=t)return this.log("returning found public key"),r.record=new fk(n,t,new Date).serialize(),r}const[i,o]=await Promise.all([this._checkLocalDatastore(n),this.peerRouting.getCloserPeersOffline(n,e)]);return null!=i&&(this.log("had record for %b in local datastore",n),r.record=i.serialize()),o.length>0&&(this.log("had %s closer peers in routing table",o.length),r.closer=o.map((e=>({id:e.id.toBytes(),multiaddrs:e.multiaddrs.map((e=>e.bytes))})))),r}async _checkLocalDatastore(e){this.log("checkLocalDatastore looking for %b",e);const t=Rk(e);let n;try{n=await this.datastore.get(t)}catch(i){if("ERR_NOT_FOUND"===i.code)return;throw i}const r=fk.deserialize(n);if(null==r)throw new Mr("Invalid record","ERR_INVALID_RECORD");if(!(null==r.timeReceived||Date.now()-r.timeReceived.getTime()>ZS))return r;await this.datastore.delete(t)}}class sA{constructor(e,t){je(this,"log",void 0),this.log=e.logger.forComponent("".concat(t.logPrefix,":rpc:handlers:ping"))}async handle(e,t){return this.log("ping from %p",e),t}}class aA{constructor(e,t){je(this,"components",void 0),je(this,"validators",void 0),je(this,"log",void 0);const{validators:n}=t;this.components=e,this.log=e.logger.forComponent("".concat(t.logPrefix,":rpc:handlers:put-value")),this.validators=n}async handle(e,t){const n=t.key;if(this.log("%p asked us to store value for key %b",e,n),null==t.record){const t="Empty record from: ".concat(e.toString());throw this.log.error(t),new Mr(t,"ERR_EMPTY_RECORD")}try{const e=fk.deserialize(t.record);await _k(this.validators,e),e.timeReceived=new Date;const r=Rk(e.key);await this.components.datastore.put(r,e.serialize().subarray()),this.log("put record for %b into datastore under key %k",n,r)}catch(r){this.log("did not put record for key %b into datastore %o",n,r)}return t}}class lA{constructor(e,t){je(this,"handlers",void 0),je(this,"routingTable",void 0),je(this,"log",void 0);const{providers:n,peerRouting:r,validators:i,logPrefix:o,peerInfoMapper:s}=t;this.log=e.logger.forComponent("".concat(o,":rpc")),this.routingTable=t.routingTable,this.handlers={[sk.GET_VALUE.toString()]:new oA(e,{peerRouting:r,logPrefix:o}),[sk.PUT_VALUE.toString()]:new aA(e,{validators:i,logPrefix:o}),[sk.FIND_NODE.toString()]:new rA(e,{peerRouting:r,logPrefix:o,peerInfoMapper:s}),[sk.ADD_PROVIDER.toString()]:new nA(e,{providers:n,logPrefix:o}),[sk.GET_PROVIDERS.toString()]:new iA(e,{peerRouting:r,providers:n,logPrefix:o,peerInfoMapper:s}),[sk.PING.toString()]:new sA(e,{logPrefix:o})}}async handleMessage(e,t){try{await this.routingTable.add(e)}catch(r){this.log.error("Failed to update the kbucket store",r)}const n=this.handlers[t.type];if(null!=n)return n.handle(e,t);this.log.error("no handler found for message type: ".concat(t.type))}onIncomingStream(e){Promise.resolve().then((async()=>{const{stream:t,connection:n}=e,r=n.remotePeer;try{await this.routingTable.add(r)}catch(o){this.log.error(o)}const i=this;await Cr(t,(e=>Eg(e)),(async function*(e){for await(const t of e){const e=hk.decode(t);i.log("incoming %s from %p",e.type,r);const n=await i.handleMessage(r,e);null!=n&&(yield hk.encode(n))}}),(e=>mg(e)),t)})).catch((e=>{this.log.error(e)}))}}class cA extends bu{constructor(e,t){super(),je(this,"log",void 0),je(this,"components",void 0),je(this,"protocol",void 0),je(this,"running",void 0),je(this,"registrarId",void 0);const{protocol:n,logPrefix:r}=t;this.components=e,this.log=e.logger.forComponent("".concat(r,":topology-listener")),this.running=!1,this.protocol=n}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.registrarId=await this.components.registrar.register(this.protocol,{onConnect:e=>{this.log("observed peer %p with protocol %s",e,this.protocol),this.dispatchEvent(new _u("peer",{detail:e}))}}))}async stop(){this.running=!1,null!=this.registrarId&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class uA{constructor(e){je(this,"dht",void 0),this.dht=e}async provide(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};await gn(this.dht.provide(e,t))}findProviders(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){for await(const r of t.dht.findProviders(e,n))"PROVIDER"===r.name&&(yield*r.providers)}()}catch(n){return Promise.reject(n)}}async put(e,t,n){await gn(this.dht.put(e,t,n))}async get(e,t){for await(const n of this.dht.get(e,t))if("VALUE"===n.name)return n.value;throw new Mr("Not found","ERR_NOT_FOUND")}}class hA{constructor(e){je(this,"dht",void 0),this.dht=e}async findPeer(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for await(const n of this.dht.findPeer(e,t))if("FINAL_PEER"===n.name)return n.peer;throw new Mr("Not found","ERR_NOT_FOUND")}getClosestPeers(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){for await(const r of t.dht.getClosestPeers(e,n))"FINAL_PEER"===r.name&&(yield r.peer)}()}catch(n){return Promise.reject(n)}}}class dA extends bu{constructor(e,t){var n;super(),je(this,"protocol",void 0),je(this,"routingTable",void 0),je(this,"providers",void 0),je(this,"network",void 0),je(this,"peerRouting",void 0),je(this,"components",void 0),je(this,"log",void 0),je(this,"running",void 0),je(this,"kBucketSize",void 0),je(this,"clientMode",void 0),je(this,"validators",void 0),je(this,"selectors",void 0),je(this,"queryManager",void 0),je(this,"contentFetching",void 0),je(this,"contentRouting",void 0),je(this,"routingTableRefresh",void 0),je(this,"rpc",void 0),je(this,"topologyListener",void 0),je(this,"querySelf",void 0),je(this,"maxInboundStreams",void 0),je(this,"maxOutboundStreams",void 0),je(this,"dhtContentRouting",void 0),je(this,"dhtPeerRouting",void 0),je(this,"peerInfoMapper",void 0);const{kBucketSize:r,clientMode:i,validators:o,selectors:s,querySelfInterval:a,protocol:l,logPrefix:c,pingTimeout:u,pingConcurrency:h,maxInboundStreams:d,maxOutboundStreams:f,providers:p}=t,g=null!==c&&void 0!==c?c:"libp2p:kad-dht";this.running=!1,this.components=e,this.log=e.logger.forComponent(g),this.protocol=null!==l&&void 0!==l?l:"/ipfs/kad/1.0.0",this.kBucketSize=null!==r&&void 0!==r?r:20,this.clientMode=null===i||void 0===i||i,this.maxInboundStreams=null!==d&&void 0!==d?d:32,this.maxOutboundStreams=null!==f&&void 0!==f?f:64,this.peerInfoMapper=null!==(n=t.peerInfoMapper)&&void 0!==n?n:Ak,this.routingTable=new Zk(e,{kBucketSize:r,pingTimeout:u,pingConcurrency:h,protocol:this.protocol,logPrefix:g}),this.providers=new Fk(e,null!==p&&void 0!==p?p:{}),this.validators={...Sk,...o},this.selectors={...Ek,...s},this.network=new Bk(e,{protocol:this.protocol,logPrefix:g});const y=mn();!0===t.allowQueryWithZeroPeers&&y.resolve(),this.queryManager=new qk(e,{disjointPaths:Math.ceil(this.kBucketSize/2),logPrefix:g,initialQuerySelfHasRun:y,routingTable:this.routingTable}),this.peerRouting=new Uk(e,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,logPrefix:g}),this.contentFetching=new xk(e,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,logPrefix:g}),this.contentRouting=new Nk(e,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,logPrefix:g}),this.routingTableRefresh=new tA(e,{peerRouting:this.peerRouting,routingTable:this.routingTable,logPrefix:g}),this.rpc=new lA(e,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,logPrefix:g,peerInfoMapper:this.peerInfoMapper}),this.topologyListener=new cA(e,{protocol:this.protocol,logPrefix:g}),this.querySelf=new Qk(e,{peerRouting:this.peerRouting,interval:a,initialInterval:t.initialQuerySelfInterval,logPrefix:g,initialQuerySelfHasRun:y,routingTable:this.routingTable}),this.network.addEventListener("peer",(e=>{const t=e.detail;this.onPeerConnect(t).catch((e=>{this.log.error("could not add %p to routing table",t.id,e)})),this.dispatchEvent(new _u("peer",{detail:t}))})),this.topologyListener.addEventListener("peer",(e=>{const t=e.detail;Promise.resolve().then((async()=>{const e=await this.components.peerStore.get(t),n={id:t,multiaddrs:e.addresses.map((e=>{let{multiaddr:t}=e;return t})),protocols:e.protocols};await this.onPeerConnect(n)})).catch((e=>{this.log.error("could not add %p to routing table",t,e)}))})),this.dhtPeerRouting=new hA(this),this.dhtContentRouting=new uA(this),null==t.clientMode&&e.events.addEventListener("self:peer:update",(e=>{this.log("received update of self-peer info"),Promise.resolve().then((async()=>{const t=e.detail.peer.addresses.some((e=>{let{multiaddr:t}=e;return function(e){const t=e.stringTuples();for(const n of t)if(290===n[0])return!1;if(54===t[0][0]||55===t[0][0]||56===t[0][0])return!0;if(4===t[0][0]||41===t[0][0]){const e=kf("".concat(t[0][1]));return null==e||!e}return!1}(t)})),n=this.getMode();t&&"client"===n?await this.setMode("server"):"server"!==n||t||await this.setMode("client")})).catch((e=>{this.log.error("error setting dht server mode",e)}))}))}get[Su](){return this.dhtContentRouting}get[ku](){return this.dhtPeerRouting}get[Au](){return this}async onPeerConnect(e){if(this.log("peer %p connected",e.id),0!==(e=this.peerInfoMapper(e)).multiaddrs.length)try{await this.routingTable.add(e.id)}catch(t){this.log.error("could not add %p to routing table",e.id,t)}else this.log("ignoring %p as there were no valid addresses in %s after filtering",e.id,e.multiaddrs.map((e=>e.toString())))}isStarted(){return this.running}getMode(){return this.clientMode?"client":"server"}async setMode(e){await this.components.registrar.unhandle(this.protocol),"client"===e?(this.log("enabling client mode"),this.clientMode=!0):(this.log("enabling server mode"),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running=!0,await this.setMode(this.clientMode?"client":"server"),this.querySelf.start(),await Promise.all([this.providers.start(),this.queryManager.start(),this.network.start(),this.routingTable.start(),this.topologyListener.start(),this.routingTableRefresh.start()])}async stop(){this.running=!1,this.querySelf.stop(),await Promise.all([this.providers.stop(),this.queryManager.stop(),this.network.stop(),this.routingTable.stop(),this.routingTableRefresh.stop(),this.topologyListener.stop()])}put(e,t){try{var n=this;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return async function*(){yield*n.contentFetching.put(e,t,r)}()}catch(r){return Promise.reject(r)}}get(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){yield*t.contentFetching.get(e,n)}()}catch(n){return Promise.reject(n)}}provide(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){yield*t.contentRouting.provide(e,t.components.addressManager.getAddresses(),n)}()}catch(n){return Promise.reject(n)}}findProviders(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){yield*t.contentRouting.findProviders(e,n)}()}catch(n){return Promise.reject(n)}}findPeer(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){yield*t.peerRouting.findPeer(e,n)}()}catch(n){return Promise.reject(n)}}getClosestPeers(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){yield*t.peerRouting.getClosestPeers(e,n)}()}catch(n){return Promise.reject(n)}}async refreshRoutingTable(){this.routingTableRefresh.refreshTable(!0)}}var fA;!function(e){e[e.SEND_QUERY=0]="SEND_QUERY",e[e.PEER_RESPONSE=1]="PEER_RESPONSE",e[e.FINAL_PEER=2]="FINAL_PEER",e[e.QUERY_ERROR=3]="QUERY_ERROR",e[e.PROVIDER=4]="PROVIDER",e[e.VALUE=5]="VALUE",e[e.ADD_PEER=6]="ADD_PEER",e[e.DIAL_PEER=7]="DIAL_PEER"}(fA||(fA={}));const pA=new Uint32Array([1732584193,4023233417,2562383102,271733878,3285377520]),gA=new Uint32Array(80);class yA extends di{constructor(){super(64,20,8,!1),this.A=0|pA[0],this.B=0|pA[1],this.C=0|pA[2],this.D=0|pA[3],this.E=0|pA[4]}get(){const{A:e,B:t,C:n,D:r,E:i}=this;return[e,t,n,r,i]}set(e,t,n,r,i){this.A=0|e,this.B=0|t,this.C=0|n,this.D=0|r,this.E=0|i}process(e,t){for(let a=0;a<16;a++,t+=4)gA[a]=e.getUint32(t,!1);for(let a=16;a<80;a++)gA[a]=ei(gA[a-3]^gA[a-8]^gA[a-14]^gA[a-16],1);let{A:n,B:r,C:i,D:o,E:s}=this;for(let a=0;a<80;a++){let e,t;a<20?(e=ui(r,i,o),t=1518500249):a<40?(e=r^i^o,t=1859775393):a<60?(e=hi(r,i,o),t=2400959708):(e=r^i^o,t=3395469782);const l=ei(n,5)+e+s+t+gA[a]|0;s=o,o=i,i=ei(r,30),r=n,n=l}n=n+this.A|0,r=r+this.B|0,i=i+this.C|0,o=o+this.D|0,s=s+this.E|0,this.set(n,r,i,o,s)}roundClean(){gA.fill(0)}destroy(){this.set(0,0,0,0,0),this.buffer.fill(0)}}const vA={sha1:li((()=>new yA)),"sha2-256":Mc,"sha2-512":Si};function mA(e,t,n,r,i){if("sha1"!==i&&"sha2-256"!==i&&"sha2-512"!==i){const e=Object.keys(vA).join(" / ");throw new Mr("Hash '".concat(i,"' is unknown or not supported. Must be ").concat(e),"ERR_UNSUPPORTED_HASH_TYPE")}const o=function(e,t,n,r){const{c:i,dkLen:o,DK:s,PRF:a,PRFSalt:l}=ca(e,t,n,r);let c;const u=new Uint8Array(4),h=$r(u),d=new Uint8Array(a.outputLen);for(let f=1,p=0;p<o;f++,p+=a.outputLen){const e=s.subarray(p,p+a.outputLen);h.setInt32(0,f,!1),(c=l._cloneInto(c)).update(u).digestInto(d),e.set(d.subarray(0,e.length));for(let t=1;t<i;t++){a._cloneInto(c).update(d).digestInto(d);for(let t=0;t<e.length;t++)e[t]^=d[t]}}return ua(a,l,s,c,d)}(vA[i],e,t,{c:n,dkLen:r});return cn.encode(o).substring(1)}var wA,bA=n(1287);!function(e){e.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",e.ERR_INVALID_KEY_NAME="ERR_INVALID_KEY_NAME",e.ERR_INVALID_KEY_TYPE="ERR_INVALID_KEY_TYPE",e.ERR_KEY_ALREADY_EXISTS="ERR_KEY_ALREADY_EXISTS",e.ERR_INVALID_KEY_SIZE="ERR_INVALID_KEY_SIZE",e.ERR_KEY_NOT_FOUND="ERR_KEY_NOT_FOUND",e.ERR_OLD_KEY_NAME_INVALID="ERR_OLD_KEY_NAME_INVALID",e.ERR_NEW_KEY_NAME_INVALID="ERR_NEW_KEY_NAME_INVALID",e.ERR_PASSWORD_REQUIRED="ERR_PASSWORD_REQUIRED",e.ERR_PEM_REQUIRED="ERR_PEM_REQUIRED",e.ERR_CANNOT_READ_KEY="ERR_CANNOT_READ_KEY",e.ERR_MISSING_PRIVATE_KEY="ERR_MISSING_PRIVATE_KEY",e.ERR_INVALID_OLD_PASS_TYPE="ERR_INVALID_OLD_PASS_TYPE",e.ERR_INVALID_NEW_PASS_TYPE="ERR_INVALID_NEW_PASS_TYPE",e.ERR_INVALID_PASS_LENGTH="ERR_INVALID_PASS_LENGTH"}(wA||(wA={}));const EA="/info/",_A=new WeakMap,SA=14,kA=16,AA=1e3,IA={dek:{keyLength:64,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function TA(e){return null!=e&&("string"===typeof e&&(e===bA(e.trim())&&e.length>0))}async function RA(){const e=800*Math.random()+200;await new Promise((t=>setTimeout(t,e)))}function CA(e){return new Er("/pkcs8/"+e)}function xA(e){return new Er(EA+e)}class PA{constructor(e,t){var n,r,i,o,s,a,l,c,u;if(je(this,"components",void 0),je(this,"init",void 0),je(this,"log",void 0),this.components=e,this.log=e.logger.forComponent("libp2p:keychain"),this.init=Ip(IA,t),null!=this.init.pass&&(null===(n=this.init.pass)||void 0===n?void 0:n.length)<20)throw new Error("pass must be least 20 characters");if(null!=(null===(r=this.init.dek)||void 0===r?void 0:r.keyLength)&&this.init.dek.keyLength<SA)throw new Error("dek.keyLength must be least ".concat(SA," bytes"));if(null!=(null===(i=this.init.dek)||void 0===i||null===(i=i.salt)||void 0===i?void 0:i.length)&&this.init.dek.salt.length<kA)throw new Error("dek.saltLength must be least ".concat(kA," bytes"));if(null!=(null===(o=this.init.dek)||void 0===o?void 0:o.iterationCount)&&this.init.dek.iterationCount<AA)throw new Error("dek.iterationCount must be least ".concat(AA));const h=null!=this.init.pass&&null!=(null===(s=this.init.dek)||void 0===s?void 0:s.salt)?mA(this.init.pass,null===(a=this.init.dek)||void 0===a?void 0:a.salt,null===(l=this.init.dek)||void 0===l?void 0:l.iterationCount,null===(c=this.init.dek)||void 0===c?void 0:c.keyLength,null===(u=this.init.dek)||void 0===u?void 0:u.hash):"";_A.set(this,{dek:h})}static generateOptions(){const e=Object.assign({},IA),t=3*Math.ceil(kA/3);return e.dek.salt=vr(mc(t),"base64"),e}static get options(){return IA}async createKey(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2048;if(!TA(e)||"self"===e)throw await RA(),new Mr("Invalid key name",wA.ERR_INVALID_KEY_NAME);if("string"!==typeof t)throw await RA(),new Mr("Invalid key type",wA.ERR_INVALID_KEY_TYPE);const r=CA(e);if(await this.components.datastore.has(r))throw await RA(),new Mr("Key name already exists",wA.ERR_KEY_ALREADY_EXISTS);if("rsa"===t.toLowerCase())if(!Number.isSafeInteger(n)||n<2048)throw await RA(),new Mr("Invalid RSA key size",wA.ERR_INVALID_KEY_SIZE);let i;try{const o=await uu(t,n),s=await o.id(),a=_A.get(this);if(null==a)throw new Mr("dek missing",wA.ERR_INVALID_PARAMETERS);const l=a.dek,c=await o.export(l);i={name:e,id:s};const u=this.components.datastore.batch();u.put(r,yr(c)),u.put(xA(e),yr(JSON.stringify(i))),await u.commit()}catch(o){throw await RA(),o}return i}async listKeys(){const e={prefix:EA},t=[];for await(const n of this.components.datastore.query(e))t.push(JSON.parse(vr(n.value)));return t}async findKeyById(e){try{const t=(await this.listKeys()).find((t=>t.id===e));if(null==t)throw new Mr("Key with id '".concat(e,"' does not exist."),wA.ERR_KEY_NOT_FOUND);return t}catch(t){throw await RA(),t}}async findKeyByName(e){if(!TA(e))throw await RA(),new Mr("Invalid key name '".concat(e,"'"),wA.ERR_INVALID_KEY_NAME);const t=xA(e);try{const e=await this.components.datastore.get(t);return JSON.parse(vr(e))}catch(n){throw await RA(),this.log.error(n),new Mr("Key '".concat(e,"' does not exist."),wA.ERR_KEY_NOT_FOUND)}}async removeKey(e){if(!TA(e)||"self"===e)throw await RA(),new Mr("Invalid key name '".concat(e,"'"),wA.ERR_INVALID_KEY_NAME);const t=CA(e),n=await this.findKeyByName(e),r=this.components.datastore.batch();return r.delete(t),r.delete(xA(e)),await r.commit(),n}async renameKey(e,t){if(!TA(e)||"self"===e)throw await RA(),new Mr("Invalid old key name '".concat(e,"'"),wA.ERR_OLD_KEY_NAME_INVALID);if(!TA(t)||"self"===t)throw await RA(),new Mr("Invalid new key name '".concat(t,"'"),wA.ERR_NEW_KEY_NAME_INVALID);const n=CA(e),r=CA(t),i=xA(e),o=xA(t);if(await this.components.datastore.has(r))throw await RA(),new Mr("Key '".concat(t,"' already exists"),wA.ERR_KEY_ALREADY_EXISTS);try{const e=await this.components.datastore.get(n),s=await this.components.datastore.get(i),a=JSON.parse(vr(s));a.name=t;const l=this.components.datastore.batch();return l.put(r,e),l.put(o,yr(JSON.stringify(a))),l.delete(n),l.delete(i),await l.commit(),a}catch(s){throw await RA(),s}}async exportKey(e,t){if(!TA(e))throw await RA(),new Mr("Invalid key name '".concat(e,"'"),wA.ERR_INVALID_KEY_NAME);if(null==t)throw await RA(),new Mr("Password is required",wA.ERR_PASSWORD_REQUIRED);const n=CA(e);try{const e=vr(await this.components.datastore.get(n)),r=_A.get(this);if(null==r)throw new Mr("dek missing",wA.ERR_INVALID_PARAMETERS);const i=r.dek,o=await pu(e,i);return await o.export(t)}catch(r){throw await RA(),r}}async exportPeerId(e){const t="temporary-password",n=await this.exportKey(e,t),r=await pu(n,t);return Fu(r.public.bytes,r.bytes)}async importKey(e,t,n){if(!TA(e)||"self"===e)throw await RA(),new Mr("Invalid key name '".concat(e,"'"),wA.ERR_INVALID_KEY_NAME);if(null==t)throw await RA(),new Mr("PEM encoded key is required",wA.ERR_PEM_REQUIRED);const r=CA(e);if(await this.components.datastore.has(r))throw await RA(),new Mr("Key '".concat(e,"' already exists"),wA.ERR_KEY_ALREADY_EXISTS);let i,o;try{i=await pu(t,n)}catch(l){throw await RA(),new Mr("Cannot read the key, most likely the password is wrong",wA.ERR_CANNOT_READ_KEY)}try{o=await i.id();const e=_A.get(this);if(null==e)throw new Mr("dek missing",wA.ERR_INVALID_PARAMETERS);const n=e.dek;t=await i.export(n)}catch(l){throw await RA(),l}const s={name:e,id:o},a=this.components.datastore.batch();return a.put(r,yr(t)),a.put(xA(e),yr(JSON.stringify(s))),await a.commit(),s}async importPeer(e,t){try{if(!TA(e))throw new Mr("Invalid key name '".concat(e,"'"),wA.ERR_INVALID_KEY_NAME);if(null==t)throw new Mr("PeerId is required",wA.ERR_MISSING_PRIVATE_KEY);if(null==t.privateKey)throw new Mr("PeerId.privKey is required",wA.ERR_MISSING_PRIVATE_KEY);const n=await fu(t.privateKey),r=CA(e);if(await this.components.datastore.has(r))throw await RA(),new Mr("Key '".concat(e,"' already exists"),wA.ERR_KEY_ALREADY_EXISTS);const i=_A.get(this);if(null==i)throw new Mr("dek missing",wA.ERR_INVALID_PARAMETERS);const o=i.dek,s=await n.export(o),a={name:e,id:t.toString()},l=this.components.datastore.batch();return l.put(r,yr(s)),l.put(xA(e),yr(JSON.stringify(a))),await l.commit(),a}catch(n){throw await RA(),n}}async getPrivateKey(e){if(!TA(e))throw await RA(),new Mr("Invalid key name '".concat(e,"'"),wA.ERR_INVALID_KEY_NAME);try{const t=CA(e);return vr(await this.components.datastore.get(t))}catch(t){throw await RA(),this.log.error(t),new Mr("Key '".concat(e,"' does not exist."),wA.ERR_KEY_NOT_FOUND)}}async rotateKeychainPass(e,t){var n,r,i,o;if("string"!==typeof e)throw await RA(),new Mr("Invalid old pass type '".concat(typeof e,"'"),wA.ERR_INVALID_OLD_PASS_TYPE);if("string"!==typeof t)throw await RA(),new Mr("Invalid new pass type '".concat(typeof t,"'"),wA.ERR_INVALID_NEW_PASS_TYPE);if(t.length<20)throw await RA(),new Mr("Invalid pass length ".concat(t.length),wA.ERR_INVALID_PASS_LENGTH);this.log("recreating keychain");const s=_A.get(this);if(null==s)throw new Mr("dek missing",wA.ERR_INVALID_PARAMETERS);const a=s.dek;this.init.pass=t;const l=null!=t&&null!=(null===(n=this.init.dek)||void 0===n?void 0:n.salt)?mA(t,this.init.dek.salt,null===(r=this.init.dek)||void 0===r?void 0:r.iterationCount,null===(i=this.init.dek)||void 0===i?void 0:i.keyLength,null===(o=this.init.dek)||void 0===o?void 0:o.hash):"";_A.set(this,{dek:l});const c=await this.listKeys();for(const u of c){const e=vr(await this.components.datastore.get(CA(u.name))),t=await pu(e,a),n=l.toString(),r=await t.export(n),i=this.components.datastore.batch(),o={name:u.name,id:u.id};i.put(CA(u.name),yr(r)),i.put(xA(u.name),yr(JSON.stringify(o))),await i.commit()}this.log("keychain reconstructed")}}function DA(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>new PA(t,e)}var NA;!function(e){e[e.NEW_STREAM=0]="NEW_STREAM",e[e.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",e[e.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",e[e.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",e[e.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",e[e.RESET_RECEIVER=5]="RESET_RECEIVER",e[e.RESET_INITIATOR=6]="RESET_INITIATOR"}(NA||(NA={}));const BA=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),LA=Object.freeze({NEW_STREAM:NA.NEW_STREAM,MESSAGE:NA.MESSAGE_INITIATOR,CLOSE:NA.CLOSE_INITIATOR,RESET:NA.RESET_INITIATOR}),OA=Object.freeze({MESSAGE:NA.MESSAGE_RECEIVER,CLOSE:NA.CLOSE_RECEIVER,RESET:NA.RESET_RECEIVER}),MA=1<<20;class UA{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:MA,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4194304;je(this,"_buffer",void 0),je(this,"_headerInfo",void 0),je(this,"_maxMessageSize",void 0),je(this,"_maxUnprocessedMessageQueueSize",void 0),this._buffer=new Gu,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(null==e||0===e.length)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw Object.assign(new Error("unprocessed message queue size too large!"),{code:"ERR_MSG_QUEUE_TOO_BIG"});const t=[];for(;0!==this._buffer.length;){if(null==this._headerInfo)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(n){if("ERR_MSG_TOO_BIG"===n.code)throw n;break}const{id:e,type:r,length:i,offset:o}=this._headerInfo;if(this._buffer.length-o<i)break;const s={id:e,type:r};r!==NA.NEW_STREAM&&r!==NA.MESSAGE_INITIATOR&&r!==NA.MESSAGE_RECEIVER||(s.data=this._buffer.sublist(o,o+i)),t.push(s),this._buffer.consume(o+i),this._headerInfo=null}return t}_decodeHeader(e){const{value:t,offset:n}=zA(e),{value:r,offset:i}=zA(e,n),o=7&t;if(null==BA[o])throw new Error("Invalid type received: ".concat(o));if(r>this._maxMessageSize)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"});return{id:t>>3,type:o,offset:n+i,length:r}}}const FA=128,VA=127;function zA(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0,i=0,o=n;const s=e.length;do{if(o>=s||i>49)throw n=0,new RangeError("Could not decode varint");t=e.get(o++),r+=i<28?(t&VA)<<i:(t&VA)*Math.pow(2,i),i+=7}while(t>=FA);return n=o-n,{value:r,offset:n}}const KA=10240;const jA=new class{constructor(){je(this,"_pool",void 0),je(this,"_poolOffset",void 0),this._pool=hr(KA),this._poolOffset=0}write(e,t){const n=this._pool;let r=this._poolOffset;cs(e.id<<3|e.type,n,r),r+=ss(e.id<<3|e.type),e.type!==NA.NEW_STREAM&&e.type!==NA.MESSAGE_INITIATOR&&e.type!==NA.MESSAGE_RECEIVER||null==e.data?(cs(0,n,r),r+=ss(0)):(cs(e.data.length,n,r),r+=ss(e.data.length));const i=n.subarray(this._poolOffset,r);KA-r<100?(this._pool=hr(KA),this._poolOffset=0):this._poolOffset=r,t.append(i),e.type!==NA.NEW_STREAM&&e.type!==NA.MESSAGE_INITIATOR&&e.type!==NA.MESSAGE_RECEIVER||null==e.data||t.append(e.data)}};class HA extends EE{constructor(e){super(e),je(this,"name",void 0),je(this,"streamId",void 0),je(this,"send",void 0),je(this,"types",void 0),je(this,"maxDataSize",void 0),this.types="outbound"===e.direction?LA:OA,this.send=e.send,this.name=e.name,this.streamId=e.streamId,this.maxDataSize=e.maxDataSize}async sendNewStream(){await this.send({id:this.streamId,type:LA.NEW_STREAM,data:new Gu(yr(this.name))})}async sendData(e){for(e=e.sublist();e.byteLength>0;){const t=Math.min(e.byteLength,this.maxDataSize);await this.send({id:this.streamId,type:this.types.MESSAGE,data:e.sublist(0,t)}),e.consume(t)}}async sendReset(){await this.send({id:this.streamId,type:this.types.RESET})}async sendCloseWrite(){await this.send({id:this.streamId,type:this.types.CLOSE})}async sendCloseRead(){}}function qA(e){const t={...e,type:"".concat(BA[e.type]," (").concat(e.type,")")};return e.type===NA.NEW_STREAM&&(t.data=vr(e.data instanceof Uint8Array?e.data:e.data.subarray())),e.type!==NA.MESSAGE_INITIATOR&&e.type!==NA.MESSAGE_RECEIVER||(t.data=vr(e.data instanceof Uint8Array?e.data:e.data.subarray(),"base16")),t}class WA{constructor(e,t){var n,r,i;je(this,"protocol","/mplex/6.7.0"),je(this,"sink",void 0),je(this,"source",void 0),je(this,"log",void 0),je(this,"_streamId",void 0),je(this,"_streams",void 0),je(this,"_init",void 0),je(this,"_source",void 0),je(this,"closeController",void 0),je(this,"rateLimiter",void 0),je(this,"closeTimeout",void 0),je(this,"logger",void 0),t=null!==(n=t)&&void 0!==n?n:{},this.log=e.logger.forComponent("libp2p:mplex"),this.logger=e.logger,this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=t,this.closeTimeout=null!==(r=t.closeTimeout)&&void 0!==r?r:500,this.sink=this._createSink(),this._source=_n({objectMode:!0,onEnd:()=>{for(const e of this._streams.initiators.values())e.destroy();for(const e of this._streams.receivers.values())e.destroy()}}),this.source=Cr(this._source,(e=>async function*(e){for await(const t of e){const e=new Gu;jA.write(t,e),yield e}}(e))),this.closeController=new AbortController,this.rateLimiter=new Bp({points:null!==(i=t.disconnectThreshold)&&void 0!==i?i:5,duration:1})}get streams(){const e=[];for(const t of this._streams.initiators.values())e.push(t);for(const t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new Error("Muxer already closed");const t=this._streamId++;e=null==e?t.toString():e.toString();const n=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:n})}async close(e){var t;if(this.closeController.signal.aborted)return;const n=null!==(t=null===e||void 0===e?void 0:e.signal)&&void 0!==t?t:AbortSignal.timeout(this.closeTimeout);try{await Promise.all(this.streams.map((async e=>e.close({signal:n})))),this._source.end(),await this._source.onEmpty({signal:n}),this.closeController.abort()}catch(r){this.abort(r)}}abort(e){this.closeController.signal.aborted||(this.streams.forEach((t=>{t.abort(e)})),this.closeController.abort(e))}_newReceiverStream(e){const{id:t,name:n}=e,r=this._streams.receivers;return this._newStream({id:t,name:n,type:"receiver",registry:r})}_newStream(e){var t;const{id:n,name:r,type:i,registry:o}=e;if(this.log("new %s stream %s",i,n),"initiator"===i&&this._streams.initiators.size===(null!==(t=this._init.maxOutboundStreams)&&void 0!==t?t:1024))throw new Mr("Too many outbound streams open","ERR_TOO_MANY_OUTBOUND_STREAMS");if(o.has(n))throw new Error("".concat(i," stream ").concat(n," already exists!"));const s=function(e){const{id:t,name:n,send:r,onEnd:i,type:o="initiator",maxMsgSize:s=MA}=e;return new HA({id:"initiator"===o?"i".concat(t):"r".concat(t),streamId:t,name:"".concat(null==n?t:n),direction:"initiator"===o?"outbound":"inbound",maxDataSize:s,onEnd:i,send:r,log:e.logger.forComponent("libp2p:mplex:stream:".concat(o,":").concat(t))})}({id:n,name:r,send:async e=>{this.log.enabled&&this.log.trace("%s stream %s send",i,n,qA(e)),this._source.push(e)},type:i,onEnd:()=>{this.log("%s stream with id %s and protocol %s ended",i,n,s.protocol),o.delete(n),null!=this._init.onStreamEnd&&this._init.onStreamEnd(s)},maxMsgSize:this._init.maxMsgSize,logger:this.logger});return o.set(n,s),s}_createSink(){return async e=>{const t=()=>{wE(e,this.log)};this.closeController.signal.addEventListener("abort",t);try{const t=new UA(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(const n of e)for(const e of t.write(n))await this._handleIncoming(e);this._source.end()}catch(n){this.log("error in sink",n),this._source.end(n)}finally{this.closeController.signal.removeEventListener("abort",t)}}}async _handleIncoming(e){var t;const{id:n,type:r}=e;if(this.log.enabled&&this.log.trace("incoming message",qA(e)),e.type===NA.NEW_STREAM){var i;if(this._streams.receivers.size===(null!==(i=this._init.maxInboundStreams)&&void 0!==i?i:1024)){this.log("too many inbound streams open"),this._source.push({id:n,type:NA.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{return this.log("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),void this.abort(new Error("Too many open streams"))}return}const t=this._newReceiverStream({id:n,name:vr(e.data instanceof Uint8Array?e.data:e.data.subarray())});return void(null!=this._init.onIncomingStream&&this._init.onIncomingStream(t))}const o=(1===(1&r)?this._streams.initiators:this._streams.receivers).get(n);if(null==o){this.log("missing stream %s for message type %s",n,BA[r]);try{await this.rateLimiter.consume("missing-stream",1)}catch{return this.log("rate limit hit when receiving messages for streams that do not exist - closing remote connection"),void this.abort(new Error("Too many messages for missing streams"))}return}const s=null!==(t=this._init.maxStreamBufferSize)&&void 0!==t?t:4194304;try{switch(r){case NA.MESSAGE_INITIATOR:case NA.MESSAGE_RECEIVER:if(o.sourceReadableLength()>s)throw this._source.push({id:e.id,type:r===NA.MESSAGE_INITIATOR?NA.RESET_RECEIVER:NA.RESET_INITIATOR}),new Mr("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers","ERR_STREAM_INPUT_BUFFER_FULL");o.sourcePush(e.data);break;case NA.CLOSE_INITIATOR:case NA.CLOSE_RECEIVER:o.remoteCloseWrite();break;case NA.RESET_INITIATOR:case NA.RESET_RECEIVER:o.reset();break;default:this.log("unknown message type %s",r)}}catch(a){this.log.error("error while processing message",a),o.abort(a)}}}class GA{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};je(this,"protocol","/mplex/6.7.0"),je(this,"_init",void 0),je(this,"components",void 0),this.components=e,this._init=t}createStreamMuxer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new WA(this.components,{...e,...this._init})}}function YA(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>new GA(t,e)}const QA="ERR_WRONG_PING_ACK";class XA{constructor(e){var t,n,r,i,o;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};je(this,"protocol",void 0),je(this,"components",void 0),je(this,"started",void 0),je(this,"timeout",void 0),je(this,"maxInboundStreams",void 0),je(this,"maxOutboundStreams",void 0),je(this,"runOnTransientConnection",void 0),je(this,"log",void 0),this.components=e,this.log=e.logger.forComponent("libp2p:ping"),this.started=!1,this.protocol="/".concat(null!==(t=s.protocolPrefix)&&void 0!==t?t:"ipfs","/").concat("ping","/").concat("1.0.0"),this.timeout=null!==(n=s.timeout)&&void 0!==n?n:1e4,this.maxInboundStreams=null!==(r=s.maxInboundStreams)&&void 0!==r?r:2,this.maxOutboundStreams=null!==(i=s.maxOutboundStreams)&&void 0!==i?i:1,this.runOnTransientConnection=null===(o=s.runOnTransientConnection)||void 0===o||o,this.handleMessage=this.handleMessage.bind(this)}async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnTransientConnection:this.runOnTransientConnection}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){this.log("incoming ping from %p",e.connection.remotePeer);const{stream:t}=e,n=Date.now();Cr(t,t).catch((t=>{this.log.error("incoming ping from %p failed with error",e.connection.remotePeer,t)})).finally((()=>{const t=Date.now()-n;this.log("incoming ping from %p complete in %dms",e.connection.remotePeer,t)}))}async ping(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.log("pinging %p",e);const n=Date.now(),r=mc(32),i=await this.components.connectionManager.openConnection(e,t);let o,s=()=>{};if(null==t.signal){const e=AbortSignal.timeout(this.timeout);t={...t,signal:e}}try{var a;o=await i.newStream(this.protocol,{...t,runOnTransientConnection:this.runOnTransientConnection}),s=()=>{var e;null===(e=o)||void 0===e||e.abort(new Mr("ping timeout",Kr))},null===(a=t.signal)||void 0===a||a.addEventListener("abort",s,{once:!0});const e=await Cr([r],o,(async e=>QE(e))),l=Date.now()-n;if(null==e)throw new Mr("Did not receive a ping ack after ".concat(l,"ms"),QA);if(!Hr(r,e.subarray()))throw new Mr("Received wrong ping ack after ".concat(l,"ms"),QA);return this.log("ping %p complete in %dms",i.remotePeer,l),l}catch(u){var l;throw this.log.error("error while pinging %p",i.remotePeer,u),null===(l=o)||void 0===l||l.abort(u),u}finally{var c;null===(c=t.signal)||void 0===c||c.removeEventListener("abort",s),null!=o&&await o.close()}}}function JA(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>new XA(t,e)}var $A;!function(e){e.ERR_ALREADY_ABORTED="ERR_ALREADY_ABORTED",e.ERR_DATA_CHANNEL="ERR_DATA_CHANNEL",e.ERR_CONNECTION_CLOSED="ERR_CONNECTION_CLOSED",e.ERR_HASH_NOT_SUPPORTED="ERR_HASH_NOT_SUPPORTED",e.ERR_INVALID_MULTIADDR="ERR_INVALID_MULTIADDR",e.ERR_INVALID_FINGERPRINT="ERR_INVALID_FINGERPRINT",e.ERR_INVALID_PARAMETERS="ERR_INVALID_PARAMETERS",e.ERR_NOT_IMPLEMENTED="ERR_NOT_IMPLEMENTED",e.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS",e.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS="ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS"}($A||($A={}));class ZA extends Mr{constructor(e,t){super("WebRTC transport error: ".concat(e),null!==t&&void 0!==t?t:""),this.name="WebRTCTransportError"}}class eI extends ZA{constructor(e,t){super("[stream: ".concat(e,"] data channel error: ").concat(t),$A.ERR_DATA_CHANNEL),this.name="WebRTC/DataChannelError"}}function tI(e,t){return new eI(e,t)}class nI extends ZA{constructor(e){super("There was a problem with the Multiaddr which was passed in: ".concat(e),$A.ERR_INVALID_MULTIADDR),this.name="WebRTC/InappropriateMultiaddrError"}}function rI(e){return new nI(e)}class iI extends ZA{constructor(e){super("There was a problem with a provided argument: ".concat(e),$A.ERR_INVALID_PARAMETERS),this.name="WebRTC/InvalidArgumentError"}}function oI(e){return new iI(e)}class sI extends ZA{constructor(e,t){super('Invalid fingerprint "'.concat(e,'" within ').concat(t),$A.ERR_INVALID_FINGERPRINT),this.name="WebRTC/InvalidFingerprintError"}}function aI(e,t){return new sI(e,t)}class lI extends ZA{constructor(e){super("A method (".concat(e,") was called though it has been intentionally left unimplemented."),$A.ERR_NOT_IMPLEMENTED),this.name="WebRTC/UnimplementedError"}}class cI extends ZA{constructor(e){super("unsupported hash algorithm: ".concat(e),$A.ERR_HASH_NOT_SUPPORTED),this.name="WebRTC/UnsupportedHashAlgorithmError"}}var uI=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},hI=function(e,t,n){this.name=e,this.version=t,this.os=n,this.type="browser"},dI=function(e){this.version=e,this.type="node",this.name="node",this.os=process.platform},fI=function(e,t,n,r){this.name=e,this.version=t,this.os=n,this.bot=r,this.type="bot-device"},pI=function(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null},gI=function(){this.type="react-native",this.name="react-native",this.version=null,this.os=null},yI=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,vI=3,mI=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/]],wI=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function bI(e){return""!==e&&mI.reduce((function(t,n){var r=n[0],i=n[1];if(t)return t;var o=i.exec(e);return!!o&&[r,o]}),!1)}function EI(e){var t=bI(e);if(!t)return null;var n=t[0],r=t[1];if("searchbot"===n)return new pI;var i=r[1]&&r[1].split(".").join("_").split("_").slice(0,3);i?i.length<vI&&(i=uI(uI([],i,!0),function(e){for(var t=[],n=0;n<e;n++)t.push("0");return t}(vI-i.length),!0)):i=[];var o=i.join("."),s=function(e){for(var t=0,n=wI.length;t<n;t++){var r=wI[t],i=r[0];if(r[1].exec(e))return i}return null}(e),a=yI.exec(e);return a&&a[1]?new fI(n,o,s,a[1]):new hI(n,o,s)}const _I=SI?EI(SI):"undefined"===typeof document&&"undefined"!==typeof navigator&&"ReactNative"===navigator.product?new gI:"undefined"!==typeof navigator?EI(navigator.userAgent):function(){var e="undefined"!==typeof process&&process.version;return e?new dI(process.version.slice(1)):null}();var SI;const kI=null!=_I&&"firefox"===_I.name,AI=async function*(){},II=async e=>{},TI=3e4;class RI{constructor(e,t){je(this,"log",void 0),je(this,"peerConnection",void 0),je(this,"remoteAddr",void 0),je(this,"timeline",void 0),je(this,"metrics",void 0),je(this,"source",AI()),je(this,"sink",II),this.log=e.logger.forComponent("libp2p:webrtc:maconn"),this.remoteAddr=t.remoteAddr,this.timeline=t.timeline,this.peerConnection=t.peerConnection;const n=this.peerConnection.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change",this.peerConnection.connectionState,"initial state",n),"disconnected"!==this.peerConnection.connectionState&&"failed"!==this.peerConnection.connectionState&&"closed"!==this.peerConnection.connectionState||(this.timeline.close=Date.now())}}async close(e){var t;this.log.trace("closing connection"),this.peerConnection.close(),this.timeline.close=Date.now(),null===(t=this.metrics)||void 0===t||t.increment({close:!0})}abort(e){var t;this.log.error("closing connection due to error",e),this.peerConnection.close(),this.timeline.close=Date.now(),null===(t=this.metrics)||void 0===t||t.increment({abort:!0})}}var CI;!function(e){let t,n,r;!function(e){e.FIN="FIN",e.STOP_SENDING="STOP_SENDING",e.RESET="RESET",e.FIN_ACK="FIN_ACK"}(t=e.Flag||(e.Flag={})),function(e){e[e.FIN=0]="FIN",e[e.STOP_SENDING=1]="STOP_SENDING",e[e.RESET=2]="RESET",e[e.FIN_ACK=3]="FIN_ACK"}(n||(n={})),function(e){e.codec=()=>Gs(n)}(t=e.Flag||(e.Flag={})),e.codec=()=>(null==r&&(r=Ys((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==r.lengthDelimited&&n.fork(),null!=t.flag&&(n.uint32(8),e.Flag.codec().encode(t.flag,n)),null!=t.message&&(n.uint32(18),n.bytes(t.message)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();switch(n>>>3){case 1:r.flag=e.Flag.codec().decode(t);break;case 2:r.message=t.bytes();break;default:t.skipType(7&n)}}return r}))),r),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(CI||(CI={}));class xI extends EE{constructor(e){var t,n,r,i,o;const s=e.onEnd;switch(e.onEnd=e=>{this.log.trace("readable and writeable ends closed",this.status),Promise.resolve((async()=>{if(null==this.timeline.abort&&null===this.timeline.reset)try{await $h(this.receiveFinAck.promise,{milliseconds:this.finAckTimeout})}catch(e){this.log.error("error receiving FIN_ACK",e)}})).then((()=>{this.incomingData.end(),null===s||void 0===s||s(e)})).catch((e=>{this.log.error("error ending stream",e)}))},super(e),je(this,"channel",void 0),je(this,"incomingData",void 0),je(this,"maxBufferedAmount",void 0),je(this,"bufferedAmountLowEventTimeout",void 0),je(this,"maxMessageSize",void 0),je(this,"receiveFinAck",void 0),je(this,"finAckTimeout",void 0),je(this,"openTimeout",void 0),this.channel=e.channel,this.channel.binaryType="arraybuffer",this.incomingData=_n(),this.bufferedAmountLowEventTimeout=null!==(t=e.bufferedAmountLowEventTimeout)&&void 0!==t?t:3e4,this.maxBufferedAmount=null!==(n=e.maxBufferedAmount)&&void 0!==n?n:16777216,this.maxMessageSize=(null!==(r=e.maxMessageSize)&&void 0!==r?r:16384)-5-2,this.receiveFinAck=mn(),this.finAckTimeout=null!==(i=e.closeTimeout)&&void 0!==i?i:5e3,this.openTimeout=null!==(o=e.openTimeout)&&void 0!==o?o:5e3,this.channel.readyState){case"open":this.timeline.open=(new Date).getTime();break;case"closed":case"closing":void 0!==this.timeline.close&&0!==this.timeline.close||(this.timeline.close=Date.now());break;case"connecting":break;default:throw this.log.error("unknown datachannel state %s",this.channel.readyState),new Mr("Unknown datachannel state","ERR_INVALID_STATE")}this.channel.onopen=e=>{this.timeline.open=(new Date).getTime()},this.channel.onclose=e=>{this.receiveFinAck.resolve(),this.close().catch((e=>{this.log.error("error closing stream after channel closed",e)}))},this.channel.onerror=e=>{const t=e.error;this.abort(t)},this.channel.onmessage=async e=>{const{data:t}=e;null!==t&&0!==t.byteLength&&this.incomingData.push(new Uint8Array(t,0,t.byteLength))};const a=this;Promise.resolve().then((async()=>{for await(const e of Eg(this.incomingData)){const t=a.processIncomingProtobuf(e);null!=t&&a.sourcePush(new Gu(t))}})).catch((e=>{this.log.error("error processing incoming data channel messages",e)}))}sendNewStream(){}async _sendMessage(e){if((!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.channel.bufferedAmount>this.maxBufferedAmount)try{this.log('channel buffer is %d, wait for "bufferedamountlow" event',this.channel.bufferedAmount),await Yk(this.channel,"bufferedamountlow",{timeout:this.bufferedAmountLowEventTimeout})}catch(t){if(t instanceof Yh)throw new Mr("Timed out waiting for DataChannel buffer to clear after ".concat(this.bufferedAmountLowEventTimeout,"ms"),"ERR_BUFFER_CLEAR_TIMEOUT");throw t}if("closed"===this.channel.readyState||"closing"===this.channel.readyState)throw new Mr("Invalid datachannel state - ".concat(this.channel.readyState),"ERR_INVALID_STATE");"open"!==this.channel.readyState&&(this.log('channel state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),await Yk(this.channel,"open",{timeout:this.openTimeout}),this.log('channel state is now "%s", sending data',this.channel.readyState)),this.channel.send(e.subarray())}async sendData(e){for(e=e.sublist();e.byteLength>0;){const t=Math.min(e.byteLength,this.maxMessageSize),n=e.subarray(0,t),r=CI.encode({message:n}),i=mg.single(r);await this._sendMessage(i),e.consume(t)}}async sendReset(){await this._sendFlag(CI.Flag.RESET)}async sendCloseWrite(e){if(await this._sendFlag(CI.Flag.FIN)){this.log.trace("awaiting FIN_ACK");try{await Vp(this.receiveFinAck.promise,null===e||void 0===e?void 0:e.signal,{errorMessage:"sending close-write was aborted before FIN_ACK was received",errorCode:"ERR_FIN_ACK_NOT_RECEIVED"})}catch(t){this.log.error("failed to await FIN_ACK",t)}}else this.log.trace("sending FIN failed, not awaiting FIN_ACK");this.receiveFinAck.resolve()}async sendCloseRead(){await this._sendFlag(CI.Flag.STOP_SENDING)}processIncomingProtobuf(e){const t=CI.decode(e);if(void 0!==t.flag&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',t.flag,this.writeStatus,this.readStatus),t.flag===CI.Flag.FIN&&(this.remoteCloseWrite(),this.log.trace("sending FIN_ACK"),this._sendFlag(CI.Flag.FIN_ACK).catch((e=>{this.log.error("error sending FIN_ACK immediately",e)}))),t.flag===CI.Flag.RESET&&this.reset(),t.flag===CI.Flag.STOP_SENDING&&this.remoteCloseRead(),t.flag===CI.Flag.FIN_ACK&&(this.log.trace("received FIN_ACK"),this.receiveFinAck.resolve())),"ready"===this.readStatus)return t.message}async _sendFlag(e){if("open"!==this.channel.readyState)return this.log.trace('not sending flag %s because channel is "%s" and not "open"',this.channel.readyState,e.toString()),!1;this.log.trace("sending flag %s",e.toString());const t=CI.encode({flag:e}),n=mg.single(t);try{return await this._sendMessage(n,!1),!0}catch(r){this.log.error("could not send flag %s",e.toString(),r)}return!1}}function PI(e){const{channel:t,direction:n}=e;return new xI({id:"inbound"===n?"i".concat(t.id):"r".concat(t.id),log:e.logger.forComponent("libp2p:webrtc:stream:".concat(n,":").concat(t.id)),...e})}const DI="/webrtc";class NI{constructor(e,t){var n,r;je(this,"protocol",void 0),je(this,"peerConnection",void 0),je(this,"bufferedStreams",[]),je(this,"metrics",void 0),je(this,"dataChannelOptions",void 0),je(this,"components",void 0),je(this,"log",void 0),this.components=e,this.peerConnection=t.peerConnection,this.metrics=t.metrics,this.protocol=null!==(n=t.protocol)&&void 0!==n?n:DI,this.dataChannelOptions=null!==(r=t.dataChannelOptions)&&void 0!==r?r:{},this.log=e.logger.forComponent("libp2p:webrtc:datachannelmuxerfactory"),this.peerConnection.ondatachannel=t=>{let{channel:n}=t;if(this.log.trace('incoming early datachannel with channel id %d and label "%s"',n.id),"init"===n.label)return this.log.trace("closing early init channel"),void n.close();const r={},i=PI({channel:n,direction:"inbound",onEnd:e=>{r.onEnd(e)},logger:e.logger,...this.dataChannelOptions});r.stream=i,r.channel=n,r.onEnd=()=>{this.bufferedStreams=this.bufferedStreams.filter((e=>e.stream.id!==i.id))},this.bufferedStreams.push(r)}}createStreamMuxer(e){return new LI(this.components,{...e,peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.bufferedStreams,protocol:this.protocol})}}var BI=new WeakSet;class LI{constructor(e,t){var n,r;Ve(this,BI),je(this,"init",void 0),je(this,"streams",void 0),je(this,"protocol",void 0),je(this,"log",void 0),je(this,"peerConnection",void 0),je(this,"dataChannelOptions",void 0),je(this,"metrics",void 0),je(this,"logger",void 0),je(this,"source",AI()),je(this,"sink",II),this.init=t,this.log=e.logger.forComponent("libp2p:webrtc:muxer"),this.logger=e.logger,this.streams=t.streams.map((e=>e.stream)),this.peerConnection=t.peerConnection,this.protocol=null!==(n=t.protocol)&&void 0!==n?n:DI,this.metrics=t.metrics,this.dataChannelOptions=null!==(r=t.dataChannelOptions)&&void 0!==r?r:{},this.peerConnection.ondatachannel=e=>{var n,r;let{channel:i}=e;if(this.log.trace("incoming datachannel with channel id %d",i.id),"init"===i.label)return this.log.trace("closing init channel"),void i.close();const o=PI({channel:i,direction:"inbound",onEnd:()=>{this.log("incoming channel %s ended with state %s",i.id,i.readyState),He(BI,this,OI).call(this,o,i)},logger:this.logger,...this.dataChannelOptions});this.streams.push(o),null===(n=this.metrics)||void 0===n||n.increment({incoming_stream:!0}),null===t||void 0===t||null===(r=t.onIncomingStream)||void 0===r||r.call(t,o)},this.init.streams.length>0&&queueMicrotask((()=>{this.init.streams.forEach((e=>{var t,n,r;e.onEnd=()=>{this.log("incoming early channel %s ended with state %s",e.channel.id,e.channel.readyState),He(BI,this,OI).call(this,e.stream,e.channel)},null===(t=this.metrics)||void 0===t||t.increment({incoming_stream:!0}),null===(n=this.init)||void 0===n||null===(r=n.onIncomingStream)||void 0===r||r.call(n,e.stream)}))}))}async close(e){try{await Promise.all(this.streams.map((async t=>t.close(e))))}catch(t){this.abort(t)}}abort(e){for(const t of this.streams)t.abort(e)}newStream(){var e;const t=this.peerConnection.createDataChannel("");this.log.trace("opened outgoing datachannel with channel id %s",t.id);const n=PI({channel:t,direction:"outbound",onEnd:()=>{this.log("outgoing channel %s ended with state %s",t.id,t.readyState),He(BI,this,OI).call(this,n,t)},logger:this.logger,...this.dataChannelOptions});return this.streams.push(n),null===(e=this.metrics)||void 0===e||e.increment({outgoing_stream:!0}),n}}function OI(e,t){var n,r,i;this.log.trace("stream %s %s %s onEnd",e.direction,e.id,e.protocol),function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:TI,r=arguments.length>3?arguments[3]:void 0;"open"===e.readyState&&Promise.resolve().then((async()=>{if(e.bufferedAmount>0){r.log("%s drain channel with %d buffered bytes",t,e.bufferedAmount);const i=mn();let o=!1;e.bufferedAmountLowThreshold=0;const s=()=>{o||(r.log("%s drain channel closed before drain",t),i.resolve())};e.addEventListener("close",s,{once:!0}),e.addEventListener("bufferedamountlow",(()=>{o=!0,e.removeEventListener("close",s),i.resolve()})),await $h(i.promise,{milliseconds:n})}})).then((async()=>{"open"===e.readyState&&e.close()})).catch((e=>{r.log.error("error closing outbound stream",e)}))}(t,"".concat(e.direction," ").concat(e.id," ").concat(e.protocol),this.dataChannelOptions.drainTimeout,{log:this.log}),this.streams=this.streams.filter((t=>t.id!==e.id)),null===(n=this.metrics)||void 0===n||n.increment({stream_end:!0}),null===(r=this.init)||void 0===r||null===(i=r.onStreamEnd)||void 0===i||i.call(r,e)}const MI=globalThis.RTCPeerConnection,UI=globalThis.RTCSessionDescription,FI=globalThis.RTCIceCandidate;var VI;!function(e){let t,n,r;!function(e){e.SDP_OFFER="SDP_OFFER",e.SDP_ANSWER="SDP_ANSWER",e.ICE_CANDIDATE="ICE_CANDIDATE"}(t=e.Type||(e.Type={})),function(e){e[e.SDP_OFFER=0]="SDP_OFFER",e[e.SDP_ANSWER=1]="SDP_ANSWER",e[e.ICE_CANDIDATE=2]="ICE_CANDIDATE"}(n||(n={})),function(e){e.codec=()=>Gs(n)}(t=e.Type||(e.Type={})),e.codec=()=>(null==r&&(r=Ys((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==r.lengthDelimited&&n.fork(),null!=t.type&&(n.uint32(8),e.Type.codec().encode(t.type,n)),null!=t.data&&(n.uint32(18),n.string(t.data)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();switch(n>>>3){case 1:r.type=e.Type.codec().decode(t);break;case 2:r.data=t.string();break;default:t.skipType(7&n)}}return r}))),r),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(VI||(VI={}));const zI=async(e,t,n)=>{try{const i=mn();for(!function(e,t){e[kI?"oniceconnectionstatechange":"onconnectionstatechange"]=n=>{switch(function(e){return kI?e.iceConnectionState:e.connectionState}(e)){case"connected":t.resolve();break;case"failed":case"disconnected":case"closed":t.reject(new Mr("RTCPeerConnection was closed","ERR_CONNECTION_CLOSED_BEFORE_CONNECTED"))}}}(e,i);;){var r;const s=await Promise.race([i.promise,t.read({signal:n.signal})]);if(null==s)break;if(s.type!==VI.Type.ICE_CANDIDATE)throw new Mr("ICE candidate message expected","ERR_NOT_ICE_CANDIDATE");const a=JSON.parse(null!==(r=s.data)&&void 0!==r?r:"null");if(""===a||null===a){n.log.trace("end-of-candidates received");continue}const l=new FI(a);n.log.trace("%s received new ICE candidate",n.direction,l);try{await e.addIceCandidate(l)}catch(o){n.log.error("%s bad candidate received",n.direction,a,o)}}}catch(o){var i;if(n.log.error("%s error parsing ICE candidate",n.direction,o),!0===(null===(i=n.signal)||void 0===i?void 0:i.aborted))throw o}};async function KI(e){let{peerConnection:t,signal:n,metrics:r,multiaddr:i,connectionManager:o,transportManager:s,log:a}=e;const{baseAddr:l}=function(e){const t=e.toString().split(HI+"/");if(2!==t.length)throw new Mr("webrtc protocol was not present in multiaddr",$A.ERR_INVALID_MULTIADDR);if(!t[0].includes(qI))throw new Mr("p2p-circuit protocol was not present in multiaddr",$A.ERR_INVALID_MULTIADDR);let n=Vh(t[0]);const r=Vh("/"+t[1]).getPeerId();if(null==r)throw new Mr("destination peer id was missing",$A.ERR_INVALID_MULTIADDR);const i=n.protos().pop();if(void 0===i)throw new Mr("invalid multiaddr",$A.ERR_INVALID_MULTIADDR);"p2p"!==i.name&&(n=n.encapsulate("/p2p/".concat(r)));return{baseAddr:n,peerId:Mu(r)}}(i);null===r||void 0===r||r.dialerEvents.increment({open:!0}),a.trace("dialing base address: %a",l);const c=l.getPeerId();if(null==c)throw new Mr("Relay peer was missing","ERR_INVALID_ADDRESS");const u=o.getConnections(Mu(c));let h,d=!1;0===u.length?(h=await s.dial(l,{signal:n}),d=!0):h=u[0];try{const e=await h.newStream(WI,{signal:n,runOnTransientConnection:!0}),r=q_(e).pb(VI);try{const e=t.createDataChannel("init");t.onicecandidate=e=>{var t;let{candidate:i}=e;const o=JSON.stringify(null!==(t=null===i||void 0===i?void 0:i.toJSON())&&void 0!==t?t:null);a.trace("initiator sending ICE candidate %s",o),r.write({type:VI.Type.ICE_CANDIDATE,data:o},{signal:n}).catch((e=>{a.error("error sending ICE candidate",e)}))},t.onicecandidateerror=e=>{a.error("initiator ICE candidate error",e)};const o=await t.createOffer().catch((e=>{throw a.error("could not execute createOffer",e),new Mr("Failed to set createOffer","ERR_SDP_HANDSHAKE_FAILED")}));a.trace("initiator send SDP offer %s",o.sdp),await r.write({type:VI.Type.SDP_OFFER,data:o.sdp},{signal:n}),await t.setLocalDescription(o).catch((e=>{throw a.error("could not execute setLocalDescription",e),new Mr("Failed to set localDescription","ERR_SDP_HANDSHAKE_FAILED")}));const s=await r.read({signal:n});if(s.type!==VI.Type.SDP_ANSWER)throw new Mr("Remote should send an SDP answer","ERR_SDP_HANDSHAKE_FAILED");a.trace("initiator receive SDP answer %s",s.data);const l=new UI({type:"answer",sdp:s.data});return await t.setRemoteDescription(l).catch((e=>{throw a.error("could not execute setRemoteDescription",e),new Mr("Failed to set remoteDescription","ERR_SDP_HANDSHAKE_FAILED")})),a.trace("initiator read candidates until connected"),await zI(t,r,{direction:"initiator",signal:n,log:a}),a.trace("initiator connected, closing init channel"),e.close(),a.trace("initiator closing signalling stream"),await r.unwrap().unwrap().close({signal:n}),a.trace("initiator connected to remote address %s",i),{remoteAddress:i}}catch(f){throw t.close(),e.abort(f),f}finally{t.onicecandidate=null,t.onicecandidateerror=null}}finally{if(d)try{await h.close({signal:n})}catch(f){h.abort(f)}}}class jI extends bu{constructor(e,t){super(),je(this,"peerId",void 0),je(this,"transportManager",void 0),je(this,"shutdownController",void 0),this.peerId=e.peerId,this.transportManager=e.transportManager,this.shutdownController=t.shutdownController}async listen(){this.safeDispatchEvent("listening",{})}getAddrs(){return this.transportManager.getListeners().filter((e=>e!==this)).map((e=>e.getAddrs().filter((e=>O_.matches(e))).map((e=>e.encapsulate("/webrtc/p2p/".concat(this.peerId)))))).flat()}async close(){this.shutdownController.abort(),this.safeDispatchEvent("close",{})}}const HI="/webrtc",qI="/p2p-circuit",WI="/webrtc-signaling/0.0.1";class GI{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};je(this,"components",void 0),je(this,"init",void 0),je(this,"log",void 0),je(this,"_started",!1),je(this,"metrics",void 0),je(this,"shutdownController",void 0),je(this,Symbol.toStringTag,"@libp2p/webrtc"),je(this,If,!0),this.components=e,this.init=t,this.log=e.logger.forComponent("libp2p:webrtc"),this.shutdownController=new AbortController,vu(1/0,this.shutdownController.signal),null!=e.metrics&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}isStarted(){return this._started}async start(){await this.components.registrar.handle(WI,(e=>{this._onProtocol(e).catch((t=>{this.log.error("failed to handle incoming connect from %p",e.connection.remotePeer,t)}))}),{runOnTransientConnection:!0}),this._started=!0}async stop(){await this.components.registrar.unhandle(WI),this._started=!1}createListener(e){return new jI(this.components,{shutdownController:this.shutdownController})}filter(e){return e.filter(up.exactMatch)}async dial(e,t){var n;this.log.trace("dialing address: %a",e);const r=new MI(this.init.rtcConfiguration),i=new NI(this.components,{peerConnection:r,dataChannelOptions:this.init.dataChannel}),{remoteAddress:o}=await KI({peerConnection:r,multiaddr:e,dataChannelOptions:this.init.dataChannel,signal:t.signal,connectionManager:this.components.connectionManager,transportManager:this.components.transportManager,log:this.log}),s=new RI(this.components,{peerConnection:r,timeline:{open:Date.now()},remoteAddr:o,metrics:null===(n=this.metrics)||void 0===n?void 0:n.dialerEvents}),a=await t.upgrader.upgradeOutbound(s,{skipProtection:!0,skipEncryption:!0,muxerFactory:i});return this._closeOnShutdown(r,s),a}async _onProtocol(e){var t;let{connection:n,stream:r}=e;const i=AbortSignal.timeout(null!==(t=this.init.inboundConnectionTimeout)&&void 0!==t?t:3e4),o=new MI(this.init.rtcConfiguration),s=new NI(this.components,{peerConnection:o,dataChannelOptions:this.init.dataChannel});try{var a;const{remoteAddress:e}=await async function(e){let{peerConnection:t,stream:n,signal:r,connection:i,log:o}=e;o.trace("new inbound signaling stream");const s=q_(n).pb(VI);try{t.onicecandidate=e=>{var t;let{candidate:n}=e;const i=JSON.stringify(null!==(t=null===n||void 0===n?void 0:n.toJSON())&&void 0!==t?t:null);o.trace("recipient sending ICE candidate %s",i),s.write({type:VI.Type.ICE_CANDIDATE,data:i},{signal:r}).catch((e=>{o.error("error sending ICE candidate",e)}))};const e=await s.read({signal:r});var a;if(e.type!==VI.Type.SDP_OFFER)throw new Mr("expected message type SDP_OFFER, received: ".concat(null!==(a=e.type)&&void 0!==a?a:"undefined"," "),"ERR_SDP_HANDSHAKE_FAILED");o.trace("recipient receive SDP offer %s",e.data);const n=new UI({type:"offer",sdp:e.data});await t.setRemoteDescription(n).catch((e=>{throw o.error("could not execute setRemoteDescription",e),new Mr("Failed to set remoteDescription","ERR_SDP_HANDSHAKE_FAILED")}));const i=await t.createAnswer().catch((e=>{throw o.error("could not execute createAnswer",e),new Mr("Failed to create answer","ERR_SDP_HANDSHAKE_FAILED")}));o.trace("recipient send SDP answer %s",i.sdp),await s.write({type:VI.Type.SDP_ANSWER,data:i.sdp},{signal:r}),await t.setLocalDescription(i).catch((e=>{throw o.error("could not execute setLocalDescription",e),new Mr("Failed to set localDescription","ERR_SDP_HANDSHAKE_FAILED")})),o.trace("recipient read candidates until connected"),await zI(t,s,{direction:"recipient",signal:r,log:o})}catch(c){if("connected"!==t.connectionState)throw o.error("error while handling signaling stream from peer %a",i.remoteAddr,c),t.close(),c;o("error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected",i.remoteAddr,c)}const l=Vh("/webrtc/p2p/".concat(i.remoteAddr.getPeerId()));return o.trace("recipient connected to remote address %s",l),{remoteAddress:l}}({peerConnection:o,connection:n,stream:r,signal:i,log:this.log}),t=new RI(this.components,{peerConnection:o,timeline:{open:(new Date).getTime()},remoteAddr:e,metrics:null===(a=this.metrics)||void 0===a?void 0:a.listenerEvents});this._closeOnShutdown(o,t),await this.components.upgrader.upgradeInbound(t,{skipEncryption:!0,skipProtection:!0,muxerFactory:s}),await r.close({signal:i})}catch(l){throw r.abort(l),l}}_closeOnShutdown(e,t){const n=()=>{t.close().catch((e=>{this.log.error("could not close WebRTCMultiaddrConnection",e)}))};this.shutdownController.signal.addEventListener("abort",n),e.addEventListener("close",(()=>{this.shutdownController.signal.removeEventListener("abort",n)}))}}var YI=n(3180);const QI=Object.values(cr).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)));function XI(e,t){var n;const r=null===(n=e.getConfiguration().certificates)||void 0===n?void 0:n.at(0);if(null==r||null==r.getFingerprints){t.log.trace("fetching fingerprint from local SDP");const n=e.localDescription;if(null==n)return;return function(e){var t;const n=e.match(JI);return null===n||void 0===n||null===(t=n.groups)||void 0===t?void 0:t.fingerprint}(n.sdp)}if(t.log.trace("fetching fingerprint from local certificate"),0===r.getFingerprints().length)return;const i=r.getFingerprints()[0].value;if(null==i)throw aI("","no fingerprint on local certificate");return i}const JI=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function $I(e){const t=e.stringTuples().filter((e=>e[0]===rT)).map((e=>e[1]))[0];if(void 0===t||""===t)throw rI("Couldn't find a certhash component of multiaddr: ".concat(e.toString()));return t}function ZI(e){const t=QI.decode(e);return YI.decode(t)}function eT(e){switch(e){case"sha1":return"sha-1";case"sha2-256":return"sha-256";case"sha2-512":return"sha-512";default:throw new cI(e)}}function tT(e,t){const{host:n,port:r}=e.toOptions(),i=function(e){for(const t of e.protoNames())if(t.startsWith("ip"))return t.toUpperCase();return"IP6"}(e),[o]=function(e){const t=ZI($I(e)),n=eT(t.name),r=t.digest.reduce(((e,t)=>e+t.toString(16).padStart(2,"0")),""),i=r.match(/.{1,2}/g);if(null==i)throw aI(r,e.toString());return["".concat(n.toUpperCase()," ").concat(i.join(":").toUpperCase()),r]}(e);return"v=0\no=- 0 0 IN ".concat(i," ").concat(n,"\ns=-\nc=IN ").concat(i," ").concat(n,"\nt=0 0\na=ice-lite\nm=application ").concat(r," UDP/DTLS/SCTP webrtc-datachannel\na=mid:0\na=setup:passive\na=ice-ufrag:").concat(t,"\na=ice-pwd:").concat(t,"\na=fingerprint:").concat(o,"\na=sctp-port:5000\na=max-message-size:16384\na=candidate:1467250027 1 UDP 1467250027 ").concat(n," ").concat(r," typ host\r\n")}const nT=Array.from("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),rT=(fh("webrtc-direct").code,fh("certhash").code);class iT{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};je(this,"log",void 0),je(this,"metrics",void 0),je(this,"components",void 0),je(this,"init",void 0),je(this,Symbol.toStringTag,"@libp2p/webrtc-direct"),je(this,If,!0),this.log=e.logger.forComponent("libp2p:webrtc-direct"),this.components=e,this.init=t,null!=e.metrics&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc-direct_dialer_events_total",{label:"event",help:"Total count of WebRTC-direct dial events by type"})})}async dial(e,t){const n=await this._connect(e,t);return this.log("dialing address: %a",e),n}createListener(e){throw new lI("WebRTCTransport.createListener")}filter(e){return e.filter(op.exactMatch)}async _connect(e,t){const n=new AbortController,r=n.signal,i=e.getPeerId();if(null===i)throw rI("we need to have the remote's PeerId");const o=Mu(i),s=ZI($I(e)),a=await MI.generateCertificate({name:"ECDSA",namedCurve:"P-256",hash:eT(s.name)}),l=new MI({certificates:[a]});try{var c,u,h,d;const i=new Promise(((e,t)=>{const n=l.createDataChannel("",{negotiated:!0,id:0}),r=setTimeout((()=>{var e;const r="Data channel was never opened: state: ".concat(n.readyState);this.log.error(r),null===(e=this.metrics)||void 0===e||e.dialerEvents.increment({open_error:!0}),t(tI("data",r))}),1e4);n.onopen=t=>{clearTimeout(r),e(n)},n.onerror=e=>{var n,i,o;clearTimeout(r);const s=null!==(n=null===(i=e.target)||void 0===i?void 0:i.toString())&&void 0!==n?n:"not specified",a="Error opening a data channel for handshaking: ".concat(s);this.log.error(a),null===(o=this.metrics)||void 0===o||o.dialerEvents.increment({unknown_error:!0}),t(tI("data",a))}})),a="libp2p+webrtc+v1/"+[...Array(32)].map((()=>nT.at(Math.floor(Math.random()*nT.length)))).join(""),f=function(e,t){if(void 0===e.sdp)throw oI("Can't munge a missing SDP");return e.sdp=e.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,"\na=ice-ufrag:"+t+"\n").replace(/\na=ice-pwd:[^\n]*\n/,"\na=ice-pwd:"+t+"\n"),e}(await l.createOffer(),a);await l.setLocalDescription(f);const p=function(e,t){return{type:"answer",sdp:tT(e,t)}}(e,a);await l.setRemoteDescription(p);const g=await i,y=this.components.peerId,v=$b({prologueBytes:this.generateNoisePrologue(l,s.code,e)})(this.components),m=PI({channel:g,direction:"inbound",logger:this.components.logger,...null!==(c=this.init.dataChannel)&&void 0!==c?c:{}}),w={...m,sink:m.sink.bind(m),source:async function*(){for await(const e of m.source)for(const t of e)yield t}()},b=new RI(this.components,{peerConnection:l,remoteAddr:e,timeline:{open:Date.now()},metrics:null===(u=this.metrics)||void 0===u?void 0:u.dialerEvents}),E=kI?"iceconnectionstatechange":"connectionstatechange";l.addEventListener(E,(()=>{switch(l.connectionState){case"failed":case"disconnected":case"closed":b.close().catch((e=>{this.log.error("error closing connection",e)})).finally((()=>{n.abort()}))}}),{signal:r}),null===(h=this.metrics)||void 0===h||h.dialerEvents.increment({peer_connection:!0});const _=new NI(this.components,{peerConnection:l,metrics:null===(d=this.metrics)||void 0===d?void 0:d.dialerEvents,dataChannelOptions:this.init.dataChannel});return await v.secureInbound(y,w,o),await t.upgrader.upgradeOutbound(b,{skipProtection:!0,skipEncryption:!0,muxerFactory:_})}catch(f){throw l.close(),f}}generateNoisePrologue(e,t,n){var r;if(0===(null===(r=e.getConfiguration().certificates)||void 0===r?void 0:r.length))throw oI("no local certificate");const i=XI(e,{log:this.log});if(null==i)throw oI("no local fingerprint found");const o=yr(i.trim().toLowerCase().replaceAll(":",""),"hex"),s=YI.encode(o,t),a=QI.decode($I(n));return Wo([yr("libp2p-webrtc-noise:"),s,a])}}function oT(e){return t=>new iT(t,e)}function sT(e){return t=>new GI(t,e)}const aT=[fh("tcp").code,fh("dns").code,fh("dnsaddr").code,fh("dns4").code,fh("dns6").code];function lT(e){let t;try{t=fh("sni").code}catch(n){return null}for(const[r,i]of e)if(r===t&&void 0!==i)return i;return null}function cT(e){return e.some((e=>{let[t,n]=e;return t===fh("tls").code}))}function uT(e,t,n){const r=hT[fh(e).name];if(void 0===r)throw new Error("Can't interpret protocol ".concat(fh(e).name));const i=r(t,n);return e===fh("ip6").code?"[".concat(i,"]"):i}const hT={ip4:(e,t)=>e,ip6:(e,t)=>0===t.length?e:"[".concat(e,"]"),tcp:(e,t)=>{var n;const r=t.pop();if(void 0===r)throw new Error("Unexpected end of multiaddr");return"tcp://".concat(uT(r[0],null!==(n=r[1])&&void 0!==n?n:"",t),":").concat(e)},udp:(e,t)=>{var n;const r=t.pop();if(void 0===r)throw new Error("Unexpected end of multiaddr");return"udp://".concat(uT(r[0],null!==(n=r[1])&&void 0!==n?n:"",t),":").concat(e)},dnsaddr:(e,t)=>e,dns4:(e,t)=>e,dns6:(e,t)=>e,dns:(e,t)=>e,ipfs:(e,t)=>{var n;const r=t.pop();if(void 0===r)throw new Error("Unexpected end of multiaddr");return"".concat(uT(r[0],null!==(n=r[1])&&void 0!==n?n:"",t),"/ipfs/").concat(e)},p2p:(e,t)=>{var n;const r=t.pop();if(void 0===r)throw new Error("Unexpected end of multiaddr");return"".concat(uT(r[0],null!==(n=r[1])&&void 0!==n?n:"",t),"/p2p/").concat(e)},http:(e,t)=>{var n;const r=cT(t),i=lT(t);if(r&&null!==i)return"https://".concat(i);const o=r?"https://":"http://",s=t.pop();if(void 0===s)throw new Error("Unexpected end of multiaddr");let a=uT(s[0],null!==(n=s[1])&&void 0!==n?n:"",t);return a=a.replace("tcp://",""),"".concat(o).concat(a)},tls:(e,t)=>{var n;const r=t.pop();if(void 0===r)throw new Error("Unexpected end of multiaddr");return uT(r[0],null!==(n=r[1])&&void 0!==n?n:"",t)},sni:(e,t)=>{var n;const r=t.pop();if(void 0===r)throw new Error("Unexpected end of multiaddr");return uT(r[0],null!==(n=r[1])&&void 0!==n?n:"",t)},https:(e,t)=>{var n;const r=t.pop();if(void 0===r)throw new Error("Unexpected end of multiaddr");let i=uT(r[0],null!==(n=r[1])&&void 0!==n?n:"",t);return i=i.replace("tcp://",""),"https://".concat(i)},ws:(e,t)=>{var n;const r=cT(t),i=lT(t);if(r&&null!==i)return"wss://".concat(i);const o=r?"wss://":"ws://",s=t.pop();if(void 0===s)throw new Error("Unexpected end of multiaddr");let a=uT(s[0],null!==(n=s[1])&&void 0!==n?n:"",t);return a=a.replace("tcp://",""),"".concat(o).concat(a)},wss:(e,t)=>{var n;const r=t.pop();if(void 0===r)throw new Error("Unexpected end of multiaddr");let i=uT(r[0],null!==(n=r[1])&&void 0!==n?n:"",t);return i=i.replace("tcp://",""),"wss://".concat(i)},"p2p-websocket-star":(e,t)=>{var n;const r=t.pop();if(void 0===r)throw new Error("Unexpected end of multiaddr");return"".concat(uT(r[0],null!==(n=r[1])&&void 0!==n?n:"",t),"/p2p-websocket-star")},"p2p-webrtc-star":(e,t)=>{var n;const r=t.pop();if(void 0===r)throw new Error("Unexpected end of multiaddr");return"".concat(uT(r[0],null!==(n=r[1])&&void 0!==n?n:"",t),"/p2p-webrtc-star")},"p2p-webrtc-direct":(e,t)=>{var n;const r=t.pop();if(void 0===r)throw new Error("Unexpected end of multiaddr");return"".concat(uT(r[0],null!==(n=r[1])&&void 0!==n?n:"",t),"/p2p-webrtc-direct")}};const dT=async e=>{if(e.readyState>=2)throw new Error("socket closed");1!==e.readyState&&await new Promise(((t,n)=>{function r(){e.removeEventListener("open",i),e.removeEventListener("error",o)}function i(){r(),t()}function o(t){var i;r(),n(null!==(i=t.error)&&void 0!==i?i:new Error("connect ECONNREFUSED ".concat(e.url)))}e.addEventListener("open",i),e.addEventListener("error",o)}))},fT=(e,t)=>{var n;(t=null!==(n=t)&&void 0!==n?n:{}).closeOnEnd=!1!==t.closeOnEnd;return async n=>{for await(const t of n){try{await dT(e)}catch(r){if("socket closed"===r.message)break;throw r}if(e.readyState===e.CLOSING||e.readyState===e.CLOSED)break;e.send(t)}null!=t.closeOnEnd&&e.readyState<=1&&await new Promise(((t,n)=>{e.addEventListener("close",(e=>{if(e.wasClean||1006===e.code)t();else{const t=Object.assign(new Error("ws error"),{event:e});n(t)}})),setTimeout((()=>{e.close()}))}))}};var pT=n(2605);function gT(e){var t;return e instanceof ArrayBuffer||"ArrayBuffer"===(null===e||void 0===e||null===(t=e.constructor)||void 0===t?void 0:t.name)&&"number"===typeof(null===e||void 0===e?void 0:e.byteLength)}const yT=(e,t)=>{var n;t=null!==(n=t)&&void 0!==n?n:{};const r=(e=>{e.binaryType="arraybuffer";const t=async()=>{await new Promise(((t,n)=>{if(i)return void t();if(null!=r)return void n(r);const o=t=>{e.removeEventListener("open",s),e.removeEventListener("error",a),t()},s=()=>{o(t)},a=t=>{o((()=>{var r;n(null!==(r=t.error)&&void 0!==r?r:new Error("connect ECONNREFUSED ".concat(e.url)))}))};e.addEventListener("open",s),e.addEventListener("error",a)}))},n=async function*(){const n=new pT.PP((t=>{let{push:n,stop:r,fail:i}=t;const o=e=>{let t=null;"string"===typeof e.data&&(t=yr(e.data)),gT(e.data)&&(t=new Uint8Array(e.data)),e.data instanceof Uint8Array&&(t=e.data),null!=t&&n(t)},s=e=>{var t;i(null!==(t=e.error)&&void 0!==t?t:new Error("Socket error"))};return e.addEventListener("message",o),e.addEventListener("error",s),e.addEventListener("close",r),()=>{e.removeEventListener("message",o),e.removeEventListener("error",s),e.removeEventListener("close",r)}}),{highWaterMark:1/0});await t();for await(const e of n)yield gT(e)?new Uint8Array(e):e}();let r,i=1===e.readyState;return e.addEventListener("open",(()=>{i=!0,r=null})),e.addEventListener("close",(()=>{i=!1,r=null})),e.addEventListener("error",(t=>{var n;i||(r=null!==(n=t.error)&&void 0!==n?n:new Error("connect ECONNREFUSED ".concat(e.url)))})),Object.assign(n,{connected:t})})(e);let i=t.remoteAddress,o=t.remotePort;if(null!=e.url)try{const t=new URL(e.url);i=t.hostname,o=parseInt(t.port,10)}catch{}if(null==i||null==o)throw new Error("Remote connection did not have address and/or port");const s={sink:fT(e,t),source:r,connected:async()=>{await r.connected()},close:async()=>{e.readyState!==e.CONNECTING&&e.readyState!==e.OPEN||await new Promise((t=>{e.addEventListener("close",(()=>{t()})),e.close()}))},destroy:()=>{null!=e.terminate?e.terminate():e.close()},remoteAddress:i,remotePort:o,socket:e};return s},vT=WebSocket,mT={"http:":"ws:","https:":"wss:"};function wT(e,t){var n;t=null!==(n=t)&&void 0!==n?n:{};const r=((e,t)=>{var n;if(e.startsWith("//")&&(e="".concat(null!==(n=null===t||void 0===t?void 0:t.protocol)&&void 0!==n?n:"ws:").concat(e)),e.startsWith("/")&&null!=t){var r;const n=null!==(r=t.protocol)&&void 0!==r?r:"ws:",i=t.host,o=null!=t.port&&!0!==(null===i||void 0===i?void 0:i.endsWith(":".concat(t.port)))?":".concat(t.port):"";e="".concat(n,"//").concat(i).concat(o).concat(e)}const i=new URL(e);for(const[o,s]of Object.entries(mT))i.protocol===o&&(i.protocol=s);return i})(e,"undefined"===typeof window?void 0:window.location),i=new vT(r.toString(),t.websocket);return yT(i,t)}function bT(e){return e.filter((e=>{if(e.protoCodes().includes(290))return!1;const t=e.decapsulateCode(421);return E_.matches(t)||S_.matches(t)}))}class ET{constructor(e,t){je(this,"log",void 0),je(this,"init",void 0),je(this,"logger",void 0),je(this,Symbol.toStringTag,"@libp2p/websockets"),je(this,If,!0),this.log=e.logger.forComponent("libp2p:websockets"),this.logger=e.logger,this.init=t}async dial(e,t){var n;this.log("dialing %s",e),t=null!==(n=t)&&void 0!==n?n:{};const r=function(e,t,n){const r=n.logger.forComponent("libp2p:websockets:maconn"),i={log:r,async sink(t){try{await e.sink(async function*(){for await(const e of t)e instanceof Uint8Array?yield e:yield e.subarray()}())}catch(n){"aborted"!==n.type&&r.error(n)}},source:e.source,remoteAddr:t,timeline:{open:Date.now()},async close(){var t;let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const o=Date.now();if(null==n.signal){const e=AbortSignal.timeout(500);n={...n,signal:e}}const s=()=>{const{host:e,port:t}=i.remoteAddr.toOptions();r("timeout closing stream to %s:%s after %dms, destroying it manually",e,t,Date.now()-o),this.abort(new Mr("Socket close timeout","ERR_SOCKET_CLOSE_TIMEOUT"))};null===(t=n.signal)||void 0===t||t.addEventListener("abort",s);try{await e.close()}catch(l){r.error("error closing WebSocket gracefully",l),this.abort(l)}finally{var a;null===(a=n.signal)||void 0===a||a.removeEventListener("abort",s),i.timeline.close=Date.now()}},abort(t){const{host:n,port:o}=i.remoteAddr.toOptions();r("timeout closing stream to %s:%s due to error",n,o,t),e.destroy(),i.timeline.close=Date.now()}};return e.socket.addEventListener("close",(()=>{null==i.timeline.close&&(i.timeline.close=Date.now())}),{once:!0}),i}(await this._connect(e,t),e,{logger:this.logger});this.log("new outbound connection %s",r.remoteAddr);const i=await t.upgrader.upgradeOutbound(r);return this.log("outbound connection %s upgraded",r.remoteAddr),i}async _connect(e,t){var n;if(!0===(null===t||void 0===t||null===(n=t.signal)||void 0===n?void 0:n.aborted))throw new Or;const r=e.toOptions();this.log("dialing %s:%s",r.host,r.port);const i=mn(),o=wT(function(e,t){var n;const r=Vh(e).stringTuples(),i=r.pop();if(void 0===i)throw new Error("Unexpected end of multiaddr");const o=fh(i[0]),s=hT[o.name];if(null==s)throw new Error("No interpreter found for ".concat(o.name));let a=s(null!==(n=i[1])&&void 0!==n?n:"",r);return!1!==(null===t||void 0===t?void 0:t.assumeHttp)&&aT.includes(i[0])&&(a=a.replace(/^.*:\/\//,""),a="443"===i[1]?"https://".concat(a):"http://".concat(a)),(a.startsWith("http://")||a.startsWith("https://"))&&(a=new URL(a).toString(),a.endsWith("/")&&(a=a.substring(0,a.length-1))),a}(e),this.init);if(o.socket.addEventListener("error",(()=>{const t=new Mr("Could not connect to ".concat(e.toString()),"ERR_CONNECTION_FAILED");this.log.error("connection error:",t),i.reject(t)})),null==t.signal)return await Promise.race([o.connected(),i.promise]),this.log("connected %s",e),o;let s;const a=new Promise(((e,n)=>{var r,i;s=()=>{n(new Or),o.close().catch((e=>{this.log.error("error closing raw socket",e)}))},!0!==(null===t||void 0===t||null===(r=t.signal)||void 0===r?void 0:r.aborted)?null===t||void 0===t||null===(i=t.signal)||void 0===i||i.addEventListener("abort",s):s()}));try{await Promise.race([a,i.promise,o.connected()])}finally{var l;if(null!=s)null===t||void 0===t||null===(l=t.signal)||void 0===l||l.removeEventListener("abort",s)}return this.log("connected %s",e),o}createListener(e){return function(){throw new Error("WebSocket Servers can not be created in the browser!")}(this.logger,this.init)}filter(e){var t,n;return e=Array.isArray(e)?e:[e],null!=(null===(t=this.init)||void 0===t?void 0:t.filter)?null===(n=this.init)||void 0===n?void 0:n.filter(e):xS||BS?function(e){return e.filter((e=>{if(e.protoCodes().includes(290))return!1;const t=e.decapsulateCode(421);return S_.matches(t)}))}(e):bT(e)}}function _T(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>new ET(t,e)}async function ST(e,t,n,r,i,o){const s=o.forComponent("libp2p:webtransport:stream:".concat(n,":").concat(t)),a=e.writable.getWriter(),l=e.readable.getReader();function c(){const e=r.findIndex((e=>e===f));-1!==e&&(r.splice(e,1),f.timeline.close=Date.now(),null===i||void 0===i||i(f))}await a.ready;let u=!1,h=!1;(async function(){const e=await a.closed.catch((e=>e));if(null!=e){const n=e.message;n.includes("aborted by the remote server")||n.includes("STOP_SENDING")||s.error("WebTransport writer closed unexpectedly: streamId=".concat(t," err=").concat(e.message))}u=!0,u&&h&&c()})().catch((()=>{s.error("WebTransport failed to cleanup closed stream")})),async function(){const e=await l.closed.catch((e=>e));null!=e&&s.error("WebTransport reader closed unexpectedly: streamId=".concat(t," err=").concat(e.message)),h=!0,u&&h&&c()}().catch((()=>{s.error("WebTransport failed to cleanup closed stream")}));let d=!1;const f={id:t,status:"open",writeStatus:"ready",readStatus:"ready",abort(e){u||(a.abort(e).catch((e=>{s.error("could not abort stream",e)})),u=!0),h=!0,this.status="aborted",this.writeStatus="closed",this.readStatus="closed",this.timeline.reset=this.timeline.close=this.timeline.closeRead=this.timeline.closeWrite=Date.now(),c()},async close(e){this.status="closing",await Promise.all([f.closeRead(e),f.closeWrite(e)]),c(),this.status="closed",this.timeline.close=Date.now()},async closeRead(e){if(!h){this.readStatus="closing";try{await l.cancel()}catch(t){!0===t.toString().includes("RESET_STREAM")&&(u=!0)}this.timeline.closeRead=Date.now(),this.readStatus="closed",h=!0}u&&c()},async closeWrite(e){if(!u){u=!0,this.writeStatus="closing";try{await a.close()}catch(t){!0===t.toString().includes("RESET_STREAM")&&(h=!0)}this.timeline.closeWrite=Date.now(),this.writeStatus="closed"}h&&c()},direction:n,timeline:{open:Date.now()},metadata:{},source:async function*(){for(;;){const e=await l.read();if(e.done)return h=!0,void(u&&c());yield new Gu(e.value)}}(),sink:async function(e){if(d)throw new Error("sink already called on stream");d=!0;try{this.writeStatus="writing";for await(const t of e)if(t instanceof Uint8Array)await a.write(t);else for(const e of t)await a.write(e);this.writeStatus="done"}finally{this.timeline.closeWrite=Date.now(),this.writeStatus="closed",await f.closeWrite()}},log:s};return f}function kT(){return{source:{[Symbol.asyncIterator]:()=>({next:async()=>new Promise((()=>{}))})},sink:async e=>new Promise((()=>{}))}}const AT=Object.values(cr).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)));function IT(e){var t;if(!ap.matches(e))throw new Mr("Invalid multiaddr, was not a WebTransport address","ERR_INVALID_MULTIADDR");const n=e.stringTuples(),r=n.filter((e=>{let[t,n]=e;return t===fh("certhash").code})).map((e=>{let[t,n]=e;return r=null!==n&&void 0!==n?n:"",Wt(AT.decode(r));var r})),i=n.filter((e=>{let[t,n]=e;return t===fh("p2p").code})).map((e=>{let[t,n]=e;return Mu(null!==n&&void 0!==n?n:"")}))[0],o=e.toOptions();let s=o.host;return 6===o.family&&null!==(t=s)&&void 0!==t&&t.includes(":")&&(s="[".concat(s,"]")),{url:"https://".concat(s,":").concat(o.port),certhashes:r,remotePeer:i}}class TT{constructor(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};je(this,"log",void 0),je(this,"components",void 0),je(this,"config",void 0),je(this,"metrics",void 0),je(this,Symbol.toStringTag,"@libp2p/webtransport"),je(this,If,!0),this.log=e.logger.forComponent("libp2p:webtransport"),this.components=e,this.config={maxInboundStreams:null!==(t=n.maxInboundStreams)&&void 0!==t?t:1e3},null!=e.metrics&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webtransport_dialer_events_total",{label:"event",help:"Total count of WebTransport dialer events by type"})})}async dial(e,t){var n,r;null===(n=t)||void 0===n||null===(n=n.signal)||void 0===n||n.throwIfAborted(),this.log("dialing %s",e);const i=this.components.peerId;if(void 0===i)throw new Error("Need a local peerid");t=null!==(r=t)&&void 0!==r?r:{};const{url:o,certhashes:s,remotePeer:a}=IT(e);if(null==a)throw new Error("Need a target peerid");if(0===s.length)throw new Error("Expected multiaddr to contain certhashes");let l,c,u=()=>{},h=!1,d=!1,f=!1;try{var p,g,y,v;null===(p=this.metrics)||void 0===p||p.dialerEvents.increment({pending:!0});const n=new WebTransport("".concat(o,"/.well-known/libp2p-webtransport?type=noise"),{serverCertificateHashes:s.map((e=>({algorithm:"sha-256",value:e.digest})))});if(u=e=>{if(!h)try{var t;null===(t=this.metrics)||void 0===t||t.dialerEvents.increment({[e]:!0}),n.close()}catch(r){this.log.error("error closing wt session",r)}finally{null!=c&&(c.timeline.close=Date.now()),h=!0}},l=()=>{u(d?"noise_timeout":"ready_timeout")},null===(g=t.signal)||void 0===g||g.addEventListener("abort",l,{once:!0}),await Promise.race([n.closed,n.ready]),d=!0,null===(y=this.metrics)||void 0===y||y.dialerEvents.increment({ready:!0}),n.closed.catch((e=>{this.log.error("error on remote wt session close",e)})).finally((()=>{u("remote_close")})),!await this.authenticateWebTransport(n,i,a,s))throw new Error("Failed to authenticate webtransport");return null===(v=this.metrics)||void 0===v||v.dialerEvents.increment({open:!0}),c={close:async()=>{this.log("Closing webtransport"),u("close")},abort:e=>{this.log("aborting webtransport due to passed err",e),u("abort")},remoteAddr:e,timeline:{open:Date.now()},log:this.components.logger.forComponent("libp2p:webtransport:maconn"),...kT()},f=!0,await t.upgrader.upgradeOutbound(c,{skipEncryption:!0,muxerFactory:this.webtransportMuxer(n),skipProtection:!0})}catch(w){throw this.log.error("caught wt session err",w),u(f?"upgrade_error":d?"noise_error":"ready_error"),w}finally{var m;if(null!=l)null===(m=t.signal)||void 0===m||m.removeEventListener("abort",l)}}async authenticateWebTransport(e,t,n,r){var i;const o=await e.createBidirectionalStream(),s=o.writable.getWriter(),a=o.readable.getReader();await s.ready;const l={source:async function*(){for(;;){const e=await a.read();if(null!=e.value&&(yield e.value),e.done)break}}(),sink:async function(e){for await(const t of e)t instanceof Uint8Array?await s.write(t):await s.write(t.subarray())}},c=$b()(this.components),{remoteExtensions:u}=await c.secureOutbound(t,l,n);if(s.close().catch((e=>{this.log.error("Failed to close authentication stream writer: ".concat(e.message))})),a.cancel().catch((e=>{this.log.error("Failed to close authentication stream reader: ".concat(e.message))})),!function(e,t){return t.filter((t=>Boolean(e.find((e=>Hr(t,e)))))).length===t.length}(null!==(i=null===u||void 0===u?void 0:u.webtransportCerthashes)&&void 0!==i?i:[],r.map((e=>e.bytes))))throw new Error("Our certhashes are not a subset of the remote's reported certhashes");return!0}webtransportMuxer(e){let t=0;const n=this.config,r=this;return{protocol:"webtransport",createStreamMuxer:i=>{"function"===typeof i&&(i={onIncomingStream:i});const o=[];(async function(){const s=e.incomingBidirectionalStreams.getReader();for(;;){const{done:e,value:h}=await s.read();if(e)break;if(o.length>=n.maxInboundStreams)h.writable.close().catch((e=>{r.log.error("Failed to close inbound stream that crossed our maxInboundStream limit: ".concat(e.message))})),h.readable.cancel().catch((e=>{r.log.error("Failed to close inbound stream that crossed our maxInboundStream limit: ".concat(e.message))}));else{var a,l,c,u;const e=await ST(h,String(t++),"inbound",o,null===(a=i)||void 0===a?void 0:a.onStreamEnd,r.components.logger);o.push(e),null===(l=i)||void 0===l||null===(c=(u=l).onIncomingStream)||void 0===c||c.call(u,e)}}})().catch((()=>{this.log.error("WebTransport failed to receive incoming stream")}));return{protocol:"webtransport",streams:o,newStream:async n=>{var s,a,l;const c=await e.createBidirectionalStream(),u=await ST(c,String(t++),null!==(s=null===(a=i)||void 0===a?void 0:a.direction)&&void 0!==s?s:"outbound",o,null===(l=i)||void 0===l?void 0:l.onStreamEnd,r.components.logger);return o.push(u),u},close:async e=>{this.log("Closing webtransport muxer"),await Promise.all(o.map((async t=>t.close(e))))},abort:e=>{this.log("Aborting webtransport muxer with err:",e);for(const t of o)t.abort(e)},...kT()}}}}createListener(e){throw new Error("Webtransport servers are not supported in Node or the browser")}filter(e){return e.filter(ap.exactMatch)}}function RT(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>new TT(t,e)}function CT(e,t){const n=t.map(((e,t)=>({record:UE(e),index:t})));return n.sort(((e,t)=>{const n=e.record.sequence,r=t.record.sequence;if(n>r)return-1;if(n<r)return 1;if(e.record.validityType===NE.ValidityType.EOL&&t.record.validityType===NE.ValidityType.EOL){const n=jE.fromString(e.record.validity).toDate(),r=jE.fromString(t.record.validity).toDate();if(n.getTime()>r.getTime())return-1;if(n.getTime()<r.getTime())return 1}return 0})),n[0].index}const xT="4.1.0",PT="helia",DT={list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"]};function NT(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{peerId:e.peerId,dns:e.dns,addresses:{listen:["/webrtc"]},transports:[vS({discoverRelays:1}),sT(),oT(),RT(),_T()],connectionEncryption:[$b()],streamMuxers:[TE(),YA()],peerDiscovery:[j_(DT)],services:{autoNAT:c_(),dcutr:IS(),delegatedRouting:()=>function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new o_(new URL(e),t)}("https://delegated-ipfs.dev"),dht:(t={clientMode:!0,validators:{ipns:GE},selectors:{ipns:CT}},e=>new dA(e,t)),identify:JS({agentVersion:"".concat(PT,"/").concat(xT," ").concat(Vg,"/").concat(Fg," UserAgent=").concat(globalThis.navigator.userAgent)}),keychain:DA(e.keychain),ping:JA()}};var t}async function BT(){var e,t,n;let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i=null!==(e=r.datastore)&&void 0!==e?e:new Tr,o=null!==(t=r.blockstore)&&void 0!==t?t:new an;let s;s=function(e){if(null==e)return!1;return["dial","dialProtocol","hangUp","handle","unhandle","getMultiaddrs","getProtocols"].every((t=>"function"===typeof e[t]))}(r.libp2p)?r.libp2p:await async function(e){var t,n,r,i;const o=null===(t=e.libp2p)||void 0===t?void 0:t.peerId,s=null!==(n=e.logger)&&void 0!==n?n:fn(),a=new Er("/pkcs8/self");let l;var c;null==o&&null!=e.datastore&&(l=DA(e.keychain)({datastore:e.datastore,logger:s}),await e.datastore.has(a)&&(e.libp2p=null!==(c=e.libp2p)&&void 0!==c?c:{},e.libp2p.peerId=await l.exportPeerId("self")));const u=NT(e);u.datastore=null!==(r=u.datastore)&&void 0!==r?r:e.datastore,e=null!==(i=e)&&void 0!==i?i:{};const h=await qg({...u,...e.libp2p,start:!1});return null!=o||null==l||await e.datastore.has(a)||await l.importPeer("self",h.peerId),h}({...r,libp2p:{dns:r.dns,...r.libp2p,start:void 0},datastore:i});const a=new Uw({...r,libp2p:s,datastore:i,blockstore:o,blockBrokers:null!==(n=r.blockBrokers)&&void 0!==n?n:[qy(),My()],routers:[Gy(s)]});return!1!==r.start&&await a.start(),a}function LT(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw new Error("number"===typeof e?"[MobX] minified error nr: "+e+(n.length?" "+n.map(String).join(","):"")+". Find the full error at: https://github.com/mobxjs/mobx/blob/main/packages/mobx/src/errors.ts":"[MobX] "+e)}var OT={};function MT(){return"undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:OT}var UT=Object.assign,FT=Object.getOwnPropertyDescriptor,VT=Object.defineProperty,zT=Object.prototype,KT=[];Object.freeze(KT);var jT={};Object.freeze(jT);var HT="undefined"!==typeof Proxy,qT=Object.toString();function WT(){HT||LT("Proxy not available")}function GT(e){var t=!1;return function(){if(!t)return t=!0,e.apply(this,arguments)}}var YT=function(){};function QT(e){return"function"===typeof e}function XT(e){switch(typeof e){case"string":case"symbol":case"number":return!0}return!1}function JT(e){return null!==e&&"object"===typeof e}function $T(e){if(!JT(e))return!1;var t=Object.getPrototypeOf(e);if(null==t)return!0;var n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return"function"===typeof n&&n.toString()===qT}function ZT(e){var t=null==e?void 0:e.constructor;return!!t&&("GeneratorFunction"===t.name||"GeneratorFunction"===t.displayName)}function eR(e,t,n){VT(e,t,{enumerable:!1,writable:!0,configurable:!0,value:n})}function tR(e,t,n){VT(e,t,{enumerable:!1,writable:!1,configurable:!0,value:n})}function nR(e,t){var n="isMobX"+e;return t.prototype[n]=!0,function(e){return JT(e)&&!0===e[n]}}function rR(e){return e instanceof Map}function iR(e){return e instanceof Set}var oR="undefined"!==typeof Object.getOwnPropertySymbols;var sR="undefined"!==typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:oR?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames;function aR(e){return null===e?null:"object"===typeof e?""+e:e}function lR(e,t){return zT.hasOwnProperty.call(e,t)}var cR=Object.getOwnPropertyDescriptors||function(e){var t={};return sR(e).forEach((function(n){t[n]=FT(e,n)})),t};function uR(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,mR(r.key),r)}}function hR(e,t,n){return t&&uR(e.prototype,t),n&&uR(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function dR(){return dR=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},dR.apply(this,arguments)}function fR(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,pR(e,t)}function pR(e,t){return pR=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},pR(e,t)}function gR(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function yR(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function vR(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(e){if("string"===typeof e)return yR(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?yR(e,t):void 0}}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function mR(e){var t=function(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===typeof t?t:String(t)}var wR=Symbol("mobx-stored-annotations");function bR(e){return Object.assign((function(t,n){if(_R(n))return e.decorate_20223_(t,n);ER(t,n,e)}),e)}function ER(e,t,n){lR(e,wR)||eR(e,wR,dR({},e[wR])),function(e){return e.annotationType_===xR}(n)||(e[wR][t]=n)}function _R(e){return"object"==typeof e&&"string"==typeof e.kind}var SR=Symbol("mobx administration"),kR=function(){function e(e){void 0===e&&(e="Atom"),this.name_=void 0,this.isPendingUnobservation_=!1,this.isBeingObserved_=!1,this.observers_=new Set,this.diffValue_=0,this.lastAccessedBy_=0,this.lowestObserverState_=CC.NOT_TRACKING_,this.onBOL=void 0,this.onBUOL=void 0,this.name_=e}var t=e.prototype;return t.onBO=function(){this.onBOL&&this.onBOL.forEach((function(e){return e()}))},t.onBUO=function(){this.onBUOL&&this.onBUOL.forEach((function(e){return e()}))},t.reportObserved=function(){return ex(this)},t.reportChanged=function(){$C(),tx(this),ZC()},t.toString=function(){return this.name_},e}(),AR=nR("Atom",kR);function IR(e,t,n){void 0===t&&(t=YT),void 0===n&&(n=YT);var r,i=new kR(e);return t!==YT&&Ax(_x,i,t,r),n!==YT&&kx(i,n),i}var TR={identity:function(e,t){return e===t},structural:function(e,t){return GP(e,t)},default:function(e,t){return Object.is?Object.is(e,t):e===t?0!==e||1/e===1/t:e!==e&&t!==t},shallow:function(e,t){return GP(e,t,1)}};function RR(e,t,n){return zx(e)?e:Array.isArray(e)?dC.array(e,{name:n}):$T(e)?dC.object(e,void 0,{name:n}):rR(e)?dC.map(e,{name:n}):iR(e)?dC.set(e,{name:n}):"function"!==typeof e||mx(e)||Fx(e)?e:ZT(e)?Mx(e):vx(n,e)}function CR(e){return e}var xR="override";function PR(e,t){return{annotationType_:e,options_:t,make_:DR,extend_:NR,decorate_20223_:BR}}function DR(e,t,n,r){var i;if(null!=(i=this.options_)&&i.bound)return null===this.extend_(e,t,n,!1)?0:1;if(r===e.target_)return null===this.extend_(e,t,n,!1)?0:2;if(mx(n.value))return 1;var o=LR(e,this,t,n,!1);return VT(r,t,o),2}function NR(e,t,n,r){var i=LR(e,this,t,n);return e.defineProperty_(t,i,r)}function BR(e,t){var n=t.kind,r=t.name,i=t.addInitializer,o=this;if("field"!=n){var s;if("method"==n)return mx(e)||(e=function(e){var t,n,i,s;return _C(null!=(t=null==(n=o.options_)?void 0:n.name)?t:r.toString(),e,null!=(i=null==(s=o.options_)?void 0:s.autoAction)&&i)}(e)),null!=(s=this.options_)&&s.bound&&i((function(){var e=this,t=e[r].bind(e);t.isMobxAction=!0,e[r]=t})),e;LT("Cannot apply '"+o.annotationType_+"' to '"+String(r)+"' (kind: "+n+"):\n'"+o.annotationType_+"' can only be used on properties with a function value.")}else i((function(){ER(this,r,o)}))}function LR(e,t,n,r,i){var o,s,a,l,c,u,h,d;void 0===i&&(i=YC.safeDescriptors),d=r,t.annotationType_,d.value;var f,p=r.value;null!=(o=t.options_)&&o.bound&&(p=p.bind(null!=(f=e.proxy_)?f:e.target_));return{value:_C(null!=(s=null==(a=t.options_)?void 0:a.name)?s:n.toString(),p,null!=(l=null==(c=t.options_)?void 0:c.autoAction)&&l,null!=(u=t.options_)&&u.bound?null!=(h=e.proxy_)?h:e.target_:void 0),configurable:!i||e.isPlainObject_,enumerable:!1,writable:!i}}function OR(e,t){return{annotationType_:e,options_:t,make_:MR,extend_:UR,decorate_20223_:FR}}function MR(e,t,n,r){var i;if(r===e.target_)return null===this.extend_(e,t,n,!1)?0:2;if(null!=(i=this.options_)&&i.bound&&(!lR(e.target_,t)||!Fx(e.target_[t]))&&null===this.extend_(e,t,n,!1))return 0;if(Fx(n.value))return 1;var o=VR(e,this,t,n,!1,!1);return VT(r,t,o),2}function UR(e,t,n,r){var i,o=VR(e,this,t,n,null==(i=this.options_)?void 0:i.bound);return e.defineProperty_(t,o,r)}function FR(e,t){var n;var r=t.name,i=t.addInitializer;return Fx(e)||(e=Mx(e)),null!=(n=this.options_)&&n.bound&&i((function(){var e=this,t=e[r].bind(e);t.isMobXFlow=!0,e[r]=t})),e}function VR(e,t,n,r,i,o){var s;void 0===o&&(o=YC.safeDescriptors),s=r,t.annotationType_,s.value;var a,l=r.value;(Fx(l)||(l=Mx(l)),i)&&((l=l.bind(null!=(a=e.proxy_)?a:e.target_)).isMobXFlow=!0);return{value:l,configurable:!o||e.isPlainObject_,enumerable:!1,writable:!o}}function zR(e,t){return{annotationType_:e,options_:t,make_:KR,extend_:jR,decorate_20223_:HR}}function KR(e,t,n){return null===this.extend_(e,t,n,!1)?0:1}function jR(e,t,n,r){return function(e,t,n,r){t.annotationType_,r.get;0}(0,this,0,n),e.defineComputedProperty_(t,dR({},this.options_,{get:n.get,set:n.set}),r)}function HR(e,t){var n=this,r=t.name;return(0,t.addInitializer)((function(){var t=AP(this)[SR],i=dR({},n.options_,{get:e,context:this});i.name||(i.name="ObservableObject."+r.toString()),t.values_.set(r,new PC(i))})),function(){return this[SR].getObservablePropValue_(r)}}function qR(e,t){return{annotationType_:e,options_:t,make_:WR,extend_:GR,decorate_20223_:YR}}function WR(e,t,n){return null===this.extend_(e,t,n,!1)?0:1}function GR(e,t,n,r){var i,o;return function(e,t,n,r){t.annotationType_;0}(0,this),e.defineObservableProperty_(t,n.value,null!=(i=null==(o=this.options_)?void 0:o.enhancer)?i:RR,r)}function YR(e,t){var n=this,r=t.kind,i=t.name,o=new WeakSet;function s(e,t){var r,s,a=AP(e)[SR],l=new RC(t,null!=(r=null==(s=n.options_)?void 0:s.enhancer)?r:RR,"ObservableObject."+i.toString(),!1);a.values_.set(i,l),o.add(e)}if("accessor"==r)return{get:function(){return o.has(this)||s(this,e.get.call(this)),this[SR].getObservablePropValue_(i)},set:function(e){return o.has(this)||s(this,e),this[SR].setObservablePropValue_(i,e)},init:function(e){return o.has(this)||s(this,e),e}}}var QR="true",XR=JR();function JR(e){return{annotationType_:QR,options_:e,make_:$R,extend_:ZR,decorate_20223_:eC}}function $R(e,t,n,r){var i,o,s,a;if(n.get)return yC.make_(e,t,n,r);if(n.set){var l=_C(t.toString(),n.set);return r===e.target_?null===e.defineProperty_(t,{configurable:!YC.safeDescriptors||e.isPlainObject_,set:l})?0:2:(VT(r,t,{configurable:!0,set:l}),2)}if(r!==e.target_&&"function"===typeof n.value)return ZT(n.value)?(null!=(a=this.options_)&&a.autoBind?Mx.bound:Mx).make_(e,t,n,r):(null!=(s=this.options_)&&s.autoBind?vx.bound:vx).make_(e,t,n,r);var c,u=!1===(null==(i=this.options_)?void 0:i.deep)?dC.ref:dC;"function"===typeof n.value&&null!=(o=this.options_)&&o.autoBind&&(n.value=n.value.bind(null!=(c=e.proxy_)?c:e.target_));return u.make_(e,t,n,r)}function ZR(e,t,n,r){var i,o,s;if(n.get)return yC.extend_(e,t,n,r);if(n.set)return e.defineProperty_(t,{configurable:!YC.safeDescriptors||e.isPlainObject_,set:_C(t.toString(),n.set)},r);"function"===typeof n.value&&null!=(i=this.options_)&&i.autoBind&&(n.value=n.value.bind(null!=(s=e.proxy_)?s:e.target_));return(!1===(null==(o=this.options_)?void 0:o.deep)?dC.ref:dC).extend_(e,t,n,r)}function eC(e,t){LT("'"+this.annotationType_+"' cannot be used as a decorator")}var tC={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};function nC(e){return e||tC}Object.freeze(tC);var rC=qR("observable"),iC=qR("observable.ref",{enhancer:CR}),oC=qR("observable.shallow",{enhancer:function(e,t,n){return void 0===e||null===e||RP(e)||hP(e)||mP(e)||EP(e)?e:Array.isArray(e)?dC.array(e,{name:n,deep:!1}):$T(e)?dC.object(e,void 0,{name:n,deep:!1}):rR(e)?dC.map(e,{name:n,deep:!1}):iR(e)?dC.set(e,{name:n,deep:!1}):void 0}}),sC=qR("observable.struct",{enhancer:function(e,t){return GP(e,t)?t:e}}),aC=bR(rC);function lC(e){return!0===e.deep?RR:!1===e.deep?CR:function(e){var t,n;return e&&null!=(t=null==(n=e.options_)?void 0:n.enhancer)?t:RR}(e.defaultDecorator)}function cC(e,t,n){return _R(t)?rC.decorate_20223_(e,t):XT(t)?void ER(e,t,rC):zx(e)?e:$T(e)?dC.object(e,t,n):Array.isArray(e)?dC.array(e,t):rR(e)?dC.map(e,t):iR(e)?dC.set(e,t):"object"===typeof e&&null!==e?e:dC.box(e,t)}UT(cC,aC);var uC,hC,dC=UT(cC,{box:function(e,t){var n=nC(t);return new RC(e,lC(n),n.name,!0,n.equals)},array:function(e,t){var n=nC(t);return(!1===YC.useProxies||!1===n.proxy?zP:nP)(e,lC(n),n.name)},map:function(e,t){var n=nC(t);return new vP(e,lC(n),n.name)},set:function(e,t){var n=nC(t);return new bP(e,lC(n),n.name)},object:function(e,t,n){return qP((function(){return xx(!1===YC.useProxies||!1===(null==n?void 0:n.proxy)?AP({},n):function(e,t){var n,r;return WT(),e=AP(e,t),null!=(r=(n=e[SR]).proxy_)?r:n.proxy_=new Proxy(e,Hx)}({},n),e,t)}))},ref:bR(iC),shallow:bR(oC),deep:aC,struct:bR(sC)}),fC="computed",pC=zR(fC),gC=zR("computed.struct",{equals:TR.structural}),yC=function(e,t){if(_R(t))return pC.decorate_20223_(e,t);if(XT(t))return ER(e,t,pC);if($T(e))return bR(zR(fC,e));var n=$T(t)?t:{};return n.get=e,n.name||(n.name=e.name||""),new PC(n)};Object.assign(yC,pC),yC.struct=bR(gC);var vC,mC=0,wC=1,bC=null!=(uC=null==(hC=FT((function(){}),"name"))?void 0:hC.configurable)&&uC,EC={value:"action",configurable:!0,writable:!1,enumerable:!1};function _C(e,t,n,r){function i(){return SC(e,n,t,r||this,arguments)}return void 0===n&&(n=!1),i.isMobxAction=!0,i.toString=function(){return t.toString()},bC&&(EC.value=e,VT(i,"name",EC)),i}function SC(e,t,n,r,i){var o=function(e,t,n,r){var i=!1,o=0;0;var s=YC.trackingDerivation,a=!t||!s;$C();var l=YC.allowStateChanges;a&&(VC(),l=AC(!0));var c=KC(!0),u={runAsAction_:a,prevDerivation_:s,prevAllowStateChanges_:l,prevAllowStateReads_:c,notifySpy_:i,startTime_:o,actionId_:wC++,parentActionId_:mC};return mC=u.actionId_,u}(0,t);try{return n.apply(r,i)}catch(s){throw o.error_=s,s}finally{!function(e){mC!==e.actionId_&&LT(30);mC=e.parentActionId_,void 0!==e.error_&&(YC.suppressReactionErrors=!0);IC(e.prevAllowStateChanges_),jC(e.prevAllowStateReads_),ZC(),e.runAsAction_&&zC(e.prevDerivation_);0;YC.suppressReactionErrors=!1}(o)}}function kC(e,t){var n=AC(e);try{return t()}finally{IC(n)}}function AC(e){var t=YC.allowStateChanges;return YC.allowStateChanges=e,t}function IC(e){YC.allowStateChanges=e}vC=Symbol.toPrimitive;var TC,RC=function(e){function t(t,n,r,i,o){var s;return void 0===r&&(r="ObservableValue"),void 0===i&&(i=!0),void 0===o&&(o=TR.default),(s=e.call(this,r)||this).enhancer=void 0,s.name_=void 0,s.equals=void 0,s.hasUnreportedChange_=!1,s.interceptors_=void 0,s.changeListeners_=void 0,s.value_=void 0,s.dehancer=void 0,s.enhancer=n,s.name_=r,s.equals=o,s.value_=n(t,void 0,r),s}fR(t,e);var n=t.prototype;return n.dehanceValue=function(e){return void 0!==this.dehancer?this.dehancer(e):e},n.set=function(e){this.value_;if((e=this.prepareNewValue_(e))!==YC.UNCHANGED){0,this.setNewValue_(e)}},n.prepareNewValue_=function(e){if(OC(this),qx(this)){var t=Gx(this,{object:this,type:Zx,newValue:e});if(!t)return YC.UNCHANGED;e=t.newValue}return e=this.enhancer(e,this.value_,this.name_),this.equals(this.value_,e)?YC.UNCHANGED:e},n.setNewValue_=function(e){var t=this.value_;this.value_=e,this.reportChanged(),Yx(this)&&Xx(this,{type:Zx,object:this,newValue:e,oldValue:t})},n.get=function(){return this.reportObserved(),this.dehanceValue(this.value_)},n.intercept_=function(e){return Wx(this,e)},n.observe_=function(e,t){return t&&e({observableKind:"value",debugObjectName:this.name_,object:this,type:Zx,newValue:this.value_,oldValue:void 0}),Qx(this,e)},n.raw=function(){return this.value_},n.toJSON=function(){return this.get()},n.toString=function(){return this.name_+"["+this.value_+"]"},n.valueOf=function(){return aR(this.get())},n[vC]=function(){return this.valueOf()},t}(kR);TC=Symbol.toPrimitive;var CC,xC,PC=function(){function e(e){this.dependenciesState_=CC.NOT_TRACKING_,this.observing_=[],this.newObserving_=null,this.isBeingObserved_=!1,this.isPendingUnobservation_=!1,this.observers_=new Set,this.diffValue_=0,this.runId_=0,this.lastAccessedBy_=0,this.lowestObserverState_=CC.UP_TO_DATE_,this.unboundDepsCount_=0,this.value_=new NC(null),this.name_=void 0,this.triggeredBy_=void 0,this.isComputing_=!1,this.isRunningSetter_=!1,this.derivation=void 0,this.setter_=void 0,this.isTracing_=xC.NONE,this.scope_=void 0,this.equals_=void 0,this.requiresReaction_=void 0,this.keepAlive_=void 0,this.onBOL=void 0,this.onBUOL=void 0,e.get||LT(31),this.derivation=e.get,this.name_=e.name||"ComputedValue",e.set&&(this.setter_=_C("ComputedValue-setter",e.set)),this.equals_=e.equals||(e.compareStructural||e.struct?TR.structural:TR.default),this.scope_=e.context,this.requiresReaction_=e.requiresReaction,this.keepAlive_=!!e.keepAlive}var t=e.prototype;return t.onBecomeStale_=function(){!function(e){if(e.lowestObserverState_!==CC.UP_TO_DATE_)return;e.lowestObserverState_=CC.POSSIBLY_STALE_,e.observers_.forEach((function(e){e.dependenciesState_===CC.UP_TO_DATE_&&(e.dependenciesState_=CC.POSSIBLY_STALE_,e.onBecomeStale_())}))}(this)},t.onBO=function(){this.onBOL&&this.onBOL.forEach((function(e){return e()}))},t.onBUO=function(){this.onBUOL&&this.onBUOL.forEach((function(e){return e()}))},t.get=function(){if(this.isComputing_&&LT(32,this.name_,this.derivation),0!==YC.inBatch||0!==this.observers_.size||this.keepAlive_){if(ex(this),LC(this)){var e=YC.trackingContext;this.keepAlive_&&!e&&(YC.trackingContext=this),this.trackAndCompute()&&function(e){if(e.lowestObserverState_===CC.STALE_)return;e.lowestObserverState_=CC.STALE_,e.observers_.forEach((function(t){t.dependenciesState_===CC.POSSIBLY_STALE_?t.dependenciesState_=CC.STALE_:t.dependenciesState_===CC.UP_TO_DATE_&&(e.lowestObserverState_=CC.UP_TO_DATE_)}))}(this),YC.trackingContext=e}}else LC(this)&&(this.warnAboutUntrackedRead_(),$C(),this.value_=this.computeValue_(!1),ZC());var t=this.value_;if(BC(t))throw t.cause;return t},t.set=function(e){if(this.setter_){this.isRunningSetter_&&LT(33,this.name_),this.isRunningSetter_=!0;try{this.setter_.call(this.scope_,e)}finally{this.isRunningSetter_=!1}}else LT(34,this.name_)},t.trackAndCompute=function(){var e=this.value_,t=this.dependenciesState_===CC.NOT_TRACKING_,n=this.computeValue_(!0),r=t||BC(e)||BC(n)||!this.equals_(e,n);return r&&(this.value_=n),r},t.computeValue_=function(e){this.isComputing_=!0;var t,n=AC(!1);if(e)t=MC(this,this.derivation,this.scope_);else if(!0===YC.disableErrorBoundaries)t=this.derivation.call(this.scope_);else try{t=this.derivation.call(this.scope_)}catch(r){t=new NC(r)}return IC(n),this.isComputing_=!1,t},t.suspend_=function(){this.keepAlive_||(UC(this),this.value_=void 0)},t.observe_=function(e,t){var n=this,r=!0,i=void 0;return wx((function(){var o=n.get();if(!r||t){var s=VC();e({observableKind:"computed",debugObjectName:n.name_,type:Zx,object:n,newValue:o,oldValue:i}),zC(s)}r=!1,i=o}))},t.warnAboutUntrackedRead_=function(){},t.toString=function(){return this.name_+"["+this.derivation.toString()+"]"},t.valueOf=function(){return aR(this.get())},t[TC]=function(){return this.valueOf()},e}(),DC=nR("ComputedValue",PC);!function(e){e[e.NOT_TRACKING_=-1]="NOT_TRACKING_",e[e.UP_TO_DATE_=0]="UP_TO_DATE_",e[e.POSSIBLY_STALE_=1]="POSSIBLY_STALE_",e[e.STALE_=2]="STALE_"}(CC||(CC={})),function(e){e[e.NONE=0]="NONE",e[e.LOG=1]="LOG",e[e.BREAK=2]="BREAK"}(xC||(xC={}));var NC=function(e){this.cause=void 0,this.cause=e};function BC(e){return e instanceof NC}function LC(e){switch(e.dependenciesState_){case CC.UP_TO_DATE_:return!1;case CC.NOT_TRACKING_:case CC.STALE_:return!0;case CC.POSSIBLY_STALE_:for(var t=KC(!0),n=VC(),r=e.observing_,i=r.length,o=0;o<i;o++){var s=r[o];if(DC(s)){if(YC.disableErrorBoundaries)s.get();else try{s.get()}catch(a){return zC(n),jC(t),!0}if(e.dependenciesState_===CC.STALE_)return zC(n),jC(t),!0}}return HC(e),zC(n),jC(t),!1}}function OC(e){}function MC(e,t,n){var r=KC(!0);HC(e),e.newObserving_=new Array(0===e.runId_?100:e.observing_.length),e.unboundDepsCount_=0,e.runId_=++YC.runId;var i,o=YC.trackingDerivation;if(YC.trackingDerivation=e,YC.inBatch++,!0===YC.disableErrorBoundaries)i=t.call(n);else try{i=t.call(n)}catch(s){i=new NC(s)}return YC.inBatch--,YC.trackingDerivation=o,function(e){for(var t=e.observing_,n=e.observing_=e.newObserving_,r=CC.UP_TO_DATE_,i=0,o=e.unboundDepsCount_,s=0;s<o;s++){var a=n[s];0===a.diffValue_&&(a.diffValue_=1,i!==s&&(n[i]=a),i++),a.dependenciesState_>r&&(r=a.dependenciesState_)}n.length=i,e.newObserving_=null,o=t.length;for(;o--;){var l=t[o];0===l.diffValue_&&XC(l,e),l.diffValue_=0}for(;i--;){var c=n[i];1===c.diffValue_&&(c.diffValue_=0,QC(c,e))}r!==CC.UP_TO_DATE_&&(e.dependenciesState_=r,e.onBecomeStale_())}(e),jC(r),i}function UC(e){var t=e.observing_;e.observing_=[];for(var n=t.length;n--;)XC(t[n],e);e.dependenciesState_=CC.NOT_TRACKING_}function FC(e){var t=VC();try{return e()}finally{zC(t)}}function VC(){var e=YC.trackingDerivation;return YC.trackingDerivation=null,e}function zC(e){YC.trackingDerivation=e}function KC(e){var t=YC.allowStateReads;return YC.allowStateReads=e,t}function jC(e){YC.allowStateReads=e}function HC(e){if(e.dependenciesState_!==CC.UP_TO_DATE_){e.dependenciesState_=CC.UP_TO_DATE_;for(var t=e.observing_,n=t.length;n--;)t[n].lowestObserverState_=CC.UP_TO_DATE_}}var qC=function(){this.version=6,this.UNCHANGED={},this.trackingDerivation=null,this.trackingContext=null,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!1,this.allowStateReads=!0,this.enforceActions=!0,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1,this.useProxies=!0,this.verifyProxies=!1,this.safeDescriptors=!0},WC=!0,GC=!1,YC=function(){var e=MT();return e.__mobxInstanceCount>0&&!e.__mobxGlobals&&(WC=!1),e.__mobxGlobals&&e.__mobxGlobals.version!==(new qC).version&&(WC=!1),WC?e.__mobxGlobals?(e.__mobxInstanceCount+=1,e.__mobxGlobals.UNCHANGED||(e.__mobxGlobals.UNCHANGED={}),e.__mobxGlobals):(e.__mobxInstanceCount=1,e.__mobxGlobals=new qC):(setTimeout((function(){GC||LT(35)}),1),new qC)}();function QC(e,t){e.observers_.add(t),e.lowestObserverState_>t.dependenciesState_&&(e.lowestObserverState_=t.dependenciesState_)}function XC(e,t){e.observers_.delete(t),0===e.observers_.size&&JC(e)}function JC(e){!1===e.isPendingUnobservation_&&(e.isPendingUnobservation_=!0,YC.pendingUnobservations.push(e))}function $C(){YC.inBatch++}function ZC(){if(0===--YC.inBatch){ox();for(var e=YC.pendingUnobservations,t=0;t<e.length;t++){var n=e[t];n.isPendingUnobservation_=!1,0===n.observers_.size&&(n.isBeingObserved_&&(n.isBeingObserved_=!1,n.onBUO()),n instanceof PC&&n.suspend_())}YC.pendingUnobservations=[]}}function ex(e){var t=YC.trackingDerivation;return null!==t?(t.runId_!==e.lastAccessedBy_&&(e.lastAccessedBy_=t.runId_,t.newObserving_[t.unboundDepsCount_++]=e,!e.isBeingObserved_&&YC.trackingContext&&(e.isBeingObserved_=!0,e.onBO())),e.isBeingObserved_):(0===e.observers_.size&&YC.inBatch>0&&JC(e),!1)}function tx(e){e.lowestObserverState_!==CC.STALE_&&(e.lowestObserverState_=CC.STALE_,e.observers_.forEach((function(e){e.dependenciesState_===CC.UP_TO_DATE_&&e.onBecomeStale_(),e.dependenciesState_=CC.STALE_})))}var nx=function(){function e(e,t,n,r){void 0===e&&(e="Reaction"),this.name_=void 0,this.onInvalidate_=void 0,this.errorHandler_=void 0,this.requiresObservable_=void 0,this.observing_=[],this.newObserving_=[],this.dependenciesState_=CC.NOT_TRACKING_,this.diffValue_=0,this.runId_=0,this.unboundDepsCount_=0,this.isDisposed_=!1,this.isScheduled_=!1,this.isTrackPending_=!1,this.isRunning_=!1,this.isTracing_=xC.NONE,this.name_=e,this.onInvalidate_=t,this.errorHandler_=n,this.requiresObservable_=r}var t=e.prototype;return t.onBecomeStale_=function(){this.schedule_()},t.schedule_=function(){this.isScheduled_||(this.isScheduled_=!0,YC.pendingReactions.push(this),ox())},t.isScheduled=function(){return this.isScheduled_},t.runReaction_=function(){if(!this.isDisposed_){$C(),this.isScheduled_=!1;var e=YC.trackingContext;if(YC.trackingContext=this,LC(this)){this.isTrackPending_=!0;try{this.onInvalidate_()}catch(t){this.reportExceptionInDerivation_(t)}}YC.trackingContext=e,ZC()}},t.track=function(e){if(!this.isDisposed_){$C();0,this.isRunning_=!0;var t=YC.trackingContext;YC.trackingContext=this;var n=MC(this,e,void 0);YC.trackingContext=t,this.isRunning_=!1,this.isTrackPending_=!1,this.isDisposed_&&UC(this),BC(n)&&this.reportExceptionInDerivation_(n.cause),ZC()}},t.reportExceptionInDerivation_=function(e){var t=this;if(this.errorHandler_)this.errorHandler_(e,this);else{if(YC.disableErrorBoundaries)throw e;var n="[mobx] uncaught error in '"+this+"'";YC.suppressReactionErrors||console.error(n,e),YC.globalReactionErrorHandlers.forEach((function(n){return n(e,t)}))}},t.dispose=function(){this.isDisposed_||(this.isDisposed_=!0,this.isRunning_||($C(),UC(this),ZC()))},t.getDisposer_=function(e){var t=this,n=function n(){t.dispose(),null==e||null==e.removeEventListener||e.removeEventListener("abort",n)};return null==e||null==e.addEventListener||e.addEventListener("abort",n),n[SR]=this,n},t.toString=function(){return"Reaction["+this.name_+"]"},t.trace=function(e){void 0===e&&(e=!1)},e}();var rx=100,ix=function(e){return e()};function ox(){YC.inBatch>0||YC.isRunningReactions||ix(sx)}function sx(){YC.isRunningReactions=!0;for(var e=YC.pendingReactions,t=0;e.length>0;){++t===rx&&(console.error("[mobx] cycle in reaction: "+e[0]),e.splice(0));for(var n=e.splice(0),r=0,i=n.length;r<i;r++)n[r].runReaction_()}YC.isRunningReactions=!1}var ax=nR("Reaction",nx);var lx="action",cx="autoAction",ux="<unnamed action>",hx=PR(lx),dx=PR("action.bound",{bound:!0}),fx=PR(cx,{autoAction:!0}),px=PR("autoAction.bound",{autoAction:!0,bound:!0});function gx(e){return function(t,n){return QT(t)?_C(t.name||ux,t,e):QT(n)?_C(t,n,e):_R(n)?(e?fx:hx).decorate_20223_(t,n):XT(n)?ER(t,n,e?fx:hx):XT(t)?bR(PR(e?cx:lx,{name:t,autoAction:e})):void 0}}var yx=gx(!1);Object.assign(yx,hx);var vx=gx(!0);function mx(e){return QT(e)&&!0===e.isMobxAction}function wx(e,t){var n,r,i,o,s;void 0===t&&(t=jT);var a,l=null!=(n=null==(r=t)?void 0:r.name)?n:"Autorun";if(!t.scheduler&&!t.delay)a=new nx(l,(function(){this.track(h)}),t.onError,t.requiresObservable);else{var c=Ex(t),u=!1;a=new nx(l,(function(){u||(u=!0,c((function(){u=!1,a.isDisposed_||a.track(h)})))}),t.onError,t.requiresObservable)}function h(){e(a)}return null!=(i=t)&&null!=(o=i.signal)&&o.aborted||a.schedule_(),a.getDisposer_(null==(s=t)?void 0:s.signal)}Object.assign(vx,fx),yx.bound=bR(dx),vx.bound=bR(px);var bx=function(e){return e()};function Ex(e){return e.scheduler?e.scheduler:e.delay?function(t){return setTimeout(t,e.delay)}:bx}var _x="onBO",Sx="onBUO";function kx(e,t,n){return Ax(Sx,e,t,n)}function Ax(e,t,n,r){var i="function"===typeof r?KP(t,n):KP(t),o=QT(r)?r:n,s=e+"L";return i[s]?i[s].add(o):i[s]=new Set([o]),function(){var e=i[s];e&&(e.delete(o),0===e.size&&delete i[s])}}var Ix="never",Tx="always",Rx="observed";function Cx(e){!0===e.isolateGlobalState&&function(){if((YC.pendingReactions.length||YC.inBatch||YC.isRunningReactions)&&LT(36),GC=!0,WC){var e=MT();0===--e.__mobxInstanceCount&&(e.__mobxGlobals=void 0),YC=new qC}}();var t=e.useProxies,n=e.enforceActions;if(void 0!==t&&(YC.useProxies=t===Tx||t!==Ix&&"undefined"!==typeof Proxy),"ifavailable"===t&&(YC.verifyProxies=!0),void 0!==n){var r=n===Tx?Tx:n===Rx;YC.enforceActions=r,YC.allowStateChanges=!0!==r&&r!==Tx}["computedRequiresReaction","reactionRequiresObservable","observableRequiresReaction","disableErrorBoundaries","safeDescriptors"].forEach((function(t){t in e&&(YC[t]=!!e[t])})),YC.allowStateReads=!YC.observableRequiresReaction,e.reactionScheduler&&function(e){var t=ix;ix=function(n){return e((function(){return t(n)}))}}(e.reactionScheduler)}function xx(e,t,n,r){var i=cR(t);return qP((function(){var t=AP(e,r)[SR];sR(i).forEach((function(e){t.extend_(e,i[e],!n||(!(e in n)||n[e]))}))})),e}function Px(e,t){return Dx(KP(e,t))}function Dx(e){var t,n={name:e.name_};return e.observing_&&e.observing_.length>0&&(n.dependencies=(t=e.observing_,Array.from(new Set(t))).map(Dx)),n}var Nx=0;function Bx(){this.message="FLOW_CANCELLED"}Bx.prototype=Object.create(Error.prototype);var Lx=OR("flow"),Ox=OR("flow.bound",{bound:!0}),Mx=Object.assign((function(e,t){if(_R(t))return Lx.decorate_20223_(e,t);if(XT(t))return ER(e,t,Lx);var n=e,r=n.name||"<unnamed flow>",i=function(){var e,t=arguments,i=++Nx,o=yx(r+" - runid: "+i+" - init",n).apply(this,t),s=void 0,a=new Promise((function(t,n){var a=0;function l(e){var t;s=void 0;try{t=yx(r+" - runid: "+i+" - yield "+a++,o.next).call(o,e)}catch(l){return n(l)}u(t)}function c(e){var t;s=void 0;try{t=yx(r+" - runid: "+i+" - yield "+a++,o.throw).call(o,e)}catch(l){return n(l)}u(t)}function u(e){if(!QT(null==e?void 0:e.then))return e.done?t(e.value):(s=Promise.resolve(e.value)).then(l,c);e.then(u,n)}e=n,l(void 0)}));return a.cancel=yx(r+" - runid: "+i+" - cancel",(function(){try{s&&Ux(s);var t=o.return(void 0),n=Promise.resolve(t.value);n.then(YT,YT),Ux(n),e(new Bx)}catch(r){e(r)}})),a};return i.isMobXFlow=!0,i}),Lx);function Ux(e){QT(e.cancel)&&e.cancel()}function Fx(e){return!0===(null==e?void 0:e.isMobXFlow)}function Vx(e,t){return!!e&&(void 0!==t?!!RP(e)&&e[SR].values_.has(t):RP(e)||!!e[SR]||AR(e)||ax(e)||DC(e))}function zx(e){return Vx(e)}function Kx(e,t){void 0===t&&(t=void 0),$C();try{return e.apply(t)}finally{ZC()}}function jx(e){return e[SR]}Mx.bound=bR(Ox);var Hx={has:function(e,t){return jx(e).has_(t)},get:function(e,t){return jx(e).get_(t)},set:function(e,t,n){var r;return!!XT(t)&&(null==(r=jx(e).set_(t,n,!0))||r)},deleteProperty:function(e,t){var n;return!!XT(t)&&(null==(n=jx(e).delete_(t,!0))||n)},defineProperty:function(e,t,n){var r;return null==(r=jx(e).defineProperty_(t,n))||r},ownKeys:function(e){return jx(e).ownKeys_()},preventExtensions:function(e){LT(13)}};function qx(e){return void 0!==e.interceptors_&&e.interceptors_.length>0}function Wx(e,t){var n=e.interceptors_||(e.interceptors_=[]);return n.push(t),GT((function(){var e=n.indexOf(t);-1!==e&&n.splice(e,1)}))}function Gx(e,t){var n=VC();try{for(var r=[].concat(e.interceptors_||[]),i=0,o=r.length;i<o&&((t=r[i](t))&&!t.type&&LT(14),t);i++);return t}finally{zC(n)}}function Yx(e){return void 0!==e.changeListeners_&&e.changeListeners_.length>0}function Qx(e,t){var n=e.changeListeners_||(e.changeListeners_=[]);return n.push(t),GT((function(){var e=n.indexOf(t);-1!==e&&n.splice(e,1)}))}function Xx(e,t){var n=VC(),r=e.changeListeners_;if(r){for(var i=0,o=(r=r.slice()).length;i<o;i++)r[i](t);zC(n)}}function Jx(e,t,n){return qP((function(){var r=AP(e,n)[SR];null!=t||(t=function(e){return lR(e,wR)||eR(e,wR,dR({},e[wR])),e[wR]}(e)),sR(t).forEach((function(e){return r.make_(e,t[e])}))})),e}var $x="splice",Zx="update",eP={get:function(e,t){var n=e[SR];return t===SR?n:"length"===t?n.getArrayLength_():"string"!==typeof t||isNaN(t)?lR(rP,t)?rP[t]:e[t]:n.get_(parseInt(t))},set:function(e,t,n){var r=e[SR];return"length"===t&&r.setArrayLength_(n),"symbol"===typeof t||isNaN(t)?e[t]=n:r.set_(parseInt(t),n),!0},preventExtensions:function(){LT(15)}},tP=function(){function e(e,t,n,r){void 0===e&&(e="ObservableArray"),this.owned_=void 0,this.legacyMode_=void 0,this.atom_=void 0,this.values_=[],this.interceptors_=void 0,this.changeListeners_=void 0,this.enhancer_=void 0,this.dehancer=void 0,this.proxy_=void 0,this.lastKnownLength_=0,this.owned_=n,this.legacyMode_=r,this.atom_=new kR(e),this.enhancer_=function(e,n){return t(e,n,"ObservableArray[..]")}}var t=e.prototype;return t.dehanceValue_=function(e){return void 0!==this.dehancer?this.dehancer(e):e},t.dehanceValues_=function(e){return void 0!==this.dehancer&&e.length>0?e.map(this.dehancer):e},t.intercept_=function(e){return Wx(this,e)},t.observe_=function(e,t){return void 0===t&&(t=!1),t&&e({observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:"splice",index:0,added:this.values_.slice(),addedCount:this.values_.length,removed:[],removedCount:0}),Qx(this,e)},t.getArrayLength_=function(){return this.atom_.reportObserved(),this.values_.length},t.setArrayLength_=function(e){("number"!==typeof e||isNaN(e)||e<0)&&LT("Out of range: "+e);var t=this.values_.length;if(e!==t)if(e>t){for(var n=new Array(e-t),r=0;r<e-t;r++)n[r]=void 0;this.spliceWithArray_(t,0,n)}else this.spliceWithArray_(e,t-e)},t.updateArrayLength_=function(e,t){e!==this.lastKnownLength_&&LT(16),this.lastKnownLength_+=t,this.legacyMode_&&t>0&&VP(e+t+1)},t.spliceWithArray_=function(e,t,n){var r=this;this.atom_;var i=this.values_.length;if(void 0===e?e=0:e>i?e=i:e<0&&(e=Math.max(0,i+e)),t=1===arguments.length?i-e:void 0===t||null===t?0:Math.max(0,Math.min(t,i-e)),void 0===n&&(n=KT),qx(this)){var o=Gx(this,{object:this.proxy_,type:$x,index:e,removedCount:t,added:n});if(!o)return KT;t=o.removedCount,n=o.added}if(n=0===n.length?n:n.map((function(e){return r.enhancer_(e,void 0)})),this.legacyMode_){var s=n.length-t;this.updateArrayLength_(i,s)}var a=this.spliceItemsIntoValues_(e,t,n);return 0===t&&0===n.length||this.notifyArraySplice_(e,n,a),this.dehanceValues_(a)},t.spliceItemsIntoValues_=function(e,t,n){var r;if(n.length<1e4)return(r=this.values_).splice.apply(r,[e,t].concat(n));var i=this.values_.slice(e,e+t),o=this.values_.slice(e+t);this.values_.length+=n.length-t;for(var s=0;s<n.length;s++)this.values_[e+s]=n[s];for(var a=0;a<o.length;a++)this.values_[e+n.length+a]=o[a];return i},t.notifyArrayChildUpdate_=function(e,t,n){var r=!this.owned_&&!1,i=Yx(this),o=i||r?{observableKind:"array",object:this.proxy_,type:Zx,debugObjectName:this.atom_.name_,index:e,newValue:t,oldValue:n}:null;this.atom_.reportChanged(),i&&Xx(this,o)},t.notifyArraySplice_=function(e,t,n){var r=!this.owned_&&!1,i=Yx(this),o=i||r?{observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:$x,index:e,removed:n,added:t,removedCount:n.length,addedCount:t.length}:null;this.atom_.reportChanged(),i&&Xx(this,o)},t.get_=function(e){if(!(this.legacyMode_&&e>=this.values_.length))return this.atom_.reportObserved(),this.dehanceValue_(this.values_[e]);console.warn("[mobx] Out of bounds read: "+e)},t.set_=function(e,t){var n=this.values_;if(this.legacyMode_&&e>n.length&&LT(17,e,n.length),e<n.length){this.atom_;var r=n[e];if(qx(this)){var i=Gx(this,{type:Zx,object:this.proxy_,index:e,newValue:t});if(!i)return;t=i.newValue}(t=this.enhancer_(t,r))!==r&&(n[e]=t,this.notifyArrayChildUpdate_(e,t,r))}else{for(var o=new Array(e+1-n.length),s=0;s<o.length-1;s++)o[s]=void 0;o[o.length-1]=t,this.spliceWithArray_(n.length,0,o)}},e}();function nP(e,t,n,r){return void 0===n&&(n="ObservableArray"),void 0===r&&(r=!1),WT(),qP((function(){var i=new tP(n,t,r,!1);tR(i.values_,SR,i);var o=new Proxy(i.values_,eP);return i.proxy_=o,e&&e.length&&i.spliceWithArray_(0,0,e),o}))}var rP={clear:function(){return this.splice(0)},replace:function(e){var t=this[SR];return t.spliceWithArray_(0,t.values_.length,e)},toJSON:function(){return this.slice()},splice:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var o=this[SR];switch(arguments.length){case 0:return[];case 1:return o.spliceWithArray_(e);case 2:return o.spliceWithArray_(e,t)}return o.spliceWithArray_(e,t,r)},spliceWithArray:function(e,t,n){return this[SR].spliceWithArray_(e,t,n)},push:function(){for(var e=this[SR],t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.spliceWithArray_(e.values_.length,0,n),e.values_.length},pop:function(){return this.splice(Math.max(this[SR].values_.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var e=this[SR],t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.spliceWithArray_(0,0,n),e.values_.length},reverse:function(){return YC.trackingDerivation&&LT(37,"reverse"),this.replace(this.slice().reverse()),this},sort:function(){YC.trackingDerivation&&LT(37,"sort");var e=this.slice();return e.sort.apply(e,arguments),this.replace(e),this},remove:function(e){var t=this[SR],n=t.dehanceValues_(t.values_).indexOf(e);return n>-1&&(this.splice(n,1),!0)}};function iP(e,t){"function"===typeof Array.prototype[e]&&(rP[e]=t(e))}function oP(e){return function(){var t=this[SR];t.atom_.reportObserved();var n=t.dehanceValues_(t.values_);return n[e].apply(n,arguments)}}function sP(e){return function(t,n){var r=this,i=this[SR];return i.atom_.reportObserved(),i.dehanceValues_(i.values_)[e]((function(e,i){return t.call(n,e,i,r)}))}}function aP(e){return function(){var t=this,n=this[SR];n.atom_.reportObserved();var r=n.dehanceValues_(n.values_),i=arguments[0];return arguments[0]=function(e,n,r){return i(e,n,r,t)},r[e].apply(r,arguments)}}iP("at",oP),iP("concat",oP),iP("flat",oP),iP("includes",oP),iP("indexOf",oP),iP("join",oP),iP("lastIndexOf",oP),iP("slice",oP),iP("toString",oP),iP("toLocaleString",oP),iP("toSorted",oP),iP("toSpliced",oP),iP("with",oP),iP("every",sP),iP("filter",sP),iP("find",sP),iP("findIndex",sP),iP("findLast",sP),iP("findLastIndex",sP),iP("flatMap",sP),iP("forEach",sP),iP("map",sP),iP("some",sP),iP("toReversed",sP),iP("reduce",aP),iP("reduceRight",aP);var lP,cP,uP=nR("ObservableArrayAdministration",tP);function hP(e){return JT(e)&&uP(e[SR])}var dP={},fP="add",pP="delete";lP=Symbol.iterator,cP=Symbol.toStringTag;var gP,yP,vP=function(){function e(e,t,n){var r=this;void 0===t&&(t=RR),void 0===n&&(n="ObservableMap"),this.enhancer_=void 0,this.name_=void 0,this[SR]=dP,this.data_=void 0,this.hasMap_=void 0,this.keysAtom_=void 0,this.interceptors_=void 0,this.changeListeners_=void 0,this.dehancer=void 0,this.enhancer_=t,this.name_=n,QT(Map)||LT(18),qP((function(){r.keysAtom_=IR("ObservableMap.keys()"),r.data_=new Map,r.hasMap_=new Map,e&&r.merge(e)}))}var t=e.prototype;return t.has_=function(e){return this.data_.has(e)},t.has=function(e){var t=this;if(!YC.trackingDerivation)return this.has_(e);var n=this.hasMap_.get(e);if(!n){var r=n=new RC(this.has_(e),CR,"ObservableMap.key?",!1);this.hasMap_.set(e,r),kx(r,(function(){return t.hasMap_.delete(e)}))}return n.get()},t.set=function(e,t){var n=this.has_(e);if(qx(this)){var r=Gx(this,{type:n?Zx:fP,object:this,newValue:t,name:e});if(!r)return this;t=r.newValue}return n?this.updateValue_(e,t):this.addValue_(e,t),this},t.delete=function(e){var t=this;if((this.keysAtom_,qx(this))&&!Gx(this,{type:pP,object:this,name:e}))return!1;if(this.has_(e)){var n=Yx(this),r=n?{observableKind:"map",debugObjectName:this.name_,type:pP,object:this,oldValue:this.data_.get(e).value_,name:e}:null;return Kx((function(){var n;t.keysAtom_.reportChanged(),null==(n=t.hasMap_.get(e))||n.setNewValue_(!1),t.data_.get(e).setNewValue_(void 0),t.data_.delete(e)})),n&&Xx(this,r),!0}return!1},t.updateValue_=function(e,t){var n=this.data_.get(e);if((t=n.prepareNewValue_(t))!==YC.UNCHANGED){var r=Yx(this),i=r?{observableKind:"map",debugObjectName:this.name_,type:Zx,object:this,oldValue:n.value_,name:e,newValue:t}:null;0,n.setNewValue_(t),r&&Xx(this,i)}},t.addValue_=function(e,t){var n=this;this.keysAtom_,Kx((function(){var r,i=new RC(t,n.enhancer_,"ObservableMap.key",!1);n.data_.set(e,i),t=i.value_,null==(r=n.hasMap_.get(e))||r.setNewValue_(!0),n.keysAtom_.reportChanged()}));var r=Yx(this),i=r?{observableKind:"map",debugObjectName:this.name_,type:fP,object:this,name:e,newValue:t}:null;r&&Xx(this,i)},t.get=function(e){return this.has(e)?this.dehanceValue_(this.data_.get(e).get()):this.dehanceValue_(void 0)},t.dehanceValue_=function(e){return void 0!==this.dehancer?this.dehancer(e):e},t.keys=function(){return this.keysAtom_.reportObserved(),this.data_.keys()},t.values=function(){var e=this,t=this.keys();return XP({next:function(){var n=t.next(),r=n.done,i=n.value;return{done:r,value:r?void 0:e.get(i)}}})},t.entries=function(){var e=this,t=this.keys();return XP({next:function(){var n=t.next(),r=n.done,i=n.value;return{done:r,value:r?void 0:[i,e.get(i)]}}})},t[lP]=function(){return this.entries()},t.forEach=function(e,t){for(var n,r=vR(this);!(n=r()).done;){var i=n.value,o=i[0],s=i[1];e.call(t,s,o,this)}},t.merge=function(e){var t=this;return mP(e)&&(e=new Map(e)),Kx((function(){$T(e)?function(e){var t=Object.keys(e);if(!oR)return t;var n=Object.getOwnPropertySymbols(e);return n.length?[].concat(t,n.filter((function(t){return zT.propertyIsEnumerable.call(e,t)}))):t}(e).forEach((function(n){return t.set(n,e[n])})):Array.isArray(e)?e.forEach((function(e){var n=e[0],r=e[1];return t.set(n,r)})):rR(e)?(e.constructor!==Map&&LT(19,e),e.forEach((function(e,n){return t.set(n,e)}))):null!==e&&void 0!==e&&LT(20,e)})),this},t.clear=function(){var e=this;Kx((function(){FC((function(){for(var t,n=vR(e.keys());!(t=n()).done;){var r=t.value;e.delete(r)}}))}))},t.replace=function(e){var t=this;return Kx((function(){for(var n,r=function(e){if(rR(e)||mP(e))return e;if(Array.isArray(e))return new Map(e);if($T(e)){var t=new Map;for(var n in e)t.set(n,e[n]);return t}return LT(21,e)}(e),i=new Map,o=!1,s=vR(t.data_.keys());!(n=s()).done;){var a=n.value;if(!r.has(a))if(t.delete(a))o=!0;else{var l=t.data_.get(a);i.set(a,l)}}for(var c,u=vR(r.entries());!(c=u()).done;){var h=c.value,d=h[0],f=h[1],p=t.data_.has(d);if(t.set(d,f),t.data_.has(d)){var g=t.data_.get(d);i.set(d,g),p||(o=!0)}}if(!o)if(t.data_.size!==i.size)t.keysAtom_.reportChanged();else for(var y=t.data_.keys(),v=i.keys(),m=y.next(),w=v.next();!m.done;){if(m.value!==w.value){t.keysAtom_.reportChanged();break}m=y.next(),w=v.next()}t.data_=i})),this},t.toString=function(){return"[object ObservableMap]"},t.toJSON=function(){return Array.from(this)},t.observe_=function(e,t){return Qx(this,e)},t.intercept_=function(e){return Wx(this,e)},hR(e,[{key:"size",get:function(){return this.keysAtom_.reportObserved(),this.data_.size}},{key:cP,get:function(){return"Map"}}]),e}(),mP=nR("ObservableMap",vP);var wP={};gP=Symbol.iterator,yP=Symbol.toStringTag;var bP=function(){function e(e,t,n){var r=this;void 0===t&&(t=RR),void 0===n&&(n="ObservableSet"),this.name_=void 0,this[SR]=wP,this.data_=new Set,this.atom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.dehancer=void 0,this.enhancer_=void 0,this.name_=n,QT(Set)||LT(22),this.enhancer_=function(e,r){return t(e,r,n)},qP((function(){r.atom_=IR(r.name_),e&&r.replace(e)}))}var t=e.prototype;return t.dehanceValue_=function(e){return void 0!==this.dehancer?this.dehancer(e):e},t.clear=function(){var e=this;Kx((function(){FC((function(){for(var t,n=vR(e.data_.values());!(t=n()).done;){var r=t.value;e.delete(r)}}))}))},t.forEach=function(e,t){for(var n,r=vR(this);!(n=r()).done;){var i=n.value;e.call(t,i,i,this)}},t.add=function(e){var t=this;if((this.atom_,qx(this))&&!Gx(this,{type:fP,object:this,newValue:e}))return this;if(!this.has(e)){Kx((function(){t.data_.add(t.enhancer_(e,void 0)),t.atom_.reportChanged()}));var n=!1,r=Yx(this),i=r?{observableKind:"set",debugObjectName:this.name_,type:fP,object:this,newValue:e}:null;n,r&&Xx(this,i)}return this},t.delete=function(e){var t=this;if(qx(this)&&!Gx(this,{type:pP,object:this,oldValue:e}))return!1;if(this.has(e)){var n=Yx(this),r=n?{observableKind:"set",debugObjectName:this.name_,type:pP,object:this,oldValue:e}:null;return Kx((function(){t.atom_.reportChanged(),t.data_.delete(e)})),n&&Xx(this,r),!0}return!1},t.has=function(e){return this.atom_.reportObserved(),this.data_.has(this.dehanceValue_(e))},t.entries=function(){var e=0,t=Array.from(this.keys()),n=Array.from(this.values());return XP({next:function(){var r=e;return e+=1,r<n.length?{value:[t[r],n[r]],done:!1}:{done:!0}}})},t.keys=function(){return this.values()},t.values=function(){this.atom_.reportObserved();var e=this,t=0,n=Array.from(this.data_.values());return XP({next:function(){return t<n.length?{value:e.dehanceValue_(n[t++]),done:!1}:{done:!0}}})},t.replace=function(e){var t=this;return EP(e)&&(e=new Set(e)),Kx((function(){Array.isArray(e)||iR(e)?(t.clear(),e.forEach((function(e){return t.add(e)}))):null!==e&&void 0!==e&&LT("Cannot initialize set from "+e)})),this},t.observe_=function(e,t){return Qx(this,e)},t.intercept_=function(e){return Wx(this,e)},t.toJSON=function(){return Array.from(this)},t.toString=function(){return"[object ObservableSet]"},t[gP]=function(){return this.values()},hR(e,[{key:"size",get:function(){return this.atom_.reportObserved(),this.data_.size}},{key:yP,get:function(){return"Set"}}]),e}(),EP=nR("ObservableSet",bP),_P=Object.create(null),SP="remove",kP=function(){function e(e,t,n,r){void 0===t&&(t=new Map),void 0===r&&(r=XR),this.target_=void 0,this.values_=void 0,this.name_=void 0,this.defaultAnnotation_=void 0,this.keysAtom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.proxy_=void 0,this.isPlainObject_=void 0,this.appliedAnnotations_=void 0,this.pendingKeys_=void 0,this.target_=e,this.values_=t,this.name_=n,this.defaultAnnotation_=r,this.keysAtom_=new kR("ObservableObject.keys"),this.isPlainObject_=$T(this.target_)}var t=e.prototype;return t.getObservablePropValue_=function(e){return this.values_.get(e).get()},t.setObservablePropValue_=function(e,t){var n=this.values_.get(e);if(n instanceof PC)return n.set(t),!0;if(qx(this)){var r=Gx(this,{type:Zx,object:this.proxy_||this.target_,name:e,newValue:t});if(!r)return null;t=r.newValue}if((t=n.prepareNewValue_(t))!==YC.UNCHANGED){var i=Yx(this),o=i?{type:Zx,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,oldValue:n.value_,name:e,newValue:t}:null;0,n.setNewValue_(t),i&&Xx(this,o)}return!0},t.get_=function(e){return YC.trackingDerivation&&!lR(this.target_,e)&&this.has_(e),this.target_[e]},t.set_=function(e,t,n){return void 0===n&&(n=!1),lR(this.target_,e)?this.values_.has(e)?this.setObservablePropValue_(e,t):n?Reflect.set(this.target_,e,t):(this.target_[e]=t,!0):this.extend_(e,{value:t,enumerable:!0,writable:!0,configurable:!0},this.defaultAnnotation_,n)},t.has_=function(e){if(!YC.trackingDerivation)return e in this.target_;this.pendingKeys_||(this.pendingKeys_=new Map);var t=this.pendingKeys_.get(e);return t||(t=new RC(e in this.target_,CR,"ObservableObject.key?",!1),this.pendingKeys_.set(e,t)),t.get()},t.make_=function(e,t){if(!0===t&&(t=this.defaultAnnotation_),!1!==t){if(xP(this,t,e),!(e in this.target_)){var n;if(null!=(n=this.target_[wR])&&n[e])return;LT(1,t.annotationType_,this.name_+"."+e.toString())}for(var r=this.target_;r&&r!==zT;){var i=FT(r,e);if(i){var o=t.make_(this,e,i,r);if(0===o)return;if(1===o)break}r=Object.getPrototypeOf(r)}CP(this,t,e)}},t.extend_=function(e,t,n,r){if(void 0===r&&(r=!1),!0===n&&(n=this.defaultAnnotation_),!1===n)return this.defineProperty_(e,t,r);xP(this,n,e);var i=n.extend_(this,e,t,r);return i&&CP(this,n,e),i},t.defineProperty_=function(e,t,n){void 0===n&&(n=!1),this.keysAtom_;try{$C();var r=this.delete_(e);if(!r)return r;if(qx(this)){var i=Gx(this,{object:this.proxy_||this.target_,name:e,type:fP,newValue:t.value});if(!i)return null;var o=i.newValue;t.value!==o&&(t=dR({},t,{value:o}))}if(n){if(!Reflect.defineProperty(this.target_,e,t))return!1}else VT(this.target_,e,t);this.notifyPropertyAddition_(e,t.value)}finally{ZC()}return!0},t.defineObservableProperty_=function(e,t,n,r){void 0===r&&(r=!1),this.keysAtom_;try{$C();var i=this.delete_(e);if(!i)return i;if(qx(this)){var o=Gx(this,{object:this.proxy_||this.target_,name:e,type:fP,newValue:t});if(!o)return null;t=o.newValue}var s=TP(e),a={configurable:!YC.safeDescriptors||this.isPlainObject_,enumerable:!0,get:s.get,set:s.set};if(r){if(!Reflect.defineProperty(this.target_,e,a))return!1}else VT(this.target_,e,a);var l=new RC(t,n,"ObservableObject.key",!1);this.values_.set(e,l),this.notifyPropertyAddition_(e,l.value_)}finally{ZC()}return!0},t.defineComputedProperty_=function(e,t,n){void 0===n&&(n=!1),this.keysAtom_;try{$C();var r=this.delete_(e);if(!r)return r;if(qx(this))if(!Gx(this,{object:this.proxy_||this.target_,name:e,type:fP,newValue:void 0}))return null;t.name||(t.name="ObservableObject.key"),t.context=this.proxy_||this.target_;var i=TP(e),o={configurable:!YC.safeDescriptors||this.isPlainObject_,enumerable:!1,get:i.get,set:i.set};if(n){if(!Reflect.defineProperty(this.target_,e,o))return!1}else VT(this.target_,e,o);this.values_.set(e,new PC(t)),this.notifyPropertyAddition_(e,void 0)}finally{ZC()}return!0},t.delete_=function(e,t){if(void 0===t&&(t=!1),this.keysAtom_,!lR(this.target_,e))return!0;if(qx(this)&&!Gx(this,{object:this.proxy_||this.target_,name:e,type:SP}))return null;try{var n,r;$C();var i,o=Yx(this),s=this.values_.get(e),a=void 0;if(!s&&o)a=null==(i=FT(this.target_,e))?void 0:i.value;if(t){if(!Reflect.deleteProperty(this.target_,e))return!1}else delete this.target_[e];if(s&&(this.values_.delete(e),s instanceof RC&&(a=s.value_),tx(s)),this.keysAtom_.reportChanged(),null==(n=this.pendingKeys_)||null==(r=n.get(e))||r.set(e in this.target_),o){var l={type:SP,observableKind:"object",object:this.proxy_||this.target_,debugObjectName:this.name_,oldValue:a,name:e};0,o&&Xx(this,l)}}finally{ZC()}return!0},t.observe_=function(e,t){return Qx(this,e)},t.intercept_=function(e){return Wx(this,e)},t.notifyPropertyAddition_=function(e,t){var n,r,i=Yx(this);if(i){var o=i?{type:fP,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,name:e,newValue:t}:null;0,i&&Xx(this,o)}null==(n=this.pendingKeys_)||null==(r=n.get(e))||r.set(!0),this.keysAtom_.reportChanged()},t.ownKeys_=function(){return this.keysAtom_.reportObserved(),sR(this.target_)},t.keys_=function(){return this.keysAtom_.reportObserved(),Object.keys(this.target_)},e}();function AP(e,t){var n;if(lR(e,SR))return e;var r=null!=(n=null==t?void 0:t.name)?n:"ObservableObject",i=new kP(e,new Map,String(r),function(e){var t;return e?null!=(t=e.defaultDecorator)?t:JR(e):void 0}(t));return eR(e,SR,i),e}var IP=nR("ObservableObjectAdministration",kP);function TP(e){return _P[e]||(_P[e]={get:function(){return this[SR].getObservablePropValue_(e)},set:function(t){return this[SR].setObservablePropValue_(e,t)}})}function RP(e){return!!JT(e)&&IP(e[SR])}function CP(e,t,n){var r;null==(r=e.target_[wR])||delete r[n]}function xP(e,t,n){}var PP,DP,NP=UP(0),BP=function(){var e=!1,t={};return Object.defineProperty(t,"0",{set:function(){e=!0}}),Object.create(t)[0]=1,!1===e}(),LP=0,OP=function(){};PP=OP,DP=Array.prototype,Object.setPrototypeOf?Object.setPrototypeOf(PP.prototype,DP):void 0!==PP.prototype.__proto__?PP.prototype.__proto__=DP:PP.prototype=DP;var MP=function(e,t,n){function r(t,n,r,i){var o;return void 0===r&&(r="ObservableArray"),void 0===i&&(i=!1),o=e.call(this)||this,qP((function(){var e=new tP(r,n,i,!0);e.proxy_=gR(o),tR(gR(o),SR,e),t&&t.length&&o.spliceWithArray(0,0,t),BP&&Object.defineProperty(gR(o),"0",NP)})),o}fR(r,e);var i=r.prototype;return i.concat=function(){this[SR].atom_.reportObserved();for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Array.prototype.concat.apply(this.slice(),t.map((function(e){return hP(e)?e.slice():e})))},i[n]=function(){var e=this,t=0;return XP({next:function(){return t<e.length?{value:e[t++],done:!1}:{done:!0,value:void 0}}})},hR(r,[{key:"length",get:function(){return this[SR].getArrayLength_()},set:function(e){this[SR].setArrayLength_(e)}},{key:t,get:function(){return"Array"}}]),r}(OP,Symbol.toStringTag,Symbol.iterator);function UP(e){return{enumerable:!1,configurable:!0,get:function(){return this[SR].get_(e)},set:function(t){this[SR].set_(e,t)}}}function FP(e){VT(MP.prototype,""+e,UP(e))}function VP(e){if(e>LP){for(var t=LP;t<e+100;t++)FP(t);LP=e}}function zP(e,t,n){return new MP(e,t,n)}function KP(e,t){if("object"===typeof e&&null!==e){if(hP(e))return void 0!==t&&LT(23),e[SR].atom_;if(EP(e))return e.atom_;if(mP(e)){if(void 0===t)return e.keysAtom_;var n=e.data_.get(t)||e.hasMap_.get(t);return n||LT(25,t,HP(e)),n}if(RP(e)){if(!t)return LT(26);var r=e[SR].values_.get(t);return r||LT(27,t,HP(e)),r}if(AR(e)||DC(e)||ax(e))return e}else if(QT(e)&&ax(e[SR]))return e[SR];LT(28)}function jP(e,t){return e||LT(29),void 0!==t?jP(KP(e,t)):AR(e)||DC(e)||ax(e)||mP(e)||EP(e)?e:e[SR]?e[SR]:void LT(24,e)}function HP(e,t){var n;if(void 0!==t)n=KP(e,t);else{if(mx(e))return e.name;n=RP(e)||mP(e)||EP(e)?jP(e):KP(e)}return n.name_}function qP(e){var t=VC(),n=AC(!0);$C();try{return e()}finally{ZC(),IC(n),zC(t)}}Object.entries(rP).forEach((function(e){var t=e[0],n=e[1];"concat"!==t&&eR(MP.prototype,t,n)})),VP(1e3);var WP=zT.toString;function GP(e,t,n){return void 0===n&&(n=-1),YP(e,t,n)}function YP(e,t,n,r,i){if(e===t)return 0!==e||1/e===1/t;if(null==e||null==t)return!1;if(e!==e)return t!==t;var o=typeof e;if("function"!==o&&"object"!==o&&"object"!=typeof t)return!1;var s=WP.call(e);if(s!==WP.call(t))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+e===""+t;case"[object Number]":return+e!==+e?+t!==+t:0===+e?1/+e===1/t:+e===+t;case"[object Date]":case"[object Boolean]":return+e===+t;case"[object Symbol]":return"undefined"!==typeof Symbol&&Symbol.valueOf.call(e)===Symbol.valueOf.call(t);case"[object Map]":case"[object Set]":n>=0&&n++}e=QP(e),t=QP(t);var a="[object Array]"===s;if(!a){if("object"!=typeof e||"object"!=typeof t)return!1;var l=e.constructor,c=t.constructor;if(l!==c&&!(QT(l)&&l instanceof l&&QT(c)&&c instanceof c)&&"constructor"in e&&"constructor"in t)return!1}if(0===n)return!1;n<0&&(n=-1),i=i||[];for(var u=(r=r||[]).length;u--;)if(r[u]===e)return i[u]===t;if(r.push(e),i.push(t),a){if((u=e.length)!==t.length)return!1;for(;u--;)if(!YP(e[u],t[u],n-1,r,i))return!1}else{var h,d=Object.keys(e);if(u=d.length,Object.keys(t).length!==u)return!1;for(;u--;)if(!lR(t,h=d[u])||!YP(e[h],t[h],n-1,r,i))return!1}return r.pop(),i.pop(),!0}function QP(e){return hP(e)?e.slice():rR(e)||mP(e)||iR(e)||EP(e)?Array.from(e.entries()):e}function XP(e){return e[Symbol.iterator]=JP,e}function JP(){return this}["Symbol","Map","Set"].forEach((function(e){"undefined"===typeof MT()[e]&&LT("MobX requires global '"+e+"' to be available or polyfilled")})),"object"===typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:function(e){return console.warn("[mobx.spy] Is a no-op in production builds"),function(){}},extras:{getDebugName:HP},$mobx:SR});const $P=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.join("/").replace(/((?<=\/)\/+)|(^\.\/)|((?<=\/)\.\/)/g,"")||"."},ZP=$P,eD=async e=>{let{ipfs:t,log:n,events:r,onSynced:i,start:o,timeout:s}=e;if(!t)throw new Error("An instance of ipfs is required.");if(!n)throw new Error("An instance of log is required.");const a=t.libp2p,l=t.libp2p.services.pubsub,c=n.id,u=ZP("/orbitdb/heads/",c),h=new yd({concurrency:1}),d=new Set;r=r||new _y.EventEmitter,s=s||3e4;let f=!1;const p=e=>async function*(){const e=await n.heads();for await(const{bytes:t}of e)yield t}(),g=e=>async t=>{for await(const e of t){const t=e.subarray();t&&i&&await i(t)}f&&await(async e=>{const t=await n.heads();r.emit("join",e,t)})(e)},y=async e=>{let{connection:t,stream:n}=e;const i=String(t.remotePeer);try{d.add(i),await Cr(n,g(i),p,n)}catch(o){d.delete(i),r.emit("error",o)}},v=async e=>{h.add((async()=>{const{peerId:t,subscriptions:n}=e.detail,i=String(t),o=n.find((e=>e.topic===c));if(o)if(o.subscribe){if(d.has(i))return;const e=new yy.TimeoutController(s),{signal:n}=e;try{d.add(i);const e=await a.dialProtocol(t,u,{signal:n});await Cr(p,e,g(i))}catch(l){console.error(l),d.delete(i),"ERR_UNSUPPORTED_PROTOCOL"===l.code||r.emit("error",l)}finally{e&&e.clear()}}else d.delete(i),r.emit("leave",i)}))},m=async e=>{const{topic:t,data:n}=e.detail,o=async()=>{try{n&&i&&await i(n)}catch(e){r.emit("error",e)}};t===c&&h.add(o)},w=async()=>{f||(await a.handle(u,y),l.addEventListener("subscription-change",v),l.addEventListener("message",m),await l.subscribe(c),f=!0)};return!1!==o&&await w(),{add:async e=>{f&&await l.publish(c,e.bytes)},stop:async()=>{f&&(f=!1,await h.onIdle(),l.removeEventListener("subscription-change",v),l.removeEventListener("message",m),await a.unhandle(u),await l.unsubscribe(c),d.clear())},start:w,events:r,peers:d}};var tD=n(3477);const nD=(e,t)=>{const n=e.time-t.time;return 0===n&&e.id!==t.id?e.id<t.id?-1:1:n},rD=(e,t)=>({id:e,time:t=t||0}),iD=(new Uint8Array(0),e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")});var oD=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var o=e.charAt(i),s=o.charCodeAt(0);if(255!==n[s])throw new TypeError(o+" is ambiguous");n[s]=i}var a=e.length,l=e.charAt(0),c=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if("string"!==typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var r=0,i=0;e[t]===l;)r++,t++;for(var o=(e.length-t)*c+1>>>0,s=new Uint8Array(o);e[t];){var u=n[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=o-1;(0!==u||h<i)&&-1!==d;d--,h++)u+=a*s[d]>>>0,s[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=o-i;f!==o&&0===s[f];)f++;for(var p=new Uint8Array(r+(o-f)),g=r;f!==o;)p[g++]=s[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,i=0,o=t.length;i!==o&&0===t[i];)i++,n++;for(var s=(o-i)*u+1>>>0,c=new Uint8Array(s);i!==o;){for(var h=t[i],d=0,f=s-1;(0!==h||d<r)&&-1!==f;f--,d++)h+=256*c[f]>>>0,c[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");r=d,i++}for(var p=s-r;p!==s&&0===c[p];)p++;for(var g=l.repeat(n);p<s;++p)g+=e.charAt(c[p]);return g},decodeUnsafe:h,decode:function(e){var n=h(e);if(n)return n;throw new Error("Non-".concat(t," character"))}}};const sD=oD;class aD{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return"".concat(this.prefix).concat(this.baseEncode(e));throw Error("Unknown type, must be binary type")}}class lD{constructor(e,t,n){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if("string"===typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error("Unable to decode multibase string ".concat(JSON.stringify(e),", ").concat(this.name," decoder only supports inputs prefixed with ").concat(this.prefix));return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return uD(this,e)}}class cD{constructor(e){this.decoders=e}or(e){return uD(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError("Unable to decode multibase string ".concat(JSON.stringify(e),", only inputs prefixed with ").concat(Object.keys(this.decoders)," are supported"))}}const uD=(e,t)=>new cD({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class hD{constructor(e,t,n,r){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new aD(e,t,n),this.decoder=new lD(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const dD=e=>{let{name:t,prefix:n,encode:r,decode:i}=e;return new hD(t,n,r,i)},fD=e=>{let{prefix:t,name:n,alphabet:r}=e;const{encode:i,decode:o}=sD(r,n);return dD({prefix:t,name:n,encode:i,decode:e=>iD(o(e))})},pD=e=>{let{name:t,prefix:n,bitsPerChar:r,alphabet:i}=e;return dD({prefix:n,name:t,encode:e=>((e,t,n)=>{const r="="===t[t.length-1],i=(1<<n)-1;let o="",s=0,a=0;for(let l=0;l<e.length;++l)for(a=a<<8|e[l],s+=8;s>n;)s-=n,o+=t[i&a>>s];if(s&&(o+=t[i&a<<n-s]),r)for(;o.length*n&7;)o+="=";return o})(e,i,r),decode:e=>((e,t,n,r)=>{const i={};for(let u=0;u<t.length;++u)i[t[u]]=u;let o=e.length;for(;"="===e[o-1];)--o;const s=new Uint8Array(o*n/8|0);let a=0,l=0,c=0;for(let u=0;u<o;++u){const t=i[e[u]];if(void 0===t)throw new SyntaxError("Non-".concat(r," character"));l=l<<n|t,a+=n,a>=8&&(a-=8,s[c++]=255&l>>a)}if(a>=n||255&l<<8-a)throw new SyntaxError("Unexpected end of data");return s})(e,i,r,t)})},gD=pD({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),yD=(pD({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),pD({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),pD({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),pD({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),pD({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),pD({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),pD({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),pD({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),fD({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}));fD({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var vD=function e(t,n,r){n=n||[];var i=r=r||0;for(;t>=bD;)n[r++]=255&t|mD,t/=128;for(;t&wD;)n[r++]=255&t|mD,t>>>=7;return n[r]=0|t,e.bytes=r-i+1,n},mD=128,wD=-128,bD=Math.pow(2,31);var ED=function e(t,n){var r,i=0,o=0,s=n=n||0,a=t.length;do{if(s>=a)throw e.bytes=0,new RangeError("Could not decode varint");r=t[s++],i+=o<28?(r&SD)<<o:(r&SD)*Math.pow(2,o),o+=7}while(r>=_D);return e.bytes=s-n,i},_D=128,SD=127;var kD=Math.pow(2,7),AD=Math.pow(2,14),ID=Math.pow(2,21),TD=Math.pow(2,28),RD=Math.pow(2,35),CD=Math.pow(2,42),xD=Math.pow(2,49),PD=Math.pow(2,56),DD=Math.pow(2,63);const ND={encode:vD,decode:ED,encodingLength:function(e){return e<kD?1:e<AD?2:e<ID?3:e<TD?4:e<RD?5:e<CD?6:e<xD?7:e<PD?8:e<DD?9:10}},BD=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return[ND.decode(e,t),ND.decode.bytes]},LD=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return ND.encode(e,t,n),t},OD=e=>ND.encodingLength(e),MD=(e,t)=>{const n=t.byteLength,r=OD(e),i=r+OD(n),o=new Uint8Array(i+n);return LD(e,o,0),LD(n,o,r),o.set(t,i),new UD(e,n,t,o)};class UD{constructor(e,t,n,r){this.code=e,this.size=t,this.digest=n,this.bytes=r}}const FD=(e,t)=>{const{bytes:n,version:r}=e;return 0===r?HD(n,zD(e),t||yD.encoder):qD(n,zD(e),t||gD.encoder)},VD=new WeakMap,zD=e=>{const t=VD.get(e);if(null==t){const t=new Map;return VD.set(e,t),t}return t};class KD{constructor(e,t,n,r){this.code=t,this.version=e,this.multihash=n,this.bytes=r,this["/"]=r}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==WD)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==GD)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return KD.createV0(t)}default:throw Error("Can not convert CID version ".concat(this.version," to version 0. This is a bug please report"))}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=MD(e,t);return KD.createV1(this.code,n)}case 1:return this;default:throw Error("Can not convert CID version ".concat(this.version," to version 1. This is a bug please report"))}}equals(e){return KD.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&((e,t)=>{if(e===t)return!0;{const n=t;return e.code===n.code&&e.size===n.size&&n.bytes instanceof Uint8Array&&((e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0})(e.bytes,n.bytes)}})(e.multihash,n.multihash)}toString(e){return FD(this,e)}toJSON(){return{"/":FD(this)}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID(".concat(this.toString(),")")}static asCID(e){if(null==e)return null;const t=e;if(t instanceof KD)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:n,multihash:r,bytes:i}=t;return new KD(e,n,r,i||YD(e,n,r.bytes))}if(!0===t[QD]){const{version:e,multihash:n,code:r}=t,i=(e=>{const t=iD(e),[n,r]=BD(t),[i,o]=BD(t.subarray(r)),s=t.subarray(r+o);if(s.byteLength!==i)throw new Error("Incorrect length");return new UD(n,i,s,t)})(n);return KD.create(e,r,i)}return null}static create(e,t,n){if("number"!==typeof t)throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==WD)throw new Error("Version 0 CID must use dag-pb (code: ".concat(WD,") block encoding"));return new KD(e,t,n,n.bytes);case 1:{const r=YD(e,t,n.bytes);return new KD(e,t,n,r)}default:throw new Error("Invalid version")}}static createV0(e){return KD.create(0,WD,e)}static createV1(e,t){return KD.create(1,e,t)}static decode(e){const[t,n]=KD.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=KD.inspectBytes(e),n=t.size-t.multihashSize,r=iD(e.subarray(n,n+t.multihashSize));if(r.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=r.subarray(t.multihashSize-t.digestSize),o=new UD(t.multihashCode,t.digestSize,i,r);return[0===t.version?KD.createV0(o):KD.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[n,r]=BD(e.subarray(t));return t+=r,n};let r=n(),i=WD;if(18===r?(r=0,t=0):i=n(),0!==r&&1!==r)throw new RangeError("Invalid CID version ".concat(r));const o=t,s=n(),a=n(),l=t+a;return{version:r,codec:i,multihashCode:s,digestSize:a,multihashSize:l-o,size:l}}static parse(e,t){const[n,r]=jD(e,t),i=KD.decode(r);if(0===i.version&&"Q"!==e[0])throw Error("Version 0 CID string must not include multibase prefix");return zD(i).set(n,e),i}}const jD=(e,t)=>{switch(e[0]){case"Q":{const n=t||yD;return[yD.prefix,n.decode("".concat(yD.prefix).concat(e))]}case yD.prefix:{const n=t||yD;return[yD.prefix,n.decode(e)]}case gD.prefix:{const n=t||gD;return[gD.prefix,n.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},HD=(e,t,n)=>{const{prefix:r}=n;if(r!==yD.prefix)throw Error("Cannot string encode V0 in ".concat(n.name," encoding"));const i=t.get(r);if(null==i){const i=n.encode(e).slice(1);return t.set(r,i),i}return i},qD=(e,t,n)=>{const{prefix:r}=n,i=t.get(r);if(null==i){const i=n.encode(e);return t.set(r,i),i}return i},WD=112,GD=18,YD=(e,t,n)=>{const r=OD(e),i=r+OD(t),o=new Uint8Array(i+n.byteLength);return LD(e,o,0),LD(t,o,r),o.set(n,i),o},QD=Symbol.for("@ipld/js-cid/CID"),XD=e=>{let{name:t,code:n,encode:r}=e;return new JD(t,n,r)};class JD{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?MD(this.code,t):t.then((e=>MD(this.code,e)))}throw Error("Unknown type, must be binary type")}}function $D(){let{enumerable:e=!0,configurable:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{enumerable:e,configurable:t,writable:!1}}function*ZD(e,t){if(null!=t&&"object"===typeof t)if(Array.isArray(t))for(const[n,r]of t.entries()){const t=[...e,n],i=KD.asCID(r);i?yield[t.join("/"),i]:"object"===typeof r&&(yield*eN(r,t))}else{const n=KD.asCID(t);n?yield[e.join("/"),n]:yield*eN(t,e)}}function*eN(e,t){if(null==e||e instanceof Uint8Array)return;const n=KD.asCID(e);n&&(yield[t.join("/"),n]);for(const[r,i]of Object.entries(e)){const e=[...t,r];yield*ZD(e,i)}}function*tN(e,t){if(Array.isArray(t))for(const[n,r]of t.entries()){const t=[...e,n];yield t.join("/"),"object"!==typeof r||KD.asCID(r)||(yield*nN(r,t))}else yield*nN(t,e)}function*nN(e,t){if(null!=e&&"object"===typeof e)for(const[n,r]of Object.entries(e)){const e=[...t,n];yield e.join("/"),null==r||r instanceof Uint8Array||"object"!==typeof r||KD.asCID(r)||(yield*tN(e,r))}}class rN{constructor(e){let{cid:t,bytes:n,value:r}=e;if(!t||!n||"undefined"===typeof r)throw new Error("Missing required argument");this.cid=t,this.bytes=n,this.value=r,this.asBlock=this,Object.defineProperties(this,{cid:$D(),bytes:$D(),value:$D(),asBlock:$D()})}links(){return eN(this.value,[])}tree(){return nN(this.value,[])}get(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/";return function(e,t){let n=e;for(const[r,i]of t.entries()){if(n=n[i],null==n)throw new Error("Object has no property at ".concat(t.slice(0,r+1).map((e=>"[".concat(JSON.stringify(e),"]"))).join("")));const e=KD.asCID(n);if(e)return{value:e,remaining:t.slice(r+1).join("/")}}return{value:n}}(this.value,e.split("/").filter(Boolean))}}async function iN(e){let{value:t,codec:n,hasher:r}=e;if("undefined"===typeof t)throw new Error('Missing required argument "value"');if(!n||!r)throw new Error("Missing required argument: codec or hasher");const i=n.encode(t),o=await r.digest(i),s=KD.create(1,n.code,o);return new rN({value:t,bytes:i,cid:s})}async function oN(e){let{bytes:t,codec:n,hasher:r}=e;if(!t)throw new Error('Missing required argument "bytes"');if(!n||!r)throw new Error("Missing required argument: codec or hasher");const i=n.decode(t),o=await r.digest(t),s=KD.create(1,n.code,o);return new rN({value:i,bytes:t,cid:s})}const sN=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),aN=XD({name:"sha2-256",code:18,encode:sN("SHA-256")}),lN=(XD({name:"sha2-512",code:19,encode:sN("SHA-512")}),b),cN=aN,uN=yD,hN=e=>e&&void 0!==e.id&&void 0!==e.next&&void 0!==e.payload&&void 0!==e.v&&void 0!==e.clock&&void 0!==e.refs,dN=async e=>{const{cid:t,bytes:n}=await iN({value:e,codec:lN,hasher:cN}),r=t.toString(uN),i=rD(e.clock.id,e.clock.time);return{...e,clock:i,hash:r,bytes:n}},fN=async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[];if(null==e)throw new Error("Identity is required, cannot create entry");if(null==t)throw new Error("Entry requires an id");if(null==n)throw new Error("Entry requires a payload");if(null==i||!Array.isArray(i))throw new Error("'next' argument is not an array");r=r||rD(e.publicKey);const s={id:t,payload:n,next:i,refs:o,clock:r,v:2},{bytes:a}=await iN({value:s,codec:lN,hasher:cN}),l=await e.sign(e,a);return s.key=e.publicKey,s.identity=e.hash,s.sig=l,dN(s)},pN=async(e,t)=>{if(!e)throw new Error("Identities is required, cannot verify entry");if(!hN(t))throw new Error("Invalid Log entry");if(!t.key)throw new Error("Entry doesn't have a key");if(!t.sig)throw new Error("Entry doesn't have a signature");const n={id:t.id,payload:t.payload,next:t.next,refs:t.refs,clock:t.clock,v:t.v},{bytes:r}=await iN({value:n,codec:lN,hasher:cN});return e.verify(t.sig,t.key,r)},gN=async e=>{const{value:t}=await oN({bytes:e,codec:lN,hasher:cN});return dN(t)},yN=(e,t)=>e&&t&&e.hash===t.hash,vN=async()=>{let e={};const t=async(t,n)=>{e[t]=n};return{put:t,del:async t=>{delete e[t]},get:async t=>e[t],iterator:async function*(){for await(const[t,n]of Object.entries(e))yield[t,n]},merge:async e=>{if(e)for await(const[n,r]of e.iterator())t(n,r)},clear:async()=>{e={}},close:async()=>{}}},mN=vN,wN=e=>{e=new Set(e);const t={};for(const r of e)for(const e of r.next)t[e]=r.hash;const n=[];for(const r of e)t[r.hash]||n.push(r);return n},bN=async e=>{let{storage:t,heads:n}=e;t=t||await mN();const r=async e=>{e=wN(e);for(const n of e)await t.put(n.hash,n.bytes)},i=async e=>{await t.clear(),await r(e)},o=async function*(){const e=t.iterator();for await(const[,t]of e){const e=await gN(t);yield e}},s=async()=>{const e=[];for await(const t of o())e.push(t);return e};return await r(n||[]),{put:r,set:i,add:async e=>{const t=await s();if(t.find((t=>yN(t,e))))return;const n=wN([...t,e]);return await i(n),n},remove:async e=>{const t=(await s()).filter((t=>t.hash!==e));await i(t)},iterator:o,all:s,clear:async()=>{await t.clear()},close:async()=>{await t.close()}}};function EN(e,t,n){const r=nD(e.clock,t.clock);return 0===r?n(e,t):r}function _N(e,t,n){return e.clock.id===t.clock.id?n(e,t):e.clock.id<t.clock.id?-1:1}const SN={SortByClocks:EN,SortByClockId:_N,LastWriteWins:function(e,t){const n=(e,t)=>e,r=(e,t)=>_N(e,t,n);return((e,t)=>EN(e,t,r))(e,t)},NoZeroes:function(e){const t="Your log's tiebreaker function, ".concat(e.name,", has returned zero and therefore cannot be");return(n,r)=>{const i=e(n,r);if(0===i)throw Error(t);return i}}},{LastWriteWins:kN,NoZeroes:AN}=SN,IN=(e,t)=>Math.max(e,t.clock.time),TN=vN,RN=async function(e){let{logId:t,logHeads:n,access:r,entryStorage:i,headsStorage:o,indexStorage:s,sortFn:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(null==e)throw new Error("Identity is required");if(null!=n&&!Array.isArray(n))throw new Error("'logHeads' argument must be an array");const l=t||(new Date).getTime().toString();r=r||await(async()=>({canAppend:async e=>!0}))();const c=i||await TN(),u=s||await TN();o=o||await TN();const h=await bN({storage:o,heads:n});a=AN(a||kN);const d=new yd({concurrency:1}),f=new yd({concurrency:1}),p=async()=>{const t=Math.max(0,(await g()).reduce(IN,0));return rD(e.publicKey,t)},g=async()=>(await h.all()).sort(a).reverse(),y=async()=>{const e=[];for await(const t of b())e.unshift(t);return e},v=async e=>{const t=await c.get(e);if(t){return await gN(t)}},m=async e=>null!=await u.get(e),w=async t=>f.add((async()=>{if(await m(t.hash))return!1;const n=async t=>{if(t.id!==l)throw new Error("Entry's id (".concat(t.id,") doesn't match the log's id (").concat(l,")."));if(!await r.canAppend(t))throw new Error('Could not append entry:\nKey "'.concat(t.identity,'" is not allowed to write to the log'));if(!await pN(e,t))throw new Error('Could not validate signature for entry "'.concat(t.hash,'"'))};await n(t);const i=(await g()).map((e=>e.hash)),o=new Set([t.hash]),s=new Set([...t.next,...t.refs]),a=new Set,c=async()=>{const e=Array.from(s.values()).filter(m).map(v),t=await Promise.all(e);for(const r of t){s.delete(r.hash),await n(r),o.add(r.hash);for(const e of[...r.next,...r.refs]){await m(e)||o.has(e)?i.includes(e)&&a.add(e):s.add(e)}}s.size>0&&await c()};await c();for(const e of o.values())await u.put(e,!0);for(const e of a.values())await h.remove(e);return await h.add(t),!0})),b=function(e,t){try{let n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return async function*(){t=t||(()=>!1);let r=(e=e||await g()).sort(a);const i={};let o=[];const s={},l=e=>!(i[e]||s[e]);let c;for(;r.length>0;)if(r=r.sort(a),c=r.pop(),c){const{hash:e,next:a,refs:u}=c;if(!i[e]){yield c;if(!0===await t(c))break;i[e]=!0,s[e]=!0,o=[...o,...a,...n?u:[]].filter(l);const h=e=>{if(!i[e]&&!s[e])return s[e]=!0,v(e)},d=await Promise.all(o.map(h));o=d.filter((e=>null!==e&&void 0!==e)).reduce(((e,t)=>Array.from(new Set([...e,...t.next,...n?t.refs:[]]))),[]).filter(l),r=[...d,...r]}}}()}catch(n){return Promise.reject(n)}},E=e=>e&&void 0!==e.id&&void 0!==e.clock&&void 0!==e.heads&&void 0!==e.values&&void 0!==e.access&&void 0!==e.identity&&void 0!==e.storage,_=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=[];const r=async e=>n.length>=t&&-1!==t;for await(const{hash:i}of b(e,r,!1))n.push(i);return n=n.slice(e.length+1,t),n};return{id:l,clock:p,heads:g,values:y,all:y,get:v,has:m,append:async function(t){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{referencesCount:0};return d.add((async()=>{const i=await g(),o=i.map((e=>e.hash)),s=await _(i,n.referencesCount+i.length),a=await fN(e,l,t,(e=>rD(e.id,++e.time))(await p()),o,s);if(!await r.canAppend(a))throw new Error('Could not append entry:\nKey "'.concat(e.hash,'" is not allowed to write to the log'));return await h.set([a]),await c.put(a.hash,a.bytes),await u.put(a.hash,!0),a}))},join:async e=>{if(!e)throw new Error("Log instance not defined");if(!E(e))throw new Error("Given argument is not an instance of Log");c.merge&&await c.merge(e.storage);const t=await e.heads();for(const n of t)await w(n)},joinEntry:w,traverse:b,iterator:function(){try{let{amount:e=-1,gt:t,gte:n,lt:r,lte:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async function*(){if(0===e)return;if("string"===typeof i&&(i=[await v(i)]),"string"===typeof r){const e=await v(r),t=await Promise.all(e.next.map((e=>v(e))));r=t}if(null!=r&&!Array.isArray(r))throw new Error("lt must be a string or an array of Entries");if(null!=i&&!Array.isArray(i))throw new Error("lte must be a string or an array of Entries");const o=(r||i||await g()).filter((e=>null!=e)),s=t||n?await v(t||n):null,a=s||-1===e?-1:e;let l=0;const c=s&&-1!==e&&!r&&!i,u=c?new tD(e+2):null;let h=0;const d=b(o,(async e=>(l++,!!e&&(l>=a&&-1!==a||!(!s||!yN(e,s))))));for await(const e of d){const n=r&&yN(e,o),i=t&&yN(e,s);n||i||(c?u.set(h++,e.hash):yield e)}if(c){const t=u.keys.length,n=t>e?t-e:0,r=u.keys.slice(n,t);for(const e of r){const t=u.get(e),n=await v(t);yield n}}}()}catch(e){return Promise.reject(e)}},clear:async()=>{await u.clear(),await h.clear(),await c.clear()},close:async()=>{await u.close(),await h.close(),await c.close()},access:r,identity:e,storage:c}},CN=async(e,t)=>({put:async(n,r)=>{await e.put(n,r),await t.put(n,r)},get:async n=>{let r=await e.get(n);return r||(r=await t.get(n),r&&await e.put(n,r)),r},del:async n=>{await e.del(n),await t.del(n)},iterator:function(){try{let{amount:n,reverse:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async function*(){const i=[],o={amount:n||-1,reverse:r||!1};for(const n of[e,t])for await(const[e,t]of n.iterator(o))i[e]||(i[e]=!0,yield[e,t])}()}catch(n){return Promise.reject(n)}},merge:async n=>{await e.merge(n),await t.merge(n),await n.merge(e),await n.merge(t)},clear:async()=>{await e.clear(),await t.clear()},close:async()=>{await e.close(),await t.close()}}),xN=async function(){let{ipfs:e,pin:t,timeout:n}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e)throw new Error("An instance of ipfs is required.");return{put:async(r,i)=>{const o=KD.parse(r,yD),{signal:s}=new yy.TimeoutController(n||3e4);await e.blockstore.put(o,i,{signal:s}),t&&!await e.pins.isPinned(o)&&await gn(e.pins.add(o))},del:async e=>{},get:async t=>{const r=KD.parse(t,yD),{signal:i}=new yy.TimeoutController(n||3e4),o=await e.blockstore.get(r,{signal:i});if(o)return o},iterator:async function*(){},merge:async e=>{},clear:async()=>{},close:async()=>{}}},PN=async function(){let{path:e,valueEncoding:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=e||"./level",t=t||"view";const n=new Rn.Level(e,{valueEncoding:t,passive:!0});await n.open();return{put:async(e,t)=>{await n.put(e,t)},del:async e=>{await n.del(e)},get:async e=>{try{const t=await n.get(e);if(t)return t}catch(t){}},iterator:function(){try{let{amount:e,reverse:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async function*(){const r={limit:e||-1,reverse:t||!1};for await(const[e,t]of n.iterator(r))yield[e,t]}()}catch(e){return Promise.reject(e)}},merge:async e=>{},clear:async()=>{await n.clear()},close:async()=>{await n.close()}}},DN=1e6,NN=async function(){let{size:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new tD(e||DN);return{put:async(e,n)=>{t.set(e,n)},del:async e=>{t.remove(e)},get:async e=>t.get(e),iterator:async function*(){for await(const e of t.keys){const n=t.get(e);yield[e,n]}},merge:async e=>{if(e)for await(const[n,r]of e.iterator())t.set(n,r)},clear:async()=>{t=new tD(e||DN)},close:async()=>{}}},BN=1e3,LN=async e=>{let{ipfs:t,identity:n,address:r,name:i,access:o,directory:s,meta:a,headsStorage:l,entryStorage:c,indexStorage:u,referencesCount:h,syncAutomatically:d,onUpdate:f}=e;s=ZP(s||"./orbitdb","./".concat(r,"/")),a=a||{},h=Number(h)>-1?h:16,c=c||await CN(await NN({size:BN}),await xN({ipfs:t,pin:!0})),l=l||await CN(await NN({size:BN}),await PN({path:ZP(s,"/log/_heads/")})),u=u||await CN(await NN({size:BN}),await PN({path:ZP(s,"/log/_index/")}));const p=await RN(n,{logId:r,access:o,entryStorage:c,headsStorage:l,indexStorage:u}),g=new _y.EventEmitter,y=new yd({concurrency:1}),v=await eD({ipfs:t,log:p,events:g,onSynced:async e=>{await y.add((async()=>{const t=await gN(e);if(t){await p.joinEntry(t)&&(f&&await f(p,t),g.emit("update",t))}}))},start:d});return{address:r,name:i,identity:n,meta:a,close:async()=>{await v.stop(),await y.onIdle(),await p.close(),o&&o.close&&await o.close(),g.emit("close")},drop:async()=>{await y.onIdle(),await p.clear(),o&&o.drop&&await o.drop(),g.emit("drop")},addOperation:async e=>{const t=await y.add((async()=>{const t=await p.append(e,{referencesCount:h});return await v.add(t),f&&await f(p,t),g.emit("update",t),t.hash}));return await y.onIdle(),t},log:p,sync:v,peers:v.peers,events:g,access:o}},ON="documents",MN={indexBy:"_id"},UN=function(){let{indexBy:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:MN;return async t=>{let{ipfs:n,identity:r,address:i,name:o,access:s,directory:a,meta:l,headsStorage:c,entryStorage:u,indexStorage:h,referencesCount:d,syncAutomatically:f,onUpdate:p}=t;const g=await LN({ipfs:n,identity:r,address:i,name:o,access:s,directory:a,meta:l,headsStorage:c,entryStorage:u,indexStorage:h,referencesCount:d,syncAutomatically:f}),{addOperation:y,log:v}=g,m=async e=>{for await(const t of w())if(e===t.key)return t},w=function(){try{let{amount:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async function*(){const t={};let n=0;for await(const r of v.iterator()){const{op:i,key:o,value:s}=r.payload;if("PUT"!==i||t[o])"DEL"!==i||t[o]||(t[o]=!0);else{t[o]=!0,n++;const e=r.hash;yield{hash:e,key:o,value:s}}if(n>=e)break}}()}catch(e){return Promise.reject(e)}};return{...g,type:ON,put:async t=>{const n=t[e];if(!n)throw new Error("The provided document doesn't contain field '".concat(e,"'"));return y({op:"PUT",key:n,value:t})},del:async e=>{if(!await m(e))throw new Error("No document with key '".concat(e,"' in the database"));return y({op:"DEL",key:e,value:null})},get:m,iterator:w,query:async e=>{const t=[];for await(const n of w())e(n.value)&&t.push(n.value);return t},indexBy:e,all:async()=>{const e=[];for await(const t of w())e.unshift(t);return e}}}};UN.type=ON;const FN=UN,VN="events",zN=()=>async e=>{let{ipfs:t,identity:n,address:r,name:i,access:o,directory:s,meta:a,headsStorage:l,entryStorage:c,indexStorage:u,referencesCount:h,syncAutomatically:d,onUpdate:f}=e;const p=await LN({ipfs:t,identity:n,address:r,name:i,access:o,directory:s,meta:a,headsStorage:l,entryStorage:c,indexStorage:u,referencesCount:h,syncAutomatically:d,onUpdate:f}),{addOperation:g,log:y}=p,v=function(){try{let{gt:e,gte:t,lt:n,lte:r,amount:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async function*(){const o=y.iterator({gt:e,gte:t,lt:n,lte:r,amount:i});for await(const e of o){const t=e.hash,n=e.payload.value;yield{hash:t,value:n}}}()}catch(e){return Promise.reject(e)}};return{...p,type:VN,add:async e=>g({op:"ADD",key:null,value:e}),get:async e=>(await y.get(e)).payload.value,iterator:v,all:async()=>{const e=[];for await(const t of v())e.unshift(t);return e}}};zN.type=VN;const KN=zN,jN="keyvalue",HN=()=>async e=>{let{ipfs:t,identity:n,address:r,name:i,access:o,directory:s,meta:a,headsStorage:l,entryStorage:c,indexStorage:u,referencesCount:h,syncAutomatically:d,onUpdate:f}=e;const p=await LN({ipfs:t,identity:n,address:r,name:i,access:o,directory:s,meta:a,headsStorage:l,entryStorage:c,indexStorage:u,referencesCount:h,syncAutomatically:d,onUpdate:f}),{addOperation:g,log:y}=p,v=async(e,t)=>g({op:"PUT",key:e,value:t}),m=function(){try{let{amount:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async function*(){const t={};let n=0;for await(const r of y.traverse()){const{op:i,key:o,value:s}=r.payload;if("PUT"!==i||t[o])"DEL"!==i||t[o]||(t[o]=!0);else{t[o]=!0,n++;const e=r.hash;yield{key:o,value:s,hash:e}}if(n>=e)break}}()}catch(e){return Promise.reject(e)}};return{...p,type:jN,put:v,set:v,del:async e=>g({op:"DEL",key:e,value:null}),get:async e=>{for await(const t of y.traverse()){const{op:n,key:r,value:i}=t.payload;if("PUT"===n&&r===e)return i;if("DEL"===n&&r===e)return}},iterator:m,all:async()=>{const e=[];for await(const t of m())e.unshift(t);return e}}};HN.type=jN;const qN=HN,WN="json",GN=()=>async e=>{let{ipfs:t,identity:n,address:r,name:i,access:o,directory:s,meta:a,headsStorage:l,entryStorage:c,indexStorage:u,referencesCount:h,syncAutomatically:d,onUpdate:f}=e;s=ZP(s||"./orbitdb","./".concat(r,"/_index/"));const p=await function(){let{directory:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async()=>{const t=await PN({path:e,valueEncoding:WN}),n=await PN({path:ZP(e,"/_indexedEntries/"),valueEncoding:WN});return{get:t.get,iterator:t.iterator,update:async(e,r)=>{const i=new Set,o=new Set,s=r.hash,a=async e=>!0===await n.get(e),l=async e=>!await a(e),c=async e=>{for await(const t of e.next)await l(t)&&o.add(t);return await a(s)&&0===o.size};for await(const u of e.traverse(null,c)){const{hash:e,payload:r}=u;if(await l(e)){const{op:s,key:a}=r;"PUT"!==s||i.has(a)?"DEL"!==s||i.has(a)||(i.add(a),await t.del(a),await n.put(e,!0)):(i.add(a),await t.put(a,u),await n.put(e,!0)),o.delete(e)}}},close:async()=>{await t.close(),await n.close()},drop:async()=>{await t.clear(),await n.clear()}}}}({directory:s})(),g=await qN()({ipfs:t,identity:n,address:r,name:i,access:o,directory:s,meta:a,headsStorage:l,entryStorage:c,indexStorage:u,referencesCount:h,syncAutomatically:d,onUpdate:p.update});return{...g,get:async e=>{const t=await p.get(e);if(t)return t.payload.value},iterator:function(){try{let{amount:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async function*(){const t=p.iterator({amount:e,reverse:!0});for await(const e of t){const t=e[1],{key:n,value:r}=t.payload,i=t.hash;yield{key:n,value:r,hash:i}}}()}catch(e){return Promise.reject(e)}},close:async()=>{await g.close(),await p.close()},drop:async()=>{await g.drop(),await p.drop()}}};GN.type="keyvalue";const YN={},QN=e=>{if(!e.type)throw new Error("Database type does not contain required field 'type'.");YN[e.type]=e};QN(KN),QN(FN),QN(qN);n(9353);var XN=n(45);const JN={get(){const e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:globalThis).crypto;if(null==e||null==e.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}};n(5465),n(3555);new Uint8Array(0);function $N(e){if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")}var ZN=function(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<e.length;i++){var o=e.charAt(i),s=o.charCodeAt(0);if(255!==n[s])throw new TypeError(o+" is ambiguous");n[s]=i}var a=e.length,l=e.charAt(0),c=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if("string"!==typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){for(var r=0,i=0;e[t]===l;)r++,t++;for(var o=(e.length-t)*c+1>>>0,s=new Uint8Array(o);e[t];){var u=n[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=o-1;(0!==u||h<i)&&-1!==d;d--,h++)u+=a*s[d]>>>0,s[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=h,t++}if(" "!==e[t]){for(var f=o-i;f!==o&&0===s[f];)f++;for(var p=new Uint8Array(r+(o-f)),g=r;f!==o;)p[g++]=s[f++];return p}}}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,i=0,o=t.length;i!==o&&0===t[i];)i++,n++;for(var s=(o-i)*u+1>>>0,c=new Uint8Array(s);i!==o;){for(var h=t[i],d=0,f=s-1;(0!==h||d<r)&&-1!==f;f--,d++)h+=256*c[f]>>>0,c[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");r=d,i++}for(var p=s-r;p!==s&&0===c[p];)p++;for(var g=l.repeat(n);p<s;++p)g+=e.charAt(c[p]);return g},decodeUnsafe:h,decode:function(e){var n=h(e);if(n)return n;throw new Error("Non-".concat(t," character"))}}};const eB=ZN;class tB{constructor(e,t,n){je(this,"name",void 0),je(this,"prefix",void 0),je(this,"baseEncode",void 0),this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return"".concat(this.prefix).concat(this.baseEncode(e));throw Error("Unknown type, must be binary type")}}class nB{constructor(e,t,n){if(je(this,"name",void 0),je(this,"prefix",void 0),je(this,"baseDecode",void 0),je(this,"prefixCodePoint",void 0),this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if("string"===typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error("Unable to decode multibase string ".concat(JSON.stringify(e),", ").concat(this.name," decoder only supports inputs prefixed with ").concat(this.prefix));return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return iB(this,e)}}class rB{constructor(e){je(this,"decoders",void 0),this.decoders=e}or(e){return iB(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(null!=n)return n.decode(e);throw RangeError("Unable to decode multibase string ".concat(JSON.stringify(e),", only inputs prefixed with ").concat(Object.keys(this.decoders)," are supported"))}}function iB(e,t){var n,r;return new rB({...null!==(n=e.decoders)&&void 0!==n?n:{[e.prefix]:e},...null!==(r=t.decoders)&&void 0!==r?r:{[t.prefix]:t}})}class oB{constructor(e,t,n,r){je(this,"name",void 0),je(this,"prefix",void 0),je(this,"baseEncode",void 0),je(this,"baseDecode",void 0),je(this,"encoder",void 0),je(this,"decoder",void 0),this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new tB(e,t,n),this.decoder=new nB(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function sB(e){let{name:t,prefix:n,encode:r,decode:i}=e;return new oB(t,n,r,i)}function aB(e){let{name:t,prefix:n,alphabet:r}=e;const{encode:i,decode:o}=eB(r,t);return sB({prefix:n,name:t,encode:i,decode:e=>$N(o(e))})}function lB(e){let{name:t,prefix:n,bitsPerChar:r,alphabet:i}=e;return sB({prefix:n,name:t,encode:e=>function(e,t,n){const r="="===t[t.length-1],i=(1<<n)-1;let o="",s=0,a=0;for(let l=0;l<e.length;++l)for(a=a<<8|e[l],s+=8;s>n;)s-=n,o+=t[i&a>>s];if(0!==s&&(o+=t[i&a<<n-s]),r)for(;0!==(o.length*n&7);)o+="=";return o}(e,i,r),decode:e=>function(e,t,n,r){const i={};for(let u=0;u<t.length;++u)i[t[u]]=u;let o=e.length;for(;"="===e[o-1];)--o;const s=new Uint8Array(o*n/8|0);let a=0,l=0,c=0;for(let u=0;u<o;++u){const t=i[e[u]];if(void 0===t)throw new SyntaxError("Non-".concat(r," character"));l=l<<n|t,a+=n,a>=8&&(a-=8,s[c++]=255&l>>a)}if(a>=n||0!==(255&l<<8-a))throw new SyntaxError("Unexpected end of data");return s}(e,i,r,t)})}const cB=aB({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"});aB({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var uB=function e(t,n,r){n=n||[];var i=r=r||0;for(;t>=fB;)n[r++]=255&t|hB,t/=128;for(;t&dB;)n[r++]=255&t|hB,t>>>=7;return n[r]=0|t,e.bytes=r-i+1,n},hB=128,dB=-128,fB=Math.pow(2,31);var pB=function e(t,n){var r,i=0,o=0,s=n=n||0,a=t.length;do{if(s>=a)throw e.bytes=0,new RangeError("Could not decode varint");r=t[s++],i+=o<28?(r&yB)<<o:(r&yB)*Math.pow(2,o),o+=7}while(r>=gB);return e.bytes=s-n,i},gB=128,yB=127;var vB=Math.pow(2,7),mB=Math.pow(2,14),wB=Math.pow(2,21),bB=Math.pow(2,28),EB=Math.pow(2,35),_B=Math.pow(2,42),SB=Math.pow(2,49),kB=Math.pow(2,56),AB=Math.pow(2,63);const IB={encode:uB,decode:pB,encodingLength:function(e){return e<vB?1:e<mB?2:e<wB?3:e<bB?4:e<EB?5:e<_B?6:e<SB?7:e<kB?8:e<AB?9:10}};function TB(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return IB.encode(e,t,n),t}function RB(e){return IB.encodingLength(e)}function CB(e,t){const n=t.byteLength,r=RB(e),i=r+RB(n),o=new Uint8Array(i+n);return TB(e,o,0),TB(n,o,r),o.set(t,i),new xB(e,n,t,o)}class xB{constructor(e,t,n,r){je(this,"code",void 0),je(this,"size",void 0),je(this,"digest",void 0),je(this,"bytes",void 0),this.code=e,this.size=t,this.digest=n,this.bytes=r}}const PB=$N;const DB={code:0,name:"identity",encode:PB,digest:function(e){return CB(0,PB(e))}};function NB(e){let{name:t,code:n,encode:r}=e;return new BB(t,n,r)}class BB{constructor(e,t,n){je(this,"name",void 0),je(this,"code",void 0),je(this,"encode",void 0),this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?CB(this.code,t):t.then((e=>CB(this.code,e)))}throw Error("Unknown type, must be binary type")}}function LB(e){return async t=>new Uint8Array(await crypto.subtle.digest(e,t))}const OB=NB({name:"sha2-256",code:18,encode:LB("SHA-256")});NB({name:"sha2-512",code:19,encode:LB("SHA-512")});n(3900),n(9463);function MB(e,t){let n=Uint8Array.from(e.abs().toByteArray());if(n=0===n[0]?n.subarray(1):n,null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=Wo([new Uint8Array(t-n.length),n])}return vr(n,"base64url")}function UB(e){const t=FB(e);return new XN.jsbn.BigInteger(vr(t,"base16"),16)}function FB(e,t){let n=yr(e,"base64urlpad");if(null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=Wo([new Uint8Array(t-n.length),n])}return n}function VB(e){return null!=e&&("function"===typeof e.then&&"function"===typeof e.catch&&"function"===typeof e.finally)}const zB=32,KB=64,jB=32;function HB(e,t){const n=new Uint8Array(KB);for(let r=0;r<jB;r++)n[r]=e[r],n[jB+r]=t[r];return n}const qB=lB({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),WB=(lB({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),lB({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),lB({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),{alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"});function GB(e){var t,n,r,i,o,s;const a=null!==(t=null===e||void 0===e?void 0:e.algorithm)&&void 0!==t?t:"AES-GCM";let l=null!==(n=null===e||void 0===e?void 0:e.keyLength)&&void 0!==n?n:16;const c=null!==(r=null===e||void 0===e?void 0:e.nonceLength)&&void 0!==r?r:12,u=null!==(i=null===e||void 0===e?void 0:e.digest)&&void 0!==i?i:"SHA-256",h=null!==(o=null===e||void 0===e?void 0:e.saltLength)&&void 0!==o?o:16,d=null!==(s=null===e||void 0===e?void 0:e.iterations)&&void 0!==s?s:32767,f=JN.get();l*=8;return{encrypt:async function(e,t){const n=f.getRandomValues(new Uint8Array(h)),r=f.getRandomValues(new Uint8Array(c)),i={name:a,iv:r};let o;if("string"===typeof t&&(t=yr(t)),0===t.length){o=await f.subtle.importKey("jwk",WB,{name:"AES-GCM"},!0,["encrypt"]);try{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);o=await f.subtle.deriveKey(e,r,{name:a,length:l},!0,["encrypt"])}catch{o=await f.subtle.importKey("jwk",WB,{name:"AES-GCM"},!0,["encrypt"])}}else{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);o=await f.subtle.deriveKey(e,r,{name:a,length:l},!0,["encrypt"])}const s=await f.subtle.encrypt(i,o,e);return Wo([n,i.iv,new Uint8Array(s)])},decrypt:async function(e,t){const n=e.subarray(0,h),r=e.subarray(h,h+c),i=e.subarray(h+c),o={name:a,iv:r};let s;if("string"===typeof t&&(t=yr(t)),0===t.length)try{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);s=await f.subtle.deriveKey(e,r,{name:a,length:l},!0,["decrypt"])}catch{s=await f.subtle.importKey("jwk",WB,{name:"AES-GCM"},!0,["decrypt"])}else{const e={name:"PBKDF2",salt:n,iterations:d,hash:{name:u}},r=await f.subtle.importKey("raw",t,{name:"PBKDF2"},!1,["deriveKey"]);s=await f.subtle.deriveKey(e,r,{name:a,length:l},!0,["decrypt"])}const p=await f.subtle.decrypt(o,s,i);return new Uint8Array(p)}}}async function YB(e,t){const n=GB(),r=await n.encrypt(e,t);return qB.encode(r)}var QB,XB,JB,$B;!function(e){e.RSA="RSA",e.Ed25519="Ed25519",e.Secp256k1="Secp256k1"}(QB||(QB={})),function(e){e[e.RSA=0]="RSA",e[e.Ed25519=1]="Ed25519",e[e.Secp256k1=2]="Secp256k1"}(XB||(XB={})),function(e){e.codec=()=>Gs(XB)}(QB||(QB={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),QB.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.Type=QB.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(JB||(JB={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),QB.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.Type=QB.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}($B||($B={}));class ZB{constructor(e){je(this,"_key",void 0),this._key=oL(e,zB)}verify(e,t){return function(e,t,n){return Uo.verify(t,n instanceof Uint8Array?n:n.subarray(),e)}(this._key,t,e)}marshal(){return this._key}get bytes(){return JB.encode({Type:QB.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Hr(this.bytes,e.bytes)}hash(){const e=OB.digest(this.bytes);return VB(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}}class eL{constructor(e,t){je(this,"_key",void 0),je(this,"_publicKey",void 0),this._key=oL(e,KB),this._publicKey=oL(t,zB)}sign(e){return function(e,t){const n=e.subarray(0,jB);return Uo.sign(t instanceof Uint8Array?t:t.subarray(),n)}(this._key,e)}get public(){return new ZB(this._publicKey)}marshal(){return this._key}get bytes(){return $B.encode({Type:QB.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Hr(this.bytes,e.bytes)}async hash(){const e=OB.digest(this.bytes);let t;return VB(e)?({bytes:t}=await e):t=e.bytes,t}async id(){const e=DB.digest(this.public.bytes);return cB.encode(e.bytes).substring(1)}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"libp2p-key";if("libp2p-key"===t)return YB(this.bytes,e);throw new Mr("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}function tL(e){if(e.length>KB){const t=(e=oL(e,KB+zB)).subarray(0,KB),n=e.subarray(KB,e.length);return new eL(t,n)}const t=(e=oL(e,KB)).subarray(0,KB),n=e.subarray(zB);return new eL(t,n)}function nL(e){return e=oL(e,zB),new ZB(e)}async function rL(){const{privateKey:e,publicKey:t}=function(){const e=Uo.utils.randomPrivateKey(),t=Uo.getPublicKey(e);return{privateKey:HB(e,t),publicKey:t}}();return new eL(e,t)}async function iL(e){const{privateKey:t,publicKey:n}=function(e){if(e.length!==jB)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,n=Uo.getPublicKey(t);return{privateKey:HB(t,n),publicKey:n}}(e);return new eL(t,n)}function oL(e,t){var n;if((e=Uint8Array.from(null!==(n=e)&&void 0!==n?n:[])).length!==t)throw new Mr("Key must be a Uint8Array of length ".concat(t,", got ").concat(e.length),"ERR_INVALID_KEY_TYPE");return e}const sL={"P-256":256,"P-384":384,"P-521":521};Object.keys(sL).join(" / ");n(8138);n(9408);function aL(e,t){return t.map((t=>UB(e[t])))}async function lL(e){const t=[await JN.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),await uL(e)],n=await cL({privateKey:t[0],publicKey:t[1]});return{privateKey:n[0],publicKey:n[1]}}async function cL(e){if(null==e.privateKey||null==e.publicKey)throw new Mr("Private and public key are required","ERR_INVALID_PARAMETERS");return Promise.all([JN.get().subtle.exportKey("jwk",e.privateKey),JN.get().subtle.exportKey("jwk",e.publicKey)])}async function uL(e){return JN.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function hL(e,t,n,r){const i=t?function(e){return XN.pki.setRsaPublicKey(...aL(e,["n","e"]))}(e):function(e){return XN.pki.setRsaPrivateKey(...aL(e,["n","e","d","p","q","dp","dq","qi"]))}(e);return yr(r(vr(n instanceof Uint8Array?n:n.subarray(),"ascii"),i),"ascii")}function dL(e){if("RSA"!==e.kty)throw new Mr("invalid key type","ERR_INVALID_KEY_TYPE");if(null==e.n)throw new Mr("invalid key modulus","ERR_INVALID_KEY_MODULUS");return 8*yr(e.n,"base64url").length}const fL=8192;class pL{constructor(e){je(this,"_key",void 0),this._key=e}verify(e,t){return async function(e,t,n){const r=await JN.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return JN.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},r,t,n instanceof Uint8Array?n:n.subarray())}(this._key,t,e)}marshal(){return function(e){if(null==e.n||null==e.e)throw new Mr("JWK was missing components","ERR_INVALID_PARAMETERS");const t=XN.pki.publicKeyToAsn1({n:UB(e.n),e:UB(e.e)});return yr(XN.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return JB.encode({Type:QB.RSA,Data:this.marshal()}).subarray()}encrypt(e){return hL(this._key,!0,e,((e,t)=>t.encrypt(e)))}equals(e){return Hr(this.bytes,e.bytes)}hash(){const e=OB.digest(this.bytes);return VB(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}}class gL{constructor(e,t){je(this,"_key",void 0),je(this,"_publicKey",void 0),this._key=e,this._publicKey=t}genSecret(){return function(e){if(isNaN(e)||e<=0)throw new Mr("random bytes length must be a Number bigger than 0","ERR_INVALID_LENGTH");return ci(e)}(16)}sign(e){return async function(e,t){const n=await JN.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),r=await JN.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,t instanceof Uint8Array?t:t.subarray());return new Uint8Array(r,0,r.byteLength)}(this._key,e)}get public(){if(null==this._publicKey)throw new Mr("public key not provided","ERR_PUBKEY_NOT_PROVIDED");return new pL(this._publicKey)}decrypt(e){return hL(this._key,!1,e,((e,t)=>t.decrypt(e)))}marshal(){return function(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw new Mr("JWK was missing components","ERR_INVALID_PARAMETERS");const t=XN.pki.privateKeyToAsn1({n:UB(e.n),e:UB(e.e),d:UB(e.d),p:UB(e.p),q:UB(e.q),dP:UB(e.dp),dQ:UB(e.dq),qInv:UB(e.qi)});return yr(XN.asn1.toDer(t).getBytes(),"ascii")}(this._key)}get bytes(){return $B.encode({Type:QB.RSA,Data:this.marshal()}).subarray()}equals(e){return Hr(this.bytes,e.bytes)}hash(){const e=OB.digest(this.bytes);return VB(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}async id(){return vr(await this.public.hash(),"base58btc")}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"pkcs-8";if("pkcs-8"===t){const t=new XN.util.ByteBuffer(this.marshal()),n=XN.asn1.fromDer(t),r=XN.pki.privateKeyFromAsn1(n),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return XN.pki.encryptRsaPrivateKey(r,e,i)}if("libp2p-key"===t)return YB(this.bytes,e);throw new Mr("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}async function yL(e){const t=function(e){const t=XN.asn1.fromDer(vr(e,"ascii")),n=XN.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:MB(n.n),e:MB(n.e),d:MB(n.d),p:MB(n.p),q:MB(n.q),dp:MB(n.dP),dq:MB(n.dQ),qi:MB(n.qInv),alg:"RS256"}}(e);if(dL(t)>fL)throw new Mr("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const n=await lL(t);return new gL(n.privateKey,n.publicKey)}function vL(e){const t=function(e){const t=XN.asn1.fromDer(vr(e,"ascii")),n=XN.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:MB(n.n),e:MB(n.e)}}(e);if(dL(t)>fL)throw new Mr("key size is too large","ERR_KEY_SIZE_TOO_LARGE");return new pL(t)}async function mL(e){if(dL(e)>fL)throw new Mr("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await lL(e);return new gL(t.privateKey,t.publicKey)}async function wL(e){if(e>fL)throw new Mr("key size is too large","ERR_KEY_SIZE_TOO_LARGE");const t=await async function(e){const t=await JN.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),n=await cL(t);return{privateKey:n[0],publicKey:n[1]}}(e);return new gL(t.privateKey,t.publicKey)}function bL(e){try{eu.ProjectivePoint.fromHex(e)}catch(t){throw new Mr(String(t),"ERR_INVALID_PUBLIC_KEY")}}class EL{constructor(e){je(this,"_key",void 0),bL(e),this._key=e}verify(e,t){return function(e,t,n){const r=OB.digest(n instanceof Uint8Array?n:n.subarray());if(VB(r))return r.then((n=>{let{digest:r}=n;return eu.verify(t,r,e)})).catch((e=>{throw new Mr(String(e),"ERR_INVALID_INPUT")}));try{return eu.verify(t,r.digest,e)}catch(i){throw new Mr(String(i),"ERR_INVALID_INPUT")}}(this._key,t,e)}marshal(){return e=this._key,eu.ProjectivePoint.fromHex(e).toRawBytes(!0);var e}get bytes(){return JB.encode({Type:QB.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Hr(this.bytes,e.bytes)}async hash(){const e=OB.digest(this.bytes);let t;return VB(e)?({bytes:t}=await e):t=e.bytes,t}}class _L{constructor(e,t){je(this,"_key",void 0),je(this,"_publicKey",void 0),this._key=e,this._publicKey=null!==t&&void 0!==t?t:function(e){try{return eu.getPublicKey(e,!0)}catch(t){throw new Mr(String(t),"ERR_INVALID_PRIVATE_KEY")}}(e),function(e){try{eu.getPublicKey(e,!0)}catch(t){throw new Mr(String(t),"ERR_INVALID_PRIVATE_KEY")}}(this._key),bL(this._publicKey)}sign(e){return function(e,t){const n=OB.digest(t instanceof Uint8Array?t:t.subarray());if(VB(n))return n.then((t=>{let{digest:n}=t;return eu.sign(n,e).toDERRawBytes()})).catch((e=>{throw new Mr(String(e),"ERR_INVALID_INPUT")}));try{return eu.sign(n.digest,e).toDERRawBytes()}catch(r){throw new Mr(String(r),"ERR_INVALID_INPUT")}}(this._key,e)}get public(){return new EL(this._publicKey)}marshal(){return this._key}get bytes(){return $B.encode({Type:QB.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Hr(this.bytes,e.bytes)}hash(){const e=OB.digest(this.bytes);return VB(e)?e.then((e=>{let{bytes:t}=e;return t})):e.bytes}async id(){return vr(await this.public.hash(),"base58btc")}async export(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"libp2p-key";if("libp2p-key"===t)return YB(this.bytes,e);throw new Mr("export format '".concat(t,"' is not supported"),"ERR_INVALID_EXPORT_FORMAT")}}function SL(e){return new _L(e)}function kL(e){return new EL(e)}async function AL(){const e=eu.utils.randomPrivateKey();return new _L(e)}const IL={rsa:S,ed25519:_,secp256k1:k};function TL(e){const t=Object.keys(IL).join(" / ");return new Mr("invalid or unsupported key type ".concat(e,". Must be ").concat(t),"ERR_UNSUPPORTED_KEY_TYPE")}function RL(e){if("rsa"===(e=e.toLowerCase())||"ed25519"===e||"secp256k1"===e)return IL[e];throw TL(e)}async function CL(e){var t,n;const r=$B.decode(e),i=null!==(t=r.Data)&&void 0!==t?t:new Uint8Array;switch(r.Type){case QB.RSA:return IL.rsa.unmarshalRsaPrivateKey(i);case QB.Ed25519:return IL.ed25519.unmarshalEd25519PrivateKey(i);case QB.Secp256k1:return IL.secp256k1.unmarshalSecp256k1PrivateKey(i);default:throw TL(null!==(n=r.Type)&&void 0!==n?n:"RSA")}}n(8009);const xL=IL.secp256k1.unmarshalSecp256k1PrivateKey,PL=IL.secp256k1.unmarshalSecp256k1PublicKey,DL=async(e,t)=>{if(!e)throw new Error("No signing key given");if(!t)throw new Error("Given input data was undefined");return t instanceof Uint8Array||(t="string"===typeof t?yr(t):new Uint8Array(t)),vr(await e.sign(t),"base16")},NL=NN({size:1e3}),BL=async(e,t,n)=>{const r=await NL,i=await r.get(e);let o=!1;if(i){const e=(e,t)=>t instanceof Uint8Array?0===Lk(e,t):e.toString()===t.toString();o=i.publicKey===t&&e(i.data,n)}else{const i=await(async(e,t,n)=>{if(!e)throw new Error("No signature given");if(!t)throw new Error("Given publicKey was undefined");if(!n)throw new Error("Given input data was undefined");n instanceof Uint8Array||(n="string"===typeof n?yr(n):new Uint8Array(n));let r=!1;try{const a=PL(yr(t,"base16"));r=await(i=a,o=n,s=yr(e,"base16"),i.verify(o,s))}catch(a){}var i,o,s;return Promise.resolve(r)})(e,t,n);o=i,i&&await r.put(e,{publicKey:t,data:n})}return o},LL=async function(){let{storage:e,path:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=e||await CN(await NN({size:1e3}),await PN({path:t||"./keystore"}));const n=async(t,n)=>{await e.put("private_"+t,n.privateKey)};return{clear:async()=>{await e.clear()},close:async()=>{await e.close()},hasKey:async t=>{if(!t)throw new Error("id needed to check a key");let n=!1;try{const r=await e.get("private_"+t);n=void 0!==r&&null!==r}catch(r){console.error("Error: ENOENT: no such file or directory")}return n},addKey:n,createKey:async e=>{if(!e)throw new Error("id needed to create a key");const t=await async function(e,t){return RL(e).generateKeyPair(null!==t&&void 0!==t?t:2048)}("secp256k1"),r=await CL(t.bytes),i={publicKey:r.public.marshal(),privateKey:r.marshal()};return await n(e,i),r},getKey:async t=>{if(!t)throw new Error("id needed to get a key");let n;try{n=await e.get("private_"+t)}catch(r){}if(n)return xL(n)},getPublic:function(e){const t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).format||"hex";if(-1===["hex","buffer"].indexOf(t))throw new Error("Supported formats are `hex` and `buffer`");const n=e.public.marshal();return"buffer"===t?n:vr(n,"base16")}}},OL=b,ML=aN,UL=yD,FL=async function(){let{id:e,publicKey:t,signatures:n,type:r,sign:i,verify:o}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e)throw new Error("Identity id is required");if(!t)throw new Error("Invalid public key");if(!n)throw new Error("Signatures object is required");if(!n.id)throw new Error("Signature of id is required");if(!n.publicKey)throw new Error("Signature of publicKey+id is required");if(!r)throw new Error("Identity type is required");n=Object.assign({},n);const s={id:e,publicKey:t,signatures:n,type:r,sign:i,verify:o},{hash:a,bytes:l}=await VL(s);return s.hash=a,s.bytes=l,s},VL=async e=>{const{id:t,publicKey:n,signatures:r,type:i}=e,o={id:t,publicKey:n,signatures:r,type:i},{cid:s,bytes:a}=await iN({value:o,codec:OL,hasher:ML});return{hash:s.toString(UL),bytes:Uint8Array.from(a)}},zL="publickey",KL=e=>{let{keystore:t}=e;return async()=>{if(!t)throw new Error("PublicKeyIdentityProvider requires a keystore parameter");return{type:zL,getId:async function(){let{id:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!e)throw new Error("id is required");return vr((await t.getKey(e)||await t.createKey(e)).public.marshal(),"base16")},signIdentity:async function(e){let{id:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!n)throw new Error("id is required");const r=await t.getKey(n);if(!r)throw new Error("Signing key for '".concat(n,"' not found"));return DL(r,e)}}}};KL.verifyIdentity=async e=>{const{id:t,publicKey:n,signatures:r}=e;return BL(r.publicKey,t,n+r.id)},KL.type=zL;const jL={},HL=e=>{if(!(e=>Object.keys(jL).includes(e))(e))throw new Error("IdentityProvider type '".concat(e,"' is not supported"));return jL[e]};(e=>{if(!e.type||"string"!==typeof e.type)throw new Error("Given IdentityProvider doesn't have a field 'type'.");if(!e.verifyIdentity)throw new Error("Given IdentityProvider doesn't have a function 'verifyIdentity'.");jL[e.type]=e})(KL);const qL=ZP("./orbitdb","identities"),WL=async function(){let{keystore:e,path:t,storage:n,ipfs:r}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=e||await LL({path:t||qL}),n||(n=r?await CN(await NN({size:1e3}),await xN({ipfs:r,pin:!0})):await vN());const i=await NN({size:1e3}),o=async(t,n)=>{const r=await e.getKey(t.id);if(!r)throw new Error("Private signing key not found from KeyStore");return await DL(r,n)},s=async(e,t,n)=>await BL(e,t,n);return{createIdentity:async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.keystore=e;const r=HL("publickey"),i=t.provider||r({keystore:e}),a=await i();if(!HL(a.type))throw new Error("Identity provider is unknown. Use useIdentityProvider(provider) to register the identity provider");const l=await a.getId(t),c=await e.getKey(l)||await e.createKey(l),u=e.getPublic(c),h=await DL(c,l),d={id:h,publicKey:await a.signIdentity(u+h,t)},f=await FL({id:l,publicKey:u,signatures:d,type:a.type,sign:o,verify:s});return await n.put(f.hash,f.bytes),f},verifyIdentity:async e=>{if(!(e=>Boolean(e.id&&e.hash&&e.bytes&&e.publicKey&&e.signatures&&e.signatures.id&&e.signatures.publicKey&&e.type))(e))return!1;const{id:t,publicKey:n,signatures:r}=e;if(!await s(r.id,n,t))return!1;const o=await i.get(r.id);if(o)return l=o,(a=e).id===l.id&&a.hash===l.hash&&a.type===l.type&&a.publicKey===l.publicKey&&a.signatures.id===l.signatures.id&&a.signatures.publicKey===l.signatures.publicKey;var a,l;const c=HL(e.type),u=await c.verifyIdentity(e);return u&&await i.put(r.id,e),u},getIdentity:async e=>{const t=await n.get(e);if(t)return(async e=>{const{value:t}=await oN({bytes:e,codec:OL,hasher:ML});return FL({...t})})(t)},sign:o,verify:s,keystore:e}},GL=e=>{if(!(e=e.toString()).startsWith("/orbitdb")&&!e.startsWith("\\orbitdb"))return!1;let t;e=(e=(e=(e=e.replaceAll("/orbitdb/","")).replaceAll("\\orbitdb\\","")).replaceAll("/","")).replaceAll("\\","");try{t=KD.parse(e,yD)}catch(n){return!1}return void 0!==t},YL=e=>{if(e&&"orbitdb"===e.protocol&&e.hash)return e;const t="orbitdb",n=e.replace("/orbitdb/","").replace("\\orbitdb\\","");return{protocol:t,hash:n,address:e,toString:()=>$P("/",t,n)}},QL=b,XL=aN,JL=yD,$L=async function(){let{ipfs:e,storage:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t=t||await CN(await NN({size:1e3}),await xN({ipfs:e,pin:!0}));return{get:async e=>{const n=await t.get(e),{value:r}=await oN({bytes:n,codec:QL,hasher:XL});return r},create:async e=>{let{name:n,type:r,accessController:i,meta:o}=e;if(!n)throw new Error("name is required");if(!r)throw new Error("type is required");if(!i)throw new Error("accessController is required");const s=Object.assign({name:n,type:r,accessController:i},void 0!==o?{meta:o}:{}),{cid:a,bytes:l}=await iN({value:s,codec:QL,hasher:XL}),c=a.toString(JL);return await t.put(c,l),{hash:c,manifest:s}},close:async()=>{await t.close()}}},ZL=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32;const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="",r=0;for(;r<e;)n+=t.charAt(Math.floor(62*Math.random())),r+=1;return n},eO=b,tO=aN,nO=yD,rO="ipfs",iO=function(){let{write:e,storage:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async n=>{let{orbitdb:r,identities:i,address:o}=n;if(t=t||await CN(await NN({size:1e3}),await xN({ipfs:r.ipfs,pin:!0})),e=e||[r.identity.id],o){const n=await t.get(o.replaceAll("/ipfs/","")),{value:r}=await oN({bytes:n,codec:eO,hasher:tO});e=r.write}else o=await(async e=>{let{storage:t,type:n,params:r}=e;const i={type:n,...r},{cid:o,bytes:s}=await iN({value:i,codec:eO,hasher:tO}),a=o.toString(nO);return await t.put(a,s),a})({storage:t,type:rO,params:{write:e}}),o=ZP("/",rO,o);return{type:rO,address:o,write:e,canAppend:async t=>{const n=await i.getIdentity(t.identity);if(!n)return!1;const{id:r}=n;return!(!e.includes(r)&&!e.includes("*"))&&i.verifyIdentity(n)}}}};iO.type=rO;const oO=iO,sO="orbitdb",aO=function(){let{write:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async t=>{let{orbitdb:n,identities:r,address:i,name:o}=t;i=i||o||await ZL(64),e=e||[n.identity.id];const s=await n.open(i,{type:"keyvalue",AccessController:oO({write:e})});i=s.address;const a=async()=>{const e=[];for await(const t of s.iterator())e[t.key]=t.value;return Object.entries({...e,admin:new Set([...e.admin||[],...s.access.write])}).forEach((t=>{const n=t[0];e[n]=new Set([...e[n]||[],...t[1]])})),e},l=async e=>(await a())[e]||new Set([]),c=async(e,t)=>{const n=new Set(await l(e));return n.has(t)||n.has("*")};return{type:sO,address:i,write:e,canAppend:async e=>{const t=await r.getIdentity(e.identity);if(!t)return!1;const{id:n}=t;return!(!await c("write",n)&&!await c("admin",n))&&r.verifyIdentity(t)},capabilities:a,get:l,grant:async(e,t)=>{const n=new Set([...await s.get(e)||[],t]);await s.put(e,Array.from(n.values()))},revoke:async(e,t)=>{const n=new Set(await s.get(e)||[]);n.delete(t),n.size>0?await s.put(e,Array.from(n.values())):await s.del(e)},close:async()=>{await s.close()},drop:async()=>{await s.drop()},events:s.events}}};aO.type=sO;const lO=aO,cO={},uO=e=>{if(!e.type)throw new Error("AccessController does not contain required field 'type'.");cO[e.type]=e};uO(oO),uO(lO);const hO=oO,dO=async function(){let{ipfs:e,id:t,identity:n,identities:r,directory:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(null==e)throw new Error("IPFS instance is a required argument.");t=t||await ZL();const o=e.libp2p.peerId;let s;i=i||"./orbitdb",r?s=r.keystore:(s=await LL({path:ZP(i,"./keystore")}),r=await WL({ipfs:e,keystore:s})),n?n.provider&&(n=await r.createIdentity({...n})):n=await r.createIdentity({id:t});const a=await $L({ipfs:e});let l={};const c=async function(t){let o,s,h,{type:d,meta:f,sync:p,Database:g,AccessController:y,headsStorage:v,entryStorage:m,indexStorage:w,referencesCount:b}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(l[t])return l[t];if(GL(t)){const i=YL(t);s=await a.get(i.hash);y=(e=>{if(!cO[e])throw new Error("AccessController type '".concat(e,"' is not supported"));return cO[e]})(s.accessController.split("/",2).pop())(),h=await y({orbitdb:{open:c,identity:n,ipfs:e},identities:r,address:s.accessController}),o=s.name,d=d||s.type,f=s.meta}else{d=d||"events",y=y||hO(),h=await y({orbitdb:{open:c,identity:n,ipfs:e},identities:r,name:t});const i=await a.create({name:t,type:d,accessController:h.address,meta:f});if(s=i.manifest,t=YL(i.hash),o=s.name,f=s.meta,l[t])return l[t]}if(g=g||(e=>{if(!e)throw new Error("Type not specified");if(!YN[e])throw new Error("Unsupported database type: '".concat(e,"'"));return YN[e]})(d)(),!g)throw new Error("Unsupported database type: '".concat(d,"'"));t=t.toString();const E=await g({ipfs:e,identity:n,address:t,name:o,access:h,directory:i,meta:f,syncAutomatically:p,headsStorage:v,entryStorage:m,indexStorage:w,referencesCount:b});return E.events.on("close",u(t)),l[t]=E,E},u=e=>()=>{delete l[e]};return{id:t,open:c,stop:async()=>{for(const e of Object.values(l))await e.close();s&&await s.close(),a&&await a.close(),l={}},ipfs:e,directory:i,keystore:s,identity:n,peerId:o}};const fO=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t=Number(t),null!=e[Symbol.asyncIterator]?async function*(){let n=[];if(t<1&&(t=1),t!==Math.round(t))throw new Error("Batch size must be an integer");for await(const r of e)for(n.push(r);n.length>=t;)yield n.slice(0,t),n=n.slice(t);for(;n.length>0;)yield n.slice(0,t),n=n.slice(t)}():function*(){let n=[];if(t<1&&(t=1),t!==Math.round(t))throw new Error("Batch size must be an integer");for(const r of e)for(n.push(r);n.length>=t;)yield n.slice(0,t),n=n.slice(t);for(;n.length>0;)yield n.slice(0,t),n=n.slice(t)}()};function pO(e){try{let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return async function*(){for await(const n of fO(e,t)){const e=n.map((async e=>e().then((e=>({ok:!0,value:e})),(e=>({ok:!1,err:e})))));for(let t=0;t<e.length;t++){const n=await e[t];if(!n.ok)throw n.err;yield n.value}}}()}catch(t){return Promise.reject(t)}}const gO=function(){var e;const t=null!==(e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).chunkSize)&&void 0!==e?e:262144;return async function*(e){let n=new Gu,r=0,i=!1;for await(const o of e)for(n.append(o),r+=o.length;r>=t;)if(yield n.slice(0,t),i=!0,t===n.length)n=new Gu,r=0;else{const e=new Gu;e.append(n.sublist(t)),n=e,r-=t}(!i||r>0)&&(yield n.subarray(0,r))}};var yO,vO,mO;!function(e){let t,n,r;!function(e){e.Raw="Raw",e.Directory="Directory",e.File="File",e.Metadata="Metadata",e.Symlink="Symlink",e.HAMTShard="HAMTShard"}(t=e.DataType||(e.DataType={})),function(e){e[e.Raw=0]="Raw",e[e.Directory=1]="Directory",e[e.File=2]="File",e[e.Metadata=3]="Metadata",e[e.Symlink=4]="Symlink",e[e.HAMTShard=5]="HAMTShard"}(n||(n={})),function(e){e.codec=()=>Gs(n)}(t=e.DataType||(e.DataType={})),e.codec=()=>(null==r&&(r=Ys((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==r.lengthDelimited&&n.fork(),null!=t.Type&&(n.uint32(8),e.DataType.codec().encode(t.Type,n)),null!=t.Data&&(n.uint32(18),n.bytes(t.Data)),null!=t.filesize&&(n.uint32(24),n.uint64(t.filesize)),null!=t.blocksizes)for(const e of t.blocksizes)n.uint32(32),n.uint64(e);null!=t.hashType&&(n.uint32(40),n.uint64(t.hashType)),null!=t.fanout&&(n.uint32(48),n.uint64(t.fanout)),null!=t.mode&&(n.uint32(56),n.uint32(t.mode)),null!=t.mtime&&(n.uint32(66),vO.codec().encode(t.mtime,n)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={blocksizes:[]},i=null==n?t.len:t.pos+n;for(;t.pos<i;){const n=t.uint32();switch(n>>>3){case 1:r.Type=e.DataType.codec().decode(t);break;case 2:r.Data=t.bytes();break;case 3:r.filesize=t.uint64();break;case 4:r.blocksizes.push(t.uint64());break;case 5:r.hashType=t.uint64();break;case 6:r.fanout=t.uint64();break;case 7:r.mode=t.uint32();break;case 8:r.mtime=vO.codec().decode(t,t.uint32());break;default:t.skipType(7&n)}}return r}))),r),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(yO||(yO={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.Seconds&&(t.uint32(8),t.int64(e.Seconds)),null!=e.FractionalNanoseconds&&(t.uint32(21),t.fixed32(e.FractionalNanoseconds)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.Seconds=e.int64();break;case 2:n.FractionalNanoseconds=e.fixed32();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(vO||(vO={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.MimeType&&(t.uint32(10),t.string(e.MimeType)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();if(t>>>3===1)n.MimeType=e.string();else e.skipType(7&t)}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(mO||(mO={}));const wO={Raw:"raw",Directory:"directory",File:"file",Metadata:"metadata",Symlink:"symlink",HAMTShard:"hamt-sharded-directory"},bO=["directory","hamt-sharded-directory"],EO=parseInt("0644",8),_O=parseInt("0755",8);class SO{static unmarshal(e){var t,n;const r=yO.decode(e),i=new SO({type:wO[null!=r.Type?r.Type.toString():"File"],data:r.Data,blockSizes:r.blocksizes,mode:r.mode,mtime:null!=r.mtime?{secs:null!==(t=r.mtime.Seconds)&&void 0!==t?t:0n,nsecs:r.mtime.FractionalNanoseconds}:void 0,fanout:r.fanout});return i._originalMode=null!==(n=r.mode)&&void 0!==n?n:0,i}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{type:"file"};je(this,"type",void 0),je(this,"data",void 0),je(this,"blockSizes",void 0),je(this,"hashType",void 0),je(this,"fanout",void 0),je(this,"mtime",void 0),je(this,"_mode",void 0),je(this,"_originalMode",void 0);const{type:t,data:n,blockSizes:r,hashType:i,fanout:o,mtime:s,mode:a}=e;if(null!=t&&!Object.values(wO).includes(t))throw qe(new Error("Type: "+t+" is not valid"),"ERR_INVALID_TYPE");this.type=null!==t&&void 0!==t?t:"file",this.data=n,this.hashType=i,this.fanout=o,this.blockSizes=null!==r&&void 0!==r?r:[],this._originalMode=0,this.mode=a,this.mtime=s}set mode(e){this._mode=null==e?this.isDirectory()?_O:EO:4095&e}get mode(){return this._mode}isDirectory(){return bO.includes(this.type)}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0n;let e=0n;return this.blockSizes.forEach((t=>{e+=t})),null!=this.data&&(e+=BigInt(this.data.length)),e}marshal(){let e;switch(this.type){case"raw":e=yO.DataType.Raw;break;case"directory":e=yO.DataType.Directory;break;case"file":e=yO.DataType.File;break;case"metadata":e=yO.DataType.Metadata;break;case"symlink":e=yO.DataType.Symlink;break;case"hamt-sharded-directory":e=yO.DataType.HAMTShard;break;default:throw qe(new Error("Type: ".concat(e," is not valid")),"ERR_INVALID_TYPE")}let t,n=this.data;var r;(null!=this.data&&0!==this.data.length||(n=void 0),null!=this.mode)&&(t=4294963200&this._originalMode|(null!==(r=this.mode)&&void 0!==r?r:0),t!==EO||this.isDirectory()||(t=void 0),t===_O&&this.isDirectory()&&(t=void 0));let i;return null!=this.mtime&&(i={Seconds:this.mtime.secs,FractionalNanoseconds:this.mtime.nsecs}),yO.encode({Type:e,Data:n,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:t,mtime:i})}}const kO=async(e,t,n)=>{null==n.codec&&(n.codec=E);const r=await ar.digest(e),i=Jt.create(n.cidVersion,n.codec.code,r);return await t.put(i,e,n),i};function AO(e){return async function*(t,n){let r=0n;for await(let o of t.content)yield async()=>{var s;let a;const l={codec:E,cidVersion:e.cidVersion,onProgress:e.onProgress};e.rawLeaves?(l.codec=i,l.cidVersion=1):(a=new SO({type:e.leafType,data:o}),o=_w({Data:a.marshal(),Links:[]}));const c=await kO(o,n,l);return r+=BigInt(o.byteLength),null===(s=e.onProgress)||void 0===s||s.call(e,new fp("unixfs:importer:progress:file:write",{bytesWritten:r,cid:c,path:t.path})),{cid:c,unixfs:a,size:BigInt(o.length),block:o}}}}const IO=async(e,t,n)=>{const r=new SO({type:"directory",mtime:e.mtime,mode:e.mode}),i=_w(yw({Data:r.marshal()}));return{cid:await kO(i,t,n),path:e.path,unixfs:r,size:BigInt(i.length),originalPath:e.originalPath,block:i}};function TO(e){return!0===e.single}const RO=async(e,t,n)=>n.layout(async function*(e,t,n){let r,i=-1;for await(const o of pO(n.bufferImporter(e,t),n.blockWriteConcurrency))i++,0!==i?(1===i&&null!=r&&(yield{...r,block:void 0,single:void 0},r=void 0),yield{...o,block:void 0}):r={...o,single:!0};null!=r&&(yield r)}(e,t,n),((e,t,n)=>async function(r){var i;if(1===r.length&&TO(r[0])&&n.reduceSingleLeafToSelf){var o;const i=r[0];let s=i.block;return!TO(i)||void 0===e.mtime&&void 0===e.mode||(i.unixfs=new SO({type:"file",mtime:e.mtime,mode:e.mode,data:i.block}),s={Data:i.unixfs.marshal(),Links:[]},i.block=_w(yw(s)),i.cid=await kO(i.block,t,{...n,cidVersion:n.cidVersion}),i.size=BigInt(i.block.length)),null===(o=n.onProgress)||void 0===o||o.call(n,new fp("unixfs:importer:progress:file:layout",{cid:i.cid,path:i.originalPath})),{cid:i.cid,path:e.path,unixfs:i.unixfs,size:i.size,originalPath:i.originalPath}}const s=new SO({type:"file",mtime:e.mtime,mode:e.mode}),a=r.filter((e=>{var t;return e.cid.code===rn&&e.size>0||null!=e.unixfs&&null==e.unixfs.data&&e.unixfs.fileSize()>0n||Boolean(null===(t=e.unixfs)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.length)})).map((e=>{return e.cid.code===rn?(s.addBlockSize(e.size),{Name:"",Tsize:Number(e.size),Hash:e.cid}):(null==e.unixfs||null==e.unixfs.data?s.addBlockSize(null!==(t=null===(n=e.unixfs)||void 0===n?void 0:n.fileSize())&&void 0!==t?t:0n):s.addBlockSize(BigInt(e.unixfs.data.length)),{Name:"",Tsize:Number(e.size),Hash:e.cid});var t,n})),l={Data:s.marshal(),Links:a},c=_w(yw(l)),u=await kO(c,t,n);return null===(i=n.onProgress)||void 0===i||i.call(n,new fp("unixfs:importer:progress:file:layout",{cid:u,path:e.originalPath})),{cid:u,path:e.path,unixfs:s,size:BigInt(c.length+l.Links.reduce(((e,t)=>{var n;return e+(null!==(n=t.Tsize)&&void 0!==n?n:0)}),0)),originalPath:e.originalPath,block:c}})(e,t,n));function CO(e){try{if(e instanceof Uint8Array)return async function*(){yield e}();if(t=e,Symbol.iterator in t)return async function*(){yield*e}();if(function(e){return Symbol.asyncIterator in e}(e))return e}catch{throw qe(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}var t;throw qe(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}function xO(e){return null!=e.content}const PO=()=>async function*(e){for await(const t of e){if(void 0===t.length)throw qe(new Error("Content was invalid"),"ERR_INVALID_CONTENT");if("string"===typeof t||t instanceof String)yield yr(t.toString());else if(Array.isArray(t))yield Uint8Array.from(t);else{if(!(t instanceof Uint8Array))throw qe(new Error("Content was invalid"),"ERR_INVALID_CONTENT");yield t}}},DO=174;function NO(e){var t;const n=null!==(t=null===e||void 0===e?void 0:e.maxChildrenPerNode)&&void 0!==t?t:DO;return async function e(t,r){const i=[];for await(const o of fO(t,n))i.push(await r(o));return i.length>1?e(i,r):i[0]}}class BO{constructor(e,t){je(this,"options",void 0),je(this,"root",void 0),je(this,"dir",void 0),je(this,"path",void 0),je(this,"dirty",void 0),je(this,"flat",void 0),je(this,"parent",void 0),je(this,"parentKey",void 0),je(this,"unixfs",void 0),je(this,"mode",void 0),je(this,"mtime",void 0),je(this,"cid",void 0),je(this,"size",void 0),je(this,"nodeSize",void 0),this.options=null!==t&&void 0!==t?t:{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}}const LO=Jt.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),OO=Jt.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi");class MO extends BO{constructor(e,t){super(e,t),je(this,"_children",void 0),this._children=new Map}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,this._children.set(e,t)}async get(e){return Promise.resolve(this._children.get(e))}childCount(){return this._children.size}directChildrenCount(){return this.childCount()}onlyChild(){return this._children.values().next().value}async*eachChildSeries(){for(const[e,t]of this._children.entries())yield{key:e,child:t}}estimateNodeSize(){if(void 0!==this.nodeSize)return this.nodeSize;this.nodeSize=0;for(const[e,t]of this._children.entries())null!=t.size&&null!=t.cid&&(this.nodeSize+=e.length+(1===this.options.cidVersion?OO.bytes.byteLength:LO.bytes.byteLength));return this.nodeSize}async*flush(e){const t=[];for(const[a,l]of this._children.entries()){let n=l;if(l instanceof BO)for await(const t of l.flush(e))n=t,yield t;null!=n.size&&null!=n.cid&&t.push({Name:a,Tsize:Number(n.size),Hash:n.cid})}const n=new SO({type:"directory",mtime:this.mtime,mode:this.mode}),r={Data:n.marshal(),Links:t},i=_w(yw(r)),o=await kO(i,e,this.options),s=i.length+r.Links.reduce(((e,t)=>e+(null==t.Tsize?0:t.Tsize)),0);this.cid=o,this.size=s,yield{cid:o,unixfs:n,path:this.path,size:BigInt(s)}}}var UO=n(2962);ir({name:"murmur3-32",code:35,encode:e=>function(e){const t=new Array(4);for(let n=0;n<4;n++)t[n]=255&e,e>>=8;return new Uint8Array(t)}(UO.x86.hash32(e))});const FO=ir({name:"murmur3-128",code:34,encode:e=>nt(UO.x64.hash128(e))});ir({name:"murmur3-x64-64",code:34,encode:e=>nt(UO.x64.hash128(e)).subarray(0,8)});var VO=n(3836);class zO{constructor(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;je(this,"_options",void 0),je(this,"_popCount",void 0),je(this,"_parent",void 0),je(this,"_posAtParent",void 0),je(this,"_children",void 0),je(this,"key",void 0),this._options=e,this._popCount=0,this._parent=t,this._posAtParent=n,this._children=new VO,this.key=null}async put(e,t){const n=await this._findNewBucketAndPos(e);n.bucket._putAt(n,e,t)}async get(e){const t=await this._findChild(e);if(null!=t)return t.value}async del(e){const t=await this._findPlace(e),n=t.bucket._at(t.pos);null!=n&&n.key===e&&t.bucket._delAt(t.pos)}leafCount(){return this._children.compactArray().reduce(((e,t)=>t instanceof zO?e+t.leafCount():e+1),0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){const e=this._children.compactArray();for(const t of e)t instanceof zO?yield*t.eachLeafSeries():yield t}serialize(e,t){return t(this._children.reduce(((n,r,i)=>(null!=r&&(r instanceof zO?n.push(r.serialize(e,t)):n.push(e(r,i))),n)),[]))}async asyncTransform(e,t){return qO(this,e,t)}toJSON(){return this.serialize(jO,HO)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(e){const t=await this._findPlace(e),n=t.bucket._at(t.pos);if(!(n instanceof zO))return null!=n&&n.key===e?n:void 0}async _findPlace(e){const t=this._options.hash("string"===typeof e?yr(e):e),n=await t.take(this._options.bits),r=this._children.get(n);return r instanceof zO?r._findPlace(t):{bucket:this,pos:n,hash:t,existingChild:r}}async _findNewBucketAndPos(e){const t=await this._findPlace(e);if(null!=t.existingChild&&t.existingChild.key!==e){const e=new zO(this._options,t.bucket,t.pos);t.bucket._putObjectAt(t.pos,e);const n=await e._findPlace(t.existingChild.hash);return n.bucket._putAt(n,t.existingChild.key,t.existingChild.value),e._findNewBucketAndPos(t.hash)}return t}_putAt(e,t,n){this._putObjectAt(e.pos,{key:t,value:n,hash:e.hash})}_putObjectAt(e,t){null==this._children.get(e)&&this._popCount++,this._children.set(e,t)}_delAt(e){if(-1===e)throw new Error("Invalid position");null!=this._children.get(e)&&this._popCount--,this._children.unset(e),this._level()}_level(){if(null!=this._parent&&this._popCount<=1)if(1===this._popCount){const e=this._children.find(KO);if(null!=e&&!(e instanceof zO)){const t=e.hash;t.untake(this._options.bits);const n={pos:this._posAtParent,hash:t,bucket:this._parent};this._parent._putAt(n,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}}function KO(e){return Boolean(e)}function jO(e,t){return e.key}function HO(e){return e}async function qO(e,t,n){const r=[];for(const i of e._children.compactArray())if(i instanceof zO)await qO(i,t,n);else{const n=await t(i);r.push({bitField:e._children.bitField(),children:n})}return n(r)}const WO=[255,254,252,248,240,224,192,128],GO=[1,3,7,15,31,63,127,255];class YO{constructor(e){je(this,"_value",void 0),je(this,"_currentBytePos",void 0),je(this,"_currentBitPos",void 0),this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,n=0;for(;t>0&&this._haveBits();){const e=this._value[this._currentBytePos],r=this._currentBitPos+1,i=Math.min(r,t);n=(n<<i)+QO(e,r-i,i),t-=i,this._currentBitPos-=i,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function QO(e,t,n){const r=function(e,t){return WO[e]&GO[Math.min(t+e-1,7)]}(t,n);return(e&r)>>>t}function XO(e){return function(t){return t instanceof JO?t:new JO(t,e)}}class JO{constructor(e,t){if(je(this,"_value",void 0),je(this,"_hashFn",void 0),je(this,"_depth",void 0),je(this,"_availableBits",void 0),je(this,"_currentBufferIndex",void 0),je(this,"_buffers",void 0),!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let n=0;for(;t>0;){const e=this._buffers[this._currentBufferIndex],r=Math.min(e.availableBits(),t);n=(n<<r)+e.take(r),t-=r,this._availableBits-=r,0===e.availableBits()&&this._currentBufferIndex++}return n}untake(e){let t=e;for(;t>0;){const e=this._buffers[this._currentBufferIndex],n=Math.min(e.totalBits()-e.availableBits(),t);e.untake(n),t-=n,this._availableBits+=n,this._currentBufferIndex>0&&e.totalBits()===e.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const e=this._depth>0?Wo([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),n=new YO(t);this._buffers.push(n),this._availableBits+=n.availableBits()}}function $O(e){var t;if(null==e||null==e.hashFn)throw new Error("please define an options.hashFn");const n={bits:null!==(t=e.bits)&&void 0!==t?t:8,hash:XO(e.hashFn)};return new zO(n)}async function ZO(e){return(await FO.encode(e)).slice(0,8).reverse()}const eM=BigInt(34);const tM=class extends BO{constructor(e,t){var n;super(e,t),je(this,"_bucket",void 0),this._bucket=$O({hashFn:ZO,bits:null!==(n=t.shardFanoutBits)&&void 0!==n?n:8})}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(e,t)}async get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}estimateNodeSize(){return void 0!==this.nodeSize||(this.nodeSize=rM(this._bucket,this,this.options)),this.nodeSize}async*flush(e){for await(const t of nM(this._bucket,e,this,this.options))yield{...t,path:this.path}}};async function*nM(e,t,n,r){const i=e._children,o=(e.tableSize()-1).toString(16).length,s=[];let a=0n;for(let f=0;f<i.length;f++){const e=i.get(f);if(null==e)continue;const n=f.toString(16).toUpperCase().padStart(o,"0");if(e instanceof zO){let i;for await(const n of nM(e,t,null,r))i=n;if(null==i)throw new Error("Could not flush sharded directory, no subshard found");s.push({Name:n,Tsize:Number(i.size),Hash:i.cid}),a+=i.size}else if("function"===typeof e.value.flush){const r=e.value;let i;for await(const e of r.flush(t))i=e,yield i;if(null==i)throw new Error("Did not flush dir");const o=n+e.key;s.push({Name:o,Tsize:Number(i.size),Hash:i.cid}),a+=i.size}else{const t=e.value;if(null==t.cid)continue;const r=n+e.key,i=t.size;s.push({Name:r,Tsize:Number(i),Hash:t.cid}),a+=BigInt(null!==i&&void 0!==i?i:0)}}const l=Uint8Array.from(i.bitField().reverse()),c=new SO({type:"hamt-sharded-directory",data:l,fanout:BigInt(e.tableSize()),hashType:eM,mtime:null===n||void 0===n?void 0:n.mtime,mode:null===n||void 0===n?void 0:n.mode}),u=_w(yw({Data:c.marshal(),Links:s})),h=await kO(u,t,r),d=BigInt(u.byteLength)+a;yield{cid:h,unixfs:c,size:d}}function rM(e,t,n){const r=e._children,i=(e.tableSize()-1).toString(16).length,o=[];for(let a=0;a<r.length;a++){const e=r.get(a);if(null==e)continue;const t=a.toString(16).toUpperCase().padStart(i,"0");if(e instanceof zO){const r=rM(e,null,n);o.push({Name:t,Tsize:Number(r),Hash:0===n.cidVersion?LO:OO})}else if("function"===typeof e.value.flush){const r=e.value.nodeSize();o.push({Name:t+e.key,Tsize:Number(r),Hash:0===n.cidVersion?LO:OO})}else{const n=e.value;if(null==n.cid)continue;const r=t+e.key,i=n.size;o.push({Name:r,Tsize:Number(i),Hash:n.cid})}}const s=Uint8Array.from(r.bitField().reverse());return _w(yw({Data:new SO({type:"hamt-sharded-directory",data:s,fanout:BigInt(e.tableSize()),hashType:eM,mtime:null===t||void 0===t?void 0:t.mtime,mode:null===t||void 0===t?void 0:t.mode}).marshal(),Links:o})).length}async function iM(e,t,n,r){let i=t;t instanceof MO&&t.estimateNodeSize()>n&&(i=await async function(e,t){const n=new tM({root:e.root,dir:!0,parent:e.parent,parentKey:e.parentKey,path:e.path,dirty:e.dirty,flat:!1,mtime:e.mtime,mode:e.mode},t);for await(const{key:r,child:i}of e.eachChildSeries())await n.put(r,i);return n}(t,r));const o=i.parent;if(null!=o){if(i!==t){if(null!=e&&(e.parent=i),null==i.parentKey)throw new Error("No parent key found");await o.put(i.parentKey,i)}return iM(i,o,n,r)}return i}const oM=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").split(/(?<!\\)\//).filter(Boolean)};async function sM(e,t,n){var r;const i=oM(null!==(r=e.path)&&void 0!==r?r:""),o=i.length-1;let s=t,a="";for(let u=0;u<i.length;u++){const r=i[u];a+="".concat(""!==a?"/":"").concat(r);const h=u===o;if(s.dirty=!0,s.cid=void 0,s.size=void 0,h)await s.put(r,e),t=await iM(null,s,n.shardSplitThresholdBytes,n);else{let e=await s.get(r);var l,c;if(null==e||!(e instanceof BO))e=new MO({root:!1,dir:!0,parent:s,parentKey:r,path:a,dirty:!0,flat:!0,mtime:null===(l=e)||void 0===l||null===(l=l.unixfs)||void 0===l?void 0:l.mtime,mode:null===(c=e)||void 0===c||null===(c=c.unixfs)||void 0===c?void 0:c.mode},n);await s.put(r,e),s=e}}return t}async function*aM(e,t){var n;e instanceof BO?yield*e.flush(t):!0===(null===(n=e.unixfs)||void 0===n?void 0:n.isDirectory())&&(yield e)}function lM(e,t){try{let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return async function*(r,i,o,s,a,l,c,u,h,d,f,p,g,y,v){let m;m=Symbol.asyncIterator in e||Symbol.iterator in e?e:[e];const w=null!==(r=n.wrapWithDirectory)&&void 0!==r&&r,b=null!==(i=n.shardSplitThresholdBytes)&&void 0!==i?i:262144,E=null!==(o=n.shardFanoutBits)&&void 0!==o?o:8,_=null!==(s=n.cidVersion)&&void 0!==s?s:1,S=null===(a=n.rawLeaves)||void 0===a||a,k=null!==(l=n.leafType)&&void 0!==l?l:"file",A=null!==(c=n.fileImportConcurrency)&&void 0!==c?c:50,I=null!==(u=n.blockWriteConcurrency)&&void 0!==u?u:10,T=null===(h=n.reduceSingleLeafToSelf)||void 0===h||h,R=null!==(d=n.chunker)&&void 0!==d?d:gO(),C=null!==(f=n.chunkValidator)&&void 0!==f?f:PO(),x=null!==(p=n.dagBuilder)&&void 0!==p?p:function(e){return async function*(t,n){for await(const r of t){let t;if(null!=r.path&&(t=r.path,r.path=r.path.split("/").filter((e=>null!=e&&"."!==e)).join("/")),xO(r)){const i={path:r.path,mtime:r.mtime,mode:r.mode,content:async function*(){let t=0n;for await(const i of e.chunker(e.chunkValidator(CO(r.content)))){var n;const o=BigInt(i.byteLength);t+=o,null===(n=e.onProgress)||void 0===n||n.call(e,new fp("unixfs:importer:progress:file:read",{bytesRead:t,chunkSize:o,path:r.path})),yield i}}(),originalPath:t};yield async()=>RO(i,n,e)}else{if(null==r.path)throw new Error("Import candidate must have content or path or both");{const i={path:r.path,mtime:r.mtime,mode:r.mode,originalPath:t};yield async()=>IO(i,n,e)}}}}}({chunker:R,chunkValidator:C,wrapWithDirectory:w,layout:null!==(g=n.layout)&&void 0!==g?g:NO(),bufferImporter:null!==(y=n.bufferImporter)&&void 0!==y?y:AO({cidVersion:_,rawLeaves:S,leafType:k,onProgress:n.onProgress}),blockWriteConcurrency:I,reduceSingleLeafToSelf:T,cidVersion:_,onProgress:n.onProgress}),P=null!==(v=n.treeBuilder)&&void 0!==v?v:function(e){return async function*(t,n){let r,i=new MO({root:!0,dir:!0,path:"",dirty:!0,flat:!0},e),o=!1;for await(const a of t){var s;if(null==a)continue;const t="".concat(null!==(s=a.originalPath)&&void 0!==s?s:"").split("/")[0];null!=t&&""!==t&&(null==r?(r=t,o=!0):r!==t&&(o=!1)),i=await sM(a,i,e),null!=a.unixfs&&a.unixfs.isDirectory()||(yield a)}if(e.wrapWithDirectory||o&&i.childCount()>1)yield*aM(i,n);else for await(const e of i.eachChildSeries())null!=e&&(yield*aM(e.child,n))}}({wrapWithDirectory:w,shardSplitThresholdBytes:b,shardFanoutBits:E,cidVersion:_,onProgress:n.onProgress});for await(const e of P(pO(x(m,t),A),t))yield{cid:e.cid,path:e.path,unixfs:e.unixfs,size:e.size}}()}catch(n){return Promise.reject(n)}}async function cM(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=await QE(lM([e],t,n));if(null==r)throw qe(new Error("Nothing imported"),"ERR_INVALID_PARAMS");return r}const uM={cidVersion:1,rawLeaves:!0,layout:NO({maxChildrenPerNode:1024}),chunker:gO({chunkSize:1048576})};async function hM(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{cid:r}=await async function(e,t){return cM({content:e},t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}(e,t,{...uM,...n});return r}async function dM(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{cid:r}=await async function(e,t){return cM({content:e},t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}(e,t,{...uM,...n});return r}async function fM(e,t){var n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{cid:i}=await async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=await QE(lM([e],t,n));if(null==r)throw qe(new Error("Nothing imported"),"ERR_INVALID_PARAMS");return r}({...e,path:null!==(n=e.path)&&void 0!==n?n:"-"},t,{...uM,...r});return i}const pM=function(e){if(null!=e[Symbol.asyncIterator])return(async()=>{let t;for await(const n of e)t=n;return t})();let t;for(const n of e)t=n;return t};function gM(e,t,n,r,i,o,s){let a=e,l=i;for(;o.length>0;){const c=o[0];if(!(c in a))throw qe(new Error("No property named ".concat(c," found in node ").concat(n)),"ERR_NO_PROP");{o.shift(),l="".concat(l,"/").concat(c);const u=Jt.asCID(a[c]);if(null!=u)return{entry:{type:"object",name:r,path:i,cid:n,node:t,depth:s,size:BigInt(t.length),content:async function*(){yield e}},next:{cid:u,name:c,path:l,toResolve:o}};a=a[c]}}return{entry:{type:"object",name:r,path:i,cid:n,node:t,depth:s,size:BigInt(t.length),content:async function*(){yield e}}}}const yM=async(e,t,n,r,i,o,s,a)=>{const l=await s.get(e,a);return gM(jm(l),l,e,t,n,r,o)},vM=async(e,t,n,r,i,o,s,a)=>{const l=await s.get(e,a);return gM(Qm(l),l,e,t,n,r,o)};const mM=function(e,t,n,r){const i=BigInt(e.length),o=BigInt(t+i);return n>=o||r<t?new Uint8Array(0):(r>=t&&r<o&&(e=e.subarray(0,Number(r-t))),n>=t&&n<o&&(e=e.subarray(Number(n-t))),e)},wM=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;const r=BigInt(e),i=BigInt(null!==t&&void 0!==t?t:0);let o=BigInt(n);if(o!==r&&(o=i+o),o>r&&(o=r),i<0n)throw qe(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(i>r)throw qe(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(o<0n)throw qe(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(o>r)throw qe(new Error("Length must be less than the file size"),"ERR_INVALID_PARAMS");return{start:i,end:o}},bM=async(e,t,n,r,i,o,s,a)=>{if(r.length>0)throw qe(new Error("No link named ".concat(n," found in raw node ").concat(e)),"ERR_NOT_FOUND");const l=Wt(e.multihash.bytes);return{entry:{type:"identity",name:t,path:n,cid:e,content:(c=l.digest,function(){try{let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async function*(t){const{start:n,end:r}=wM(c.length,e.offset,e.length),i=mM(c,0n,n,r);null===(t=e.onProgress)||void 0===t||t.call(e,new fp("unixfs:exporter:progress:identity",{bytesRead:BigInt(i.byteLength),totalBytes:r-n,fileSize:BigInt(c.byteLength)})),yield i}()}catch(e){return Promise.reject(e)}}),depth:o,size:BigInt(l.digest.length),node:l.digest}};var c},EM=async(e,t,n,r,i,o,s,a)=>{const l=await s.get(e,a);return gM(tr(l),l,e,t,n,r,o)},_M=async(e,t,n,r,i,o,s,a)=>{if(r.length>0)throw qe(new Error("No link named ".concat(n," found in raw node ").concat(e)),"ERR_NOT_FOUND");const l=await s.get(e,a);return{entry:{type:"raw",name:t,path:n,cid:e,content:(c=l,function(){try{let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async function*(t){const{start:n,end:r}=wM(c.length,e.offset,e.length),i=mM(c,0n,n,r);null===(t=e.onProgress)||void 0===t||t.call(e,new fp("unixfs:exporter:progress:raw",{bytesRead:BigInt(i.byteLength),totalBytes:r-n,fileSize:BigInt(c.byteLength)})),yield i}()}catch(e){return Promise.reject(e)}}),depth:o,size:BigInt(l.length),node:l}};var c},SM=async function(e){return(await FO.encode(e)).slice(0,8).reverse()},kM=(e,t)=>e.toString(16).toUpperCase().padStart(t,"0").substring(0,t),AM=async(e,t,n,r,i)=>{if(null==r){if(null==e.Data)throw qe(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let t;try{t=SO.unmarshal(e.Data)}catch(u){throw qe(u,"ERR_NOT_UNIXFS")}if("hamt-sharded-directory"!==t.type)throw qe(new Error("not a HAMT"),"ERR_NOT_UNIXFS");if(null==t.fanout)throw qe(new Error("missing fanout"),"ERR_NOT_UNIXFS");const n=$O({hashFn:SM,bits:Math.log2(Number(t.fanout))});r={rootBucket:n,hamtDepth:1,lastBucket:n}}const o=(r.lastBucket.tableSize()-1).toString(16).length;await(async(e,t,n)=>{const r=(t.tableSize()-1).toString(16).length;await Promise.all(e.map((async e=>{if(null==e.Name)throw new Error("Unexpected Link without a Name");if(e.Name.length!==r)await n.put(e.Name.substring(2),!0);else{const r=parseInt(e.Name,16);t._putObjectAt(r,new zO({hash:n._options.hash,bits:n._options.bits},t,r))}})))})(e.Links,r.lastBucket,r.rootBucket);const s=await r.rootBucket._findNewBucketAndPos(t);let a=kM(s.pos,o);const l=(e=>{let t=e.bucket;const n=[];for(;null!=t._parent;)n.push(t),t=t._parent;return n.push(t),n.reverse()})(s);l.length>r.hamtDepth&&(r.lastBucket=l[r.hamtDepth],a=kM(r.lastBucket._posAtParent,o));const c=e.Links.find((e=>{if(null==e.Name)return!1;const n=e.Name.substring(0,o),r=e.Name.substring(o);return n===a&&(""===r||r===t)}));if(null==c)return;if(null!=c.Name&&c.Name.substring(o)===t)return c.Hash;r.hamtDepth++;return e=Sw(await n.get(c.Hash,i)),AM(e,t,n,r,i)},IM=AM,TM=(e,t,n,r,i,o,s)=>function(){try{let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async function*(a,l,c){const u=null!==(a=n.offset)&&void 0!==a?a:0,h=null!==(l=n.length)&&void 0!==l?l:t.Links.length,d=t.Links.slice(u,h);null===(c=n.onProgress)||void 0===c||c.call(n,new fp("unixfs:exporter:walk:directory",{cid:e})),yield*Cr(d,(e=>Rr(e,(e=>async()=>{var t;const a=null!==(t=e.Name)&&void 0!==t?t:"",l="".concat(r,"/").concat(a);return(await i(e.Hash,a,l,[],o+1,s,n)).entry}))),(e=>ug(e,{ordered:!0,concurrency:n.blockReadConcurrency})),(e=>vn(e,(e=>null!=e))))}()}catch(n){return Promise.reject(n)}};async function RM(e,t,n,r,i,o,s){if(t instanceof Uint8Array){const e=mM(t,r,i,o);return void n.push(e)}if(null==t.Data)throw qe(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let a;try{a=SO.unmarshal(t.Data)}catch(c){throw qe(c,"ERR_NOT_UNIXFS")}if(null!=a.data){const e=a.data,t=mM(e,r,i,o);n.push(t),r+=BigInt(t.byteLength)}const l=[];if(t.Links.length!==a.blockSizes.length)throw qe(new Error("Inconsistent block sizes and dag links"),"ERR_NOT_UNIXFS");for(let u=0;u<t.Links.length;u++){const e=t.Links[u],n=r,s=n+a.blockSizes[u];if((i>=n&&i<s||o>=n&&o<=s||i<n&&o>s)&&l.push({link:e,blockStart:r}),(r=s)>o)break}await Cr(l,(t=>Rr(t,(t=>async()=>{const n=await e.get(t.link.Hash,s);return{...t,block:n}}))),(e=>ug(e,{ordered:!0,concurrency:s.blockReadConcurrency})),(async t=>{for await(const{link:r,block:a,blockStart:l}of t){let t;switch(r.Hash.code){case Ew:t=Sw(a);break;case rn:t=a;break;default:return void n.end(qe(new Error("Unsupported codec: ".concat(r.Hash.code)),"ERR_NOT_UNIXFS"))}const c=new yd({concurrency:1});c.on("error",(e=>{n.end(e)})),c.add((async()=>{var a;null===(a=s.onProgress)||void 0===a||a.call(s,new fp("unixfs:exporter:walk:file",{cid:r.Hash})),await RM(e,t,n,l,i,o,s)})),await c.onIdle()}})),r>=o&&n.end()}const CM=(e,t,n,r,i,o,s)=>function(){try{let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return async function*(i){const o=n.fileSize();if(void 0===o)throw new Error("File was a directory");const{start:a,end:l}=wM(o,r.offset,r.length);if(0n===l)return;let c=0n;const u=l-a,h=_n();null===(i=r.onProgress)||void 0===i||i.call(r,new fp("unixfs:exporter:walk:file",{cid:e})),RM(s,t,h,0n,a,l,r).catch((e=>{h.end(e)}));for await(const e of h){var d;if(null!=e){if(c+=BigInt(e.byteLength),c>u)throw h.end(),qe(new Error("Read too many bytes - the file size reported by the UnixFS data in the root node may be incorrect"),"ERR_OVER_READ");c===u&&h.end(),null===(d=r.onProgress)||void 0===d||d.call(r,new fp("unixfs:exporter:progress:unixfs:file",{bytesRead:c,totalBytes:u,fileSize:o})),yield e}}if(c<u)throw qe(new Error("Traversed entire DAG but did not read enough bytes"),"ERR_UNDER_READ")}()}catch(r){return Promise.reject(r)}};async function*xM(e,t,n,r,i,o){const s=e.Links;if(null==e.Data)throw qe(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let a;try{a=SO.unmarshal(e.Data)}catch(u){throw qe(u,"ERR_NOT_UNIXFS")}if(null==a.fanout)throw qe(new Error("missing fanout"),"ERR_NOT_UNIXFS");const l=(a.fanout-1n).toString(16).length,c=Cr(s,(s=>Rr(s,(s=>async()=>{const a=null!=s.Name?s.Name.substring(l):null;if(null!=a&&""!==a){const e=await n(s.Hash,a,"".concat(t,"/").concat(a),[],r+1,i,o);return{entries:null==e.entry?[]:[e.entry]}}{var c;const a=await i.get(s.Hash,o);return e=Sw(a),null===(c=o.onProgress)||void 0===c||c.call(o,new fp("unixfs:exporter:walk:hamt-sharded-directory",{cid:s.Hash})),{entries:xM(e,t,n,r,i,o)}}}))),(e=>ug(e,{ordered:!0,concurrency:o.blockReadConcurrency})));for await(const{entries:h}of c)yield*h}const PM=(e,t,n,r,i,o,s)=>function(){var n;let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return null===(n=a.onProgress)||void 0===n||n.call(a,new fp("unixfs:exporter:walk:hamt-sharded-directory",{cid:e})),xM(t,r,i,o,s,a)},DM={raw:CM,file:CM,directory:TM,"hamt-sharded-directory":PM,metadata:(e,t,n,r,i,o,s)=>()=>[],symlink:(e,t,n,r,i,o,s)=>()=>[]},NM=async(e,t,n,r,i,o,s,a)=>{const l=Sw(await s.get(e,a));let c,u;if(null==t&&(t=e.toString()),null==l.Data)throw qe(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{c=SO.unmarshal(l.Data)}catch(f){throw qe(f,"ERR_NOT_UNIXFS")}if(null==n&&(n=t),r.length>0){var h;let e;if(e="hamt-sharded-directory"===(null===(h=c)||void 0===h?void 0:h.type)?await IM(l,r[0],s):((e,t)=>{const n=e.Links.find((e=>e.Name===t));return null===n||void 0===n?void 0:n.Hash})(l,r[0]),null==e)throw qe(new Error("file does not exist"),"ERR_NOT_FOUND");const t=r.shift();u={cid:e,toResolve:r,name:null!==t&&void 0!==t?t:"",path:"".concat(n,"/").concat(t)}}const d=DM[c.type](e,l,c,n,i,o,s);if(null==d)throw qe(new Error("could not find content exporter"),"ERR_NOT_FOUND");return c.isDirectory()?{entry:{type:"directory",name:t,path:n,cid:e,content:d,unixfs:c,depth:o,node:l,size:c.fileSize()},next:u}:{entry:{type:"file",name:t,path:n,cid:e,content:d,unixfs:c,depth:o,node:l,size:c.fileSize()},next:u}},BM={[Ew]:NM,[rn]:_M,[zm]:yM,[Ym]:vM,[rr.code]:bM,[Zn]:EM},LM=async(e,t,n,r,i,o,s)=>{const a=BM[e.code];if(null==a)throw qe(new Error("No resolver for code ".concat(e.code)),"ERR_NO_RESOLVER");return a(e,t,n,r,LM,i,o,s)},OM=LM,MM=e=>{if(e instanceof Uint8Array)return{cid:Jt.decode(e),toResolve:[]};const t=Jt.asCID(e);if(null!=t)return{cid:t,toResolve:[]};if("string"===typeof e){0===e.indexOf("/ipfs/")&&(e=e.substring(6));const t=function(){var e;return(null!==(e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").trim().match(/([^\\^/]|\\\/)+/g))&&void 0!==e?e:[]).filter(Boolean)}(e);return{cid:Jt.parse(t[0]),toResolve:t.slice(1)}}throw qe(new Error("Unknown path type ".concat(e)),"ERR_BAD_PATH")};function UM(e,t){try{let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return async function*(){let{cid:r,toResolve:i}=MM(e),o=r.toString(),s=o;const a=i.length;for(;;){const l=await OM(r,o,s,i,a,t,n);if(null==l.entry&&null==l.next)throw qe(new Error("Could not resolve ".concat(e)),"ERR_NOT_FOUND");if(null!=l.entry&&(yield l.entry),null==l.next)return;i=l.next.toResolve,r=l.next.cid,o=l.next.name,s=l.next.path}}()}catch(n){return Promise.reject(n)}}async function FM(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=await pM(UM(e,t,n));if(null==r)throw qe(new Error("Could not resolve ".concat(e)),"ERR_NOT_FOUND");return r}function VM(e,t){try{let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return async function*(){const r=await FM(e,t,n);if(null!=r&&(yield r,"directory"===r.type))for await(const e of async function*e(t,n){for await(const r of t.content(n))yield r,r instanceof Uint8Array||"directory"===r.type&&(yield*e(r,n))}(r,n))yield e}()}catch(n){return Promise.reject(n)}}class zM extends Error{constructor(e,t,n){super(e),je(this,"name",void 0),je(this,"code",void 0),this.name=t,this.code=n}}class KM extends zM{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"not a Unixfs node","NotUnixFSError","ERR_NOT_UNIXFS")}}class jM extends zM{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"invalid PBNode","InvalidPBNodeError","ERR_INVALID_PBNODE")}}class HM extends zM{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"unknown error","InvalidPBNodeError","ERR_UNKNOWN_ERROR")}}class qM extends zM{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"path already exists","AlreadyExistsError","ERR_ALREADY_EXISTS")}}class WM extends zM{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"path does not exist","DoesNotExistError","ERR_DOES_NOT_EXIST")}}class GM extends zM{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"no content","NoContentError","ERR_NO_CONTENT")}}class YM extends zM{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"not a file","NotAFileError","ERR_NOT_A_FILE")}}class QM extends zM{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"not a directory","NotADirectoryError","ERR_NOT_A_DIRECTORY")}}class XM extends zM{constructor(){super(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"invalid parameters","InvalidParametersError","ERR_INVALID_PARAMETERS")}}function JM(e){return function(t){return t instanceof $M?t:new $M(t,e)}}class $M{constructor(e,t){if(je(this,"_value",void 0),je(this,"_hashFn",void 0),je(this,"_depth",void 0),je(this,"_availableBits",void 0),je(this,"_currentBufferIndex",void 0),je(this,"_buffers",void 0),!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let n=0;for(;t>0;){const e=this._buffers[this._currentBufferIndex],r=Math.min(e.availableBits(),t);n=(n<<r)+e.take(r),t-=r,this._availableBits-=r,0===e.availableBits()&&this._currentBufferIndex++}return n}untake(e){let t=e;for(;t>0;){const e=this._buffers[this._currentBufferIndex],n=Math.min(e.totalBits()-e.availableBits(),t);e.untake(n),t-=n,this._availableBits+=n,this._currentBufferIndex>0&&e.totalBits()===e.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const e=this._depth>0?Wo([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),n=new tU(t);this._buffers.push(n),this._availableBits+=n.availableBits()}}const ZM=[255,254,252,248,240,224,192,128],eU=[1,3,7,15,31,63,127,255];class tU{constructor(e){je(this,"_value",void 0),je(this,"_currentBytePos",void 0),je(this,"_currentBitPos",void 0),this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,n=0;for(;t>0&&this._haveBits();){const e=this._value[this._currentBytePos],r=this._currentBitPos+1,i=Math.min(r,t);n=(n<<i)+nU(e,r-i,i),t-=i,this._currentBitPos-=i,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function nU(e,t,n){const r=function(e,t){return ZM[e]&eU[Math.min(t+e-1,7)]}(t,n);return(e&r)>>>t}const rU=BigInt(FO.code);async function iU(e){return(await FO.encode(e)).subarray(0,8).reverse()}const oU=async(e,t,n)=>{null==n.codec&&(n.codec=E);const r=await ar.digest(e),i=Jt.create(n.cidVersion,n.codec.code,r);return await t.put(i,e,{...n,signal:n.signal}),i};class sU{constructor(e,t){je(this,"options",void 0),je(this,"root",void 0),je(this,"dir",void 0),je(this,"path",void 0),je(this,"dirty",void 0),je(this,"flat",void 0),je(this,"parent",void 0),je(this,"parentKey",void 0),je(this,"unixfs",void 0),je(this,"mode",void 0),je(this,"mtime",void 0),je(this,"cid",void 0),je(this,"size",void 0),je(this,"nodeSize",void 0),this.options=null!==t&&void 0!==t?t:{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}}class aU extends sU{constructor(e,t){super(e,t),je(this,"_bucket",void 0),this._bucket=$O({hashFn:iU,bits:8})}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(e,t)}async get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}estimateNodeSize(){return void 0!==this.nodeSize||(this.nodeSize=cU(this._bucket,this,this.options)),this.nodeSize}async*flush(e){for await(const t of lU(this._bucket,e,this,this.options))yield{...t,path:this.path}}}async function*lU(e,t,n,r){const i=e._children,o=[];let s=0n;for(let d=0;d<i.length;d++){const e=i.get(d);if(null==e)continue;const n=d.toString(16).toUpperCase().padStart(2,"0");if(e instanceof zO){let i;for await(const n of lU(e,t,null,r))i=n;if(null==i)throw new Error("Could not flush sharded directory, no subshard found");o.push({Name:n,Tsize:Number(i.size),Hash:i.cid}),s+=i.size}else if("function"===typeof e.value.flush){const r=e.value;let i;for await(const e of r.flush(t))i=e,yield i;if(null==i)throw new Error("Did not flush dir");const a=n+e.key;o.push({Name:a,Tsize:Number(i.size),Hash:i.cid}),s+=i.size}else{const t=e.value;if(null==t.cid)continue;const r=n+e.key,i=t.size;o.push({Name:r,Tsize:Number(i),Hash:t.cid}),s+=BigInt(null!==i&&void 0!==i?i:0)}}const a=Uint8Array.from(i.bitField().reverse()),l=new SO({type:"hamt-sharded-directory",data:a,fanout:BigInt(e.tableSize()),hashType:rU,mtime:null===n||void 0===n?void 0:n.mtime,mode:null===n||void 0===n?void 0:n.mode}),c=_w(yw({Data:l.marshal(),Links:o})),u=await oU(c,t,r),h=BigInt(c.byteLength)+s;yield{cid:u,unixfs:l,size:h}}function cU(e,t,n){const r=e._children,i=[];for(let s=0;s<r.length;s++){const e=r.get(s);if(null==e)continue;const t=s.toString(16).toUpperCase().padStart(2,"0");if(e instanceof zO){const r=cU(e,null,n);i.push({Name:t,Tsize:Number(r),Hash:0===n.cidVersion?uU:hU})}else if("function"===typeof e.value.flush){const r=e.value.nodeSize();i.push({Name:t+e.key,Tsize:Number(r),Hash:0===n.cidVersion?uU:hU})}else{const n=e.value;if(null==n.cid)continue;const r=t+e.key,o=n.size;i.push({Name:r,Tsize:Number(o),Hash:n.cid})}}const o=Uint8Array.from(r.bitField().reverse());return _w(yw({Data:new SO({type:"hamt-sharded-directory",data:o,fanout:BigInt(e.tableSize()),hashType:rU,mtime:null===t||void 0===t?void 0:t.mtime,mode:null===t||void 0===t?void 0:t.mode}).marshal(),Links:i})).length}const uU=Jt.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),hU=Jt.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi"),dU=pn("helia:unixfs:commands:utils:hamt-utils"),fU=e=>e.toString(16).toUpperCase().padStart(2,"0").substring(0,2),pU=async(e,t,n)=>{var r;const i=SO.unmarshal(null!==(r=e[0].node.Data)&&void 0!==r?r:new Uint8Array(0)),o=BigInt(Math.pow(2,8));let s,a;e.reverse();for(let l=0;l<e.length;l++){const r=l===e.length-1,c=e[l],u=Uint8Array.from(c.children.bitField().reverse()),h=new SO({type:"hamt-sharded-directory",data:u,fanout:o,hashType:rU});r&&(h.mtime=i.mtime,h.mode=i.mode),a={Data:h.marshal(),Links:c.node.Links};const d=_w(yw(a));if(s=await oU(d,t,n),!r){const t=e[l+1];if(null==t)throw new Error("Was not operating on shard root but also had no parent?");dU("updating link in parent sub-shard with prefix %s",t.prefix),t.node.Links=t.node.Links.filter((e=>e.Name!==t.prefix)),t.node.Links.push({Name:t.prefix,Hash:s,Tsize:c.node.Links.reduce(((e,t)=>{var n;return e+(null!==(n=t.Tsize)&&void 0!==n?n:0)}),d.byteLength)})}}if(null==s||null==a)throw new Error("Noting persisted");return{cid:s,node:a}},gU=async(e,t,n,r)=>{const i=JM(iU)(yr(t)),o=[];for(;;){var s;const l=Sw(await n.get(e,r)),c=new VO,u=await i.take(8),h=fU(u);let d;o.push({prefix:h,children:c,node:l});for(const e of l.Links){var a;const t=null!==(a=e.Name)&&void 0!==a?a:"";if(t.length<2)throw new Error("Invalid HAMT - link name was too short");const n=parseInt(t.substring(0,2),16);c.set(n,!0),t.startsWith(h)&&(d=e)}if(null==d){dU("no link found with prefix %s for %s",h,t);break}const f=null!==(s=d.Name)&&void 0!==s?s:"";if(f.length<2)throw new Error("Invalid HAMT - link name was too short");if(2!==f.length)break;e=d.Hash,dU("descend into sub-shard with prefix %s",f)}return{path:o,hash:i}};async function yU(e,t,n,r){if(null==e.Data)throw new Error("DagPB node had no data");const i=SO.unmarshal(e.Data);let o;if("directory"===i.type)o=function(e){let t=0;for(const r of e.Links){var n;t+=(null!==(n=r.Name)&&void 0!==n?n:"").length,t+=1===r.Hash.version?hU.bytes.byteLength:uU.bytes.byteLength}return t}(e);else{if("hamt-sharded-directory"!==i.type)throw new Error("Can only estimate the size of directories or shards");o=await vU(e,0,n,t,r)}return o>n}async function vU(e,t,n,r,i){if(t>n)return n;if(null==e.Data)return t;if(!SO.unmarshal(e.Data).isDirectory())return t;for(const s of e.Links){var o;let e=null!==(o=s.Name)&&void 0!==o?o:"";if(e=e.substring(2),t+=e.length,t+=s.Hash.bytes.byteLength,s.Hash.code===Ew){const e=Sw(await r.get(s.Hash,i));t+=await vU(e,t,n,r,i)}}return t}const mU=pn("helia:unixfs:components:utils:add-link");async function wU(e,t,n,r){if(null==e.node.Data)throw new XM("Invalid parent passed to addLink");if("hamt-sharded-directory"===SO.unmarshal(e.node.Data).type)return mU("adding link to sharded directory"),_U(e,t,n,r);mU("adding ".concat(t.Name," (").concat(t.Hash,") to regular directory"));const i=await EU(e,t,n,r);if(await yU(i.node,n,r.shardSplitThresholdBytes,r)){mU("converting directory to sharded directory");const e=await bU(i,n);i.cid=e.cid,i.node=Sw(await n.get(e.cid,r))}return i}const bU=async(e,t)=>{if(null==e.node.Data)throw new XM("Invalid parent passed to convertToShardedDirectory");const n=SO.unmarshal(e.node.Data),r=await(async(e,t,n)=>{const r=new aU({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mtime:n.mtime,mode:n.mode},n);for(let o=0;o<t.length;o++)await r._bucket.put(t[o].name,{size:t[o].size,cid:t[o].cid});const i=await pM(r.flush(e));if(null==i)throw new Error("Flushing shard yielded no result");return i})(t,e.node.Links.map((e=>{var t,n;return{name:null!==(t=e.Name)&&void 0!==t?t:"",size:BigInt(null!==(n=e.Tsize)&&void 0!==n?n:0),cid:e.Hash}})),{mode:n.mode,mtime:n.mtime,cidVersion:e.cid.version});return mU("converted directory to sharded directory ".concat(r.cid)),r},EU=async(e,t,n,r)=>{const i=e.node.Links.filter((e=>{const n=e.Name===t.Name;if(n&&!r.allowOverwriting)throw new qM;return!n}));if(i.push(t),null==e.node.Data)throw new jM("Parent node with no data passed to addToDirectory");const o=SO.unmarshal(e.node.Data);let s;if(null!=o.mtime){const e=Date.now(),t=Math.floor(e/1e3);o.mtime={secs:BigInt(t),nsecs:1e3*(e-1e3*t)},s=o.marshal()}else s=e.node.Data;e.node=yw({Data:s,Links:i});const a=_w(e.node),l=await ar.digest(a),c=Jt.create(e.cid.version,Ew,l);return await n.put(c,a),{node:e.node,cid:c}},_U=async(e,t,n,r)=>{const{path:i,hash:o}=await gU(e.cid,t.Name,n,r),s=i[i.length-1];if(null==s)throw new Error("Invalid HAMT, could not generate path");const a=s.prefix,l=parseInt(a,16);mU("next prefix for %s is %s",t.Name,a);const c="".concat(a).concat(t.Name),u=s.node.Links.find((e=>{var t;return(null!==(t=e.Name)&&void 0!==t?t:"").startsWith(a)}));var h;if(null!=u)if(mU("link %s was present in shard",c),u.Name===c){if(!r.allowOverwriting)throw new qM;mU("overwriting %s in subshard",t.Name),s.node.Links=s.node.Links.filter((e=>e.Name!==c)),s.node.Links.push({Name:c,Hash:t.Hash,Tsize:t.Tsize})}else{if(2===(null===(h=u.Name)||void 0===h?void 0:h.length))throw new Error("Existing link was subshard?!");{var d;mU("prefix %s already exists, creating new subshard",a);const e=s.node.Links.findIndex((e=>{var t;return null===(t=e.Name)||void 0===t?void 0:t.startsWith(a)})),n=s.node.Links.splice(e,1)[0],r=(null!==(d=n.Name)&&void 0!==d?d:"").substring(2),l=JM(iU)(yr(r));for(let t=0;t<i.length;t++)await l.take(8);for(;;){const e=await l.take(8),s=fU(e);n.Name="".concat(s).concat(r);const c=await o.take(8),u=fU(c);if(s===u){const e=new VO;e.set(c,!0),i.push({prefix:u,children:e,node:{Links:[]}});continue}const h=new VO;h.set(c,!0),h.set(e,!0),i.push({prefix:a,children:h,node:{Links:[n,{Name:"".concat(u).concat(t.Name),Hash:t.Hash,Tsize:t.Tsize}]}});break}}}else mU("link %s was not present in sub-shard",c),t.Name=c,s.node.Links.push(t),s.children.set(l,!0),mU("adding %s to existing sub-shard",c);return pU(i,n,r)};async function SU(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=await FM(e,t,n);if("directory"!==r.type)throw new QM("".concat(e.toString()," was not a UnixFS directory"));return{cid:e,node:r.node}}async function kU(e,t,n,r){const i=await FM(e,n,r);if("directory"!==i.type&&"file"!==i.type&&"raw"!==i.type)throw new KM("".concat(e.toString()," was not a UnixFS node"));return{Name:t,Tsize:i.node instanceof Uint8Array?i.node.byteLength:AU(i.node),Hash:e}}function AU(e){const t=e.Links.reduce(((e,t)=>{var n;return e+(null!==(n=t.Tsize)&&void 0!==n?n:0)}),0);return _w(e).byteLength+t}const IU=pn("helia:unixfs:components:utils:resolve");async function TU(e,t,n,r){if(null==t||""===t)return{cid:e};const i="/ipfs/".concat(e).concat(null==t?"":"/".concat(t)),o=await Sr(UM(i,n,r));if(0===o.length)throw new WM("Could not find path in directory");return IU("resolved %s to %c",t,e),{cid:o[o.length-1].cid,path:t,segments:o}}async function RU(e,t,n,r){if(null==t.segments||0===t.segments.length)return e;let i=t.segments.pop();if(null==i)throw new Error("Insufficient segments");i.cid=e,t.segments.reverse();for(const o of t.segments){const[t,s]=await Promise.all([SU(o.cid,n,r),kU(i.cid,i.name,n,r)]);e=(await wU(t,s,n,{...r,allowOverwriting:!0,cidVersion:e.version})).cid,o.cid=e,i=o}return e}const CU=Ip.bind({ignoreUndefined:!0}),xU={};const PU=262144,DU=Ip.bind({ignoreUndefined:!0}),NU=pn("helia:unixfs:chmod"),BU={recursive:!1,shardSplitThresholdBytes:PU};const LU=Ip.bind({ignoreUndefined:!0}),OU=pn("helia:unixfs:cp"),MU={force:!1,shardSplitThresholdBytes:PU};const UU=Ip.bind({ignoreUndefined:!0}),FU={};const VU=Ip.bind({ignoreUndefined:!0}),zU=pn("helia:unixfs:mkdir"),KU={cidVersion:1,force:!1,shardSplitThresholdBytes:PU};const jU=pn("helia:unixfs:utils:remove-link");const HU=async(e,t,n,r)=>{e.node.Links=e.node.Links.filter((e=>e.Name!==t));const i=_w(e.node),o=await oU(i,n,{...r,cidVersion:e.cid.version});return jU("Updated regular directory ".concat(o)),{node:e.node,cid:o}},qU=async(e,t,n,r)=>{const{path:i}=await gU(e.cid,t,n,r),o=i[i.length-1];if(null==o)throw new Error("Invalid HAMT, could not generate path");const s=o.node.Links.filter((e=>{var n;return(null!==(n=e.Name)&&void 0!==n?n:"").substring(2)===t})).map((e=>e.Name)).pop();if(null==s)throw new Error("File not found");const a=s.substring(0,2),l=parseInt(a,16);if(o.node.Links=o.node.Links.filter((e=>e.Name!==s)),o.children.unset(l),1===o.node.Links.length)for(;;){var c;if(1===i.length)break;const e=i[i.length-1];if(null==e||e.node.Links.length>1)break;i.pop();const t=i[i.length-1];if(null==t)break;const n=e.node.Links[0];t.node.Links=t.node.Links.filter((e=>{var n;return!(null!==(n=e.Name)&&void 0!==n?n:"").startsWith(t.prefix)})),t.node.Links.push({Hash:n.Hash,Name:"".concat(t.prefix).concat((null!==(c=n.Name)&&void 0!==c?c:"").substring(2)),Tsize:n.Tsize})}return pU(i,n,r)},WU=async(e,t,n)=>{if(null==e.node.Data)throw new XM("Invalid parent passed to convertToFlatDirectory");const r={Links:[]},i=await FM(e.cid,t);if("directory"!==i.type)throw new Error("Unexpected node type");for await(const a of i.content()){let e=0;e=a.node instanceof Uint8Array?a.node.byteLength:_w(a.node).length,r.Links.push({Hash:a.cid,Name:a.name,Tsize:e})}const o=SO.unmarshal(e.node.Data);r.Data=new SO({type:"directory",mode:o.mode,mtime:o.mtime}).marshal();const s=_w(yw(r));return{cid:await oU(s,t,{codec:E,cidVersion:e.cid.version,signal:n.signal}),node:r}},GU=Ip.bind({ignoreUndefined:!0}),YU=pn("helia:unixfs:rm"),QU={shardSplitThresholdBytes:PU};async function XU(e,t,n){const r=GU(QU,arguments.length>3&&void 0!==arguments[3]?arguments[3]:{});if(t.includes("/"))throw new XM("Name must not have slashes");const i=await SU(e,n,r);YU("Removing %s from %c",t,e);const o=await async function(e,t,n,r){if(null==e.node.Data)throw new jM("Parent node had no data");if("hamt-sharded-directory"===SO.unmarshal(e.node.Data).type){jU("removing ".concat(t," from sharded directory"));const i=await qU(e,t,n,r);return await yU(i.node,n,r.shardSplitThresholdBytes,r)?i:(jU("converting shard to flat directory %c",e.cid),WU(i,n,r))}return jU("removing link ".concat(t," regular directory")),HU(e,t,n,r)}(i,t,n,{...r,cidVersion:e.version});return o.cid}const JU=Ip.bind({ignoreUndefined:!0}),$U=pn("helia:unixfs:stat"),ZU={};async function eF(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r=JU(ZU,n),i=await TU(e,n.path,t,r);$U("stat %c",i.cid);const o=await FM(i.cid,t,r);if("file"!==o.type&&"directory"!==o.type&&"raw"!==o.type)throw new KM;let s,a,l=0n,c=0n,u=0n,h=0n,d=0;const f=o.type;let p;if("raw"===o.type&&(l=BigInt(o.node.byteLength),c=BigInt(o.node.byteLength),u=BigInt(o.node.byteLength),h=BigInt(o.node.byteLength),d=1),"directory"===o.type&&(l=0n,c=BigInt(o.unixfs.marshal().byteLength),u=0n,h=c,d=1,s=o.unixfs.mode,a=o.unixfs.mtime,p=o.unixfs),"file"===o.type){var g,y;const e=await tF(i.cid,t,r);l=o.unixfs.fileSize(),c=BigInt((null!==(g=null===(y=o.node.Data)||void 0===y?void 0:y.byteLength)&&void 0!==g?g:0)+o.node.Links.reduce(((e,t)=>{var n;return e+(null!==(n=t.Tsize)&&void 0!==n?n:0)}),0)),u=BigInt(e.localFileSize),h=BigInt(e.localDagSize),d=e.blocks,s=o.unixfs.mode,a=o.unixfs.mtime,p=o.unixfs}return{cid:i.cid,mode:s,mtime:a,fileSize:l,dagSize:c,localFileSize:u,localDagSize:h,blocks:d,type:f,unixfs:p}}async function tF(e,t,n){const r={localFileSize:0,localDagSize:0,blocks:0};if(await t.has(e,n)){const o=await t.get(e,n);if(r.blocks++,r.localDagSize+=o.byteLength,e.code===rn)r.localFileSize+=o.byteLength;else{if(e.code!==Ew)throw new HM("".concat(e.toString()," was neither DAG_PB nor RAW"));{const s=Sw(o);if(s.Links.length>0)for(const e of s.Links){const i=await tF(e.Hash,t,n);r.localFileSize+=i.localFileSize,r.localDagSize+=i.localDagSize,r.blocks+=i.blocks}else{var i;if(null==s.Data)throw new jM("PBNode ".concat(e.toString()," had no data"));const t=SO.unmarshal(s.Data);if(null==t.data)throw new jM("UnixFS node ".concat(e.toString()," had no data"));r.localFileSize+=null!==(i=t.data.byteLength)&&void 0!==i?i:0}}}}return r}const nF=Ip.bind({ignoreUndefined:!0}),rF=pn("helia:unixfs:touch"),iF={recursive:!1,shardSplitThresholdBytes:PU};n(9712);class oF{constructor(e){je(this,"components",void 0),this.components=e}addAll(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){yield*function(e,t){try{let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return async function*(){yield*lM(e,t,{...uM,...n})}()}catch(n){return Promise.reject(n)}}(e,t.components.blockstore,n)}()}catch(n){return Promise.reject(n)}}async addBytes(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return hM(e,this.components.blockstore,t)}async addByteStream(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return dM(e,this.components.blockstore,t)}async addFile(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{cid:r}=await cM(e,t,{...uM,...n});return r}(e,this.components.blockstore,t)}async addDirectory(){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fM(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},this.components.blockstore,e)}cat(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){yield*function(e,t){try{let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return async function*(){const r=CU(xU,n),i=await TU(e,r.path,t,r),o=await FM(i.cid,t,r);if("file"!==o.type&&"raw"!==o.type)throw new YM;if(null==o.content)throw new GM;yield*o.content(r)}()}catch(n){return Promise.reject(n)}}(e,t.components.blockstore,n)}()}catch(n){return Promise.reject(n)}}async chmod(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=DU(BU,r),o=await TU(e,i.path,n,r);if(NU("chmod %c %d",o.cid,t),i.recursive){const s=await Cr((async function*(){for await(const e of VM(o.cid,n,r)){let n,r=[];if("raw"===e.type)n=new SO({type:"file",data:e.node});else{if("file"!==e.type&&"directory"!==e.type)throw new KM;n=e.unixfs,r=e.node.Links}n.mode=t;const i={Data:n.marshal(),Links:r};yield{path:e.path,content:i}}}),(t=>lM(t,n,{...i,dagBuilder:async function*(t,n){for await(const r of t)yield async function(){const t=r.content,o=_w(t),s=await oU(o,n,{...i,cidVersion:e.version});if(null==t.Data)throw new jM("".concat(s," had no data"));const a=SO.unmarshal(t.Data);return{cid:s,size:BigInt(o.length),path:r.path,unixfs:a}}}})),(async e=>pM(e)));if(null==s)throw new HM("Could not chmod ".concat(o.cid.toString()));return RU(s.cid,o,n,i)}const s=await n.get(o.cid,r);let a,l=[];if(o.cid.code===rn)a=new SO({type:"file",data:s});else{const e=Sw(s);if(null==e.Data)throw new jM("".concat(o.cid.toString()," had no data"));l=e.Links,a=SO.unmarshal(e.Data)}a.mode=t;const c=_w({Data:a.marshal(),Links:l}),u=await ar.digest(c),h=Jt.create(o.cid.version,Ew,u);return await n.put(h,c),RU(h,o,n,i)}(e,t,this.components.blockstore,n)}async cp(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return async function(e,t,n,r){const i=LU(MU,arguments.length>4&&void 0!==arguments[4]?arguments[4]:{});if(n.includes("/"))throw new XM("Name must not have slashes");const[o,s]=await Promise.all([SU(t,r,i),kU(e,n,r,i)]);return OU('Adding %c as "%s" to %c',e,n,t),(await wU(o,s,r,{allowOverwriting:i.force,cidVersion:t.version,...i})).cid}(e,t,n,this.components.blockstore,r)}ls(e){try{var t=this;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function*(){yield*function(e,t){try{let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return async function*(){const r=UU(FU,n),i=await TU(e,r.path,t,r),o=await FM(i.cid,t);if("file"!==o.type&&"raw"!==o.type){if(null==o.content)throw new GM;if("directory"!==o.type)throw new QM;yield*o.content({offset:n.offset,length:n.length})}else yield o}()}catch(n){return Promise.reject(n)}}(e,t.components.blockstore,n)}()}catch(n){return Promise.reject(n)}}async mkdir(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return async function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=VU(KU,r);if(t.includes("/"))throw new XM("Path must not have slashes");if("directory"!==(await FM(e,n,r)).type)throw new QM("".concat(e.toString()," was not a UnixFS directory"));zU("creating %s",t);const o=_w({Data:new SO({type:"directory",mode:i.mode,mtime:i.mtime}).marshal(),Links:[]}),s=await ar.digest(o),a=Jt.create(i.cidVersion,Ew,s);await n.put(a,o);const[l,c]=await Promise.all([SU(e,n,i),kU(a,t,n,i)]);return zU("adding empty dir called %s to %c",t,e),(await wU(l,c,n,{...i,allowOverwriting:i.force})).cid}(e,t,this.components.blockstore,n)}async rm(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return XU(e,t,this.components.blockstore,n)}async stat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return eF(e,this.components.blockstore,t)}async touch(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return async function(e,t){var n;let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i=nF(iF,r),o=await TU(e,i.path,t,i),s=null!==(n=i.mtime)&&void 0!==n?n:{secs:BigInt(Math.round(Date.now()/1e3)),nsecs:0};if(rF("touch %c %o",o.cid,s),i.recursive){const n=await Cr((async function*(){for await(const e of VM(o.cid,t)){let t,n;if("raw"===e.type)t=new SO({data:e.node}),n=[];else{if("file"!==e.type&&"directory"!==e.type)throw new KM;t=e.unixfs,n=e.node.Links}t.mtime=s;const r={Data:t.marshal(),Links:n};yield{path:e.path,content:r}}}),(n=>lM(n,t,{...i,dagBuilder:async function*(t,n){for await(const r of t)yield async function(){const t=r.content,o=_w(t),s=await oU(o,n,{...i,cidVersion:e.version});if(null==t.Data)throw new jM("".concat(s," had no data"));const a=SO.unmarshal(t.Data);return{cid:s,size:BigInt(o.length),path:r.path,unixfs:a}}}})),(async e=>pM(e)));if(null==n)throw new HM("Could not chmod ".concat(o.cid.toString()));return RU(n.cid,o,t,i)}const a=await t.get(o.cid,r);let l,c=[];if(o.cid.code===rn)l=new SO({data:a});else{const e=Sw(a);if(c=e.Links,null==e.Data)throw new jM("".concat(o.cid.toString()," had no data"));l=SO.unmarshal(e.Data)}l.mtime=s;const u=_w({Data:l.marshal(),Links:c}),h=await ar.digest(u),d=Jt.create(o.cid.version,Ew,h);return await t.put(d,u),RU(d,o,t,i)}(e,this.components.blockstore,t)}}const sF=window.store=new class{constructor(){this.playlists=[],this.isOnline=!1,this.currentPlaylist={},this.version="v0.1",this.connectedPeers=[],this.ipfs=null,this.odb=null,this.playlistDB=null,this.addToPlaylists=e=>{this.playlists.push({hash:e.hash,key:e.key,name:e.value.name,address:e.value.address})},Jx(this,{playlists:dC,currentPlaylist:dC,connectedPeers:dC,connect:yx,deletePlaylist:yx,loadPlaylists:yx,joinPlaylist:yx,addFile:yx,addToPlaylists:yx})}async connect(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.ipfs=e,e.libp2p.addEventListener("connection:open",(async e=>{console.log("connection:open",e.detail.remoteAddr.toString()),this.connectedPeers.push(e.detail.remoteAddr.toString()),console.log("connectedPeers",this.connectedPeers)})),e.libp2p.addEventListener("connection:close",(e=>{console.log("connection:close",e);const t=this.connectedPeers.indexOf(e.detail.remoteAddr.toString());this.connectedPeers.splice(t,1);console.log("connectedPeers",this.connectedPeers)}));const n=await WL({ipfs:e}),r=t.identity||await n.createIdentity({id:"user"});this.odb=await dO({ipfs:e,identity:r,identities:n,directory:"./web3-workshop-11052023"}),this.playlistDB=await this.odb.open("playlists",{type:"documents",sync:!0,AccessController:oO({write:["*"]})}),this.playlistDB.events.on("join",(async(e,t)=>{console.log("join with peerId ".concat(e),t),await this.loadPlaylists()})),this.playlistDB.events.on("update",(async e=>{console.log("update event",e),await this.loadPlaylists()})),await this.loadPlaylists(),this.isOnline=!0,setInterval((async()=>{console.log(await this.ipfs.libp2p.services.pubsub.getTopics())}),1e3)}async deletePlaylist(e){try{await this.playlistDB.del(e),console.log("Playlist at address ".concat(e," deleted successfully."));const t=this.playlists.findIndex((t=>t.key===e));-1!==t&&this.playlists.splice(t,1)}catch(t){console.error("Failed to delete playlist:",t)}}async loadPlaylists(e){if("DEL"!==(null===e||void 0===e?void 0:e.op))if(console.log("loading playlists from orbitdb"),e)console.log("adding entry",e),this.addToPlaylists(e);else{this.playlists=[];const e=await this.playlistDB.all();Object.values(e).forEach((e=>{this.addToPlaylists(e)}))}}async createNewPlaylist(e){const t=await this.odb.open(e,{type:"documents",sync:!0,AccessController:lO({write:[this.odb.identity.id]})});await t.drop();const n={_id:(new Date).getTime(),name:e,address:t.address.toString()};return await this.playlistDB.put(n)}async joinPlaylist(e){if(this.odb&&e){const t=await this.odb.open(e);this.currentPlaylist=t}}sendFiles(e,t){const n=[];for(let r=0;r<e.length;r++)n.push(this._sendFile(e[r],t));return Promise.all(n)}async sha256(e){const t=(new TextEncoder).encode(e),n=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(n)).map((e=>e.toString(16).padStart(2,"0"))).join("")}async _sendFile(e,t){return new Promise((n=>{const r=new FileReader;r.onload=async r=>{const i={filename:e.name,buffer:r.target.result,meta:{mimeType:e.type,size:e.size}};i._id=await this.sha256(i);const o=await this.addFile(t,i);n(o)},r.readAsArrayBuffer(e)}))}async addFile(e,t){if(!t||!t.filename)throw new Error("Filename not specified");const n=t.filename.split("/").pop(),r=t.meta&&t.meta.size?t.meta.size:0,i=(o=this.ipfs,new oF(o));var o;const s=await i.addBytes(Buffer.from(t.buffer));console.log("upload",s.toString());const a={from:this.odb.identity.id,type:"file",ts:(new Date).getTime()},l={content:s.toString(),meta:Object.assign(a,{size:r,name:n},t.meta||{})};return l._id=await this.sha256(a),this.addToPlaylist(e,l)}async addToPlaylist(e,t){const n=await this.odb.open(e);if(n){const e=await n.put(t);return n.get(e)}}},aF=sF;var lF=n(7950),cF=n.t(lF,2);function uF(){return uF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},uF.apply(this,arguments)}function hF(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);const dF=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"];try{window.__reactRouterVersion="6"}catch(fz){}new Map;const fF=T.startTransition;cF.flushSync,T.useId;function pF(e){let{basename:t,children:n,future:r,window:i}=e,o=I.useRef();var s;null==o.current&&(o.current=(void 0===(s={window:i,v5Compat:!0})&&(s={}),M((function(e,t){let{pathname:n,search:r,hash:i}=e.location;return B("",{pathname:n,search:r,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||"default")}),(function(e,t){return"string"===typeof t?t:L(t)}),null,s)));let a=o.current,[l,c]=I.useState({action:a.action,location:a.location}),{v7_startTransition:u}=r||{},h=I.useCallback((e=>{u&&fF?fF((()=>c(e))):c(e)}),[c,u]);return I.useLayoutEffect((()=>a.listen(h)),[a,h]),I.createElement(Oe,{basename:t,children:n,location:l.location,navigationType:l.action,navigator:a,future:r})}const gF="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,yF=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,vF=I.forwardRef((function(e,t){let n,{onClick:r,relative:i,reloadDocument:o,replace:s,state:a,target:l,to:c,preventScrollReset:u,unstable_viewTransition:h}=e,d=hF(e,dF),{basename:f}=I.useContext(pe),p=!1;if("string"===typeof c&&yF.test(c)&&(n=c,gF))try{let e=new URL(window.location.href),t=c.startsWith("//")?new URL(e.protocol+c):new URL(c),n=Z(t.pathname,f);t.origin===e.origin&&null!=n?c=n+t.search+t.hash:p=!0}catch(fz){}let g=function(e,t){let{relative:n}=void 0===t?{}:t;me()||P(!1);let{basename:r,navigator:i}=I.useContext(pe),{hash:o,pathname:s,search:a}=_e(e,{relative:n}),l=s;return"/"!==r&&(l="/"===s?r:ie([r,s])),i.createHref({pathname:l,search:a,hash:o})}(c,{relative:i}),y=function(e,t){let{target:n,replace:r,state:i,preventScrollReset:o,relative:s,unstable_viewTransition:a}=void 0===t?{}:t,l=Ee(),c=we(),u=_e(e,{relative:s});return I.useCallback((t=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,n)){t.preventDefault();let n=void 0!==r?r:L(c)===L(u);l(e,{replace:n,state:i,preventScrollReset:o,relative:s,unstable_viewTransition:a})}}),[c,l,u,r,i,n,e,o,s,a])}(c,{replace:s,state:a,target:l,preventScrollReset:u,relative:i,unstable_viewTransition:h});return I.createElement("a",uF({},d,{href:n||g,onClick:p||o?r:function(e){r&&r(e),e.defaultPrevented||y(e)},ref:t,target:l}))}));var mF,wF;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(mF||(mF={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(wF||(wF={}));if(!I.useState)throw new Error("mobx-react-lite requires React with Hooks support");if(!Jx)throw new Error("mobx-react-lite@3 requires mobx at least version 6 to be available");function bF(e){e()}function EF(e){return Px(e)}var _F=!1;function SF(){return _F}var kF,AF,IF=function(){function e(e){var t=this;Object.defineProperty(this,"finalize",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"registrations",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"sweepTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sweep",{enumerable:!0,configurable:!0,writable:!0,value:function(e){void 0===e&&(e=1e4),clearTimeout(t.sweepTimeout),t.sweepTimeout=void 0;var n=Date.now();t.registrations.forEach((function(r,i){n-r.registeredAt>=e&&(t.finalize(r.value),t.registrations.delete(i))})),t.registrations.size>0&&t.scheduleSweep()}}),Object.defineProperty(this,"finalizeAllImmediately",{enumerable:!0,configurable:!0,writable:!0,value:function(){t.sweep(0)}})}return Object.defineProperty(e.prototype,"register",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){this.registrations.set(n,{value:t,registeredAt:Date.now()}),this.scheduleSweep()}}),Object.defineProperty(e.prototype,"unregister",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.registrations.delete(e)}}),Object.defineProperty(e.prototype,"scheduleSweep",{enumerable:!1,configurable:!0,writable:!0,value:function(){void 0===this.sweepTimeout&&(this.sweepTimeout=setTimeout(this.sweep,1e4))}}),e}(),TF=new("undefined"!==typeof FinalizationRegistry?FinalizationRegistry:IF)((function(e){var t;null===(t=e.reaction)||void 0===t||t.dispose(),e.reaction=null})),RF=n(9461);function CF(e){e.reaction=new nx("observer".concat(e.name),(function(){var t;e.stateVersion=Symbol(),null===(t=e.onStoreChange)||void 0===t||t.call(e)}))}function xF(e,t){if(void 0===t&&(t="observed"),SF())return e();var n=I.useRef(null);if(!n.current){var r={reaction:null,onStoreChange:null,stateVersion:Symbol(),name:t,subscribe:function(e){return TF.unregister(r),r.onStoreChange=e,r.reaction||(CF(r),r.stateVersion=Symbol()),function(){var e;r.onStoreChange=null,null===(e=r.reaction)||void 0===e||e.dispose(),r.reaction=null}},getSnapshot:function(){return r.stateVersion}};n.current=r}var i,o,s=n.current;if(s.reaction||(CF(s),TF.register(n,s,s)),I.useDebugValue(s.reaction,EF),(0,RF.useSyncExternalStore)(s.subscribe,s.getSnapshot,s.getSnapshot),s.reaction.track((function(){try{i=e()}catch(fz){o=fz}})),o)throw o;return i}var PF="function"===typeof Symbol&&Symbol.for,DF=null!==(AF=null===(kF=Object.getOwnPropertyDescriptor((function(){}),"name"))||void 0===kF?void 0:kF.configurable)&&void 0!==AF&&AF,NF=PF?Symbol.for("react.forward_ref"):"function"===typeof I.forwardRef&&(0,I.forwardRef)((function(e){return null})).$$typeof,BF=PF?Symbol.for("react.memo"):"function"===typeof I.memo&&(0,I.memo)((function(e){return null})).$$typeof;function LF(e,t){var n;if(BF&&e.$$typeof===BF)throw new Error("[mobx-react-lite] You are trying to use `observer` on a function component wrapped in either another `observer` or `React.memo`. The observer already applies 'React.memo' for you.");if(SF())return e;var r=null!==(n=null===t||void 0===t?void 0:t.forwardRef)&&void 0!==n&&n,i=e,o=e.displayName||e.name;if(NF&&e.$$typeof===NF&&(r=!0,"function"!==typeof(i=e.render)))throw new Error("[mobx-react-lite] `render` property of ForwardRef was not a function");var s=function(e,t){return xF((function(){return i(e,t)}),o)};return s.displayName=e.displayName,DF&&Object.defineProperty(s,"name",{value:e.name,writable:!0,configurable:!0}),e.contextTypes&&(s.contextTypes=e.contextTypes),r&&(s=(0,I.forwardRef)(s)),function(e,t){Object.keys(e).forEach((function(n){MF[n]||Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}))}(e,s=(0,I.memo)(s)),s}var OF,MF={$$typeof:!0,render:!0,compare:!0,type:!0,displayName:!0};(function(e){e||(e=bF),Cx({reactionScheduler:e})})(lF.unstable_batchedUpdates);OF=TF.finalizeAllImmediately;function UF(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}var FF=Symbol("patchMixins"),VF=Symbol("patchedDefinition");function zF(e,t){for(var n=this,r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];t.locks++;try{var s;return void 0!==e&&null!==e&&(s=e.apply(this,i)),s}finally{t.locks--,0===t.locks&&t.methods.forEach((function(e){e.apply(n,i)}))}}function KF(e,t){return function(){for(var n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];zF.call.apply(zF,[this,e,t].concat(r))}}function jF(e,t,n){var r=function(e,t){var n=e[FF]=e[FF]||{},r=n[t]=n[t]||{};return r.locks=r.locks||0,r.methods=r.methods||[],r}(e,t);r.methods.indexOf(n)<0&&r.methods.push(n);var i=Object.getOwnPropertyDescriptor(e,t);if(!i||!i[VF]){var o=e[t],s=HF(e,t,i?i.enumerable:void 0,r,o);Object.defineProperty(e,t,s)}}function HF(e,t,n,r,i){var o,s=KF(i,r);return(o={})[VF]=!0,o.get=function(){return s},o.set=function(i){if(this===e)s=KF(i,r);else{var o=HF(this,t,n,r,i);Object.defineProperty(this,t,o)}},o.configurable=!0,o.enumerable=n,o}var qF=Symbol("ObserverAdministration"),WF=Symbol("isMobXReactObserver");function GF(e){var t;return null!=(t=e[qF])?t:e[qF]={reaction:null,mounted:!1,reactionInvalidatedBeforeMount:!1,forceUpdate:null,name:YF(e.constructor),state:void 0,props:void 0,context:void 0}}function YF(e){return e.displayName||e.name||"<component>"}function QF(e){var t=e.bind(this),n=GF(this);return function(){n.reaction||(n.reaction=function(t){return new nx(t.name+".render()",(function(){if(t.mounted)try{null==t.forceUpdate||t.forceUpdate()}catch(e){var n;null==(n=t.reaction)||n.dispose(),t.reaction=null}else t.reactionInvalidatedBeforeMount=!0}))}(n),n.mounted||TF.register(this,n,this));var e=void 0,r=void 0;if(n.reaction.track((function(){try{r=kC(!1,t)}catch(fz){e=fz}})),e)throw e;return r}}function XF(e,t){return SF()&&console.warn("[mobx-react] It seems that a re-rendering of a React component is triggered while in static (server-side) mode. Please make sure components are rendered only once server-side."),this.state!==t||!function(e,t){if(UF(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(var i=0;i<n.length;i++)if(!Object.hasOwnProperty.call(t,n[i])||!UF(e[n[i]],t[n[i]]))return!1;return!0}(this.props,e)}function JF(e,t){if(t&&"class"!==t.kind)throw new Error("The @observer decorator can be used on classes only");return!0===e.isMobxInjector&&console.warn("Mobx observer: You are trying to use `observer` on a component that already has `inject`. Please apply `observer` before applying `inject`"),Object.prototype.isPrototypeOf.call(I.Component,e)||Object.prototype.isPrototypeOf.call(I.PureComponent,e)?function(e){var t=e.prototype;if(e[WF]){var n=YF(e);throw new Error("The provided component class ("+n+") has already been declared as an observer component.")}if(e[WF]=!0,t.componentWillReact)throw new Error("The componentWillReact life-cycle event is no longer supported");if(e.__proto__!==I.PureComponent)if(t.shouldComponentUpdate){if(t.shouldComponentUpdate!==XF)throw new Error("It is not allowed to use shouldComponentUpdate in observer based components.")}else t.shouldComponentUpdate=XF;var r=t.render;if("function"!==typeof r){var i=YF(e);throw new Error("[mobx-react] class component ("+i+") is missing `render` method.\n`observer` requires `render` being a function defined on prototype.\n`render = () => {}` or `render = function() {}` is not supported.")}t.render=function(){return Object.defineProperty(this,"render",{configurable:!1,writable:!1,value:SF()?r:QF.call(this,r)}),this.render()};var o=t.componentDidMount;return t.componentDidMount=function(){var e=this,t=GF(this);return t.mounted=!0,TF.unregister(this),t.forceUpdate=function(){return e.forceUpdate()},t.reaction&&!t.reactionInvalidatedBeforeMount||t.forceUpdate(),null==o?void 0:o.apply(this,arguments)},jF(t,"componentWillUnmount",(function(){var e;if(!SF()){var t=GF(this);null==(e=t.reaction)||e.dispose(),t.reaction=null,t.forceUpdate=null,t.mounted=!1,t.reactionInvalidatedBeforeMount=!1}})),e}(e):LF(e)}I.version.split(".")[0];if(!I.Component)throw new Error("mobx-react requires React to be available");if(!dC)throw new Error("mobx-react requires mobx to be available");var $F=n(579);const ZF=e=>{const[t,n]=(0,I.useState)("");return(0,$F.jsxs)("form",{onSubmit:async function(r){r.preventDefault(),await e.store.createNewPlaylist(t),n(""),console.log("name",t)},children:[(0,$F.jsx)("label",{htmlFor:"playlistName",children:"Enter a playlist name:"}),(0,$F.jsx)("br",{}),(0,$F.jsx)("input",{type:"text",placeholder:"New playlist",onChange:async function(e){e.preventDefault(),n(e.target.value)},value:t}),(0,$F.jsx)("input",{type:"submit",value:"Create"})]})},eV=e=>{let{playlist:t,store:n}=e;return(0,$F.jsxs)("li",{children:[(0,$F.jsx)(vF,{to:"#".concat(null===t||void 0===t?void 0:t.address),children:null===t||void 0===t?void 0:t.name}),(0,$F.jsx)("span",{style:{fontSize:"0.4em",cursor:"pointer"},onClick:e=>{console.log("deleting playlist!",t.key),e.stopPropagation(),n.deletePlaylist(t.key)},children:"del"})]})},tV=e=>{let{peer:t,index:n,store:r}=e;return(0,$F.jsx)("li",{children:t},n)},nV=JF((e=>(0,$F.jsxs)("div",{style:{maxWidth:"800px"},children:[(0,$F.jsx)(ZF,{...e}),(0,$F.jsx)("h1",{children:"PeerList"}),(0,$F.jsx)("div",{children:e.store.connectedPeers.map(((t,n)=>(0,$F.jsx)(tV,{index:n,peer:t,store:e.store})))}),(0,$F.jsxs)("ul",{className:"playlist-items",children:[" ",e.store.playlists.map((t=>(0,$F.jsx)(eV,{playlist:t,store:e.store},t.key)))]}),(0,$F.jsx)("button",{onClick:async()=>{e.store.playlistDB.drop(),e.store.playlists=[]},children:"Drop DB locally"})]})));var rV=n(9194);const iV=e=>{let{title:t}=e;return(0,$F.jsxs)("div",{className:"header",children:[(0,$F.jsx)(vF,{to:"#/",title:"Back to Home",children:" .. "}),(0,$F.jsx)("div",{id:"title",children:t})]})},oV=e=>{const[t,n]=(0,I.useState)([]),[r,i]=(0,I.useState)(!1),o=document.location.hash.split("/").length>1?"/orbitdb/"+document.location.hash.split("/")[2]:void 0;(0,I.useEffect)((function(){let t=!0;if(!o)return;return function(){e.store.joinPlaylist(o).then((async()=>{if(t){let t=await e.store.currentPlaylist.all();n(t),e.store.currentPlaylist.events.on("joined",(async()=>{let t=await e.store.currentPlaylist.all();n(t)}))}}))}(),()=>{n([]),t=!1}}),[o]);const s=e=>{let{name:t,hash:n}=e;return(0,$F.jsx)("div",{className:"playlist-item",onClick:()=>console.log(n),children:t})};return(0,$F.jsxs)("div",{className:"Playlist",children:[(0,$F.jsx)(iV,{title:"props.name to be defined"}),(0,$F.jsxs)("div",{className:"dragZone",onDragOver:e=>{e.preventDefault(),!r&&i(!0)},onDrop:t=>async function(t){t.preventDefault(),i(!1);const r=(0,rV.p$)(t);try{await e.store.sendFiles(r,o),n(e.store.currentPlaylist.all)}catch(s){throw console.log("ERROR",s),s}}(t),children:[(0,$F.jsxs)("ul",{children:[" ",t.map((e=>(0,$F.jsx)(s,{name:e.value.meta.name,hash:e.value.content},e.hash)))]}),(0,$F.jsx)("h2",{className:"message",children:"Drag audio files here to add them to the playlist"})]})]})},sV=JF((e=>e.store.isOnline?(0,$F.jsx)(oV,{...e}):null));function aV(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return null!=(null===(e=globalThis.Buffer)||void 0===e?void 0:e.alloc)?function(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}(globalThis.Buffer.alloc(t)):new Uint8Array(t)}var lV;!function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==n.lengthDelimited&&t.fork(),null!=e.publicKey&&e.publicKey.byteLength>0&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.addrs)for(const r of e.addrs)t.uint32(18),t.bytes(r);!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={publicKey:aV(0),addrs:[]},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.publicKey=e.bytes();break;case 2:n.addrs.push(e.bytes());break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=t=>Is(t,e.codec())}(lV||(lV={}));class cV extends bu{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),je(this,Au,!0),je(this,Symbol.toStringTag,"@libp2p/pubsub-peer-discovery"),je(this,"interval",void 0),je(this,"listenOnly",void 0),je(this,"topics",void 0),je(this,"intervalId",void 0),je(this,"components",void 0),je(this,"log",void 0);const{interval:n,topics:r,listenOnly:i}=t;this.components=e,this.interval=null!==n&&void 0!==n?n:1e4,this.listenOnly=null!==i&&void 0!==i&&i,this.log=e.logger.forComponent("libp2p:discovery:pubsub"),Array.isArray(r)&&r.length>0?this.topics=r:this.topics=["_peer-discovery._p2p._pubsub"],this._onMessage=this._onMessage.bind(this)}isStarted(){return null!=this.intervalId}start(){}afterStart(){if(null!=this.intervalId)return;const e=this.components.pubsub;if(null==e)throw new Error("PubSub not configured");for(const t of this.topics)e.subscribe(t),e.addEventListener("message",this._onMessage);this.listenOnly||(this._broadcast(),this.intervalId=setInterval((()=>{this._broadcast()}),this.interval))}beforeStop(){const e=this.components.pubsub;if(null==e)throw new Error("PubSub not configured");for(const t of this.topics)e.unsubscribe(t),e.removeEventListener("message",this._onMessage)}stop(){null!=this.intervalId&&(clearInterval(this.intervalId),this.intervalId=void 0)}_broadcast(){const e=this.components.peerId;if(null==e.publicKey)throw new Error("PeerId was missing public key");const t={publicKey:e.publicKey,addrs:this.components.addressManager.getAddresses().map((e=>e.bytes))},n=lV.encode(t),r=this.components.pubsub;if(null==r)throw new Error("PubSub not configured");for(const i of this.topics)0!==r.getSubscribers(i).length?(this.log("broadcasting our peer data on topic %s",i),r.publish(i,n)):this.log("skipping broadcasting our peer data on topic %s because there are no peers present",i)}_onMessage(e){if(!this.isStarted())return;const t=e.detail;if(!this.topics.includes(t.topic))return;const n=lV.decode(t.data);Fu(n.publicKey).then((e=>{e.equals(this.components.peerId)||(this.log("discovered peer %p on %s",e,t.topic),this.safeDispatchEvent("peer",{detail:{id:e,multiaddrs:n.addrs.map((e=>Vh(e)))}}))})).catch((e=>{this.log.error(e)}))}}const uV="StrictSign",hV="StrictNoSign";var dV;!function(e){e.Accept="accept",e.Ignore="ignore",e.Reject="reject"}(dV||(dV={}));const fV="/floodsub/1.0.0",pV="/meshsub/1.0.0",gV="/meshsub/1.1.0",yV=5e3,vV={maxSubscriptions:1/0,maxMessages:1/0,maxIhaveMessageIDs:1/0,maxIwantMessageIDs:1/0,maxControlMessages:1/0,maxPeerInfos:1/0};var mV,wV,bV,EV,_V,SV,kV,AV,IV,TV,RV,CV;!function(e){let t,n,r,i,o,s,a,l,c;!function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.subscribe&&(t.uint32(8),t.bool(e.subscribe)),null!=e.topic&&(t.uint32(18),t.string(e.topic)),!1!==n.lengthDelimited&&t.ldelim()}),(function(e,t){const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.subscribe=e.bool();break;case 2:n.topic=e.string();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=(t,n)=>Is(t,e.codec(),n)}(t=e.SubOpts||(e.SubOpts={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.from&&(t.uint32(10),t.bytes(e.from)),null!=e.data&&(t.uint32(18),t.bytes(e.data)),null!=e.seqno&&(t.uint32(26),t.bytes(e.seqno)),null!=e.topic&&""!==e.topic&&(t.uint32(34),t.string(e.topic)),null!=e.signature&&(t.uint32(42),t.bytes(e.signature)),null!=e.key&&(t.uint32(50),t.bytes(e.key)),!1!==n.lengthDelimited&&t.ldelim()}),(function(e,t){const n={topic:""},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.from=e.bytes();break;case 2:n.data=e.bytes();break;case 3:n.seqno=e.bytes();break;case 4:n.topic=e.string();break;case 5:n.signature=e.bytes();break;case 6:n.key=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=(t,n)=>Is(t,e.codec(),n)}(n=e.Message||(e.Message={})),function(t){let n;t.codec=()=>(null==n&&(n=Ys((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==r.lengthDelimited&&n.fork(),null!=t.ihave)for(const i of t.ihave)n.uint32(10),e.ControlIHave.codec().encode(i,n);if(null!=t.iwant)for(const i of t.iwant)n.uint32(18),e.ControlIWant.codec().encode(i,n);if(null!=t.graft)for(const i of t.graft)n.uint32(26),e.ControlGraft.codec().encode(i,n);if(null!=t.prune)for(const i of t.prune)n.uint32(34),e.ControlPrune.codec().encode(i,n);!1!==r.lengthDelimited&&n.ldelim()}),(function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i={ihave:[],iwant:[],graft:[],prune:[]},o=null==n?t.len:t.pos+n;for(;t.pos<o;){const n=t.uint32();switch(n>>>3){case 1:var s;if(null!=(null===(s=r.limits)||void 0===s?void 0:s.ihave)&&i.ihave.length===r.limits.ihave)throw new Qs('decode error - map field "ihave" had too many elements',"ERR_MAX_LENGTH");i.ihave.push(e.ControlIHave.codec().decode(t,t.uint32()));break;case 2:var a;if(null!=(null===(a=r.limits)||void 0===a?void 0:a.iwant)&&i.iwant.length===r.limits.iwant)throw new Qs('decode error - map field "iwant" had too many elements',"ERR_MAX_LENGTH");i.iwant.push(e.ControlIWant.codec().decode(t,t.uint32()));break;case 3:var l;if(null!=(null===(l=r.limits)||void 0===l?void 0:l.graft)&&i.graft.length===r.limits.graft)throw new Qs('decode error - map field "graft" had too many elements',"ERR_MAX_LENGTH");i.graft.push(e.ControlGraft.codec().decode(t,t.uint32()));break;case 4:var c;if(null!=(null===(c=r.limits)||void 0===c?void 0:c.prune)&&i.prune.length===r.limits.prune)throw new Qs('decode error - map field "prune" had too many elements',"ERR_MAX_LENGTH");i.prune.push(e.ControlPrune.codec().decode(t,t.uint32()));break;default:t.skipType(7&n)}}return i}))),n),t.encode=e=>Vs(e,t.codec()),t.decode=(e,n)=>Is(e,t.codec(),n)}(r=e.ControlMessage||(e.ControlMessage={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==n.lengthDelimited&&t.fork(),null!=e.topicID&&(t.uint32(10),t.string(e.topicID)),null!=e.messageIDs)for(const r of e.messageIDs)t.uint32(18),t.bytes(r);!1!==n.lengthDelimited&&t.ldelim()}),(function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r={messageIDs:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){const t=e.uint32();switch(t>>>3){case 1:r.topicID=e.string();break;case 2:var o;if(null!=(null===(o=n.limits)||void 0===o?void 0:o.messageIDs)&&r.messageIDs.length===n.limits.messageIDs)throw new Qs('decode error - map field "messageIDs" had too many elements',"ERR_MAX_LENGTH");r.messageIDs.push(e.bytes());break;default:e.skipType(7&t)}}return r}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=(t,n)=>Is(t,e.codec(),n)}(i=e.ControlIHave||(e.ControlIHave={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==n.lengthDelimited&&t.fork(),null!=e.messageIDs)for(const r of e.messageIDs)t.uint32(10),t.bytes(r);!1!==n.lengthDelimited&&t.ldelim()}),(function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const r={messageIDs:[]},i=null==t?e.len:e.pos+t;for(;e.pos<i;){const t=e.uint32();if(t>>>3===1){var o;if(null!=(null===(o=n.limits)||void 0===o?void 0:o.messageIDs)&&r.messageIDs.length===n.limits.messageIDs)throw new Qs('decode error - map field "messageIDs" had too many elements',"ERR_MAX_LENGTH");r.messageIDs.push(e.bytes())}else e.skipType(7&t)}return r}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=(t,n)=>Is(t,e.codec(),n)}(o=e.ControlIWant||(e.ControlIWant={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.topicID&&(t.uint32(10),t.string(e.topicID)),!1!==n.lengthDelimited&&t.ldelim()}),(function(e,t){const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();if(t>>>3===1)n.topicID=e.string();else e.skipType(7&t)}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=(t,n)=>Is(t,e.codec(),n)}(s=e.ControlGraft||(e.ControlGraft={})),function(t){let n;t.codec=()=>(null==n&&(n=Ys((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==r.lengthDelimited&&n.fork(),null!=t.topicID&&(n.uint32(10),n.string(t.topicID)),null!=t.peers)for(const i of t.peers)n.uint32(18),e.PeerInfo.codec().encode(i,n);null!=t.backoff&&(n.uint32(24),n.uint64Number(t.backoff)),!1!==r.lengthDelimited&&n.ldelim()}),(function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i={peers:[]},o=null==n?t.len:t.pos+n;for(;t.pos<o;){const n=t.uint32();switch(n>>>3){case 1:i.topicID=t.string();break;case 2:var s;if(null!=(null===(s=r.limits)||void 0===s?void 0:s.peers)&&i.peers.length===r.limits.peers)throw new Qs('decode error - map field "peers" had too many elements',"ERR_MAX_LENGTH");i.peers.push(e.PeerInfo.codec().decode(t,t.uint32()));break;case 3:i.backoff=t.uint64Number();break;default:t.skipType(7&n)}}return i}))),n),t.encode=e=>Vs(e,t.codec()),t.decode=(e,n)=>Is(e,t.codec(),n)}(a=e.ControlPrune||(e.ControlPrune={})),function(e){let t;e.codec=()=>(null==t&&(t=Ys((function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!1!==n.lengthDelimited&&t.fork(),null!=e.peerID&&(t.uint32(10),t.bytes(e.peerID)),null!=e.signedPeerRecord&&(t.uint32(18),t.bytes(e.signedPeerRecord)),!1!==n.lengthDelimited&&t.ldelim()}),(function(e,t){const n={},r=null==t?e.len:e.pos+t;for(;e.pos<r;){const t=e.uint32();switch(t>>>3){case 1:n.peerID=e.bytes();break;case 2:n.signedPeerRecord=e.bytes();break;default:e.skipType(7&t)}}return n}))),t),e.encode=t=>Vs(t,e.codec()),e.decode=(t,n)=>Is(t,e.codec(),n)}(l=e.PeerInfo||(e.PeerInfo={})),e.codec=()=>(null==c&&(c=Ys((function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!1!==r.lengthDelimited&&n.fork(),null!=t.subscriptions)for(const i of t.subscriptions)n.uint32(10),e.SubOpts.codec().encode(i,n);if(null!=t.messages)for(const i of t.messages)n.uint32(18),e.Message.codec().encode(i,n);null!=t.control&&(n.uint32(26),e.ControlMessage.codec().encode(t.control,n)),!1!==r.lengthDelimited&&n.ldelim()}),(function(t,n){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const i={subscriptions:[],messages:[]},o=null==n?t.len:t.pos+n;for(;t.pos<o;){const n=t.uint32();switch(n>>>3){case 1:var s;if(null!=(null===(s=r.limits)||void 0===s?void 0:s.subscriptions)&&i.subscriptions.length===r.limits.subscriptions)throw new Qs('decode error - map field "subscriptions" had too many elements',"ERR_MAX_LENGTH");i.subscriptions.push(e.SubOpts.codec().decode(t,t.uint32()));break;case 2:var a;if(null!=(null===(a=r.limits)||void 0===a?void 0:a.messages)&&i.messages.length===r.limits.messages)throw new Qs('decode error - map field "messages" had too many elements',"ERR_MAX_LENGTH");i.messages.push(e.Message.codec().decode(t,t.uint32()));break;case 3:i.control=e.ControlMessage.codec().decode(t,t.uint32());break;default:t.skipType(7&n)}}return i}))),c),e.encode=t=>Vs(t,e.codec()),e.decode=(t,n)=>Is(t,e.codec(),n)}(mV||(mV={}));class xV{constructor(e,t,n){je(this,"gossip",void 0),je(this,"msgs",new Map),je(this,"msgIdToStrFn",void 0),je(this,"history",[]),je(this,"notValidatedCount",0),this.gossip=e,this.msgIdToStrFn=n;for(let r=0;r<t;r++)this.history[r]=[]}get size(){return this.msgs.size}put(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{msgIdStr:r}=e;return!this.msgs.has(r)&&(this.msgs.set(r,{message:t,validated:n,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:t.topic}),n||this.notValidatedCount++,!0)}observeDuplicate(e,t){const n=this.msgs.get(e);null==n||n.validated||n.originatingPeers.add(t)}get(e){var t;return null===(t=this.msgs.get(this.msgIdToStrFn(e)))||void 0===t?void 0:t.message}getWithIWantCount(e,t){var n;const r=this.msgs.get(e);if(null==r)return null;const i=(null!==(n=r.iwantCounts.get(t))&&void 0!==n?n:0)+1;return r.iwantCounts.set(t,i),{msg:r.message,count:i}}getGossipIDs(e){const t=new Map;for(let n=0;n<this.gossip;n++)this.history[n].forEach((n=>{var r;const i=this.msgs.get(n.msgIdStr);if(null!==(r=null===i||void 0===i?void 0:i.validated)&&void 0!==r&&r&&e.has(n.topic)){let e=t.get(n.topic);null==e&&(e=[],t.set(n.topic,e)),e.push(n.msgId)}}));return t}validate(e){const t=this.msgs.get(e);if(null==t)return null;t.validated||this.notValidatedCount--;const{message:n,originatingPeers:r}=t;return t.validated=!0,t.originatingPeers=new Set,{message:n,originatingPeers:r}}shift(){this.history[this.history.length-1].forEach((e=>{const t=this.msgs.get(e.msgIdStr);null!=t&&(this.msgs.delete(e.msgIdStr),t.validated||this.notValidatedCount--)})),this.history.pop(),this.history.unshift([])}remove(e){const t=this.msgs.get(e);return null==t?null:(this.msgs.delete(e),t)}}function PV(e){switch(e){case dV.Ignore:return EV.Ignore;case dV.Reject:return EV.Reject;default:throw new Error("Unreachable")}}!function(e){e.StrictSign="StrictSign",e.StrictNoSign="StrictNoSign"}(wV||(wV={})),function(e){e[e.Signing=0]="Signing",e[e.Anonymous=1]="Anonymous"}(bV||(bV={})),function(e){e.Error="error",e.Ignore="ignore",e.Reject="reject",e.Blacklisted="blacklisted"}(EV||(EV={})),function(e){e.InvalidSignature="invalid_signature",e.InvalidSeqno="invalid_seqno",e.InvalidPeerId="invalid_peerid",e.SignaturePresent="signature_present",e.SeqnoPresent="seqno_present",e.FromPresent="from_present",e.TransformFailed="transform_failed"}(_V||(_V={})),function(e){e.duplicate="duplicate",e.invalid="invalid",e.valid="valid"}(SV||(SV={})),function(e){e.forward="forward",e.publish="publish"}(kV||(kV={})),function(e){e.Fanout="fanout",e.Random="random",e.Subscribed="subscribed",e.Outbound="outbound",e.NotEnough="not_enough",e.Opportunistic="opportunistic"}(AV||(AV={})),function(e){e.Dc="disconnected",e.BadScore="bad_score",e.Prune="prune",e.Excess="excess"}(IV||(IV={})),function(e){e.GraftBackoff="graft_backoff",e.BrokenPromise="broken_promise",e.MessageDeficit="message_deficit",e.IPColocation="IP_colocation"}(TV||(TV={})),function(e){e.LowScore="low_score",e.MaxIhave="max_ihave",e.MaxIasked="max_iasked"}(RV||(RV={})),function(e){e.graylist="graylist",e.publish="publish",e.gossip="gossip",e.mesh="mesh"}(CV||(CV={}));const DV="ERR_INVALID_PEER_SCORE_PARAMS",NV={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:36e5},BV={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function LV(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{...NV,...e,topics:null!=e.topics?Object.entries(e.topics).reduce(((e,t)=>{let[n,r]=t;return e[n]=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{...BV,...e}}(r),e}),{}):{}}}function OV(e){if(e.topicWeight<0)throw new Mr("invalid topic weight; must be >= 0",DV);if(0===e.timeInMeshQuantum)throw new Mr("invalid TimeInMeshQuantum; must be non zero",DV);if(e.timeInMeshWeight<0)throw new Mr("invalid TimeInMeshWeight; must be positive (or 0 to disable)",DV);if(0!==e.timeInMeshWeight&&e.timeInMeshQuantum<=0)throw new Mr("invalid TimeInMeshQuantum; must be positive",DV);if(0!==e.timeInMeshWeight&&e.timeInMeshCap<=0)throw new Mr("invalid TimeInMeshCap; must be positive",DV);if(e.firstMessageDeliveriesWeight<0)throw new Mr("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)",DV);if(0!==e.firstMessageDeliveriesWeight&&(e.firstMessageDeliveriesDecay<=0||e.firstMessageDeliveriesDecay>=1))throw new Mr("invalid FirstMessageDeliveriesDecay; must be between 0 and 1",DV);if(0!==e.firstMessageDeliveriesWeight&&e.firstMessageDeliveriesCap<=0)throw new Mr("invalid FirstMessageDeliveriesCap; must be positive",DV);if(e.meshMessageDeliveriesWeight>0)throw new Mr("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)",DV);if(0!==e.meshMessageDeliveriesWeight&&(e.meshMessageDeliveriesDecay<=0||e.meshMessageDeliveriesDecay>=1))throw new Mr("invalid MeshMessageDeliveriesDecay; must be between 0 and 1",DV);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesCap<=0)throw new Mr("invalid MeshMessageDeliveriesCap; must be positive",DV);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesThreshold<=0)throw new Mr("invalid MeshMessageDeliveriesThreshold; must be positive",DV);if(e.meshMessageDeliveriesWindow<0)throw new Mr("invalid MeshMessageDeliveriesWindow; must be non-negative",DV);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesActivation<1e3)throw new Mr("invalid MeshMessageDeliveriesActivation; must be at least 1s",DV);if(e.meshFailurePenaltyWeight>0)throw new Mr("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)",DV);if(0!==e.meshFailurePenaltyWeight&&(e.meshFailurePenaltyDecay<=0||e.meshFailurePenaltyDecay>=1))throw new Mr("invalid MeshFailurePenaltyDecay; must be between 0 and 1",DV);if(e.invalidMessageDeliveriesWeight>0)throw new Mr("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)",DV);if(e.invalidMessageDeliveriesDecay<=0||e.invalidMessageDeliveriesDecay>=1)throw new Mr("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1",DV)}const MV={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function UV(){return{...MV,...arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}}}function FV(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;const r=new Set;if(t<=0)return r;for(const i of e){if(r.size>=t)break;n(i)&&(r.add(i),e.delete(i))}return r}class VV extends Map{constructor(e){super(),je(this,"getDefault",void 0),this.getDefault=e}getOrDefault(e){let t=super.get(e);return void 0===t&&(t=this.getDefault(),this.set(e,t)),t}}function zV(e,t,n,r){let i=0;Object.entries(t.topics).forEach((e=>{let[t,r]=e;const o=n.topics[t];if(void 0===o)return;let s=0;if(r.inMesh){let e=r.meshTime/o.timeInMeshQuantum;e>o.timeInMeshCap&&(e=o.timeInMeshCap),s+=e*o.timeInMeshWeight}let a=r.firstMessageDeliveries;if(a>o.firstMessageDeliveriesCap&&(a=o.firstMessageDeliveriesCap),s+=a*o.firstMessageDeliveriesWeight,r.meshMessageDeliveriesActive&&r.meshMessageDeliveries<o.meshMessageDeliveriesThreshold){const e=o.meshMessageDeliveriesThreshold-r.meshMessageDeliveries;s+=e*e*o.meshMessageDeliveriesWeight}s+=r.meshFailurePenalty*o.meshFailurePenaltyWeight;s+=r.invalidMessageDeliveries*r.invalidMessageDeliveries*o.invalidMessageDeliveriesWeight,i+=s*o.topicWeight})),n.topicScoreCap>0&&i>n.topicScoreCap&&(i=n.topicScoreCap);const o=n.appSpecificScore(e);if(i+=o*n.appSpecificWeight,t.knownIPs.forEach((e=>{if(n.IPColocationFactorWhitelist.has(e))return;const t=r.get(e),o=null!=t?t.size:0;if(o>n.IPColocationFactorThreshold){const e=o-n.IPColocationFactorThreshold;i+=e*e*n.IPColocationFactorWeight}})),t.behaviourPenalty>n.behaviourPenaltyThreshold){const e=t.behaviourPenalty-n.behaviourPenaltyThreshold;i+=e*e*n.behaviourPenaltyWeight}return i}var KV,jV=n(80);!function(e){e[e.unknown=0]="unknown",e[e.valid=1]="valid",e[e.invalid=2]="invalid",e[e.ignored=3]="ignored"}(KV||(KV={}));class HV{constructor(){je(this,"records",void 0),je(this,"queue",void 0),this.records=new Map,this.queue=new jV}getRecord(e){return this.records.get(e)}ensureRecord(e){let t=this.records.get(e);if(null!=t)return t;t={status:KV.unknown,firstSeenTsMs:Date.now(),validated:0,peers:new Set},this.records.set(e,t);const n={msgId:e,expire:Date.now()+12e4};return this.queue.push(n),t}gc(){const e=Date.now();let t=this.queue.peekFront();for(;null!=t&&t.expire<e;)this.records.delete(t.msgId),this.queue.shift(),t=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}class qV{constructor(e,t,n,r){var i;je(this,"params",void 0),je(this,"metrics",void 0),je(this,"peerStats",new Map),je(this,"peerIPs",new VV((()=>new Set))),je(this,"scoreCache",new Map),je(this,"deliveryRecords",new HV),je(this,"_backgroundInterval",void 0),je(this,"scoreCacheValidityMs",void 0),je(this,"computeScore",void 0),je(this,"log",void 0),this.params=e,this.metrics=t,function(e){for(const[t,n]of Object.entries(e.topics))try{OV(n)}catch(fz){throw new Mr("invalid score parameters for topic ".concat(t,": ").concat(fz.message),DV)}if(e.topicScoreCap<0)throw new Mr("invalid topic score cap; must be positive (or 0 for no cap)",DV);if(null===e.appSpecificScore||void 0===e.appSpecificScore)throw new Mr("missing application specific score function",DV);if(e.IPColocationFactorWeight>0)throw new Mr("invalid IPColocationFactorWeight; must be negative (or 0 to disable)",DV);if(0!==e.IPColocationFactorWeight&&e.IPColocationFactorThreshold<1)throw new Mr("invalid IPColocationFactorThreshold; must be at least 1",DV);if(e.behaviourPenaltyWeight>0)throw new Mr("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)",DV);if(0!==e.behaviourPenaltyWeight&&(e.behaviourPenaltyDecay<=0||e.behaviourPenaltyDecay>=1))throw new Mr("invalid BehaviourPenaltyDecay; must be between 0 and 1",DV);if(e.decayInterval<1e3)throw new Mr("invalid DecayInterval; must be at least 1s",DV);if(e.decayToZero<=0||e.decayToZero>=1)throw new Mr("invalid DecayToZero; must be between 0 and 1",DV)}(e),this.scoreCacheValidityMs=r.scoreCacheValidityMs,this.computeScore=null!==(i=r.computeScore)&&void 0!==i?i:zV,this.log=n.forComponent("libp2p:gossipsub:score")}get size(){return this.peerStats.size}start(){null==this._backgroundInterval?(this._backgroundInterval=setInterval((()=>{this.background()}),this.params.decayInterval),this.log("started")):this.log("Peer score already running")}stop(){null!=this._backgroundInterval?(clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),this.log("stopped")):this.log("Peer score already stopped")}background(){this.refreshScores(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map((e=>{let[t,n]=e;return[t,n]})))}messageFirstSeenTimestampMs(e){const t=this.deliveryRecords.getRecord(e);return null!=t?t.firstSeenTsMs:null}refreshScores(){const e=Date.now(),t=this.params.decayToZero;this.peerStats.forEach(((n,r)=>{n.connected?(Object.entries(n.topics).forEach((n=>{let[r,i]=n;const o=this.params.topics[r];void 0!==o&&(i.firstMessageDeliveries*=o.firstMessageDeliveriesDecay,i.firstMessageDeliveries<t&&(i.firstMessageDeliveries=0),i.meshMessageDeliveries*=o.meshMessageDeliveriesDecay,i.meshMessageDeliveries<t&&(i.meshMessageDeliveries=0),i.meshFailurePenalty*=o.meshFailurePenaltyDecay,i.meshFailurePenalty<t&&(i.meshFailurePenalty=0),i.invalidMessageDeliveries*=o.invalidMessageDeliveriesDecay,i.invalidMessageDeliveries<t&&(i.invalidMessageDeliveries=0),i.inMesh&&(i.meshTime=e-i.graftTime,i.meshTime>o.meshMessageDeliveriesActivation&&(i.meshMessageDeliveriesActive=!0)))})),n.behaviourPenalty*=this.params.behaviourPenaltyDecay,n.behaviourPenalty<t&&(n.behaviourPenalty=0)):e>n.expire&&(this.removeIPsForPeer(r,n.knownIPs),this.peerStats.delete(r),this.scoreCache.delete(r))}))}score(e){var t,n;null===(t=this.metrics)||void 0===t||t.scoreFnCalls.inc();const r=this.peerStats.get(e);if(null==r)return 0;const i=Date.now(),o=this.scoreCache.get(e);if(null!=o&&o.cacheUntil>i)return o.score;null===(n=this.metrics)||void 0===n||n.scoreFnRuns.inc();const s=this.computeScore(e,r,this.params,this.peerIPs),a=i+this.scoreCacheValidityMs;var l;null!=o?(null===(l=this.metrics)||void 0===l||l.scoreCachedDelta.observe(Math.abs(s-o.score)),o.score=s,o.cacheUntil=a):this.scoreCache.set(e,{score:s,cacheUntil:a});return s}addPenalty(e,t,n){const r=this.peerStats.get(e);var i;null!=r&&(r.behaviourPenalty+=t,null===(i=this.metrics)||void 0===i||i.onScorePenalty(n))}addPeer(e){const t={connected:!0,expire:0,topics:{},knownIPs:new Set,behaviourPenalty:0};this.peerStats.set(e,t)}addIP(e,t){const n=this.peerStats.get(e);null!=n&&n.knownIPs.add(t),this.peerIPs.getOrDefault(t).add(e)}removeIP(e,t){const n=this.peerStats.get(e);null!=n&&n.knownIPs.delete(t);const r=this.peerIPs.get(t);null!=r&&(r.delete(e),0===r.size&&this.peerIPs.delete(t))}removePeer(e){const t=this.peerStats.get(e);if(null!=t){if(this.score(e)>0)return this.removeIPsForPeer(e,t.knownIPs),void this.peerStats.delete(e);Object.entries(t.topics).forEach((e=>{let[t,n]=e;n.firstMessageDeliveries=0;const r=this.params.topics[t].meshMessageDeliveriesThreshold;if(n.inMesh&&n.meshMessageDeliveriesActive&&n.meshMessageDeliveries<r){const e=r-n.meshMessageDeliveries;n.meshFailurePenalty+=e*e}n.inMesh=!1,n.meshMessageDeliveriesActive=!1})),t.connected=!1,t.expire=Date.now()+this.params.retainScore}}graft(e,t){const n=this.peerStats.get(e);if(null!=n){const e=this.getPtopicStats(n,t);null!=e&&(e.inMesh=!0,e.graftTime=Date.now(),e.meshTime=0,e.meshMessageDeliveriesActive=!1)}}prune(e,t){const n=this.peerStats.get(e);if(null!=n){const e=this.getPtopicStats(n,t);if(null!=e){const n=this.params.topics[t].meshMessageDeliveriesThreshold;if(e.meshMessageDeliveriesActive&&e.meshMessageDeliveries<n){const t=n-e.meshMessageDeliveries;e.meshFailurePenalty+=t*t}e.meshMessageDeliveriesActive=!1,e.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,t,n){this.markFirstMessageDelivery(e,n);const r=this.deliveryRecords.ensureRecord(t),i=Date.now();r.status===KV.unknown?(r.status=KV.valid,r.validated=i,r.peers.forEach((t=>{t!==e.toString()&&this.markDuplicateMessageDelivery(t,n)}))):this.log("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,i-r.firstSeenTsMs,KV[r.status])}rejectInvalidMessage(e,t){this.markInvalidMessageDelivery(e,t)}rejectMessage(e,t,n,r){switch(r){case EV.Error:return void this.markInvalidMessageDelivery(e,n);case EV.Blacklisted:return}const i=this.deliveryRecords.ensureRecord(t);if(i.status===KV.unknown){if(r===EV.Ignore)return i.status=KV.ignored,void i.peers.clear();i.status=KV.invalid,this.markInvalidMessageDelivery(e,n),i.peers.forEach((e=>{this.markInvalidMessageDelivery(e,n)})),i.peers.clear()}else this.log("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-i.firstSeenTsMs,KV[i.status])}duplicateMessage(e,t,n){const r=this.deliveryRecords.ensureRecord(t);if(!r.peers.has(e))switch(r.status){case KV.unknown:r.peers.add(e);break;case KV.valid:r.peers.add(e),this.markDuplicateMessageDelivery(e,n,r.validated);break;case KV.invalid:this.markInvalidMessageDelivery(e,n);case KV.ignored:}}markInvalidMessageDelivery(e,t){const n=this.peerStats.get(e);if(null!=n){const e=this.getPtopicStats(n,t);null!=e&&(e.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,t){const n=this.peerStats.get(e);if(null!=n){const e=this.getPtopicStats(n,t);if(null!=e){let n=this.params.topics[t].firstMessageDeliveriesCap;e.firstMessageDeliveries=Math.min(n,e.firstMessageDeliveries+1),e.inMesh&&(n=this.params.topics[t].meshMessageDeliveriesCap,e.meshMessageDeliveries=Math.min(n,e.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,t,n){const r=this.peerStats.get(e);if(null!=r){const e=void 0!==n?Date.now():0,o=this.getPtopicStats(r,t);if(null!=o&&o.inMesh){const r=this.params.topics[t];if(void 0!==n){var i;const o=e-n,s=o>r.meshMessageDeliveriesWindow;if(null===(i=this.metrics)||void 0===i||i.onDuplicateMsgDelivery(t,o,s),s)return}const s=r.meshMessageDeliveriesCap;o.meshMessageDeliveries=Math.min(s,o.meshMessageDeliveries+1)}}}removeIPsForPeer(e,t){for(const n of t){const t=this.peerIPs.get(n);null!=t&&(t.delete(e),0===t.size&&this.peerIPs.delete(n))}}getPtopicStats(e,t){let n=e.topics[t];return void 0!==n?n:void 0!==this.params.topics[t]?(n={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[t]=n,n):null}}function WV(e,t,n,r,i){let o=0;const s=new Map;if(Object.entries(t.topics).forEach((e=>{var t;let[r,a]=e;const l=null!==(t=i.get(r))&&void 0!==t?t:"unknown",c=n.topics[r];if(void 0===c)return;let u=s.get(l);null==u&&(u={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},s.set(l,u));let h=0,d=0,f=0,p=0,g=0;if(a.inMesh){h+=Math.max(a.meshTime/c.timeInMeshQuantum,c.timeInMeshCap)*c.timeInMeshWeight}let y=a.firstMessageDeliveries;if(y>c.firstMessageDeliveriesCap&&(y=c.firstMessageDeliveriesCap),d+=y*c.firstMessageDeliveriesWeight,a.meshMessageDeliveriesActive&&a.meshMessageDeliveries<c.meshMessageDeliveriesThreshold){const e=c.meshMessageDeliveriesThreshold-a.meshMessageDeliveries;f+=e*e*c.meshMessageDeliveriesWeight}p+=a.meshFailurePenalty*c.meshFailurePenaltyWeight;g+=a.invalidMessageDeliveries*a.invalidMessageDeliveries*c.invalidMessageDeliveriesWeight,o+=(h+d+f+p+g)*c.topicWeight,u.p1w+=h,u.p2w+=d,u.p3w+=f,u.p3bw+=p,u.p4w+=g})),n.topicScoreCap>0&&o>n.topicScoreCap){o=n.topicScoreCap;const e=n.topicScoreCap/o;for(const t of s.values())t.p1w*=e,t.p2w*=e,t.p3w*=e,t.p3bw*=e,t.p4w*=e}let a=0,l=0,c=0;a+=n.appSpecificScore(e)*n.appSpecificWeight,t.knownIPs.forEach((e=>{if(n.IPColocationFactorWhitelist.has(e))return;const t=r.get(e),i=null!=t?t.size:0;if(i>n.IPColocationFactorThreshold){const e=i-n.IPColocationFactorThreshold;l+=e*e*n.IPColocationFactorWeight}}));return c+=t.behaviourPenalty*t.behaviourPenalty*n.behaviourPenaltyWeight,o+=a+l+c,{byTopic:s,p5w:a,p6w:l,p7w:c,score:o}}class GV{constructor(e,t,n){var r;je(this,"rawStream",void 0),je(this,"pushable",void 0),je(this,"closeController",void 0),je(this,"maxBufferSize",void 0),this.rawStream=e,this.pushable=_n(),this.closeController=new AbortController,this.maxBufferSize=null!==(r=n.maxBufferSize)&&void 0!==r?r:1/0,this.closeController.signal.addEventListener("abort",(()=>{e.close().catch((t=>{e.abort(t)}))})),Cr(this.pushable,this.rawStream).catch(t)}get protocol(){return this.rawStream.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error("OutboundStream buffer full, size > ".concat(this.maxBufferSize));this.pushable.push(mg.single(e))}pushPrefixed(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error("OutboundStream buffer full, size > ".concat(this.maxBufferSize));this.pushable.push(e)}async close(){this.closeController.abort(),await this.pushable.return()}}class YV{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};je(this,"source",void 0),je(this,"rawStream",void 0),je(this,"closeController",void 0),this.rawStream=e,this.closeController=new AbortController,this.closeController.signal.addEventListener("abort",(()=>{e.close().catch((t=>{e.abort(t)}))})),this.source=Cr(this.rawStream,(e=>Eg(e,t)))}async close(){this.closeController.abort()}}class QV{constructor(e,t,n){je(this,"gossipsubIWantFollowupMs",void 0),je(this,"msgIdToStrFn",void 0),je(this,"metrics",void 0),je(this,"promises",new Map),je(this,"requestMsByMsg",new Map),je(this,"requestMsByMsgExpire",void 0),this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=t,this.metrics=n,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,t){const n=t[Math.floor(Math.random()*t.length)],r=this.msgIdToStrFn(n);let i=this.promises.get(r);null==i&&(i=new Map,this.promises.set(r,i));const o=Date.now();i.has(e)||(i.set(e,o+this.gossipsubIWantFollowupMs),null!=this.metrics&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(r)||this.requestMsByMsg.set(r,o)))}getBrokenPromises(){var e;const t=Date.now(),n=new Map;let r=0;return this.promises.forEach(((e,i)=>{e.forEach(((i,o)=>{var s;i<t&&(n.set(o,(null!==(s=n.get(o))&&void 0!==s?s:0)+1),e.delete(o),r++)})),0===e.size&&this.promises.delete(i)})),null===(e=this.metrics)||void 0===e||e.iwantPromiseBroken.inc(r),n}deliverMessage(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.trackMessage(e);const n=this.promises.get(e);null!=n&&(this.promises.delete(e),null!=this.metrics&&(this.metrics.iwantPromiseResolved.inc(1),t&&this.metrics.iwantPromiseResolvedFromDuplicate.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(n.size)))}rejectMessage(e,t){this.trackMessage(e),t!==EV.Error&&this.promises.delete(e)}clear(){this.promises.clear()}prune(){var e;const t=Date.now()-this.requestMsByMsgExpire;let n=0;for(const[r,i]of this.requestMsByMsg.entries()){if(!(i<t))break;this.requestMsByMsg.delete(r),n++}null===(e=this.metrics)||void 0===e||e.iwantMessagePruned.inc(n)}trackMessage(e){if(null!=this.metrics){const t=this.requestMsByMsg.get(e);void 0!==t&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-t)/1e3),this.requestMsByMsg.delete(e))}}}const XV=yr("libp2p-pubsub:");function JV(){var e,t,n,r;let i=arguments.length>1?arguments[1]:void 0;return{subscriptions:[],messages:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],control:void 0!==i?{graft:null!==(e=i.graft)&&void 0!==e?e:[],prune:null!==(t=i.prune)&&void 0!==t?t:[],ihave:null!==(n=i.ihave)&&void 0!==n?n:[],iwant:null!==(r=i.iwant)&&void 0!==r?r:[]}:void 0}}function $V(e){return void 0===e.control&&(e.control={graft:[],prune:[],ihave:[],iwant:[]}),e}function ZV(e){return vr(e,"base64")}function ez(e){if(e.length<=1)return e;for(let t=0;t<e.length;t++){const n=Math.floor(Math.random()*Math.floor(e.length)),r=e[t];e[t]=e[n],e[n]=r}return e}function tz(e){if("signed"!==e.type)throw new Error("expected signed message type");if(null==e.sequenceNumber)throw Error("missing seqno field");return((e,t)=>{const n=yr(t.toString(16).padStart(16,"0"),"base16"),r=new Uint8Array(e.length+n.length);return r.set(e,0),r.set(n,e.length),r})(e.from.toBytes(),e.sequenceNumber)}async function nz(e){return ar.encode(e.data)}var rz;!function(e){e[e.ip4=4]="ip4",e[e.ip6=41]="ip6"}(rz||(rz={}));class iz{constructor(e){je(this,"entries",new Map),je(this,"validityMs",void 0),this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,t){return!!this.entries.has(e)||(this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs}),!1)}prune(){const e=Date.now();for(const[t,n]of this.entries.entries()){if(!(n.validUntilMs<e))break;this.entries.delete(t)}}has(e){return this.entries.has(e)}get(e){const t=this.entries.get(e);return null!=t&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries.clear()}}var oz;!function(e){e[e.started=0]="started",e[e.stopped=1]="stopped"}(oz||(oz={}));class sz extends bu{constructor(e){var t,n,r,i,o;let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),je(this,"globalSignaturePolicy",void 0),je(this,"multicodecs",[gV,pV]),je(this,"publishConfig",void 0),je(this,"dataTransform",void 0),je(this,"peers",new Set),je(this,"streamsInbound",new Map),je(this,"streamsOutbound",new Map),je(this,"outboundInflightQueue",_n({objectMode:!0})),je(this,"direct",new Set),je(this,"floodsubPeers",new Set),je(this,"seenCache",void 0),je(this,"acceptFromWhitelist",new Map),je(this,"topics",new Map),je(this,"subscriptions",new Set),je(this,"mesh",new Map),je(this,"fanout",new Map),je(this,"fanoutLastpub",new Map),je(this,"gossip",new Map),je(this,"control",new Map),je(this,"peerhave",new Map),je(this,"iasked",new Map),je(this,"backoff",new Map),je(this,"outbound",new Map),je(this,"msgIdFn",void 0),je(this,"fastMsgIdFn",void 0),je(this,"msgIdToStrFn",void 0),je(this,"fastMsgIdCache",void 0),je(this,"publishedMessageIds",void 0),je(this,"mcache",void 0),je(this,"score",void 0),je(this,"topicValidators",new Map),je(this,"log",void 0),je(this,"heartbeatTicks",0),je(this,"gossipTracer",void 0),je(this,"components",void 0),je(this,"directPeerInitial",null),je(this,"opts",void 0),je(this,"decodeRpcLimits",void 0),je(this,"metrics",void 0),je(this,"status",{code:oz.stopped}),je(this,"maxInboundStreams",void 0),je(this,"maxOutboundStreams",void 0),je(this,"runOnTransientConnection",void 0),je(this,"allowedTopics",void 0),je(this,"heartbeatTimer",null),je(this,"runHeartbeat",(()=>{var e;const t=null===(e=this.metrics)||void 0===e?void 0:e.heartbeatDuration.startTimer();this.heartbeat().catch((e=>{this.log("Error running heartbeat",e)})).finally((()=>{if(null!=t&&t(),this.status.code===oz.started){clearTimeout(this.status.heartbeatTimeout);let t=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;var e;if(t<.25*this.opts.heartbeatInterval)t+=this.opts.heartbeatInterval,null===(e=this.metrics)||void 0===e||e.heartbeatSkipped.inc();this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,t)}}))})),je(this,"tagMeshPeer",(e=>{const{peerId:t,topic:n}=e.detail;this.components.peerStore.merge(Mu(t),{tags:{[n]:{value:100}}}).catch((e=>{this.log.error("Error tagging peer %s with topic %s",t,n,e)}))})),je(this,"untagMeshPeer",(e=>{const{peerId:t,topic:n}=e.detail;this.components.peerStore.merge(Mu(t),{tags:{[n]:void 0}}).catch((e=>{this.log.error("Error untagging peer %s with topic %s",t,n,e)}))}));const a={fallbackToFloodsub:!0,floodPublish:!0,batchPublish:!1,tagMeshPeers:!0,doPX:!1,directPeers:[],D:6,Dlo:4,Dhi:12,Dscore:4,Dout:2,Dlazy:6,heartbeatInterval:1e3,fanoutTTL:6e4,mcacheLength:5,mcacheGossip:3,seenTTL:12e4,gossipsubIWantFollowupMs:3e3,prunePeers:16,pruneBackoff:6e4,unsubcribeBackoff:1e4,graftFloodThreshold:1e4,opportunisticGraftPeers:2,opportunisticGraftTicks:60,directConnectTicks:300,...s,scoreParams:LV(s.scoreParams),scoreThresholds:UV(s.scoreThresholds)};if(this.components=e,this.decodeRpcLimits=null!==(t=a.decodeRpcLimits)&&void 0!==t?t:vV,this.globalSignaturePolicy=null!==(n=a.globalSignaturePolicy)&&void 0!==n?n:uV,a.fallbackToFloodsub&&this.multicodecs.push(fV),this.log=e.logger.forComponent(null!==(r=a.debugName)&&void 0!==r?r:"libp2p:gossipsub"),this.opts=a,this.direct=new Set(a.directPeers.map((e=>e.id.toString()))),this.seenCache=new iz({validityMs:a.seenTTL}),this.publishedMessageIds=new iz({validityMs:a.seenTTL}),null!=s.msgIdFn)this.msgIdFn=s.msgIdFn;else switch(this.globalSignaturePolicy){case uV:this.msgIdFn=tz;break;case hV:this.msgIdFn=nz;break;default:throw new Error("Invalid globalSignaturePolicy: ".concat(this.globalSignaturePolicy))}if(null!=s.fastMsgIdFn&&(this.fastMsgIdFn=s.fastMsgIdFn,this.fastMsgIdCache=new iz({validityMs:a.seenTTL})),this.msgIdToStrFn=null!==(i=s.msgIdToStrFn)&&void 0!==i?i:ZV,this.mcache=null!==(o=s.messageCache)&&void 0!==o?o:new xV(a.mcacheGossip,a.mcacheLength,this.msgIdToStrFn),null!=s.dataTransform&&(this.dataTransform=s.dataTransform),null!=s.metricsRegister){if(null==s.metricsTopicStrToLabel)throw Error("Must set metricsTopicStrToLabel with metrics");const e=Math.max(...Object.values(a.scoreParams.topics).map((e=>e.meshMessageDeliveriesWindow)),1e3),t=function(e,t,n){return{protocolsEnabled:e.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:e.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:e.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:e.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEventsFanout:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_fanout_total",help:"Number of times we include peers in a topic mesh for fanout reasons",labelNames:["topic"]}),meshPeerInclusionEventsRandom:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_random_total",help:"Number of times we include peers in a topic mesh for random reasons",labelNames:["topic"]}),meshPeerInclusionEventsSubscribed:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_subscribed_total",help:"Number of times we include peers in a topic mesh for subscribed reasons",labelNames:["topic"]}),meshPeerInclusionEventsOutbound:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_outbound_total",help:"Number of times we include peers in a topic mesh for outbound reasons",labelNames:["topic"]}),meshPeerInclusionEventsNotEnough:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_not_enough_total",help:"Number of times we include peers in a topic mesh for not_enough reasons",labelNames:["topic"]}),meshPeerInclusionEventsOpportunistic:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_opportunistic_total",help:"Number of times we include peers in a topic mesh for opportunistic reasons",labelNames:["topic"]}),meshPeerInclusionEventsUnknown:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_unknown_total",help:"Number of times we include peers in a topic mesh for unknown reasons",labelNames:["topic"]}),meshPeerChurnEventsDisconnected:e.gauge({name:"gossipsub_peer_churn_events_disconnected_total",help:"Number of times we remove peers in a topic mesh for disconnected reasons",labelNames:["topic"]}),meshPeerChurnEventsBadScore:e.gauge({name:"gossipsub_peer_churn_events_bad_score_total",help:"Number of times we remove peers in a topic mesh for bad_score reasons",labelNames:["topic"]}),meshPeerChurnEventsPrune:e.gauge({name:"gossipsub_peer_churn_events_prune_total",help:"Number of times we remove peers in a topic mesh for prune reasons",labelNames:["topic"]}),meshPeerChurnEventsExcess:e.gauge({name:"gossipsub_peer_churn_events_excess_total",help:"Number of times we remove peers in a topic mesh for excess reasons",labelNames:["topic"]}),meshPeerChurnEventsUnknown:e.gauge({name:"gossipsub_peer_churn_events_unknown_total",help:"Number of times we remove peers in a topic mesh for unknown reasons",labelNames:["topic"]}),peersPerProtocol:e.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:e.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:e.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),acceptedMessagesTotal:e.gauge({name:"gossipsub_accepted_messages_total",help:"Total accepted messages for each topic",labelNames:["topic"]}),ignoredMessagesTotal:e.gauge({name:"gossipsub_ignored_messages_total",help:"Total ignored messages for each topic",labelNames:["topic"]}),rejectedMessagesTotal:e.gauge({name:"gossipsub_rejected_messages_total",help:"Total rejected messages for each topic",labelNames:["topic"]}),unknownValidationResultsTotal:e.gauge({name:"gossipsub_unknown_validation_results_total",help:"Total unknown validation results for each topic",labelNames:["topic"]}),asyncValidationMcacheHit:e.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),asyncValidationDelayFromFirstSeenSec:e.histogram({name:"gossipsub_async_validation_delay_from_first_seen",help:"Async validation report delay from first seen in second",buckets:[.01,.03,.1,.3,1,3,10]}),asyncValidationUnknownFirstSeen:e.gauge({name:"gossipsub_async_validation_unknown_first_seen_count_total",help:"Async validation report unknown first seen value for message"}),peerReadStreamError:e.gauge({name:"gossipsub_peer_read_stream_err_count_total",help:"Peer read stream error"}),rpcRecvBytes:e.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:e.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:e.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:e.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:e.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:e.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:e.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:e.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:e.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcDataError:e.gauge({name:"gossipsub_rpc_data_err_count_total",help:"RPC data error"}),rpcRecvError:e.gauge({name:"gossipsub_rpc_recv_err_count_total",help:"RPC recv error"}),rpcRecvNotAccepted:e.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:e.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:e.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:e.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:e.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:e.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:e.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:e.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:e.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:e.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:e.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeersByTopic:e.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),directPeersPublishedTotal:e.gauge({name:"gossipsub_direct_peers_published_total",help:"Total direct peers that we publish a msg to",labelNames:["topic"]}),floodsubPeersPublishedTotal:e.gauge({name:"gossipsub_floodsub_peers_published_total",help:"Total floodsub peers that we publish a msg to",labelNames:["topic"]}),meshPeersPublishedTotal:e.gauge({name:"gossipsub_mesh_peers_published_total",help:"Total mesh peers that we publish a msg to",labelNames:["topic"]}),fanoutPeersPublishedTotal:e.gauge({name:"gossipsub_fanout_peers_published_total",help:"Total fanout peers that we publish a msg to",labelNames:["topic"]}),msgPublishBytes:e.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgPublishTime:e.histogram({name:"gossipsub_msg_publish_seconds",help:"Total time in seconds to publish a message",buckets:[.001,.002,.005,.01,.1,.5,1],labelNames:["topic"]}),msgForwardCount:e.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:e.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:e.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedError:e.gauge({name:"gossipsub_msg_received_error_total",help:"Total count of recv msgs error",labelNames:["topic"]}),prevalidationInvalidTotal:e.gauge({name:"gossipsub_pre_validation_invalid_total",help:"Total count of invalid messages received",labelNames:["topic"]}),prevalidationValidTotal:e.gauge({name:"gossipsub_pre_validation_valid_total",help:"Total count of valid messages received",labelNames:["topic"]}),prevalidationDuplicateTotal:e.gauge({name:"gossipsub_pre_validation_duplicate_total",help:"Total count of duplicate messages received",labelNames:["topic"]}),prevalidationUnknownTotal:e.gauge({name:"gossipsub_pre_validation_unknown_status_total",help:"Total count of unknown_status messages received",labelNames:["topic"]}),msgReceivedInvalid:e.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["error"]}),msgReceivedInvalidByTopic:e.gauge({name:"gossipsub_msg_received_invalid_by_topic_total",help:"Tracks specific invalid message by topic",labelNames:["topic"]}),duplicateMsgDeliveryDelay:e.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*n.maxMeshMessageDeliveriesWindowSec,.5*n.maxMeshMessageDeliveriesWindowSec,Number(n.maxMeshMessageDeliveriesWindowSec),2*n.maxMeshMessageDeliveriesWindowSec,4*n.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:e.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),duplicateMsgIgnored:e.gauge({name:"gossisub_ignored_published_duplicate_msgs_total",help:"Total count of published duplicate message ignored by topic",labelNames:["topic"]}),scoreFnCalls:e.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:e.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:e.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:e.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:e.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores"}),scoreWeights:e.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:e.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:e.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:e.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*n.behaviourPenaltyThreshold,.5*n.behaviourPenaltyThreshold,Number(n.behaviourPenaltyThreshold),2*n.behaviourPenaltyThreshold,4*n.behaviourPenaltyThreshold]}),ihaveRcvIgnored:e.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:e.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:e.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:e.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:e.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:e.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:e.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedFromDuplicate:e.gauge({name:"gossipsub_iwant_promise_resolved_from_duplicate_total",help:"Total count of resolved IWANT promises from duplicate messages"}),iwantPromiseResolvedPeers:e.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:e.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantMessagePruned:e.gauge({name:"gossipsub_iwant_message_pruned",help:"Total count of pruned IWANT messages"}),iwantPromiseDeliveryTime:e.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*n.gossipPromiseExpireSec,Number(n.gossipPromiseExpireSec),2*n.gossipPromiseExpireSec,4*n.gossipPromiseExpireSec]}),iwantPromiseUntracked:e.gauge({name:"gossip_iwant_promise_untracked",help:"Total count of untracked IWANT promise"}),connectedPeersBackoffSec:e.histogram({name:"gossipsub_connected_peers_backoff_seconds",help:"Backoff time in seconds",buckets:[1,2,4,10,20,60,120]}),cacheSize:e.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:e.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),mcacheNotValidatedCount:e.gauge({name:"gossipsub_mcache_not_validated_count",help:"Current mcache msg count not validated"}),fastMsgIdCacheCollision:e.gauge({name:"gossipsub_fastmsgid_cache_collision_total",help:"Total count of key collisions on fastmsgid cache put"}),newConnectionCount:e.gauge({name:"gossipsub_new_connection_total",help:"Total new connection by status",labelNames:["status"]}),topicStrToLabel:t,toTopic(e){var t;return null!==(t=this.topicStrToLabel.get(e))&&void 0!==t?t:e},onJoin(e){this.topicSubscriptionStatus.set({topicStr:e},1),this.meshPeerCounts.set({topicStr:e},0)},onLeave(e){this.topicSubscriptionStatus.set({topicStr:e},0),this.meshPeerCounts.set({topicStr:e},0)},onAddToMesh(e,t,n){const r=this.toTopic(e);switch(t){case AV.Fanout:this.meshPeerInclusionEventsFanout.inc({topic:r},n);break;case AV.Random:this.meshPeerInclusionEventsRandom.inc({topic:r},n);break;case AV.Subscribed:this.meshPeerInclusionEventsSubscribed.inc({topic:r},n);break;case AV.Outbound:this.meshPeerInclusionEventsOutbound.inc({topic:r},n);break;case AV.NotEnough:this.meshPeerInclusionEventsNotEnough.inc({topic:r},n);break;case AV.Opportunistic:this.meshPeerInclusionEventsOpportunistic.inc({topic:r},n);break;default:this.meshPeerInclusionEventsUnknown.inc({topic:r},n)}},onRemoveFromMesh(e,t,n){const r=this.toTopic(e);switch(t){case IV.Dc:this.meshPeerChurnEventsDisconnected.inc({topic:r},n);break;case IV.BadScore:this.meshPeerChurnEventsBadScore.inc({topic:r},n);break;case IV.Prune:this.meshPeerChurnEventsPrune.inc({topic:r},n);break;case IV.Excess:this.meshPeerChurnEventsExcess.inc({topic:r},n);break;default:this.meshPeerChurnEventsUnknown.inc({topic:r},n)}},onReportValidation(e,t,n){if(this.asyncValidationMcacheHit.inc({hit:null!=e?"hit":"miss"}),null!=e){const n=this.toTopic(e.message.topic);switch(t){case dV.Accept:this.acceptedMessagesTotal.inc({topic:n});break;case dV.Ignore:this.ignoredMessagesTotal.inc({topic:n});break;case dV.Reject:this.rejectedMessagesTotal.inc({topic:n});break;default:this.unknownValidationResultsTotal.inc({topic:n})}}null!=n?this.asyncValidationDelayFromFirstSeenSec.observe((Date.now()-n)/1e3):this.asyncValidationUnknownFirstSeen.inc()},onScorePenalty(e){this.scoringPenalties.inc({penalty:e},1)},onIhaveRcv(e,t,n){const r=this.toTopic(e);this.ihaveRcvMsgids.inc({topic:r},t),this.ihaveRcvNotSeenMsgids.inc({topic:r},n)},onIwantRcv(e,t){for(const[n,r]of e){const e=this.toTopic(n);this.iwantRcvMsgids.inc({topic:e},r)}this.iwantRcvDonthaveMsgids.inc(t)},onForwardMsg(e,t){const n=this.toTopic(e);this.msgForwardCount.inc({topic:n},1),this.msgForwardPeers.inc({topic:n},t)},onPublishMsg(e,t,n,r,i){const o=this.toTopic(e);this.msgPublishCount.inc({topic:o},1),this.msgPublishBytes.inc({topic:o},n*r),this.msgPublishPeersByTopic.inc({topic:o},n),this.directPeersPublishedTotal.inc({topic:o},t.direct),this.floodsubPeersPublishedTotal.inc({topic:o},t.floodsub),this.meshPeersPublishedTotal.inc({topic:o},t.mesh),this.fanoutPeersPublishedTotal.inc({topic:o},t.fanout),this.msgPublishTime.observe({topic:o},i/1e3)},onMsgRecvPreValidation(e){const t=this.toTopic(e);this.msgReceivedPreValidation.inc({topic:t},1)},onMsgRecvError(e){const t=this.toTopic(e);this.msgReceivedError.inc({topic:t},1)},onPrevalidationResult(e,t){const n=this.toTopic(e);switch(t){case SV.duplicate:this.prevalidationDuplicateTotal.inc({topic:n});break;case SV.invalid:this.prevalidationInvalidTotal.inc({topic:n});break;case SV.valid:this.prevalidationValidTotal.inc({topic:n});break;default:this.prevalidationUnknownTotal.inc({topic:n})}},onMsgRecvInvalid(e,t){const n=this.toTopic(e),r=t.reason===EV.Error?t.error:t.reason;this.msgReceivedInvalid.inc({error:r},1),this.msgReceivedInvalidByTopic.inc({topic:n},1)},onDuplicateMsgDelivery(e,t,n){const r=this.toTopic(e);this.duplicateMsgDeliveryDelay.observe({topic:r},t/1e3),n&&this.duplicateMsgLateDelivery.inc({topic:r},1)},onPublishDuplicateMsg(e){const t=this.toTopic(e);this.duplicateMsgIgnored.inc({topic:t},1)},onPeerReadStreamError(){this.peerReadStreamError.inc(1)},onRpcRecvError(){this.rpcRecvError.inc(1)},onRpcDataError(){this.rpcDataError.inc(1)},onRpcRecv(e,t){this.rpcRecvBytes.inc(t),this.rpcRecvCount.inc(1),null!=e.subscriptions&&this.rpcRecvSubscription.inc(e.subscriptions.length),null!=e.messages&&this.rpcRecvMessage.inc(e.messages.length),null!=e.control&&(this.rpcRecvControl.inc(1),null!=e.control.ihave&&this.rpcRecvIHave.inc(e.control.ihave.length),null!=e.control.iwant&&this.rpcRecvIWant.inc(e.control.iwant.length),null!=e.control.graft&&this.rpcRecvGraft.inc(e.control.graft.length),null!=e.control.prune&&this.rpcRecvPrune.inc(e.control.prune.length))},onRpcSent(e,t){if(this.rpcSentBytes.inc(t),this.rpcSentCount.inc(1),null!=e.subscriptions&&this.rpcSentSubscription.inc(e.subscriptions.length),null!=e.messages&&this.rpcSentMessage.inc(e.messages.length),null!=e.control){var n,r,i,o,s,a,l,c;const t=null!==(n=null===(r=e.control.ihave)||void 0===r?void 0:r.length)&&void 0!==n?n:0,u=null!==(i=null===(o=e.control.iwant)||void 0===o?void 0:o.length)&&void 0!==i?i:0,h=null!==(s=null===(a=e.control.graft)||void 0===a?void 0:a.length)&&void 0!==s?s:0,d=null!==(l=null===(c=e.control.prune)||void 0===c?void 0:c.length)&&void 0!==l?l:0;t>0&&this.rpcSentIHave.inc(t),u>0&&this.rpcSentIWant.inc(u),h>0&&this.rpcSentGraft.inc(h),d>0&&this.rpcSentPrune.inc(d),(t>0||u>0||h>0||d>0)&&this.rpcSentControl.inc(1)}},registerScores(e,t){let n=0,r=0,i=0,o=0;for(const s of e)s>=t.graylistThreshold&&n++,s>=t.publishThreshold&&r++,s>=t.gossipThreshold&&i++,s>=0&&o++;this.peersByScoreThreshold.set({threshold:CV.graylist},n),this.peersByScoreThreshold.set({threshold:CV.publish},r),this.peersByScoreThreshold.set({threshold:CV.gossip},i),this.peersByScoreThreshold.set({threshold:CV.mesh},o),this.score.set(e)},registerScoreWeights(e){for(const[t,n]of e.byTopic)this.scoreWeights.set({topic:t,p:"p1"},n.p1w),this.scoreWeights.set({topic:t,p:"p2"},n.p2w),this.scoreWeights.set({topic:t,p:"p3"},n.p3w),this.scoreWeights.set({topic:t,p:"p3b"},n.p3bw),this.scoreWeights.set({topic:t,p:"p4"},n.p4w);this.scoreWeights.set({p:"p5"},e.p5w),this.scoreWeights.set({p:"p6"},e.p6w),this.scoreWeights.set({p:"p7"},e.p7w)},registerScorePerMesh(e,t){const n=new Map;e.forEach(((e,t)=>{var r;const i=null!==(r=this.topicStrToLabel.get(t))&&void 0!==r?r:"unknown";let o=n.get(i);null==o&&(o=new Set,n.set(i,o)),e.forEach((e=>{var t;return null===(t=o)||void 0===t?void 0:t.add(e)}))}));for(const[r,i]of n){const e=[];i.forEach((n=>{var r;e.push(null!==(r=t.get(n))&&void 0!==r?r:0)})),this.scorePerMesh.set({topic:r},e)}}}}(s.metricsRegister,s.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:a.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:e/1e3});t.mcacheSize.addCollect((()=>{this.onScrapeMetrics(t)}));for(const n of this.multicodecs)t.protocolsEnabled.set({protocol:n},1);this.metrics=t}else this.metrics=null;this.gossipTracer=new QV(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new qV(this.opts.scoreParams,this.metrics,this.components.logger,{scoreCacheValidityMs:a.heartbeatInterval}),this.maxInboundStreams=s.maxInboundStreams,this.maxOutboundStreams=s.maxOutboundStreams,this.runOnTransientConnection=s.runOnTransientConnection,this.allowedTopics=null!=a.allowedTopics?new Set(a.allowedTopics):null}getPeers(){return[...this.peers.keys()].map((e=>Mu(e)))}isStarted(){return this.status.code===oz.started}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await async function(e,t){switch(e){case uV:{if(null==t)throw Error("Must provide PeerId");if(null==t.privateKey)throw Error("Cannot sign message, no private key present");if(null==t.publicKey)throw Error("Cannot sign message, no public key present");const e=await fu(t.privateKey);return{type:bV.Signing,author:t,key:t.publicKey,privateKey:e}}case hV:return{type:bV.Anonymous};default:throw new Error('Unknown signature policy "'.concat(e,'"'))}}(this.globalSignaturePolicy,this.components.peerId),this.outboundInflightQueue=_n({objectMode:!0}),Cr(this.outboundInflightQueue,(async e=>{for await(const{peerId:t,connection:n}of e)await this.createOutboundStream(t,n)})).catch((e=>{this.log.error("outbound inflight queue error",e)})),await Promise.all(this.opts.directPeers.map((async e=>{await this.components.peerStore.merge(e.id,{multiaddrs:e.addrs})})));const e=this.components.registrar;await Promise.all(this.multicodecs.map((async t=>e.handle(t,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnTransientConnection:this.runOnTransientConnection}))));const t={onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this),notifyOnTransient:this.runOnTransientConnection},n=await Promise.all(this.multicodecs.map((async n=>e.register(n,t)))),r=setTimeout(this.runHeartbeat,100);this.status={code:oz.started,registrarTopologyIds:n,heartbeatTimeout:r,hearbeatStartMs:Date.now()+100},this.score.start(),this.directPeerInitial=setTimeout((()=>{Promise.resolve().then((async()=>{await Promise.all(Array.from(this.direct).map((async e=>this.connect(e))))})).catch((e=>{this.log(e)}))}),1e3),this.opts.tagMeshPeers&&(this.addEventListener("gossipsub:graft",this.tagMeshPeer),this.addEventListener("gossipsub:prune",this.untagMeshPeer)),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==oz.started)return;const{registrarTopologyIds:e}=this.status;this.status={code:oz.stopped},this.opts.tagMeshPeers&&(this.removeEventListener("gossipsub:graft",this.tagMeshPeer),this.removeEventListener("gossipsub:prune",this.untagMeshPeer));const t=this.components.registrar;await Promise.all(this.multicodecs.map((async e=>t.unhandle(e)))),e.forEach((e=>{t.unregister(e)})),this.outboundInflightQueue.end();const n=[];for(const r of this.streamsOutbound.values())n.push(r.close());this.streamsOutbound.clear();for(const r of this.streamsInbound.values())n.push(r.close());this.streamsInbound.clear(),await Promise.all(n),this.peers.clear(),this.subscriptions.clear(),null!=this.heartbeatTimer&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),null!=this.fastMsgIdCache&&this.fastMsgIdCache.clear(),null!=this.directPeerInitial&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream(e){let{stream:t,connection:n}=e;if(!this.isStarted())return;const r=n.remotePeer;this.addPeer(r,n.direction,n.remoteAddr),this.createInboundStream(r,t),this.outboundInflightQueue.push({peerId:r,connection:n})}onPeerConnected(e,t){var n;null===(n=this.metrics)||void 0===n||n.newConnectionCount.inc({status:t.status}),this.isStarted()&&"open"===t.status&&(this.addPeer(e,t.direction,t.remoteAddr),this.outboundInflightQueue.push({peerId:e,connection:t}))}onPeerDisconnected(e){this.log("connection ended %p",e),this.removePeer(e)}async createOutboundStream(e,t){if(!this.isStarted())return;const n=e.toString();if(this.peers.has(n)&&!this.streamsOutbound.has(n))try{var r;const i=new GV(await t.newStream(this.multicodecs,{runOnTransientConnection:this.runOnTransientConnection}),(e=>{this.log.error("outbound pipe error",e)}),{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",e),this.streamsOutbound.set(n,i);const o=i.protocol;o===fV&&this.floodsubPeers.add(n),null===(r=this.metrics)||void 0===r||r.peersPerProtocol.inc({protocol:o},1),this.subscriptions.size>0&&(this.log("send subscriptions to",n),this.sendSubscriptions(n,Array.from(this.subscriptions),!0))}catch(fz){this.log.error("createOutboundStream error",fz)}}createInboundStream(e,t){if(!this.isStarted())return;const n=e.toString();if(!this.peers.has(n))return;const r=this.streamsInbound.get(n);void 0!==r&&(this.log("replacing existing inbound steam %s",n),r.close().catch((e=>{this.log.error(e)}))),this.log("create inbound stream %s",n);const i=new YV(t,{maxDataLength:this.opts.maxInboundDataLength});this.streamsInbound.set(n,i),this.pipePeerReadStream(e,i.source).catch((e=>{this.log(e)}))}addPeer(e,t,n){const r=e.toString();if(!this.peers.has(r)){this.log("new peer %p",e),this.peers.add(r),this.score.addPeer(r);const i=function(e){for(const t of e.tuples())switch(t[0]){case rz.ip4:case rz.ip6:return ph(t[0],t[1])}return null}(n);null!==i?this.score.addIP(r,i):this.log("Added peer has no IP in current address %s %s",r,n.toString()),this.outbound.has(r)||this.outbound.set(r,"outbound"===t)}}removePeer(e){const t=e.toString();if(!this.peers.has(t))return;this.log("delete peer %p",e),this.peers.delete(t);const n=this.streamsOutbound.get(t),r=this.streamsInbound.get(t);var i;null!=n&&(null===(i=this.metrics)||void 0===i||i.peersPerProtocol.inc({protocol:n.protocol},-1));null===n||void 0===n||n.close().catch((e=>{this.log.error(e)})),null===r||void 0===r||r.close().catch((e=>{this.log.error(e)})),this.streamsOutbound.delete(t),this.streamsInbound.delete(t);for(const s of this.topics.values())s.delete(t);for(const[s,a]of this.mesh){var o;if(a.delete(t))null===(o=this.metrics)||void 0===o||o.onRemoveFromMesh(s,IV.Dc,1)}for(const s of this.fanout.values())s.delete(t);this.floodsubPeers.delete(t),this.gossip.delete(t),this.control.delete(t),this.outbound.delete(t),this.score.removePeer(t),this.acceptFromWhitelist.delete(t)}get started(){return this.status.code===oz.started}getMeshPeers(e){const t=this.mesh.get(e);return null!=t?Array.from(t):[]}getSubscribers(e){const t=this.topics.get(e);return(null!=t?Array.from(t):[]).map((e=>Mu(e)))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(e,t){try{await Cr(t,(async t=>{for await(const s of t)try{var n;const t=s.subarray(),i=mV.decode(t,{limits:{subscriptions:this.decodeRpcLimits.maxSubscriptions,messages:this.decodeRpcLimits.maxMessages,control$:{ihave:this.decodeRpcLimits.maxIhaveMessageIDs,iwant:this.decodeRpcLimits.maxIwantMessageIDs,graft:this.decodeRpcLimits.maxControlMessages,prune:this.decodeRpcLimits.maxControlMessages,prune$:{peers:this.decodeRpcLimits.maxPeerInfos}}}});if(null===(n=this.metrics)||void 0===n||n.onRpcRecv(i,t.length),this.opts.awaitRpcHandler)try{await this.handleReceivedRpc(e,i)}catch(o){var r;null===(r=this.metrics)||void 0===r||r.onRpcRecvError(),this.log(o)}else this.handleReceivedRpc(e,i).catch((e=>{var t;null===(t=this.metrics)||void 0===t||t.onRpcRecvError(),this.log(e)}))}catch(fz){var i;null===(i=this.metrics)||void 0===i||i.onRpcDataError(),this.log(fz)}}))}catch(r){var n;null===(n=this.metrics)||void 0===n||n.onPeerReadStreamError(),this.handlePeerReadStreamError(r,e)}}handlePeerReadStreamError(e,t){this.log.error(e),this.onPeerDisconnected(t)}async handleReceivedRpc(e,t){var n;if(!this.acceptFrom(e.toString()))return this.log("received message from unacceptable peer %p",e),void(null===(n=this.metrics)||void 0===n||n.rpcRecvNotAccepted.inc());const r=null!=t.subscriptions?t.subscriptions.length:0,i=null!=t.messages?t.messages.length:0;let o=0,s=0,a=0,l=0;if(null!=t.control&&(null!=t.control.ihave&&(o=t.control.ihave.length),null!=t.control.iwant&&(s=t.control.iwant.length),null!=t.control.graft&&(a=t.control.graft.length),null!=t.control.prune&&(l=t.control.prune.length)),this.log("rpc.from ".concat(e.toString()," subscriptions ").concat(r," messages ").concat(i," ihave ").concat(o," iwant ").concat(s," graft ").concat(a," prune ").concat(l)),null!=t.subscriptions&&t.subscriptions.length>0){const n=[];t.subscriptions.forEach((t=>{const r=t.topic,i=!0===t.subscribe;if(null!=r){if(null!=this.allowedTopics&&!this.allowedTopics.has(r))return;this.handleReceivedSubscription(e,r,i),n.push({topic:r,subscribe:i})}})),this.safeDispatchEvent("subscription-change",{detail:{peerId:e,subscriptions:n}})}for(const c of t.messages){if(null!=this.allowedTopics&&!this.allowedTopics.has(c.topic))continue;const t=this.handleReceivedMessage(e,c).catch((e=>{var t;null===(t=this.metrics)||void 0===t||t.onMsgRecvError(c.topic),this.log(e)}));this.opts.awaitRpcMessageHandler&&await t}null!=t.control&&await this.handleControlMessage(e.toString(),t.control)}handleReceivedSubscription(e,t,n){this.log("subscription update from %p topic %s",e,t);let r=this.topics.get(t);null==r&&(r=new Set,this.topics.set(t,r)),n?r.add(e.toString()):r.delete(e.toString())}async handleReceivedMessage(e,t){var n,r,i;null===(n=this.metrics)||void 0===n||n.onMsgRecvPreValidation(t.topic);const o=await this.validateReceivedMessage(e,t);null===(r=this.metrics)||void 0===r||r.onPrevalidationResult(t.topic,o.code);const s=o.code;switch(s){case SV.duplicate:return this.score.duplicateMessage(e.toString(),o.msgIdStr,t.topic),this.gossipTracer.deliverMessage(o.msgIdStr,!0),void this.mcache.observeDuplicate(o.msgIdStr,e.toString());case SV.invalid:if(null!=o.msgIdStr){const n=o.msgIdStr;this.score.rejectMessage(e.toString(),n,t.topic,o.reason),this.gossipTracer.rejectMessage(n,o.reason)}else this.score.rejectInvalidMessage(e.toString(),t.topic);return void(null===(i=this.metrics)||void 0===i||i.onMsgRecvInvalid(t.topic,o));case SV.valid:if(this.score.validateMessage(o.messageId.msgIdStr),this.gossipTracer.deliverMessage(o.messageId.msgIdStr),this.mcache.put(o.messageId,t,!this.opts.asyncValidation),this.subscriptions.has(t.topic)){this.components.peerId.equals(e)&&!this.opts.emitSelf||(super.dispatchEvent(new _u("gossipsub:message",{detail:{propagationSource:e,msgId:o.messageId.msgIdStr,msg:o.msg}})),super.dispatchEvent(new _u("message",{detail:o.msg})))}this.opts.asyncValidation||this.forwardMessage(o.messageId.msgIdStr,t,e.toString());break;default:throw new Error("Invalid validation result: ".concat(s))}}async validateReceivedMessage(e,t){var n,r;const i=null===(n=this.fastMsgIdFn)||void 0===n?void 0:n.call(this,t),o=void 0!==i?null===(r=this.fastMsgIdCache)||void 0===r?void 0:r.get(i):void 0;if(null!=o)return{code:SV.duplicate,msgIdStr:o};const s=await async function(e,t){var n;switch(e){case hV:return null!=t.signature?{valid:!1,error:_V.SignaturePresent}:null!=t.seqno?{valid:!1,error:_V.SeqnoPresent}:null!=t.key?{valid:!1,error:_V.FromPresent}:{valid:!0,message:{type:"unsigned",topic:t.topic,data:null!==(n=t.data)&&void 0!==n?n:new Uint8Array(0)}};case uV:{var r,i;if(null==t.seqno)return{valid:!1,error:_V.InvalidSeqno};if(8!==t.seqno.length)return{valid:!1,error:_V.InvalidSeqno};if(null==t.signature)return{valid:!1,error:_V.InvalidSignature};if(null==t.from)return{valid:!1,error:_V.InvalidPeerId};let e,n;try{e=Uu(t.from)}catch(fz){return{valid:!1,error:_V.InvalidPeerId}}if(null!=t.key){if(n=hu(t.key),void 0!==e.publicKey&&!Hr(n.bytes,e.publicKey))return{valid:!1,error:_V.InvalidPeerId}}else{if(null==e.publicKey)return{valid:!1,error:_V.InvalidPeerId};n=hu(e.publicKey)}const o={from:t.from,data:t.data,seqno:t.seqno,topic:t.topic,signature:void 0,key:void 0},s=Wo([XV,mV.Message.encode(o)]);return await n.verify(s,t.signature)?{valid:!0,message:{type:"signed",from:e,data:null!==(r=t.data)&&void 0!==r?r:new Uint8Array(0),sequenceNumber:BigInt("0x".concat(vr(t.seqno,"base16"))),topic:t.topic,signature:t.signature,key:null!==(i=t.key)&&void 0!==i?i:du(n)}}:{valid:!1,error:_V.InvalidSignature}}default:throw new Error("Unreachable")}}(this.globalSignaturePolicy,t);if(!s.valid)return{code:SV.invalid,reason:EV.Error,error:s.error};const a=s.message;try{null!=this.dataTransform&&(a.data=this.dataTransform.inboundTransform(t.topic,a.data))}catch(fz){return this.log("Invalid message, transform failed",fz),{code:SV.invalid,reason:EV.Error,error:_V.TransformFailed}}const l=await this.msgIdFn(a),c=this.msgIdToStrFn(l),u={msgId:l,msgIdStr:c};if(void 0!==i&&null!=this.fastMsgIdCache){var h;if(this.fastMsgIdCache.put(i,c))null===(h=this.metrics)||void 0===h||h.fastMsgIdCacheCollision.inc()}if(this.seenCache.has(c))return{code:SV.duplicate,msgIdStr:c};this.seenCache.put(c);const d=this.topicValidators.get(t.topic);if(null!=d){let t;try{t=await d(e,a)}catch(fz){const n=fz.code;"ERR_TOPIC_VALIDATOR_IGNORE"===n&&(t=dV.Ignore),t="ERR_TOPIC_VALIDATOR_REJECT"===n?dV.Reject:dV.Ignore}if(t!==dV.Accept)return{code:SV.invalid,reason:PV(t),msgIdStr:c}}return{code:SV.valid,messageId:u,msg:a}}getScore(e){return this.score.score(e)}sendSubscriptions(e,t,n){this.sendRpc(e,{subscriptions:t.map((e=>({topic:e,subscribe:n}))),messages:[]})}async handleControlMessage(e,t){var n;if(void 0===t)return;const r=null!=t.ihave?this.handleIHave(e,t.ihave):[],i=null!=t.iwant?this.handleIWant(e,t.iwant):[],o=null!=t.graft?await this.handleGraft(e,t.graft):[];if(null!=t.prune&&await this.handlePrune(e,t.prune),0===r.length&&0===i.length&&0===o.length)return;const s=this.sendRpc(e,JV(i,{iwant:r,prune:o})),a=null===(n=r[0])||void 0===n?void 0:n.messageIDs;var l;null!=a&&(s?this.gossipTracer.addPromise(e,a):null===(l=this.metrics)||void 0===l||l.iwantPromiseUntracked.inc(1))}acceptFrom(e){if(this.direct.has(e))return!0;const t=Date.now(),n=this.acceptFromWhitelist.get(e);if(null!=n&&n.messagesAccepted<128&&n.acceptUntil>=t)return n.messagesAccepted+=1,!0;const r=this.score.score(e);return r>=0?this.acceptFromWhitelist.set(e,{messagesAccepted:0,acceptUntil:t+1e3}):this.acceptFromWhitelist.delete(e),r>=this.opts.scoreThresholds.graylistThreshold}handleIHave(e,t){var n,r;if(0===t.length)return[];const i=this.score.score(e);var o;if(i<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",e,i),null===(o=this.metrics)||void 0===o||o.ihaveRcvIgnored.inc({reason:RV.LowScore}),[];const s=(null!==(n=this.peerhave.get(e))&&void 0!==n?n:0)+1;var a;if(this.peerhave.set(e,s),s>10)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",e,s),null===(a=this.metrics)||void 0===a||a.ihaveRcvIgnored.inc({reason:RV.MaxIhave}),[];const l=null!==(r=this.iasked.get(e))&&void 0!==r?r:0;var c;if(l>=yV)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",e,l),null===(c=this.metrics)||void 0===c||c.ihaveRcvIgnored.inc({reason:RV.MaxIasked}),[];const u=new Map;if(t.forEach((e=>{var t;let{topicID:n,messageIDs:r}=e;if(null==n||null==r||!this.mesh.has(n))return;let i=0;r.forEach((e=>{const t=this.msgIdToStrFn(e);this.seenCache.has(t)||(u.set(t,e),i++)})),null===(t=this.metrics)||void 0===t||t.onIhaveRcv(n,r.length,i)})),0===u.size)return[];let h=u.size;h+l>yV&&(h=yV-l),this.log("IHAVE: Asking for %d out of %d messages from %s",h,u.size,e);let d=Array.from(u.values());return ez(d),d=d.slice(0,h),this.iasked.set(e,l+h),[{messageIDs:d}]}handleIWant(e,t){var n;if(0===t.length)return[];const r=this.score.score(e);if(r<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",e,r),[];const i=new Map,o=new Map;let s=0;return t.forEach((t=>{let{messageIDs:n}=t;null===n||void 0===n||n.forEach((t=>{var n;const r=this.msgIdToStrFn(t),a=this.mcache.getWithIWantCount(r,e);null!=a?(o.set(a.msg.topic,1+(null!==(n=o.get(a.msg.topic))&&void 0!==n?n:0)),a.count>3?this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",e,t):i.set(r,a.msg)):s++}))})),null===(n=this.metrics)||void 0===n||n.onIwantRcv(o,s),0===i.size?(this.log("IWANT: Could not provide any wanted messages to %s",e),[]):(this.log("IWANT: Sending %d messages to %s",i.size,e),Array.from(i.values()))}async handleGraft(e,t){const n=[],r=this.score.score(e),i=Date.now();let o=this.opts.doPX;if(t.forEach((t=>{var s,a;let{topicID:l}=t;if(null==l)return;const c=this.mesh.get(l);if(null==c)return void(o=!1);if(c.has(e))return;const u=null===(s=this.backoff.get(l))||void 0===s?void 0:s.get(e);if(this.direct.has(e))this.log("GRAFT: ignoring request from direct peer %s",e),n.push(l),o=!1;else if("number"===typeof u&&i<u){this.log("GRAFT: ignoring backed off peer %s",e),this.score.addPenalty(e,1,TV.GraftBackoff),o=!1;const t=u+this.opts.graftFloodThreshold-this.opts.pruneBackoff;i<t&&this.score.addPenalty(e,1,TV.GraftBackoff),this.addBackoff(e,l),n.push(l)}else if(r<0)this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",e,r,l),n.push(l),o=!1,this.addBackoff(e,l);else if(c.size>=this.opts.Dhi&&(null===(a=this.outbound.get(e))||void 0===a||!a))n.push(l),this.addBackoff(e,l);else{var h;this.log("GRAFT: Add mesh link from %s in %s",e,l),this.score.graft(e,l),c.add(e),null===(h=this.metrics)||void 0===h||h.onAddToMesh(l,AV.Subscribed,1)}this.safeDispatchEvent("gossipsub:graft",{detail:{peerId:e,topic:l,direction:"inbound"}})})),0===n.length)return[];return Promise.all(n.map((async t=>this.makePrune(e,t,o,false))))}async handlePrune(e,t){const n=this.score.score(e);for(const{topicID:i,backoff:o,peers:s}of t){if(null==i)continue;const t=this.mesh.get(i);if(null==t)return;var r;if(this.log("PRUNE: Remove mesh link to %s in %s",e,i),this.score.prune(e,i),t.has(e))t.delete(e),null===(r=this.metrics)||void 0===r||r.onRemoveFromMesh(i,IV.Prune,1);"number"===typeof o&&o>0?this.doAddBackoff(e,i,1e3*o):this.addBackoff(e,i),null!=s&&s.length>0&&(n<this.opts.scoreThresholds.acceptPXThreshold?this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",e,n,i):await this.pxConnect(s)),this.safeDispatchEvent("gossipsub:prune",{detail:{peerId:e,topic:i,direction:"inbound"}})}}addBackoff(e,t){this.doAddBackoff(e,t,this.opts.pruneBackoff)}doAddBackoff(e,t,n){var r;let i=this.backoff.get(t);null==i&&(i=new Map,this.backoff.set(t,i));const o=Date.now()+n;(null!==(r=i.get(e))&&void 0!==r?r:0)<o&&i.set(e,o)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach(((e,t)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",t,e),this.score.addPenalty(t,e,TV.BrokenPromise)}))}clearBackoff(){if(this.heartbeatTicks%15!==0)return;const e=Date.now();this.backoff.forEach(((t,n)=>{t.forEach(((n,r)=>{n+1*this.opts.heartbeatInterval<e&&t.delete(r)})),0===t.size&&this.backoff.delete(n)}))}async directConnect(){const e=[];this.direct.forEach((t=>{this.streamsOutbound.has(t)||e.push(t)})),await Promise.all(e.map((async e=>this.connect(e))))}async pxConnect(e){e.length>this.opts.prunePeers&&(ez(e),e=e.slice(0,this.opts.prunePeers));const t=[];await Promise.all(e.map((async e=>{if(null==e.peerID)return;const n=Uu(e.peerID),r=n.toString();if(!this.peers.has(r))if(null!=e.signedPeerRecord)try{if(!await this.components.peerStore.consumePeerRecord(e.signedPeerRecord,n))return void this.log("bogus peer record obtained through px: could not add peer record to address book");t.push(r)}catch(fz){this.log("bogus peer record obtained through px: invalid signature or not a peer record")}else t.push(r)}))),0!==t.length&&await Promise.all(t.map((async e=>this.connect(e))))}async connect(e){this.log("Initiating connection with %s",e);const t=Mu(e),n=await this.components.connectionManager.openConnection(t);for(const i of this.multicodecs)for(const e of this.components.registrar.getTopologies(i)){var r;null===(r=e.onConnect)||void 0===r||r.call(e,t,n)}}subscribe(e){if(this.status.code!==oz.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(e)){this.subscriptions.add(e);for(const t of this.peers.keys())this.sendSubscriptions(t,[e],!0)}this.join(e)}unsubscribe(e){if(this.status.code!==oz.started)throw new Error("Pubsub is not started");const t=this.subscriptions.delete(e);if(this.log("unsubscribe from %s - am subscribed %s",e,t),t)for(const n of this.peers.keys())this.sendSubscriptions(n,[e],!1);this.leave(e)}join(e){var t;if(this.status.code!==oz.started)throw new Error("Gossipsub has not started");if(this.mesh.has(e))return;this.log("JOIN %s",e),null===(t=this.metrics)||void 0===t||t.onJoin(e);const n=new Set,r=this.backoff.get(e),i=this.fanout.get(e);var o;null!=i&&(this.fanout.delete(e),this.fanoutLastpub.delete(e),i.forEach((e=>{this.direct.has(e)||!(this.score.score(e)>=0)||null!=r&&r.has(e)||n.add(e)})),null===(o=this.metrics)||void 0===o||o.onAddToMesh(e,AV.Fanout,n.size));if(n.size<this.opts.D){var s;const t=n.size;this.getRandomGossipPeers(e,this.opts.D,(e=>!n.has(e)&&!this.direct.has(e)&&this.score.score(e)>=0&&(null==r||!r.has(e)))).forEach((e=>{n.add(e)})),null===(s=this.metrics)||void 0===s||s.onAddToMesh(e,AV.Random,n.size-t)}this.mesh.set(e,n),n.forEach((t=>{this.log("JOIN: Add mesh link to %s in %s",t,e),this.sendGraft(t,e)}))}leave(e){var t;if(this.status.code!==oz.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",e),null===(t=this.metrics)||void 0===t||t.onLeave(e);const n=this.mesh.get(e);null!=n&&(Promise.all(Array.from(n).map((async t=>{this.log("LEAVE: Remove mesh link to %s in %s",t,e),await this.sendPrune(t,e)}))).catch((e=>{this.log("Error sending prunes to mesh peers",e)})),this.mesh.delete(e))}selectPeersToForward(e,t,n){const r=new Set,i=this.topics.get(e);null!=i&&(this.direct.forEach((e=>{var o;!i.has(e)||t===e||null!==(o=null===n||void 0===n?void 0:n.has(e))&&void 0!==o&&o||r.add(e)})),this.floodsubPeers.forEach((e=>{var o;i.has(e)&&t!==e&&(null===(o=null===n||void 0===n?void 0:n.has(e))||void 0===o||!o)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&r.add(e)})));const o=this.mesh.get(e);return null!=o&&o.size>0&&o.forEach((e=>{var i;t===e||null!==(i=null===n||void 0===n?void 0:n.has(e))&&void 0!==i&&i||r.add(e)})),r}selectPeersToPublish(e){const t=new Set,n={direct:0,floodsub:0,mesh:0,fanout:0},r=this.topics.get(e);if(null!=r)if(this.opts.floodPublish)r.forEach((e=>{this.direct.has(e)?(t.add(e),n.direct++):this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&(t.add(e),n.floodsub++)}));else{this.direct.forEach((e=>{r.has(e)&&(t.add(e),n.direct++)})),this.floodsubPeers.forEach((e=>{r.has(e)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&(t.add(e),n.floodsub++)}));const i=this.mesh.get(e);if(null!=i&&i.size>0)i.forEach((e=>{t.add(e),n.mesh++}));else{const r=this.fanout.get(e);if(null!=r&&r.size>0)r.forEach((e=>{t.add(e),n.fanout++}));else{const r=this.getRandomGossipPeers(e,this.opts.D,(e=>this.score.score(e)>=this.opts.scoreThresholds.publishThreshold));r.size>0&&(this.fanout.set(e,r),r.forEach((e=>{t.add(e),n.fanout++})))}this.fanoutLastpub.set(e,Date.now())}}return{tosend:t,tosendCount:n}}forwardMessage(e,t,n,r){var i;null!=n&&this.score.deliverMessage(n,e,t.topic);const o=this.selectPeersToForward(t.topic,n,r);o.forEach((e=>{this.sendRpc(e,JV([t]))})),null===(i=this.metrics)||void 0===i||i.onForwardMsg(t.topic,o.size)}async publish(e,t,n){var r,i,o,s;const a=Date.now(),l=null!=this.dataTransform?this.dataTransform.outboundTransform(e,t):t;if(null==this.publishConfig)throw Error("PublishError.Uninitialized");const{raw:c,msg:u}=await async function(e,t,n,r){switch(e.type){case bV.Signing:{const i={from:e.author.toBytes(),data:r,seqno:mc(8),topic:t,signature:void 0,key:void 0},o=Wo([XV,mV.Message.encode(i)]);return i.signature=await e.privateKey.sign(o),i.key=e.key,{raw:i,msg:{type:"signed",from:e.author,data:n,sequenceNumber:BigInt("0x".concat(vr(i.seqno,"base16"))),topic:t,signature:i.signature,key:i.key}}}case bV.Anonymous:return{raw:{from:void 0,data:r,seqno:void 0,topic:t,signature:void 0,key:void 0},msg:{type:"unsigned",data:n,topic:t}};default:throw new Error("Unreachable")}}(this.publishConfig,e,t,l),h=await this.msgIdFn(u),d=this.msgIdToStrFn(h),f=null!==(r=null===n||void 0===n?void 0:n.ignoreDuplicatePublishError)&&void 0!==r?r:this.opts.ignoreDuplicatePublishError;if(this.seenCache.has(d)){var p;if(f)return null===(p=this.metrics)||void 0===p||p.onPublishDuplicateMsg(e),{recipients:[]};throw Error("PublishError.Duplicate")}const{tosend:g,tosendCount:y}=this.selectPeersToPublish(e),v=this.opts.emitSelf&&this.subscriptions.has(e),m=null!==(i=null===n||void 0===n?void 0:n.allowPublishToZeroTopicPeers)&&void 0!==i?i:this.opts.allowPublishToZeroTopicPeers;if(0===g.size&&!m&&!v)throw Error("PublishError.NoPeersSubscribedToTopic");this.seenCache.put(d),this.mcache.put({msgId:h,msgIdStr:d},c,!0),this.publishedMessageIds.put(d);const w=null!==(o=null===n||void 0===n?void 0:n.batchPublish)&&void 0!==o?o:this.opts.batchPublish,b=JV([c]);if(w)this.sendRpcInBatch(g,b);else for(const _ of g){this.sendRpc(_,b)||g.delete(_)}const E=Date.now()-a;return null===(s=this.metrics)||void 0===s||s.onPublishMsg(e,y,g.size,null!=c.data?c.data.length:0,E),v&&(g.add(this.components.peerId.toString()),super.dispatchEvent(new _u("gossipsub:message",{detail:{propagationSource:this.components.peerId,msgId:d,msg:u}})),super.dispatchEvent(new _u("message",{detail:u}))),{recipients:Array.from(g.values()).map((e=>Mu(e)))}}sendRpcInBatch(e,t){const n=mV.encode(t),r=mg.single(n);for(const o of e){var i;const s=this.streamsOutbound.get(o);if(null!=s){try{s.pushPrefixed(r)}catch(fz){e.delete(o),this.log.error("Cannot send rpc to ".concat(o),fz)}null===(i=this.metrics)||void 0===i||i.onRpcSent(t,n.length)}else this.log("Cannot send RPC to ".concat(o," as there is no open stream to it available")),e.delete(o)}}reportMessageValidationResult(e,t,n){var r;let i;if(n===dV.Accept){if(i=this.mcache.validate(e),null!=i){const{message:n,originatingPeers:r}=i;this.score.deliverMessage(t,e,n.topic),this.forwardMessage(e,i.message,t,r)}}else if(i=this.mcache.remove(e),null!=i){const r=PV(n),{message:o,originatingPeers:s}=i;this.score.rejectMessage(t,e,o.topic,r);for(const t of s)this.score.rejectMessage(t,e,o.topic,r)}const o=this.score.messageFirstSeenTimestampMs(e);null===(r=this.metrics)||void 0===r||r.onReportValidation(i,n,o)}sendGraft(e,t){const n=JV([],{graft:[{topicID:t}]});this.sendRpc(e,n)}async sendPrune(e,t){const n=JV([],{prune:[await this.makePrune(e,t,this.opts.doPX,!0)]});this.sendRpc(e,n)}sendRpc(e,t){var n,r,i;const o=this.streamsOutbound.get(e);if(null==o)return this.log("Cannot send RPC to ".concat(e," as there is no open stream to it available")),!1;const s=this.control.get(e);null!=s&&(this.piggybackControl(e,t,s),this.control.delete(e));const a=this.gossip.get(e);null!=a&&(this.piggybackGossip(e,t,a),this.gossip.delete(e));const l=mV.encode(t);try{o.push(l)}catch(fz){return this.log.error("Cannot send rpc to ".concat(e),fz),null!=s&&this.control.set(e,s),null!=a&&this.gossip.set(e,a),!1}if(null===(n=this.metrics)||void 0===n||n.onRpcSent(t,l.length),null!=(null===(r=t.control)||void 0===r?void 0:r.graft))for(const h of null===(c=t.control)||void 0===c?void 0:c.graft){var c;null!=h.topicID&&this.safeDispatchEvent("gossipsub:graft",{detail:{peerId:e,topic:h.topicID,direction:"outbound"}})}if(null!=(null===(i=t.control)||void 0===i?void 0:i.prune))for(const h of null===(u=t.control)||void 0===u?void 0:u.prune){var u;null!=h.topicID&&this.safeDispatchEvent("gossipsub:prune",{detail:{peerId:e,topic:h.topicID,direction:"outbound"}})}return!0}piggybackControl(e,t,n){const r=$V(t);for(const l of n.graft){var i,o;null!=l.topicID&&null!==(i=null===(o=this.mesh.get(l.topicID))||void 0===o?void 0:o.has(e))&&void 0!==i&&i&&r.control.graft.push(l)}for(const l of n.prune){var s,a;null==l.topicID||null!==(s=null===(a=this.mesh.get(l.topicID))||void 0===a?void 0:a.has(e))&&void 0!==s&&s||r.control.prune.push(l)}}piggybackGossip(e,t,n){$V(t).control.ihave=n}async sendGraftPrune(e,t,n){const r=this.opts.doPX,i=!1;for(const[o,s]of e){const e=s.map((e=>({topicID:e})));let a=[];const l=t.get(o);null!=l&&(a=await Promise.all(l.map((async e=>{var t;return this.makePrune(o,e,r&&!(null!==(t=n.get(o))&&void 0!==t&&t),i)}))),t.delete(o)),this.sendRpc(o,JV([],{graft:e,prune:a}))}for(const[o,s]of t){const e=await Promise.all(s.map((async e=>{var t;return this.makePrune(o,e,r&&!(null!==(t=n.get(o))&&void 0!==t&&t),i)})));this.sendRpc(o,JV([],{prune:e}))}}emitGossip(e){const t=this.mcache.getGossipIDs(new Set(e.keys()));for(const[r,i]of e){var n;this.doEmitGossip(r,i,null!==(n=t.get(r))&&void 0!==n?n:[])}}doEmitGossip(e,t,n){if(0===n.length)return;if(ez(n),n.length>yV&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",n.length),0===t.size)return;let r=this.opts.Dlazy;const i=.25*t.size;let o=t;i>r&&(r=i),r>o.size?r=o.size:o=ez(Array.from(o)).slice(0,r),o.forEach((t=>{let r=n;n.length>yV&&(r=ez(r.slice()).slice(0,yV)),this.pushGossip(t,{topicID:e,messageIDs:r})}))}flush(){for(const[e,t]of this.gossip.entries())this.gossip.delete(e),this.sendRpc(e,JV([],{ihave:t}));for(const[e,t]of this.control.entries()){this.control.delete(e);const n=JV([],{graft:t.graft,prune:t.prune});this.sendRpc(e,n)}}pushGossip(e,t){var n;this.log("Add gossip to %s",e);const r=null!==(n=this.gossip.get(e))&&void 0!==n?n:[];this.gossip.set(e,r.concat(t))}async makePrune(e,t,n,r){var i;if(this.score.prune(e,t),(null===(i=this.streamsOutbound.get(e))||void 0===i?void 0:i.protocol)===pV)return{topicID:t,peers:[]};const o=r?this.opts.unsubcribeBackoff:this.opts.pruneBackoff,s=o/1e3;if(this.doAddBackoff(e,t,o),!n)return{topicID:t,peers:[],backoff:s};const a=this.getRandomGossipPeers(t,this.opts.prunePeers,(t=>t!==e&&this.score.score(t)>=0)),l=await Promise.all(Array.from(a).map((async e=>{var t;const n=Mu(e);let r;try{r=await this.components.peerStore.get(n)}catch(i){if("ERR_NOT_FOUND"!==i.code)throw i}return{peerID:n.toBytes(),signedPeerRecord:null===(t=r)||void 0===t?void 0:t.peerRecordEnvelope}})));return{topicID:t,peers:l,backoff:s}}async heartbeat(){var e,t;const{D:n,Dlo:r,Dhi:i,Dscore:o,Dout:s,fanoutTTL:a}=this.opts;this.heartbeatTicks++;const l=new Map,c=e=>{let t=l.get(e);return void 0===t&&(t=this.score.score(e),l.set(e,t)),t},u=new Map,h=new Map,d=new Map;this.clearBackoff(),this.peerhave.clear(),null===(e=this.metrics)||void 0===e||e.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks===0&&await this.directConnect(),null===(t=this.fastMsgIdCache)||void 0===t||t.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();const f=new Map;this.mesh.forEach(((e,t)=>{const a=this.topics.get(t),l=new Set,p=new Set;if(f.set(t,p),null!=a){const n=ez(Array.from(a)),r=this.backoff.get(t);for(const t of n){const n=this.streamsOutbound.get(t);if(null!=n&&this.multicodecs.includes(n.protocol)&&!e.has(t)&&!this.direct.has(t)){const e=c(t);(null==r||!r.has(t))&&e>=0&&l.add(t),e>=this.opts.scoreThresholds.gossipThreshold&&p.add(t)}}}const g=(n,r)=>{var i;this.log("HEARTBEAT: Remove mesh link to %s in %s",n,t),this.addBackoff(n,t),e.delete(n),c(n)>=this.opts.scoreThresholds.gossipThreshold&&p.add(n),null===(i=this.metrics)||void 0===i||i.onRemoveFromMesh(t,r,1);const o=h.get(n);null==o?h.set(n,[t]):o.push(t)},y=(n,r)=>{var i;this.log("HEARTBEAT: Add mesh link to %s in %s",n,t),this.score.graft(n,t),e.add(n),p.delete(n),null===(i=this.metrics)||void 0===i||i.onAddToMesh(t,r,1);const o=u.get(n);null==o?u.set(n,[t]):o.push(t)};if(e.forEach((e=>{const n=c(e);n<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",e,n,t),g(e,IV.BadScore),d.set(e,!0))})),e.size<r){const t=function(e,t){return FV(e,t,(()=>!0))}(l,n-e.size);t.forEach((e=>{y(e,AV.NotEnough)}))}if(e.size>i){let t=Array.from(e);t.sort(((e,t)=>c(t)-c(e))),t=t.slice(0,o).concat(ez(t.slice(o)));let r=0;if(t.slice(0,n).forEach((e=>{var t;null!==(t=this.outbound.get(e))&&void 0!==t&&t&&r++})),r<s){const e=e=>{const n=t[e];for(let r=e;r>0;r--)t[r]=t[r-1];t[0]=n};if(r>0){let i=r;for(let r=1;r<n&&i>0;r++){var v;null!==(v=this.outbound.get(t[r]))&&void 0!==v&&v&&(e(r),i--)}}let i=n-r;for(let r=n;r<t.length&&i>0;r++){var m;null!==(m=this.outbound.get(t[r]))&&void 0!==m&&m&&(e(r),i--)}}t.slice(n).forEach((e=>{g(e,IV.Excess)}))}if(e.size>=r){let t=0;if(e.forEach((e=>{var n;null!==(n=this.outbound.get(e))&&void 0!==n&&n&&t++})),t<s){FV(l,s-t,(e=>!0===this.outbound.get(e))).forEach((e=>{y(e,AV.Outbound)}))}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks===0&&e.size>1){const n=Array.from(e).sort(((e,t)=>c(e)-c(t))),r=Math.floor(e.size/2),i=c(n[r]);if(i<this.opts.scoreThresholds.opportunisticGraftThreshold){const e=FV(l,this.opts.opportunisticGraftPeers,(e=>c(e)>i));for(const n of e)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",n,t),y(n,AV.Opportunistic)}}}));const p=Date.now();this.fanoutLastpub.forEach(((e,t)=>{e+a<p&&(this.fanout.delete(t),this.fanoutLastpub.delete(t))})),this.fanout.forEach(((e,t)=>{const r=this.topics.get(t);e.forEach((t=>{var n;(null===(n=null===r||void 0===r?void 0:r.has(t))||void 0===n||!n||c(t)<this.opts.scoreThresholds.publishThreshold)&&e.delete(t)}));const i=this.topics.get(t),o=[],s=new Set;if(f.set(t,s),null!=i){const t=ez(Array.from(i));for(const n of t){const t=this.streamsOutbound.get(n);if(null!=t&&this.multicodecs.includes(t.protocol)&&!e.has(n)&&!this.direct.has(n)){const e=c(n);e>=this.opts.scoreThresholds.publishThreshold&&o.push(n),e>=this.opts.scoreThresholds.gossipThreshold&&s.add(n)}}}if(e.size<n){const t=n-e.size;o.slice(0,t).forEach((t=>{e.add(t),null===s||void 0===s||s.delete(t)}))}})),this.emitGossip(f),await this.sendGraftPrune(u,h,d),this.flush(),this.mcache.shift(),this.dispatchEvent(new _u("gossipsub:heartbeat"))}getRandomGossipPeers(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;const r=this.topics.get(e);if(null==r)return new Set;let i=[];return r.forEach((e=>{const t=this.streamsOutbound.get(e);null!=t&&this.multicodecs.includes(t.protocol)&&n(e)&&i.push(e)})),i=ez(i),t>0&&i.length>t&&(i=i.slice(0,t)),new Set(i)}onScrapeMetrics(e){var t,n;e.mcacheSize.set(this.mcache.size),e.mcacheNotValidatedCount.set(this.mcache.notValidatedCount),e.cacheSize.set({cache:"direct"},this.direct.size),e.cacheSize.set({cache:"seenCache"},this.seenCache.size),e.cacheSize.set({cache:"fastMsgIdCache"},null!==(t=null===(n=this.fastMsgIdCache)||void 0===n?void 0:n.size)&&void 0!==t?t:0),e.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),e.cacheSize.set({cache:"mcache"},this.mcache.size),e.cacheSize.set({cache:"score"},this.score.size),e.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),e.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),e.cacheSize.set({cache:"topics"},this.topics.size),e.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),e.cacheSize.set({cache:"mesh"},this.mesh.size),e.cacheSize.set({cache:"fanout"},this.fanout.size),e.cacheSize.set({cache:"peers"},this.peers.size),e.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),e.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),e.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),e.cacheSize.set({cache:"gossip"},this.gossip.size),e.cacheSize.set({cache:"control"},this.control.size),e.cacheSize.set({cache:"peerhave"},this.peerhave.size),e.cacheSize.set({cache:"outbound"},this.outbound.size);let r=0;const i=Date.now();e.connectedPeersBackoffSec.reset();for(const u of this.backoff.values()){r+=u.size;for(const[t,n]of u.entries())this.peers.has(t)&&e.connectedPeersBackoffSec.observe(Math.max(0,n-i)/1e3)}e.cacheSize.set({cache:"backoff"},r);for(const[u,h]of this.topics)e.topicPeersCount.set({topicStr:u},h.size);for(const[u,h]of this.mesh)e.meshPeerCounts.set({topicStr:u},h.size);const o=[],s=new Map;e.behaviourPenalty.reset();for(const u of this.peers.keys()){var a,l;const t=this.score.score(u);o.push(t),s.set(u,t),e.behaviourPenalty.observe(null!==(a=null===(l=this.score.peerStats.get(u))||void 0===l?void 0:l.behaviourPenalty)&&void 0!==a?a:0)}e.registerScores(o,this.opts.scoreThresholds),e.registerScorePerMesh(this.mesh,s);const c=function(e,t,n,r,i){const o={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(const s of e){const e=t.get(s);if(null!=e){const t=WV(s,e,n,r,i);for(const[e,n]of t.byTopic){let t=o.byTopic.get(e);null==t&&(t={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},o.byTopic.set(e,t)),t.p1w.push(n.p1w),t.p2w.push(n.p2w),t.p3w.push(n.p3w),t.p3bw.push(n.p3bw),t.p4w.push(n.p4w)}o.p5w.push(t.p5w),o.p6w.push(t.p6w),o.p7w.push(t.p7w),o.score.push(t.score)}else o.p5w.push(0),o.p6w.push(0),o.p7w.push(0),o.score.push(0)}return o}(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,e.topicStrToLabel);e.registerScoreWeights(c)}}je(sz,"multicodec",gV);Symbol.for("@libp2p/transport");var az;!function(e){e[e.FATAL_ALL=0]="FATAL_ALL",e[e.NO_FATAL=1]="NO_FATAL"}(az||(az={}));const lz={list:["/dns4/ipfs.le-space.de/tcp/443/wss/p2p/12D3KooWAJjbRkp8FPF5MKgMU53aUTxWkqvDrs4zc1VMbwRwfsbE"]},cz={addresses:{listen:["/webrtc","/webtransport","/wss","/ws"]},transports:[_T({filter:bT}),sT({rtcConfiguration:{iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}]}}),oT(),RT(),vS({discoverRelays:1})],connectionEncryption:[$b()],transportManager:{faultTolerance:az.NO_FATAL},streamMuxers:[TE()],connectionGater:{denyDialMultiaddr:()=>!1},peerDiscovery:[j_(lz),function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>new cV(t,e)}({interval:1e4,topics:["dcontact._peer-discovery._p2p._pubsub"],listenOnly:!1})],services:{ping:JA({protocolPrefix:"dContact"}),identify:JS(),autoNAT:c_(),dcutr:IS(),pubsub:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=>new sz(t,e)}({allowPublishToZeroTopicPeers:!0,canRelayMessage:!0})}};class uz extends I.Component{async componentDidMount(){console.log("component mounted");let e=new xn("./helia-blocks"),t=new Lr("./helia-data");const n=await qg(cz),r=await BT({blockstore:e,datastore:t,libp2p:n});await aF.connect(r),window.store=aF,n.addEventListener("connection:open",(async e=>{console.log("connection:open",e.detail.remoteAddr.toString())})),n.addEventListener("connection:close",(e=>{console.log("connection:close",e)}))}async componentWillUnmount(){aF.odb&&await aF.odb.stop(),aF.ipfs&&await aF.ipfs.stop()}render(){return(0,$F.jsxs)("div",{children:[(0,$F.jsx)("pre",{children:"      .-``'.  \ud83d\udcfb                            \ud83d\udcfb  .'''-."}),(0,$F.jsx)("pre",{children:"    .`   .`       ~ O R B I T   W A V E S ~      `.   '."}),(0,$F.jsxs)("pre",{children:["_.-'     '._ ",(0,$F.jsx)("a",{href:"https://github.com/orbitdb/web3-workshop/",children:"github.com/orbitdb/web3-workshop/"})," _.'     '-._"]}),(0,$F.jsxs)(Me,{children:[(0,$F.jsx)(Le,{path:"/orbitdb/:hash/:name",element:(0,$F.jsx)(sV,{store:aF})}),(0,$F.jsx)(Le,{exact:!0,path:"/",element:(0,$F.jsx)(nV,{store:aF})})]})]})}}const hz=uz,dz=e=>{e&&e instanceof Function&&n.e(453).then(n.bind(n,6453)).then((t=>{let{getCLS:n,getFID:r,getFCP:i,getLCP:o,getTTFB:s}=t;n(e),r(e),i(e),o(e),s(e)}))};R.createRoot(document.getElementById("root")).render((0,$F.jsx)(pF,{children:(0,$F.jsx)(hz,{})})),dz()})()})();
//# sourceMappingURL=main.4c494121.js.map